description,issue_type,key,labels,summary
"While looking for ways to influence report generation (to manipulate the types being reported by resources in MODULES-5970), a problematic line was discovered inside the metric calculation at [https://github.com/puppetlabs/puppet/blob/5c092467789093d87228c1f471a469d314e3ae4f/lib/puppet/transaction/report.rb#L462:]

 
{code:java} type = Puppet::Resource.new(name).type{code}
 

A new resource is being created solely to resolve its type name, which is already available inside the status object.

That code originated in Feb 27, 2010 from lak at [https://github.com/puppetlabs/puppet/commit/9919b14f262c994a58eb202cda408f1b90d728e0]

 

At that point in time, resource_type was not part of the status object - [https://github.com/puppetlabs/puppet/blob/9919b14f262c994a58eb202cda408f1b90d728e0/lib/puppet/resource/status.rb]

resource_type was later added in [https://github.com/puppetlabs/puppet/commit/1f72c31f9e0223e71e2729da96e0e98ebea5417e] for Puppet 1.5.2 in Dec 30, 2010, at which point the code above could have been refactored, but never was

 

The fix here should be a simple replacement of the call to generate a new resource with use of the already reported type.",Improvement,PUP-8746,[],Improve time_metrics in report generation to use existing statuses
"h1.  The Problem

Passing a type alias to the match function results in an error.  

Example Code: 

https://github.com/npwalker/regex_variable/blob/test_pattern_type_alias/manifests/profile/test.pp#L14

And example error:

{code}
error during compilation: Evaluation Error: Error while evaluating a Method call, match() expects pattern of T, where T is String, Regexp, Regexp[r], Pattern[p], or Array[T]. Got Puppet::Pops::Types::PTypeAliasType (file: /home/travis/build/npwalker/regex_variable/spec/fixtures/modules/regex_variable/manifests/profile/test.pp, line: 14, column: 21) on node travis-job-npwalker-regex-variable-124411915.travisci.net
{code}

Which can been seen in travis as well: 

https://travis-ci.com/npwalker/regex_variable/jobs/124411915#L532",Bug,PUP-8745,[],The match function does not accept a type alias 
"h1. The Problem

If you use a variable from say your params class in a type of a parameter then whether or not you can parse that class depends on whether you included a class that loaded params before the class you use the variable in.  

Anyway here's an example: 

https://github.com/npwalker/regex_variable/blob/master/manifests/profile/test.pp#L8

h1.  Suggested solution

Either this should work every time or it should never work.  I'd be fine with detection of this behavior and an outright failure.  ",Bug,PUP-8744,[],Using a variable in a Type on a parameter results in an error unless the variable was already loaded
"{{devicedir}} (the root directory of devices) is a combination of /etc and /opt:

{code}
/opt/puppetlabs/puppet/cache/devices/*/

  clientbucket
  client_data
  client_yaml
  facts.d
  lib
  locales
  preview
  ssl
  state

/opt/puppetlabs/puppet/cache/

  clientbucket
  client_data
  client_yaml
  facts.d
  lib
  locals
  preview
  state

/etc/puppetlabs/puppet/

  ssl
{code}

When the proxy Puppet agent for a device is the master, and the user executes a backup and restore (manually, or as automated in OpsWorks), the certificate and keys in the {{ssldir}} in each {{devicedir}} are lost, requiring certificate regeneration for those devices.

We should either:

* Add these device {{ssldir}} directories to our backup model
* Move these device {{ssldir}} directories to /etc/puppetlabs",Improvement,PUP-8736,"['backup-restore', 'devices']",/opt/puppetlabs contains device ssldir(s) normally in /etc/puppetlabs
"*Puppet Version:* 5.5.1 (Win x64)
*Puppet Server Version:* N/A
*OS Name/Version:* Windows 10 - 1803

*Desired Behavior:*

Given a manifest saved as UTF8

{code}
file { ""c:\\install\\test\\Testing-wordsé"":
  ensure  => file,
  content => 'Testing é',
} ->

file { ""c:\\install\\test\\Testing-words-copyé"":
  ensure => file,
  source => ""c:\\install\\test\\Testing-wordsé"",
} ->

file { ""c:\\install\\test2"":
  ensure  => directory,
  source  => ""c:\\install\\test"",
    recurse => remote,
    replace => true,
}
{code}

It should create the files in the C:\install\test directory
It should copy the C:\install\test directory to C:\install\test2


*Actual Behavior:*

Puppet apply errors with;

{{Could not set 'file' on ensure: invalid byte sequence in UTF-8}}


Full trace dump in comments",Bug,PUP-8735,"['i18n', 'utf-8', 'windows']",File resource doesn't seem to parse UTF8 filenames when recursively copying directoies
"*NOTE*: If you have found your way to this issue based on troubleshooting an issue with the file_concat module, please see SERVER-40 for an easy workaround.

This issue was uncovered by SERVER-40.

There is a difference in how Kernel.load() and require interact when referencing the same Ruby file -- at least the file type -- under an MRI puppet master vs. Puppet Server, both running 3.7.1 core Ruby Puppet code and 1.9-based Ruby.

During settings initialization, both masters will perform a:

{code}
Kernel.load("".../lib/puppet/type/file.rb"", nil)
{code}

This causes the Puppet::Type::File type to be defined, as well as several related types, e.g., Puppet::Type::File::Owner, by virtue of ""file.rb"" doing _require 'puppet/type/file/*'_ calls.

Assuming a custom module which includes a _require 'puppet/type/file'_ call in some Ruby code is in place, the behavior when that line is exercised under MRI Ruby Puppet vs. Puppet Server during a catalog request differs.

Under the MRI Ruby Puppet master, the file require call does not result in the ""file.rb"" file being re-executed.

Under Puppet Server, however, the file require call does result in the ""file.rb"" file being re-executed.  The Puppet::Type::File type is subsequently redefined, causing the subordinate types like Puppet::Type::File::Owner to no longer be defined.  The ""file.rb"" file executes the _require 'puppet/type/file/..._ calls again but because JRuby's loader interprets the associated files as already having been executed, the files are not executed again and the Puppet::Type::File::* types are not redefined.  Any subsequent attempts to reference these subordinate types in code would, therefore, result in an error.

I suspect this may be showing a difference between how the caching behind Kernel.load() and Kernel.require() is linked under MRI Ruby vs. JRuby 1.9.  This will probably involve further research into the loaders for those respective runtimes.

To demonstrate this problem, I created the following custom function and placed it under ""<confdir>/<modules>/<modname>/lib/puppet/parser/functions/owner_defed_after_require.rb"" on the server:

{code}
require 'puppet/type/file'

module Puppet::Parser::Functions
  newfunction(:owner_defed_after_require, :type => :rvalue) do |args|
    Puppet.info ""owner_defed_after_require: enter""

    klass_defined = false
    if Object.const_defined?(""Puppet"")
      klass = Object.const_get(""Puppet"")
      if (klass.const_defined?(""Type""))
        klass = klass.const_get(""Type"")
        if (klass.const_defined?(""File""))
          klass_defined = klass.const_get(""File"").const_defined?(""Owner"")
        end
      end
    end

    Puppet.info ""owner_defed_after_require: exit (#{klass_defined})""
    klass_defined
  end
end
{code}

On the same server, I stored the following at ""<confdir>/manifests/site.pp"":

{code}
notify { 'owner_defed_after_require':
  message  => owner_defed_after_require()
}
{code}

When I performed a catalog request to the master, I saw ""true"" for the owner_defed_after_require message in the response for the MRI Ruby master vs. ""false"" for the same message in the response for the Puppet Server master.


",Bug,PUP-8733,[],File type redefined when required in code
"Currently Puppet Device pluginsync processes all items.  We should see if this can be limited to items that relate to Puppet Device.

This would benefit uses in pluginsync time and duplication of files, as a cache is maintained for  *each* node Puppet Device manages.",Improvement,PUP-8732,[],Investigate if Puppet Device pluginsync can be limited to remote modules
,Sub-task,PUP-8731,[],"Update specification of ""parameter scope"" to cover when types are asserted"
"*Puppet Version: 5.5.1*
 *OS Name/Version: Amazon Linux*

*Desired Behavior:*

{{report_instanceid and fastestmirror_enabled parameters can be set as parameters to a Yumrepo definition.}}

*Actual Behavior:*

*{{Error: no parameter named 'fastestmirror_enabled'}}*

*{{Error: no parameter named 'report_instanceid'}}*

 

*CAVEAT:*

report_instanceid is valid and very immediately desirable; however fastestmirror_enabled is defined in Amazon Linux, and supported by Chef already, but I am not convinced it does anything. I haven't yet found any applicable yum or fastestmirror plugin source code that consumes this parameter.

 ",New Feature,PUP-8730,[],Yumrepo Parameters: report_instanceid and fastestmirror_enabled
"Running a simple command line manifest does not interpret UTF8 characters correctly e.g.

From source...
{code}
C:\source\puppet [master ≡]> bundle exec puppet apply -e ""notify { 'ᚠᛇᚻ': }""
DL is deprecated, please use Fiddle
Notice: Compiled catalog for win-edson23cglf.localdomain in environment production in 0.08 seconds
Notice: ???
Notice: /Stage[main]/Main/Notify[???]/message: defined 'message' as '???'
Notice: Applied catalog in 0.06 seconds
{code}

Pup 4.4.1 installation
{code}
C:\>puppet --version
4.4.1

C:\>puppet apply -e ""notify { 'ᚠᛇᚻ': }""
Notice: Compiled catalog for win-edson23cglf.localdomain in environment production in 0.08 seconds
Notice: ???
Notice: /Stage[main]/Main/Notify[???]/message: defined 'message' as '???'
Notice: Applied catalog in 0.05 seconds
{code}",Bug,PUP-8729,"['i18n', 'utf-8']",Puppet does not accept UTF8 on the command line
"h1.  The Problem

Given the below code I would expect to get an error message back indicating that the test parameter didn't pass type validation but it instead causes failure in the function used in the parameter below. 

{code}
    function puppet_enterprise::calculate_log_temp_files(
      Variant[String, Integer] $work_mem,
    ) >> Integer {
      #work_mem is specified in kB if no memory unit is provided
      if $work_mem =~ /\A(\d+)(kB|MB|GB|TB)\Z/ {
    
        $wm_size = $work_mem.pe_size()
    
        $work_mem_integer = $work_mem[0, $wm_size - 2]
    
        $work_mem_suffix = $work_mem[$wm_size-2, $wm_size]
    
        $multiplier = $work_mem_suffix ? {
          'kb' => 1,
          'MB' => 1024,
          'GB' => 1024*1024,
          'TB' => 1024*1024*1024,
        }
    
        $log_temp_files = Integer($work_mem_integer * $multiplier)
      } else {
        $log_temp_files = Integer($work_mem)
      }
    }
    
    
    class my_class (
      Integer[64] $test,
      Integer     $blah = puppet_enterprise::calculate_log_temp_files($test),
    ) {
      #do things
    }
    
    class { 'my_class' :
      test => 63,
    }
{code}

Causes a failure like: 

{code}
    [root@master201811-centos ~]# puppet apply /tmp/test.pp
    Error: Evaluation Error: Left match operand must result in a String value. Got an Integer. (file: /tmp/test.pp, line: 5, column: 6) on node master201811-centos.puppetdebug.vlan
{code}

h1. Expected Behavior

If I fix the function so it doesn't fail then I get something like this which is the same thing I would expect since I don't expect the function to be evaluated if the first parameter doesn't pass type validation.  

{code}
    Error: Evaluation Error: Error while evaluating a Resource Statement, Class[My_class]:
      parameter 'test' expects an Integer[64] value, got Integer[63, 63]
{code}
",Bug,PUP-8728,[],A parameter that does not pass type validation can cause catalog compilation failure if used in the default expression of another parameter 
"Example resource:

{quote}user { 'dragos':
  ensure           => 'present',
  comment          => 'dragos',
  expiry           => '1970-01-01',
  gid              => '120',
  home             => '/home/dragos',
  password         => 'here-goes-a-hash',
  password_max_age => '99999',
  password_min_age => '0',
  shell            => '/bin/bash',
  uid              => '1003',
{quote}

If I'm setting the expiry via the manifests file as absent:

bq. expiry           => 'absent',

, will cause a --noop run to report that the current expiry value should be absent:

bq. Notice: /Stage[main]/XXX::dragos/User[dragos]/expiry: current_value 1970-01-01, should be absent (noop)

, while an actual run will report an invalid expiry value:

bq. Notice: /Stage[main]/XXX::dragos/User[dragos]/expiry: undefined 'expiry' from '1970-01-01'

The goal is to be able to remove the account expire date, for an account that already has a value set.
",Improvement,PUP-8727,"['help_wanted', 'linux', 'maintenance', 'triaged', 'user']",Unclear message when removing user expiry
"Required - newer masters supporting agent lookup and rich data types must be able to talk to newer agents which also support these features, and older agents that don't (content negotiation).",Task,PUP-8726,[],Agent Functions - Content negotiation of rich data types to old/new agents
Once PUP-8724 is complete audit against PuppetDB to ensure uniformity.,Task,PUP-8725,[],Agent Functions - Check Puppet Type Specifications against PDB 
Update/Create a specification of Puppet Types and their ranges.,Task,PUP-8724,[],Agent Functions - Create/Update specification of Puppet Types
"Create deferred evaluation that calls into Vault to retrieve secrets.  
 * What is the performance impact evaluation? 
 * Where's the performance impact?  Is it in Puppet?  Is it in Vault
 * What's the reference architecture for Vault deployment with Puppet?",Task,PUP-8723,[],Agent Functions - Create Vault deferred evaluation
Research ticket to understand and design Vault integration for Agent Lookup.,Task,PUP-8722,[],Agent Functions - Spike research Vault integration
Set up an internal server for testing. This just for initial implementation research.,Task,PUP-8721,[],Agent Functions - Set up Vault Server internally for testing
"This was brought up as a concern during our design session. 
 * What rich facts need to be added?
 * From rich facts stored in PuppetDB what will likely be queried so we can optimize

 ",Task,PUP-8720,[],Agent Functions - Research Adding rich facts
"There were some concerns about the implications rich data will have on reporting.  Examples:
 * Catalogs during compilation
 * Reports during the run
 * more..",Task,PUP-8719,[],Agent Functions - Research report implications of rich data
"Reach out to users in the field using the existing features.  Report back on functionality.
 * How is it being used?
 * What type of data is being stored?
 * What's working well?
 * What could use some improvement?
 * Are there any observed performance bottlenecks",Task,PUP-8718,[],Agent Functions - Gather feedback from users using rich data.
"Create/Update rich data format.  The assumption is that the Agent Lookup functionality will work with the current PuppetDB schema, but it needs further documentation.",Task,PUP-8717,[],Agent Functions - Document Rich Data format in PuppetDB
"After PUP-7398 was shipped with 5.4 and 2018.1, we can remove {{puppet module generate}} functionality completely for puppet6.",Improvement,PUP-8716,[],Remove puppet module generate functionality
"Since PUP-8501 at least the logstash reporter ([https://de.slideshare.net/pkill/puppetconf-2015-puppet-reporting-with-elasticsearch-logstash-and-kibana]) does not work anylonger. The puppetserver process will throw an error:
{code:java}2018-05-07 08:41:59,449 ERROR [qtp2051514142-117] [puppetserver] Puppet Failed to write to dashboard.puppet.syseleven.de on port 5603: undefined method `delete' for #<JSON::Ext::Generator::State:0x4da746a8> {code}
[https://github.com/elastic/puppet-logstash-reporter/blob/master/lib/puppet/reports/logstash.rb#L61]

 

The corresponding code that changed is the new monkey patched json.rb that is now used when using `require 'json'`, [https://github.com/puppetlabs/puppet/blob/6b5bb8aaaf1b54e025b2003d83844450a1800bf6/lib/puppet/util/json.rb#L72] is the line that is actually failing now.

 

 ",Bug,PUP-8715,[],monkey patched json.rb breaks code using json gem
"OS: Centos7 1804

Install: Puppet agent 5.5.1

Puppet Server: 5.3.1-1

systemd Config: ExecStart=/opt/puppetlabs/puppet/bin/puppet agent $PUPPET_EXTRA_OPTS --no-daemonize

Process: /opt/puppetlabs/puppet/bin/ruby /opt/puppetlabs/puppet/bin/puppet agent --no-daemonize

 

Problem:

After a network failure puppet agent try to connect to the puppet server (and it can not do it since there is a network problem) getting errror (it is expected): 

 Unable to fetch my node definition, but the agent run will continue:
Failed to open TCP connection to puppet5:8140 (getaddrinfo: Name or service noi known)

 

After network is back puppet runs every 30 mins but it still give the same error even though the network service is re-establish

I can telnet puppet 8140.

IF I run manually ""puppet agent -t"" it is successful but the systemd process is still failing.

If the systemd service runs normally it fails.

The ONLY option to make it work is to perform a ""systemctl restart puppet""

I perform a tcpdump on port 8140 but nothig is coming out of the systemd process, so it seems as it is stuck with its failure.

 

Expected Way of working:

After network recovery the  pupept agent should connect to the server. It works fine if doing manually and only solution is to restart the process which then works fine.",Bug,PUP-8714,"['daemon', 'networking', 'triaged']",Puppet Agent doesn't recover from network failure
"h2. Overview
Would like to be able to lock *and unlock* user accounts using puppet (or with manual unlock).

h2. See Summary
https://projects.puppetlabs.com/issues/219 from 8 years ago

h2.  Current workaround
Presently, users can lock a password by setting {{password => '*'}} or similar.  The problem with doing this is that the user cannot then be unlocked with {{passwd -u} as the above code will have destroyed the original password.

h2. Customer impact
While in many cases, its simple to reset a password rather then unlock it, there are cases, however-much we disapprove of them, where this could be a problem.

For example, where the password is being used remotely and is incorporated into other scripts and systems or where passwords are controlled by systems such as cyberark where the reset process is non-trivial or slow due to external process hardening.",New Feature,PUP-8713,"['linux', 'redmine', 'triaged', 'type_and_provider', 'user']",Would like to be able to lock (and unlock) users
"We added a deprecation warning when running {{puppet master}}, but if you run {{puppet master --configprint}} it exits before the deprecation warning is emitted. Since we're removing the master application in 6.0, we need to emit a deprecation warning in 5.y for the configprint case, and say to use {{puppet config print [setting] --section master}} instead. /cc [~nick.walker]",Task,PUP-8712,[],Add deprecation warning for puppet master --configprint
"Many modern infrastructures make use of key-value stores like Conjur by CyberArk, Consul and Vault by Hashicorp, or Apache Zookeeper. These services keep track of rapidly-changing information like the list of servers currently active in an application pool as well as provide a central, access-controlled distribution point for sensitive data like access tokens, login credentials, and encryption keys.

This epic tracks work towards a feature with the working title of ""Agent Lookups"", which provides a natural, intuitive interface to these services. The agent consults the service as it applies the catalog, providing credentials if needed, and injects the result of the lookup into the appropriate place on the host. ",Epic,PUP-8711,[],Implement Agent Functions to support secret lookups at catalog application time
"I'm a Puppet practitioner with tens of thousands of systems who wants to reduce load on my Puppet infrastructure, so I'm using use_cached_catalog = true. However, sometimes intrinsic information (facts) changes necessitate a new catalog. (Let's say state needs to change when uptime, free disk space or available memory crosses some threshold, but it could be any change in any fact)

I want to instruct puppet agents on one or more systems to watch specific facts, and if those cross some threshold, request a new catalog from the Puppet infrastructure (and not use the cached catalog). Continuing the earlier example, let's say we're watching disk free space. At the start, free disk space would be high and the cached catalog would be used exclusively. At some point, the free disk space would diminish and puppet would request a new catalog when the disk is 80% full. At 80% full, it would run with the new cached catalog for a period of time.  Let us assume that at some point, space frees up. When it crosses 80% going the other direction, the puppet agent would request a new catalog.

With respect to implementation, I don't know if this is something that would go into Puppet DSL (probably best option from a workflow/accountability perspective, or if it would go into the puppet agent as perhaps a config option (my assumption). 

The impact of this feature not being present is that Puppet users fall into bad habits with cached catalogs and run execs to check facter (or other values) as a sub-optimal way to accomplish what is being asked here.",New Feature,PUP-8710,[],Smarter cached catalogs
"The following puppet snippet results in endless recursion
{code:puppet}
type StringData = Variant[String, Numeric, Iterable[StringData], Hash[StringData, StringData]]
notice([1,2,3] =~ Iterable[StringData])
{code}

It should have noticed {{true}}",Bug,PUP-8709,"['Language', 'typesystem']",Iterable[T] with recursive type T results in endless recursion
"*Puppet Version:5.5.0*
 *Puppet Server Version:5.5.0*
 *OS Name/Version: Ubuntu:18.04*

While running the test cases using a root user I am facing below test case failure.
 Failures details:

1) Puppet::Type::File::ParameterSource#validate should strip trailing forward slashes
 Failure/Error: expect(resource[:source]).to eq(%w\{file:/foo/bar\\})

expected: [""file:/foo/bar\\""]
 got: [""file:///foo/bar\\""]

(compared using ==)
 # ./spec/unit/type/file/source_spec.rb:47:in `block (3 levels) in <top (required)>'
 # ./spec/unit/type/file/source_spec.rb:13:in `block (3 levels) in <top (required)>'
 # ./lib/puppet/context.rb:65:in `override'
 # ./lib/puppet.rb:260:in `override'
 # ./spec/unit/type/file/source_spec.rb:12:in `block (2 levels) in <top (required)>'

Finished in 22.97 seconds (files took 4.05 seconds to load)
3500 examples, 1 failure, 1 pending

Failed examples:

rspec ./spec/unit/type/file/source_spec.rb:45 # Puppet::Type::File::ParameterSource#validate should strip trailing forward slashes

 

 

Please let me know how do I proceed further or if anything more needs to be done.

Thanks in Advance",Bug,PUP-8708,[],Test Case Failure Encountered
"This epic contains tickets related to the new REST client we are adding to Puppet, backed by the third-party [HTTPClient gem|https://github.com/nahi/httpclient].",Epic,PUP-8706,[],HTTPClient in Puppet
"Currently, Puppet::Rest::Client does not do any SRV lookups, unlike the other indirector-based HTTP client in Puppet. We need to implement this, once we fully understand the tradeoffs between performance and the need to restrict caching due to the nature of SRV lookups.

A quick look at the current implementation (https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/request.rb#L187-L197 and https://github.com/puppetlabs/puppet/blob/master/lib/puppet/network/resolver.rb#L8-L41) makes it look as though DNS::Resolv objects and SRV lookups are performed on every request. We need to evaluate whether this is necessary, or more could be done to cut down on work that must be done per-request.",Task,PUP-8705,[],Add SRV record support to Puppet::Rest::Client
"*Puppet Version:* Anything since 4.0.0-rc1
*Puppet Server Version:* n/a
*OS Name/Version:* n/a

In code inspection we found that {{to_hierayaml}} does not properly escape the resource's title in https://github.com/puppetlabs/puppet/blob/c99148fc86bfb7da15947e9f70aab2a3b55f941b/lib/puppet/resource.rb#L429

*Desired Behavior:*

{{puppet resource --to_yaml exec ""/bin/echo foo: bar""}} creates valid YAML output.

*Actual Behavior:*

{{puppet resource --to_yaml exec ""/bin/echo foo: bar""}} creates invalid YAML output:

{code}
david@davids:~/git/puppet-resource_api$ puppet resource --to_yaml exec ""/bin/echo foo: bar""
exec:
  /bin/echo foo: bar:
    returns: 'notrun'
david@davids:~/git/puppet-resource_api$ puppet resource --to_yaml exec ""/bin/echo foo: bar"" | ruby -ryaml -e 'puts YAML.parse(STDIN).inspect'
Traceback (most recent call last):
	3: from -e:1:in `<main>'
	2: from /usr/lib/ruby/2.5.0/psych.rb:350:in `parse'
	1: from /usr/lib/ruby/2.5.0/psych.rb:402:in `parse_stream'
/usr/lib/ruby/2.5.0/psych.rb:402:in `parse': (<unknown>): mapping values are not allowed in this context at line 2 column 21 (Psych::SyntaxError)
david@davids:~/git/puppet-resource_api$ 
{code}

The Resource API has fixed that in https://github.com/puppetlabs/puppet-resource_api/pull/77/commits/478c9254238749d9af8a1633b53f95ed1a01dcde",Bug,PUP-8704,[],resource.rb: to_hierayaml does not escape the title
"The {{Numeric}} data type when given the string ""0"" will fail because it attempts to look at the second char in the string - if it is a downcased 'b' or 'x' - and this fails since there is nothing to downcase.",Bug,PUP-8703,[],Numeric('0') raises an error
"The existing HTTP client code in Puppet had the capability to stream responses bolted on fairly late. For this new client, we should make sure that streaming is built into the design. HTTPClient provides an API for chunking responses (https://github.com/nahi/httpclient/blob/master/lib/httpclient.rb#L69-L73) that we should be able to incorporate fairly easily. Because it does not return a raw response object, but rather checks status internally and throws an error if the response is bad, this will require us to change the way we do error handling, which is another argument (besides the obvious one around safety) for having all responses be streamed.",Improvement,PUP-8702,[],Allow (or maybe require) responses to be streamed from Puppet::Rest::Client
"*Puppet Version: 5.5*
 *Puppet Server Version:2018.1*
 *OS Name/Version: all*

Describe your issue in as much detail as possible…
`puppet help help help help help` is an ages old 'feature' of puppet help, it's an awesome ice breaker and demo tool for tasks etc. 

 

In seriousness the fix is incorrect it allows you to run:
puppet help
puppet help help
puppet help help help
puppet help help help help 

with no error and just the help page being served it only serves the error at the 5th help?

*Desired Behavior:*

Put it back, `puppet help help help help help` should render asci image
{code}$ puppet help help help help help

                 %%%%
                %%%%-(
              _%%%%%_/                        \ ' /
            _%%%%%%%%                        - (_) -
          _%%%%%%%/ \%                        / , \
         %%%%%%%%%\\ \_
           %%%%%%   \ \\
               )    /\_/
             /(___. \
             '----' (
            /       )
---....____/        (_____ __ _ ___ ___ __ _ _ _____ _ _ ___
          /         )---...___ =-= = -_= -=_= _-=_-_ -=- =-_
        ,'          (         ```--.._= -_= -_= _-=- -_= _=-
     ,-'            )                 ``--._=-_ =-=_-= _-= _
     '-._    '-..___(                       ``-._=_-=_- =_-=
         ``---....__)                            `-._-=_-_=-
               )|)|                                  `-._=-_
    gnv       '-'-.\_                                    `-.

    RELAX, TODAY IS THE FIRST DAY OF THE REST OF YOUR LIFE.

Error: Puppet help only takes two (optional) arguments: a subcommand and an action
Error: Try 'puppet help help help' for usage
{code}
puppet help help should render with colorization or with error to direct people to use the command on another subcommand. 

puppet help help help help help help ... should render warning

*Actual Behavior:*

nice error message appears 
{code:java}root@master:~ # puppet help help help help help
Error: The 'puppet help' command takes two (optional) arguments: a subcommand and an action
Error: Try 'puppet help help help' for usage {code}
 ",Bug,PUP-8701,[],Update to Puppet help in PUP-8646 removed 'help easter egg'; please put it back!
"*Puppet Version: 5.5.1*
 *Puppet Server Version: N/A*
 *OS Name/Version: Centos 7.4.1708*

Many `puppet` applications such as `puppet facts` and `puppet catalog` take a `–terminus` option to specify what indirector to use. These applications generally also specify a `–extra` argument, like so:

`--extra HASH                  - Extra arguments to pass to the indirection request`

As far as I can determine, this argument is not actually possible to use, since any argument supplied to the `–extra` option is treated by Ruby as a String. For example, `puppet facts --terminus network_device --extra '\{target => ""example-device""}'` results in `Error: Could not call 'find' on 'facts': undefined method `inject' for ""\{target => \""example-device\""}"":String`

The same results are had when trying other hash-ish syntaxes such as JSON or key-value pairs.

If there's some existing syntax that will actually work here, it should be documented. But I had a look through the source code, and I don't think any such syntax exists.

Describe steps to reproduce…

`puppet facts --terminus network_device --extra <anything at all here>`

*Desired Behavior:*

**The `–extra` argument should function, or should be removed.

*Actual Behavior:*

 

```

$ sudo puppet facts --terminus network_device --extra '\{target => ""example-device""}' --trace
Error: Could not call 'find' on 'facts': undefined method `inject' for ""\{target => \""example-device\""}"":String
Did you mean? inspect
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/request.rb:68:in `initialize'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `new'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `request'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:187:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:46:in `call_indirection_method'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:84:in `block (2 levels) in <class:Face>'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/interface/action.rb+eval[wrapper]:264:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/face_base.rb:247:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:661:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
Error: Could not call 'find' on 'facts': undefined method `inject' for ""\{target => \""example-device\""}"":String
Did you mean? inspect
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/request.rb:68:in `initialize'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `new'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `request'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:187:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:46:in `call_indirection_method'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:84:in `block (2 levels) in <class:Face>'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/interface/action.rb+eval[wrapper]:264:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/face_base.rb:247:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:661:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
Error: Try 'puppet help facts find' for usage

```",Bug,PUP-8700,['commandline'],--extra cli option is nonfunctional
"Much like `puppet device --resource` roughly provides the behavior of `puppet resource` for network devices, there should be a `puppet device --facts` command that provides a feature analogous to `puppet facts`, but for network devices.",New Feature,PUP-8699,[],puppet device application should support outputting facts
"h3. *SUMMARY*

Generated module does not work when using templates. Seems to be dependency now to puppet-stdlib.
h3. *REPRODUCE*

 
{code:java}
$ puppet module generate foo/bar --skip-interview
$ mkdir bar/templates
$ cat <<-EOF > bar/templates/index.html.erb
<html>
  <body>
    <h1>hello world</h1>
  </body>
</html>
EOF
$ cat <<-EOF > bar/manifests/init.pp
class bar {
  package { 'apache2':
    ensure => present,
  }
  service { 'apache2':
    ensure => running,
    enable => true,
  }
  file { '/var/www/html/index.html':
    content => template('bar/index.html.erb'),
  }
}
EOF
$ sudo puppet apply --modulepath=. -e 'include ::bar'{code}
 
h3. *DESIRED BEHAVIOR*

Expected that I would have a functional module.
h3. *ACTUAL BEHAVIOR*

 
{code:java}
Warning: ModuleLoader: module 'bar' has unresolved dependencies - it will only see those that are resolved. Use 'puppet module list --tree' to see information about modules\n (file & line not available) 
Notice: Compiled catalog for controlrepo.test in environment production in 0.61 seconds 
Notice: /Stage[main]/Bar/File[/var/www/html/index.html]/content: content changed '{md5}c32ad802df5abca941d784abf642e7fd' to '{md5}2d60ab375367b3e2996c7c1803009d55' 
Notice: Applied catalog in 0.08 seconds
{code}
h3. *NOTES*

When I run the module list command, I get this:

 

 
{code:java}
$ sudo puppet module list --tree --modulepath=. 
Warning: Missing dependency 'puppetlabs-stdlib': 'foo-bar' (v0.1.0) requires 'puppetlabs-stdlib' (>= 1.0.0) 
/vagrant/scratch 
└─┬ foo-bar (v0.1.0) 
  └── UNMET DEPENDENCY puppetlabs-stdlib (>= 1.0.0)
{code}
 ",Bug,PUP-8698,[],puppet module generate broken w/o stdlib
"We should write some RSpec tests that exercise {{Puppet::Rest::Client}} to make real HTTP requests using the HTTPClient backing library against a fake server. This ticket includes doing the research to figure out a good library for standing up mock HTTP servers in Ruby unit tests.

Update: we are already pulling in both WebMock and VCR, which both seem like good options. I think it makes sense to use WebMock for generic testing of the client, and then we can consider using VCR to test the real endpoints, e.g. for downloading certs and CRLs, unless we feel that is already sufficiently covered in puppetserver tests or beaker acceptance tests.",Task,PUP-8697,[],Write integration level test for Puppet::Rest::Client
"Puppet loses track of the current environment when calling the autoloader to load/find:

* applications
* features
* parent providers that haven't been loaded yet, e.g. {{openbsd}} which is a parent of {{freebsd}}, where {{freebsd}} is loaded first because of its name.
* termini

Puppet then falls back to the configured environment ({{Puppet[:environment]}}), which may not match the current environment ({{Puppet.lookup(:current_environment)}}). For the agent specifically, it means we sometimes use the configured environment's modulepath which has a higher precedence than our {{libdir}} containing pluginsync'ed files. This is a problem, because when we include {{vendor_modules}} in the {{basemodulepath}} (see PUP-8582), we don't want that to have higher precedence that the {{libdir}} as the agent might load a type/provider that is incompatible with the type that the master used during compilation.

To reproduce, create the following files on the master:

{noformat}
[root@yhw77y0zn0j776u ~]# tree /etc/puppetlabs/code/environments/production/
/etc/puppetlabs/code/environments/production/
├── data
├── environment.conf
├── hiera.yaml
├── manifests
│   └── site.pp
└── modules
    └── foo
        └── lib
            └── puppet
                ├── feature
                │   └── foo.rb
                ├── provider
                │   └── foo
                │       └── foo.rb
                └── type
                    └── foo.rb

10 directories, 6 files
[root@yhw77y0zn0j776u ~]# find /etc/puppetlabs/code/environments/production/{manifests,modules} -type f -print -exec cat {} \;
/etc/puppetlabs/code/environments/production/manifests/site.pp
foo { 'hi': }
/etc/puppetlabs/code/environments/production/modules/foo/lib/puppet/type/foo.rb
Puppet::Type.newtype(:foo) do
  newparam(:name, namevar: true)
  newproperty(:message)
end
/etc/puppetlabs/code/environments/production/modules/foo/lib/puppet/feature/foo.rb
Puppet.features.add(:foo, libs: ['pp'])
/etc/puppetlabs/code/environments/production/modules/foo/lib/puppet/provider/foo/foo.rb
Puppet::Type.type(:foo).provide(:foo) do
  confine :feature => :foo

  def message=(value)
    puts value
  end

  def message
    :absent
  end
end
{noformat}

On the agent which must be one a different host, create a bogus feature:

{noformat}
$ tree ~/.puppetlabs/etc/code/environments/production/modules
/Users/josh/.puppetlabs/etc/code/environments/production/modules
└── foo
    └── lib
        └── puppet
            └── feature
                └── foo.rb

4 directories, 1 file
$ cat ~/.puppetlabs/etc/code/environments/production/modules/foo/lib/puppet/feature/foo.rb
BOOM!!
{noformat}

The agent run will fail, with the path to the bogus feature:

{noformat}
$ bx puppet agent -t
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Retrieving locales
Info: Caching catalog for localhost
Error: Could not autoload puppet/feature/foo: /Users/josh/.puppetlabs/etc/code/environments/production/modules/foo/lib/puppet/feature/foo.rb:1: syntax error, unexpected end-of-input
Error: Failed to apply catalog: Could not autoload puppet/feature/foo: /Users/josh/.puppetlabs/etc/code/environments/production/modules/foo/lib/puppet/feature/foo.rb:1: syntax error, unexpected end-of-input
{noformat}",Bug,PUP-8696,[],Puppet loses track of the current environment
" 

*Desired Behavior:* When a manifest specifies ensure => stopped ** on a service in Windows that has dependent services, the service resource should be capable of stopping the dependent services to ensure that the requested service can be stopped.

*Actual Behavior:*

Currently the service resource does not understand dependent services. If a running service has dependent services that are still running, the stop command will fail.",Improvement,PUP-8695,"['service', 'windows']",Service resource on Windows should handle dependent services.
"When comparing Numeric to Timestamp or Timespan it does not work to compare with the Numeric value first:

{code:puppet}
1 < Timespan(2)
1 < Timestamp(2)
{code}
but works in reverse
{code:puppet}
Timespan(2) > 1
Timestamp(2) > 1
{code}

It should work both ways.",Bug,PUP-8694,[],"Comparison of Numeric to Timestamp/Timespan fails, but other way is ok"
"In PUP-8603, the functions min and max are added. For backwards compatibility reasons they must continue to compare values with unwanted/strange automatic type conversion. In order to give users a sane alternative those functions will accept a lambda to enable taking over the responsibility to compare. To facilitate that, a {{compare(a,b)}} function should be added that returns -1, 0, 1 depending on the order of the values.

In addition, when {{compare}} is given two strings, it should accept a third Boolean argument to control if string comparison ignores case (true - by default), or not.",New Feature,PUP-8693,[],Add a compare() function
"Please could you add a username / login for Yahel Vahaba, email 
[yahel.vahaba@iop.org|mailto:yahel.vahaba@iop.org]
He is taking the lead on the Puppet work here at IOPP
Thanks
 ",Task,PUP-8692,[],Please add a user to puppetlabs tickets
"HI Team,

 

im configuring the puppet master and client setup i have noticed the below error while runinng the puppet agent command from the below client node can you pls help on here.

 

root@puppetclient:/etc/puppetlabs/puppet# puppet agent -t
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: getaddrinfo: Name or service not known
Info: Retrieving pluginfacts
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': getaddrinfo: Name or service not known
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: getaddrinfo: Name or service not known
Info: Retrieving plugin
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': getaddrinfo: Name or service not known
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: getaddrinfo: Name or service not known
Error: Could not retrieve catalog from remote server: getaddrinfo: Name or service not known
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
Error: Could not send report: getaddrinfo: Name or service not known
root@puppetclient:/etc/puppetlabs/puppet#",Bug,PUP-8691,[],running agent fails with eval_generate error
"Since PUP-8655, PUP-8656, and PUP-8653 were all touching much of the same code, we opted to just merge the PRs as is and refactor overlapping interests after those had been merged. This ticket is to track that work and make sure it gets done.

Areas for refactor:

* Overlapping functionality in {{decode_cert_bundle}} from {{Puppet::SSL::DefaultValidator}}; probably need specific function for decoding crls and cert bundles
* Usage of {{PuppetSpec::SSL}} in spec tests for {{Puppet::SSL::DefaultValidator}}
* Factor out logic around verify mode for HTTP connections, for use by {{Rest::Client}} and {{SSL::DefaultValidator}}",Sub-task,PUP-8690,[],Refactor Puppet::SSL::* methods and spec tests
"As part of the work to support the intermediate CA, we have decided to experiment with using a third part library for making HTTP requests from the puppet-agent. For now the new client should only be used for SSL bootstrapping requests, but if it proves cleaner and easier, we should ultimately consider using this third-party implementation for all of Puppet's HTTP activity, in lieu of our own request pools.

*In Scope*
- establish a basic API for a new rest client in Puppet, backed by the HTTPClient ruby gem
- Incorporate whatever business logic -- like server/port selection and response processing -- is needed for making requests related to SSL bootstrapping",Improvement,PUP-8688,[],Use HTTPClient library for updates to Puppet's REST behavior
"The {{--logdest}} option is described like this:
{quote}A path ending with '.json' will receive structured output in JSON format. The log file will not have an ending ']' automatically written to it due to the appending nature of logging. It must be appended manually to make the content valid JSON.
{quote}
[https://puppet.com/docs/puppet/5.5/man/agent.html]

Instead of writing out invalid JSON that must be manually accounted for, we should write out newline-delimited JSON. There are libraries that can work with this file format rather than needing to manually account for the closing {{]}} each time you work with it.

* https://en.wikipedia.org/wiki/JSON_streaming#Line-delimited_JSON
* http://jsonlines.org
* http://ndjson.org/libraries.html",Improvement,PUP-8687,[],Should log JSON in newline-delimited format
"For each puppet resource type, e.g. {{file}}, the autoloader will attempt to load all providers for that type. The autoloader's {{loadall}} method will glob each directory in its autoloader search pat looking for files of the form {{puppet/provider/<type>}}. In a dev/bundler setup with no module there are about 100 directories to scan due to gems, etc.

The {{files_to_load}} method will return a list of relative paths, e.g. {{puppet/provider/type/file/posix.rb}}. The autoloader will then call {{load_file}} to load the file using it's relative path. The autoloader then searches the entire search space again! So we've got an O^2 thing going on.

The autoloader should preserve the absolute path of the provider it globbed, and try to load *that* file, instead of searching for it again. Making that change reduced the number of {{stat64}} calls from 1515 to 1146, so 25% less.",Bug,PUP-8686,[],Autoloader excessively stats files
"We currently use packaging's ""package:gem"" task to build the Puppet gem which adds a lot more complexity than we need (i.e. it builds a gemspec from data in project_data.yaml and then builds the corresponding default gem from it + any platform-specific gems [that might have platform-specific dependences]).

We should have the info. in project_data.yaml in the .gemspec file so that a simple gem build should do the trick.",Task,PUP-8685,['triaged'],Migrate gemspec info in project_data.yaml to the .gemspec file
"Currently when calling puppet (e.g `puppet facts`) you can override the directory from which custom facts in ruby are loaded (using the `--factdir` flag or the FACTERLIB environment variable), however it does not appear to be possible to customize the location from which external facts are loaded other than by editing facter.conf.

When calling `facter` directly as a command line tool, you can of course specify the `--external-dir` flag at the command line, but there is no equivalent flag when calling `puppet facts` (or `puppet agent`, `puppet catalog`, etc), nor is there an environment variable you can set to achieve this end.",Improvement,PUP-8684,"['configuration', 'facter', 'triaged']",Allow overriding Facter config (specifically external facts dir) when calling Puppet
"Puppet's http_read_timeout currently defaults to 0 which means infinite. If the agent sends an HTTP request and is waiting for a response, but the response never arrives (eg hard server crash, cable disconnect, router crash, etc), then the agent will hang indefinitely unless {{runtimeout}} is set to a non-zero default, or TCP keepalive detects if the connection is still valid.

In Puppet 6, we should change the {{http_read_timeout}} to something less. It also needs to be greater than the amount of time it takes the server to process catalog, report, etc requests.

We should also change the {{runtimeout}} to be something less than infinite as well.",Task,PUP-8683,[],Change http_read_timeout and runtimeout defaults to be less than infinite
When initializing Puppet as a library to handle master requests I do not want the settings catalog applied every time. There should be a setting that I can set when initializing Puppet that disables setting catalog compilation and application.,Improvement,PUP-8682,[],Allow disabling settings catalog
"Allow passing the ip address, short hostname, domain name, and/or full qualified hostname into Puppet when initializing settings.

Currently Puppet Server uses Puppet as a library and does not handle Facter fact look ups well. We can run Facter, or Puppet, or get this information from the JVM, on start up and pass this into Puppet when we initialize it in each JRuby instance. This would prevent multiple Facter calls for each JRuby initialization (which causes a huge performance hit when starting Puppet Server as well as intermittently during runtime. ",Improvement,PUP-8681,[],Allow passing the server_facts into Puppet when initializing settings.
"The problem of stuck agents during periods of network instability comes up often see for example PUP-1570 which was marked wontfix.

Network instability is a real problem, perhaps we cant fix the real problem but the symptoms and fall out can be better managed.

There's no conceivable reason for a puppet catalog application to take hours or days:

{code}
root     21490  2.6  1.2 281488 49480 ?        Ssl  Apr20   0:02 /opt/puppetlabs/puppet/bin/ruby /opt/puppetlabs/puppet/bin/puppet agent --no-daemonize
root      3050  0.0  2.3 397320 90968 ?        Sl   Apr26   0:08 puppet agent: applying configuration
{code}

Today is the 30th, surely the puppet agent that spawns the applier could detect this and kill the bad applier?

Worse, restarting puppet agent service does not resolve this:

{code}
% sudo service puppet restart
% ps -auxw|grep puppet
root      3050  0.0  2.3 397320 90968 ?        Sl   Apr26   0:08 puppet agent: applying configuration
root     21834 69.5  1.2 281772 49772 ?        Ssl  09:47   0:01 /opt/puppetlabs/puppet/bin/ruby /opt/puppetlabs/puppet/bin/puppet agent --no-daemonize
{code}

So when this happens there is no choice but to go to machines - or use bolt/choria/whatever - and kill these things off effectively manually.

I agree we cant fix the problem but how about doing better at managing it?",New Feature,PUP-8680,[],Puppet should supervise and kill its applying child if it gets stuck
"I am using theforeman/puppet 8.2.0 to manage Puppet which allows me to define the puppet-agent package version.  I tried upgrading from 5.3.3 to 5.5.1 and it's failing.

Below is relevant output from ""puppet agent --test --debug --trace"".  After the errors Puppet exits early and fails to continue with applying the catalog.

 
{noformat}
Debug: Package[puppet-agent](provider=yum): Ensuring => 5.5.1-1.el7
Debug: Package[puppet-agent](provider=yum): Detected Arch argument in package! - Moving arch to end of version string
Debug: Executing: '/bin/rpm -q puppet-agent --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n''
Debug: Package[puppet-agent](provider=yum): Upgrading package puppet-agent from version 5.3.3-1.el7 to 5.5.1-1.el7
Debug: Executing: '/bin/yum -d 0 -e 0 -y update puppet-agent-5.5.1-1.el7'
Debug: Executing: '/bin/rpm -q puppet-agent --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n''
Error: Could not convert change ensure to string: No such file or directory @ rb_sysopen - /opt/puppetlabs/puppet/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.0/lib/fast_gettext/vendor/empty.mo
File: /opt/puppetlabs/puppet/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.0/lib/fast_gettext/vendor/empty.mo
Debug: Storing state
Debug: Stored state in 0.17 seconds
Debug: Dynamically-bound server lookup failed, falling back to report_server setting
Debug: Dynamically-bound port lookup failed; falling back to report_port setting
Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: report supports formats: json pson yaml
Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: report supports formats: json pson yaml
Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: report supports formats: json pson yaml
Debug: Closing connection for https://puppet-test.ten.osc.edu:8140
Debug: Creating new connection for https://puppet-test.ten.osc.edu:8140
Debug: Starting connection for https://puppet-test.ten.osc.edu:8140
Debug: Caching connection for https://puppet-test.ten.osc.edu:8140
Debug: Closing connection for https://puppet-test.ten.osc.edu:8140
Error: No such file or directory @ rb_sysopen - /opt/puppetlabs/puppet/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.0/lib/fast_gettext/vendor/empty.mo
File: /opt/puppetlabs/puppet/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.0/lib/fast_gettext/vendor/empty.mo{noformat}",Bug,PUP-8679,[],Unable to update puppet-agent with Puppet
"We have a large Puppet footprint in our company. We have been using Puppet to provisioning our application servers for 6+ months. We are using a module from Puppet forge called orawls. Recently we upgraded orawls from version 2.0.6 to 2.0.15. While promoting the changes to one of our environments we encountered an error ""Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: no parameter named ....""

We spoke to the module owner and he stated that ""somehow the puppet types changes are not detected"". He suggested ""you need to restart all the PE services on the puppet master (this will flush the PE cache)"". The Puppet engineer restarted PE services but we continue to encounter the error.

How do we resolve this issue ?

Worth pointing out that when I execute this on a local Puppet ""learning"" VM I do not encounter any errors. 

 ",Bug,PUP-8678,[],Could not retrieve catalog from remote server: Error 500 on SERVER
"*Puppet Version: 5.3.3*
 *Puppet Server Version: 5.1.4*
 *OS Name/Version: RHEL 7.3*

Puppet's parsing of crontab can't handle certain files in /var/spool/cron.  We're seeing problems when when a file like ""#tmp.<OMIT HOSTNAME>.XXXXgblNI6"" exists in /var/spool/cron.

*Desired Behavior:*

Puppet would ignore tmp files in /var/spool/cron or files that don't map to usernames.

*Actual Behavior:*

 

Puppet dumps errors to stderr that crontab was executed incorrectly.

 

 

 
{noformat}
# puppet agent --test --noop
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Applying configuration version '1524775460'
crontab: option requires an argument -- 'u'
crontab: usage error: unrecognized option
Usage:
 crontab [options] file
 crontab [options]
 crontab -n [hostname]
Options:
 -u <user> define user
 -e edit user's crontab
 -l list user's crontab
 -r delete user's crontab
 -i prompt before deleting
 -n <host> set host in cluster to run users' crontabs
 -c get host in cluster to run users' crontabs
 -s selinux context
 -x <mask> enable debugging
Default operation is replace, per 1003.2
Notice: Applied catalog in 23.61 seconds
{noformat}
 

I don't know what is triggering the creation of these tmp files. I suspect users on this system are closing their SSH session without saving their edits to crontab.  Easy to reproduce:

1) Touch file: touch /var/spool/cron/#tmp.XXXXgblNI6

2) Run Puppet

 

From --debug not much more information is given:

 
{noformat}
Debug: Prefetching crontab resources for cron
Debug: looking for crontabs in /var/spool/cron
crontab: option requires an argument -- 'u'
crontab: usage error: unrecognized option
Usage:
 crontab [options] file
 crontab [options]
 crontab -n [hostname]
Options:
 -u <user> define user
 -e edit user's crontab
 -l list user's crontab
 -r delete user's crontab
 -i prompt before deleting
 -n <host> set host in cluster to run users' crontabs
 -c get host in cluster to run users' crontabs
 -s selinux context
 -x <mask> enable debugging
Default operation is replace, per 1003.2
{noformat}
 

 ",Bug,PUP-8677,[],Puppet can't parse cron when tmp files in /var/spool/cron
"It is expected that functions used for lazy evaluation will need to cache a connection to a backend to be able to handle multiple calls without reconnecting as that could be very slow.

This should be supported such that an {{InternalFunction}} is allowed to specify a {{cache_param}} in a dispatcher's list of parameters. When the function is called it will be given an adapter that supports a call on the format {{adapter.retrieve(self)}} to get the cache for the function. This will return a hash that can be mutated.

For those cases when there are several functions in need of using the same cache, they can collaborate by using the same object in the call to {{retrieve}} - typically one of the functions sharing the cache.

The lifecycle of the cache is the same as that of the compiler - i.e. one compilation when used master side, and the resolution of deferred values when used agent side.",New Feature,PUP-8676,[],Add cache support to 4.x function API
"If you attempt to use the {{\-\-section}} flag with an {{--}} argument using the config command, it will create a new section called {{[--]}} which will break the config command until it is removed.

{noformat}
[root@pe-20171nightly-agent ~]# puppet config --section -- set server false.pd.vlan
[root@pe-20171nightly-agent ~]# vi /etc/puppetlabs/puppet/puppet.conf
# This file can be used to override the default puppet settings.
# See the following links for more details on what settings are available:
# - https://docs.puppetlabs.com/puppet/latest/reference/config_important_settings.html
# - https://docs.puppetlabs.com/puppet/latest/reference/config_about_settings.html
# - https://docs.puppetlabs.com/puppet/latest/reference/config_file_main.html
# - https://docs.puppetlabs.com/puppet/latest/reference/configuration.html
[main]
server = pe-20171nightly-master.puppetdebug.vlan
certname = pe-20171nightly-agent.puppetdebug.vlan
[--]
server = false.pd.vlan

[root@pe-20171nightly-agent ~]# puppet config set server alt.pd.vlan
Error: Could not parse /etc/puppetlabs/puppet/puppet.conf: Could not match line [--]
 at /etc/puppetlabs/puppet/puppet.conf:10
{noformat}",Bug,PUP-8675,[],Attempting to use `puppet config --section -- set` breaks the config command.
"Puppet version *5.5.1* introduced new deprecations - specifically, deprecating Ruby versions 2.1.x and 2.2.x.  Per [SemVer docs|https://semver.org/#how-should-i-handle-deprecating-functionality], deprecations should introduce a new _minor_ version, not a new _patch_ version.",Bug,PUP-8673,[],Puppet 5.5.1 should not have changed the Ruby deprecations - deprecations should be introduced in a new minor version
"There is a memory leak introduced with i18n which is triggered when an environment is expired. If the environment was ephemeral and will never be used again, then the translation repository related to that environment will never be deleted.

Specifically https://github.com/puppetlabs/puppet/blob/master/lib/puppet/gettext/config.rb#L120 never successfully clears a translation repository. When we add a text domain, we always use a symbolized version of the environment name. When we delete the domain, it uses the environment name in the environment cache (which is almost always a string). Meaning we almost never actually delete a domain. When an environment is used again, it will overwrite the previous {{translation_repositories}} entry, so garbage collection will then cleanup the old translation repository.

While digging into this, we also found that successfully deleting domains leads to a thread-local storage issue in Puppet Server that will need to be addressed:
* thread A creates an environment as part of a request
* thread B deletes it because it's expired (so A's {{text_domain}} now refers to an absent domain) and creates a different environment
* thread A tries to handle a request and fails because it's configured for an unknown domain.",Bug,PUP-8672,[],Memory leak in Puppet Server from loading translations
"According to the [documentation|https://puppet.com/docs/puppet/5.5/lang_resources_advanced.html#amending-attributes-with-a-collector] the following code should be valid:

{code:java}define clamav::group() {
 # Add clamav user to group
 User <| title == 'clamav' |> {}
   groups +> $title,
 }
}{code}
 
But executing *{color:#660000}puppet parser validate clamav/group.pp{color}* fails with the following error message:
{noformat}Error: Could not parse for environment production: Syntax error at '+>' at clamav/group.pp:4:11
{noformat}
This seems like a validation bug, since it compiles and works just fine.

*Note:* This happens with both puppet version 4.10.12 and 5.5.0.

 ",Bug,PUP-8671,"['parser', 'validate']",puppet parser validate and amending parameters
"The {{puppet help <subcommand>}} command displays the help page of a particular Puppet subcommand. However, Puppet will also dispatch to ""external"" subcommands that are executables in the PATH with names that match {{puppet-*}}. The {{help}} subcommand should invoke these with the {{--help}} flag to show usage.

h2. Reproduction Case

  - Install the {{puppet-agent}} package on CentOS 7 along with the {{puppet-client-tools}} package, which provides some external subcommands:

{code:bash}
rpm -Uvh http://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm
yum install -y puppet-agent puppet-client-tools

# Add bin directories to PATH
source /etc/profile.d/puppet-agent.sh
{code}

  - Run: {{puppet help query}}

h3. Outcome

The command fails:

{noformat}
# puppet help query
Error: Could not load help for the face query.
Please check the error logs for more information.

Detail: ""Could not find Puppet Face query""
Error: Try 'puppet help help help' for usage
{noformat}


h3. Expected Outcome

The {{puppet help}} output should dispatch to {{puppet-query --help}}:

{noformat}
# puppet help query
puppet-query.

Usage:
  puppet-query [options] (--version | --help)
  puppet-query [options] <query>

Options:
  -h --help           Show this screen.
  -v --version        Show version.
  -c --config=<path>  Path to CLI config, defaults to $HOME/.puppetlabs/client-tools/puppetdb.conf.
  -u --urls=<urls>    Urls to PuppetDB instances.
  --cacert=<path>     Path to CA certificate for auth.
  --cert=<path>       Path to client certificate for auth.
  --key=<path>        Path to client private key for auth.
  --token=<path>      Path to RBAC token for auth (PE Only).
{noformat}",Improvement,PUP-8670,[],The `puppet help` command should display usage for external subcommands
"The {{puppet help}} command lists all available subcommands that can be run via {{puppet <subcommand name>}}. However, Puppet will also dispatch to ""external"" subcommands that are executables in the PATH with names that match {{puppet-*}}. The {{help}} subcommand should list these as well.

h2. Reproduction Case

  - Install the {{puppet-agent}} package on CentOS 7 along with the {{puppet-client-tools}} package, which provides some external subcommands:

{code:bash}
rpm -Uvh http://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm
yum install -y puppet-agent puppet-client-tools

# Add bin directories to PATH
source /etc/profile.d/puppet-agent.sh
{code}

  - Run: {{puppet help}}

h3. Outcome

The output of {{puppet help}} lists only Ruby subcommands:

{noformat}
# puppet help

Usage: puppet <subcommand> [options] <action> [options]

Available subcommands:

  agent             The puppet agent daemon
  apply             Apply Puppet manifests locally
  ca                Local Puppet Certificate Authority management. (Deprecated)
  catalog           Compile, save, view, and convert catalogs.
  cert              Manage certificates and requests
  certificate       Provide access to the CA for certificate management.
  certificate_request  Manage certificate requests. (Deprecated)
  certificate_revocation_list  Manage the list of revoked certificates. (Deprecated)
  config            Interact with Puppet's settings.
  describe          Display help about resource types
  device            Manage remote network devices
  doc               Generate Puppet references
  epp               Interact directly with the EPP template parser/renderer.
  facts             Retrieve and store facts.
  filebucket        Store and retrieve files in a filebucket
  generate          Generates Puppet code from Ruby definitions.
  help              Display Puppet help.
  key               Create, save, and remove certificate keys. (Deprecated)
  lookup            Interactive Hiera lookup
  man               Display Puppet manual pages. (Deprecated)
  master            The puppet master daemon
  module            Creates, installs and searches for modules on the Puppet Forge.
  node              View and manage node definitions.
  parser            Interact directly with the parser.
  plugin            Interact with the Puppet plugin system.
  report            Create, display, and submit reports.
  resource          The resource abstraction layer shell
  script            Run a puppet manifests as a script without compiling a catalog
  status            View puppet server status. (Deprecated)

See 'puppet help <subcommand> <action>' for help on a specific subcommand action.
See 'puppet help <subcommand>' for help on a specific subcommand.
Puppet v5.5.1
{noformat}


h3. Expected Outcome

The {{puppet help}} output should include an ""External subcommands"" section which lists the actions provided by the {{puppet-client-tools}} package:

{noformat}
# puppet help

Usage: puppet <subcommand> [options] <action> [options]

Available subcommands:

  agent             The puppet agent daemon
  apply             Apply Puppet manifests locally
  ca                Local Puppet Certificate Authority management. (Deprecated)
  catalog           Compile, save, view, and convert catalogs.
  cert              Manage certificates and requests
  certificate       Provide access to the CA for certificate management.
  certificate_request  Manage certificate requests. (Deprecated)
  certificate_revocation_list  Manage the list of revoked certificates. (Deprecated)
  config            Interact with Puppet's settings.
  describe          Display help about resource types
  device            Manage remote network devices
  doc               Generate Puppet references
  epp               Interact directly with the EPP template parser/renderer.
  facts             Retrieve and store facts.
  filebucket        Store and retrieve files in a filebucket
  generate          Generates Puppet code from Ruby definitions.
  help              Display Puppet help.
  key               Create, save, and remove certificate keys. (Deprecated)
  lookup            Interactive Hiera lookup
  man               Display Puppet manual pages. (Deprecated)
  master            The puppet master daemon
  module            Creates, installs and searches for modules on the Puppet Forge.
  node              View and manage node definitions.
  parser            Interact directly with the parser.
  plugin            Interact with the Puppet plugin system.
  report            Create, display, and submit reports.
  resource          The resource abstraction layer shell
  script            Run a puppet manifests as a script without compiling a catalog
  status            View puppet server status. (Deprecated)

External subcommands:

  db
  query

See 'puppet help <subcommand> <action>' for help on a specific subcommand action.
See 'puppet help <subcommand>' for help on a specific subcommand.
Puppet v5.5.1
{noformat}",Improvement,PUP-8669,[],The `puppet help` command should list external subcommands
"_Basic Info_
 *Puppet Version: 5.5.1 (puppetserver 2.8.1)*
 *OS Name/Version: RHEL 7.4*

*Desired Behavior:*

Upgrading puppet-agent should not be able to break puppetserver

*Actual Behavior:*

After installing {{puppet-agent 5.5.1}} on the server running {{puppetserver 2.8.1}}, Puppet broke completely. All manifest compilations failed with a message like the following:

{{2018-04-19 06:01:52,233 ERROR [qtp1943791090-346] [puppetserver] Puppet Evaluation Error: Error while evaluating a Function Call, undefined method `top_of_stack' for Puppet::Pops::PuppetStack:Module (file: /etc/puppetlabs/code/environments/production/modules/some/manifests/module.pp, line: 12, column: 3) on node some.host.tld}}

I eventually tracked it down to being caused by any call to ensure_packages or ensure_resource. Downgrading the installation of puppet-agent to 5.5.0 the problems magically went away – didn't even have to restart puppetserver.

I have not tried to reproduce this issue, but I'm surprised that an installation of puppet-agent was able to break puppetserver – I'd have thought that those two components were completely independent.",Bug,PUP-8668,[],Installing puppet-agent 5.5.1 together with puppetserver 2.8.1 breaks puppetserver
"When using the 'tidy' resource to cleanup files, this resource will always report that a given file it manages does not, or no longer, exist. The fact that the file to be tidied up is not present is the expected result, and the report about this fact is unnecessarily verbose.

This is the style of message that is produced:

    +Info: /Stage[main]/[...]/Tidy[<title>]: File does not exist+

at each and every puppet agent run.

Suggested fix:

In file */opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/tidy.rb,* at line *337*: change

  *info _(""File does not exist"")*

to

  *debug _(""File does not exist"")*",Improvement,PUP-8667,[],resource 'tidy' should be less chatty
"Running {{puppet help lookup}} does not indicate that you can use puppet settings as options.

For example, {{puppet help apply}} includes this text:

{noformat}
OPTIONS
-------
Note that any setting that's valid in the configuration
file is also a valid long argument. For example, 'tags' is a
valid setting, so you can specify '--tags <class>,<tag>'
as an argument.

See the configuration file documentation at
https://docs.puppetlabs.com/puppet/latest/reference/configuration.html for the
full list of acceptable parameters. A commented list of all
configuration options can also be generated by running puppet with
'--genconfig'.
{noformat}


{{puppet help lookup}} only reports the options specific to {{lookup}}.",Bug,PUP-8666,[],`puppet help lookup` does not indicate that you can use puppet settings
"mcollective is being deprecated for Platform 6. There are still some acceptance tests in the Puppet repo's master branch that reference/use it, so they need to be cleaned up.",Task,PUP-8665,[],Remove any reference/uses of mcollective from acceptance tests
"*Puppet Version: 5.3.5 (and older)*
 *Puppet Server Version: N/A*
 *OS Name/Version: Centos/Redhat*

The uninstall method in the rpm package provider is more specific than the package resource it is uninstalling, and uses a cache that can become out of date by the time it executes.

*Desired Behavior:*

Unconditionally uninstall a package when conditions are not specified.

*Actual Behavior:*

Example:
{code:java}
  package { 'cronie-anacron':
    ensure  => absent,
    require => Package['cronie-noanacron']
  }

  package { 'cronie-noanacron':
    ensure => installed,
  }
{code}
 
{code:java}
yum[3546]: Updated: cronie-anacron-1.4.11-19.el7.x86_64 
yum[3546]: Updated: cronie-1.4.11-19.el7.x86_64 
yum[3546]: Installed: cronie-noanacron-1.4.11-19.el7.x86_64

puppet-agent[1371]: (/Stage[main]/Package[cronie-noanacron]/ensure) created 
puppet-agent[1371]: Execution of '/usr/bin/rpm -e cronie-anacron-1.4.11-17.el7.x86_64' returned 1: error: package cronie-anacron-1.4.11-17.el7.x86_64 is not installed 
puppet-agent[1371]: (/Stage[main]/Package[cronie-anacron]/ensure) change from '1.4.11-17.el7' to 'absent' failed: Execution of '/usr/bin/rpm -e cronie-anacron-1.4.11-17.el7.x86_64' returned 1: error: package cronie-anacron-1.4.11-17.el7.x86_64 is not installed
{code}

 To reset the test environment after that puppet run, download cronie-1.4.11-14.el7.x86_64.rpm and cronie-anacron-1.4.11-14.el7.x86_64.rpm and run:

{code:java}
rpm -e cronie cronie-noanacron crontabs ; yum install -y cronie-* ; rpm -qa | grep cron ; puppet agent -t ; rpm -qa | grep cron
{code}
",Bug,PUP-8664,['cs_pr_review'],rpm package provider is too specific
"Back when the {{http_keepalive_timeout}} setting was introduced, Puppet ran under Ruby 1.9.3 and life was good:

https://github.com/puppetlabs/puppet/blob/5.5.0/lib/puppet/network/http/pool.rb

Then Ruby 2.x descended from the mountains and brought with it a {{Net::HTTP#keep_alive_timeout}}:

https://github.com/ruby/ruby/blob/v2_4_3/lib/net/http.rb#L664

Ruby's timeout defaults to 2 seconds and always overrides the timeout used by the Puppet agent. This causes HTTP connections to be closed early instead of being re-used which increases the TLS handshake load on Puppet Server along with the amount of connection state that network devices between the agent and server have to contend with.


h2. Reproduction Case

  - Install {{puppet-agent}} 5.5.0 and {{puppetserver}} 5.3.0 on a CentOS 7
    node:

{code:bash}
rpm -Uvh http://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm
yum install -y puppet-agent-5.5.0 puppetserver-5.3.0
{code}

  - Configure the puppet agent to connect to the local host and start
    puppetserver:

{code:bash}
/opt/puppetlabs/bin/puppet config set --section main server $(hostname -f)
systemctl start puppetserver
{code}


  - Run {{puppet agent -t}} to verify things work.

  - Add a custom fact that will sleep for 4 seconds, which delays the
    HTTP POST request for a catalog:

{code:bash}
cat <<-'EOF' > /etc/puppetlabs/code/modules/testmod/lib/facter/sleep_fact.rb
Facter.add(:sleep_fact) do
  setcode do
    $stdout.puts(""Sleeping for 4 seconds..."")
    Kernel.sleep(4)
    nil
  end
end
EOF
{code}

  - Set Puppet's {{http_keepalive_timeout}} to 15 seconds:

{code:bash}
/opt/puppetlabs/bin/puppet config set --section main http_keepalive_timeout 15s
{code}

  - Run {{puppet agent -t}} and track HTTP connections:

{code:bash}
/opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -v '^->\|<-'
{code}


h3. Outcome

The Puppet Agent opens a new TCP connection after loading facts despite
{{http_keepalive_timeout}} being set to 15 seconds:

{noformat}
# /opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -v '^->\|<-'
opening connection to m4t83ynafhampi9.delivery.puppetlabs.net:8140...
opened
starting SSL for m4t83ynafhampi9.delivery.puppetlabs.net:8140...
SSL established
reading 3339 bytes...
read 3339 bytes
Conn keep-alive
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
reading 204 bytes...
read 204 bytes
Conn keep-alive
Info: Retrieving plugin
reading 259 bytes...
read 259 bytes
Conn keep-alive
Info: Retrieving locales
reading 204 bytes...
read 204 bytes
Conn keep-alive

Info: Loading facts
Sleeping for 4 seconds...
Conn close because of keep_alive_timeout
opening connection to m4t83ynafhampi9.delivery.puppetlabs.net:8140...
opened
starting SSL for m4t83ynafhampi9.delivery.puppetlabs.net:8140...
SSL established

reading 310 bytes...
read 310 bytes
Conn keep-alive
Info: Caching catalog for m4t83ynafhampi9.delivery.puppetlabs.net
Info: Applying configuration version '1523668333'
Notice: Applied catalog in 0.11 seconds
reading 9 bytes...
read 9 bytes
Conn keep-alive
{noformat}


h3. Expected Outcome

The Puppet agent should re-use the connection opened at the beginning of the run.",Bug,PUP-8663,[],http_keepalive_timeout setting doesn't work correctly under Ruby 2.x
"The {{puppet plugin download}} command doesn't re-use connections to the
Puppet Server when downloading plugins from modules. This adds considerable time to
downloads along with extra load on the Puppet Server due to multiple redundant TLS handshakes.

h2. Reproduction Case

  - Install {{puppet-agent}} 5.5.0 and {{puppetserver}} 5.3.0 on a CentOS 7
    node:

{code:bash}
rpm -Uvh http://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm
yum install -y puppet-agent-5.5.0 puppetserver-5.3.0
{code}

  - Configure the puppet agent to connect to the local host and start
    puppetserver:

{code:bash}
/opt/puppetlabs/bin/puppet config set --section main server $(hostname -f)
systemctl start puppetserver
{code}


  - Run {{puppet agent -t}} to verify things work.

  - Install the {{puppetlabs-windows}} module, which brings in a ton of
    plugins that will have to be synced:

{code:bash}
/opt/puppetlabs/bin/puppet module install puppetlabs-windows
{code}

  - Empty the plugin cache, and time a puppet agent run along with the
    number of network connections it opens:

{code:bash}
rm -rf /opt/puppetlabs/puppet/cache/lib
time /opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -e Info: -e 'opening connection'
{code}

  - Empty the cache again and time a puppet plugin download run along
    with the number of network connections opened:

{code:bash}
rm -rf /opt/puppetlabs/puppet/cache/lib
time /opt/puppetlabs/bin/puppet plugin download --verbose --http_debug 2>&1|grep -e Info: -e 'opening connection'
{code}



h3. Outcome

The puppet agent run uses a handful of connections:

{noformat}
# rm -rf /opt/puppetlabs/puppet/cache/lib
# time /opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -e Info: -e 'opening connection'

opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
Info: Retrieving locales
Info: Loading facts
Info: Caching catalog for wzwhytp204ipraf.delivery.puppetlabs.net
Info: Applying configuration version '1523665266'

real	0m43.990s
user	0m16.685s
sys	0m1.497s
{noformat}

The puppet plugin download run uses hundreds of connections and takes much
longer than the puppet agent run despite only doing a subset of the work:

{noformat}
# rm -rf /opt/puppetlabs/puppet/cache/lib
# time /opt/puppetlabs/bin/puppet plugin download --verbose --http_debug 2>&1|grep -e Info: -e 'opening connection'

Info: Retrieving pluginfacts
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
Info: Retrieving plugin
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
... omitted hundreds of open calls for brevity ...
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...
Info: Retrieving locales
opening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...

real  3m39.345s
user  1m29.576s
sys 0m2.405s
{noformat}

h3. Expected Outcome

The {{puppet plugin download}} action should complete much faster than
{{puppet agent -t}} when populating a cold plugin cache.",Bug,PUP-8662,[],puppet plugin download doesn't re-use HTTP connections
"Puppet sticks a nil total time in the metrics if it failed to retrieve a catalog from the master. We should make sure we stick a real time there.

{noformat}
""time""=>
 {""name""=>""time"",
  ""label""=>""Time"",
  ""values""=>
   [[""node_retrieval"", ""Node retrieval"", 0.07789189496543258],
    [""plugin_sync"", ""Plugin sync"", 0.06572247401345521],
    [""fact_generation"", ""Fact generation"", 1.5629146320279688],
    [""total"", ""Total"", nil]]},
{noformat}

The nil time was causing issues with puppetdb.",Bug,PUP-8661,['regression'],Total time metric is nil on failed catalog retrieval
"*Puppet Version: PE 2016.4.5*
 *Puppet Server Version:*  *2016.4.5***
 *OS Name/Version:  RHEL 6.4*

When using ""puppet apply"" to locally smoke-test updates to an existing and already ""deployed"" module, everything works properly except when the module happens to also contain an updated custom fact.  The updated custom fact never gets loaded; instead, ""puppet apply"" always reads from the pluginsync'ed cache, regardless of ""modulepath"" setting.  (In this particular case, the custom fact update added support for a second operating system via a small change to the confine directive.)

The module autoload seems to be pretty deterministic and follows the modulepath (user-definable), so why wouldn’t fact loading do the same?  Since “puppet apply” is totally disconnected and unaware of any master anyway, why does it bother loading custom facts from the cache since it really should not count on them being there in the first place? It should be able to get them all via dependencies in “modulepath”.

Proposed workarounds were to delete the old fact from the cache under /opt/puppetlabs/puppet/cache (which works until pluginsync kicks in again), rename the module and fact under test (kludgey, prone to error, and does not test code as-is; and not conducive to integration testing).


 Steps to reproduce (transcribed–not from copy & paste):

file { ‘/opt/softwaredir’:

  ensure => directory,

  owner => ‘root’,

  group  => $::my_fact ? {

    /[a-zA-Z0-9]+/ => $::my_fact,

    default            => undef,

  },

}

 

<mymodule>/lib/facter/my_fact.rb

 

getmyfact = “/usr/bin/groups <pick a user> | /usr/bin/tr ‘ ‘ ‘\012’ | /bin/egrep ‘^(<group1>|<group2>|<group3>)$’ | /usr/bin/head -1”

 

Facter.add(:my_fact) do

  confine kernel: 'Solaris'

  setcode do

    Facter::Core::Execution.exec(getmyfact)

  end

end

 

UPDATE to custom fact:

   confine kernel: ['Solaris', 'Linux']

If you test on Linux, the fact never gets created because it is still 'Solaris'-only in the cache.  However, ""facter"" --custom-dir ...  works properly.

 

*Desired Behavior:  Either ""puppet apply"" should ignore pluginsync'ed cache completely, write the new custom fact to the cache and use it, follow ""modulepath"" for loading custom facts, or have some sort of option/flag to override loading custom facts from cache.  (The independent, master-oblivious ""puppet apply"" should use the files from the module under test, and pull from modulepath if not found.)*

*Actual Behavior:  ""puppet apply"" ignores updated custom fact file and reads old/stale data from cache.*

Log output is not possible, since systems exist in a closed environment (no Internet).",Improvement,PUP-8660,[],"""puppet apply"" should not ignore updated custom facts within the module under test"
"*Puppet Version: 5.3.5*
 *Puppet Server Version: 5.1.6*
 **

This feature request arose from a support ticket where the customer has experienced the following error from the puppet agent:

""Error: Could not send report: Connection reset by peer""

The customer would like if Puppet tried to send these reports at a later time, for example, before the next run, at the beginning of the next run or save them until they do get sent.",New Feature,PUP-8658,[],Feature Request : Reports not sent due to error get sent at a later time
"When resolution of a Deferred value takes place on the agent side and the resolution returns a Sensitive value the attribute it is assigned to may not have been marked as sensitive. Also, to be backwards compatible, a Sensitive value needs to be unwrapped before it is assigned to the attribute.",New Feature,PUP-8657,[],Handle resolution of Sensitive for Deferred values
"Once we are correctly saving the CRL bundles, we need to ensure that we're using the whole bundle to verify the credentials of our master. We might get this for free from SSL once we are saving the right data.",Sub-task,PUP-8656,[],Agents should use the CRL bundle to verify the revocation status of their master
"Once we can properly download cert bundles, we need to ensure that trust chain checking still works. All of the code in puppet is written as though it assumes that it is handling only one cert, even though SSL correctly handles the bundled cert. At very least we should update Puppet's semantics to make it more clear that we are potentially handling a cert bundle.

This entails not using the indirector to load the cert bundle from disk. The new implementation should have the right semantics; i.e. should not refer to it as if it will always be a single cert.",Sub-task,PUP-8655,[],Agent should use whole cert bundle to verify master's credentials
"Currently the puppet agent does not correctly handle chained CRLs. When using an intermediate CA, users must now turn on leaf-only checking for CRLs to work around this. Puppet needs to be able to verify the revocation status of the master using the whole chain, not just the leaf.

This is complicated by the indirector, which hard codes an assumption that we only have one CRL. We should sidestep the indirector here to handle bundled CRLs properly, adding all of them to trust store, not just the leaves.",Sub-task,PUP-8654,[],Agents should save all CRLs downloaded from the server
"Currently, puppet agents only save the first cert in any bundle downloaded from the CA. In order to correctly verify the master's credentials, we need to save all of the certs in the bundle for proper trust chain checking.

This is currently complicated by the indirector, so we should consider pulling this subsystem out entirely.",Sub-task,PUP-8653,[],Agents should save all certs downloaded from the server
"When I am using a Puppet CA set up as an intermediate CA, I need my agents to be able to verify the credentials of the master using the intermediate CA cert and CRL chain.

This entails being able to download bundled certs and CRLS, and process them correctly.",Story,PUP-8652,[],Agents should be able to use CA and CRL bundles
"*Puppet Version: 4.10.9*
 *Puppet Server Version: 2.6.0*
 *OS Name/Version: AIX 7.1*

This issue arose from a support ticket where a customer experiences the following error during a puppet run on one of their AIX servers.
{code:java}
Debug: Augeas[sshd_config](provider=augeas): Opening augeas with root /, lens path , flags 32 
Debug: Augeas[sshd_config](provider=augeas): Augeas version 1.4.0 is installed 
Debug: Augeas[sshd_config](provider=augeas): Closed the augeas connection 
Error: /Stage[main]/Profiles::Pci_dss::Sshd_config/Augeas[sshd_config]: Could not evaluate: unknown error - Matching path expression '/augeas/load/*['/etc/ssh/sshd_config/' !~ glob(incl) + regexp('/.*')]' failed 
{code}
This box was recently updated from puppet 4.7.0 to 4.10.9

The piece of code causing this issue follows a straight forward sshd_config example from our documentation with some added DenyUser statements:
{code:java}
 augeas { 'sshd_config':
   lens => 'Sshd.lns',
   incl => '/files/etc/ssh/sshd_config',
   context => '/files/etc/ssh/sshd_config',
   changes => [
     'set PermitRootLogin no',
     'set Protocol 2',
     'set Banner /etc/qvc_sshd_banner',
     'set DenyUsers/1 lp',
     'set DenyUsers/2 ipsec',
     'set DenyUsers/3 nobody',
     'set DenyUsers/4 invscout',
     'set DenyUsers/5 lpd',
   ],
   notify  => Service[$sshd_service]
 }
{code}
The same code being applied to other AIX boxes causes no issues.

 

 

 ",Bug,PUP-8651,[],Augeas unknown error - Matching path expression
"We had a problem with our artifactory server, where it would return a 404 for the Puppet repository it was providing. This caused an error message to appear, about 404 errors. I tried to install the module manually (or search for it) and also got a 404 error:
{code:java}
[root@puppetmaster ~]# puppet module --debug search saz-sudo
Debug: Runtime environment: puppet_version=5.3.5, ruby_version=2.4.3, run_mode=user, default_encoding=UTF-8
Notice: Searching https://artifactory.domain.com/artifactory/api/puppet/puppet ...
Debug: HTTP GET https://artifactory.domain.com/artifactory/api/puppet/puppet/artifactory/api/puppet/puppet/v3/modules?query=saz-sudo&module_groups=base%20pe_only
Error: Request to Puppet Forge failed.
  The server being queried was https://artifactory.domain.com/v3/modules?query=saz-sudo&module_groups=base%20pe_only
  The HTTP response we received was '404 '
Error: Try 'puppet help module search' for usage {code}
 

Before adding the debug flag, I thought that the puppet module tool was loosing the ""path"" part of the ""module_repository"" configuration when it read it from the puppet.conf, vs when it was specified on the command line. This was not the case, but it led to a lot of pointless troubleshooting. The error message should have the correct URL that failed.

 

NOTICE the difference between:
{code:java}
Debug: HTTP GET https://artifactory.domain.com/artifactory/api/puppet/puppet/artifactory/api/puppet/puppet/v3/modules?query=saz-sudo&module_groups=base%20pe_only {code}
... and:
{code:java}
The server being queried was https://artifactory.domain.com/v3/modules?query=saz-sudo&module_groups=base%20pe_only {code}
 ",Bug,PUP-8650,[],Repository error message uri is missing part of the path
"In preparation for removing non-core types and providers from puppet we are going to move them within the puppet code base to the {{lib/puppet/vendor/modules}} directory. We need to:

1. Add each module's lib directory to the ruby load path so the autoloader can still find them
2. When running {{rake spec}} and {{rake parallel:spec}} we should execute the modules' unit tests as well.
",Task,PUP-8649,[],Load vendored modules and execute unit tests
"(Initial planned release date: 2018-04-17)

1) Create versions and filters for the release in in JIRA. Ensure that the filters are shared with the ‘All Employees’ group.

2) Create or update the Kanban board for the release series. Ensure that the underlying filter for the board includes issues from the release filter and add a quick filter to highlight just those issues.

3) Create Release tickets (in the Project Central project) for the Puppet Platform and puppet-agent releases, with sub-tasks for each milestone (e.g., “String Freeze”, “Stop Ship Line”, “Ready to Ship”, and “General Availability (GA)”.

4) Create release pages for the Puppet Platform and puppet-agent releases in Confluence, under the appropriate “Upcoming Releases” parent page. Make sure the pages reference the release filters, tickets, and Kanban board as needed.

5) Update the “Versions & Dependencies” pages for Puppet Platform and puppet-agent with dependency versions for releases. Format the release versions in italics and link them to their corresponding release pages.

6) Add events for the release milestone dates to Group-Platform Google calendar. Ensure the description for each event includes a link to the release page.

7) Send an email to stakeholders (e.g., puppet-dev@googlegroups.com and discuss-platform@puppet.com) outlining the scope and timeline for the release.
",Task,PUP-8648,['release'],Communicate scope and timeline of next release (Puppet Platform 5.5.1)
"(Initial planned release date: 2018-04-17)

1) Update the release pages for Puppet Platform and puppet-agent in Confluence based on the release. Replace “Target Date” with “Release Date”, change language to past tense, and move the pages to the appropriate parent pages under “Current Releases”.

2) Update the “Versions & Dependencies pages for Puppet Platform and puppet-agent based on the release. Format the release versions in bold and move them to the appropriate tables under “Current Releases”.

3) Close any outstanding Milestone and Risk tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the Milestone tickets as needed to ensure they match the actual milestone dates.

4) Close the Release tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the tickets as needed to ensure they match the actual release date.

5) Close all tickets that have been resolved as part of the release. When using a bulk modify operation to transition the tickets to ‘Closed’ status in JIRA, be sure to select the appropriate resolution and disable notifications to avoid spamming watchers.

6) Make all tickets that were marked as Internal for the release public. When using bulk modify operation to change the value of the ‘level’ field for tickets to ‘None’ in JIRA, be sure to disable notifications to avoid spamming watchers.

7) Mark all versions that were shipped as part of the release as “released”. When doing so, be sure to update the description and release date of each version as needed based on what was shipped when.

8) Update the Kanban board for the release series. Remove the release filter from the underlying filter for the board and remove the quick filter for the release as well.
",Task,PUP-8647,['release'],Update Confluence and JIRA based on release (Puppet Platform 5.5.1)
"(Initial planned release date: 2018-04-17)

1) Ensure all prerequisite release tasks are complete.

2) Review the release Kanban board to ensure all tickets are resolved.

3) Ping release leads in ‘Platform Core’ HipChat room for go/no-go decision.

4) Send email indicating Ready To Ship milestone has been achieved.
",Task,PUP-8646,['release'],Declare Ready to Ship (go/no-go) milestone (Puppet Platform 5.5.1)
"(Initial planned release date: 2018-04-17)

Please paste the text of the announcement in the 'Send announcement' ticket.
If there are any links, it would be most helpful for the sender if they were already hyperlinked to the display text, so only a copy+paste to Gmail is necessary.
",Task,PUP-8645,['release'],Prepare release announcement (Puppet Platform 5.5.1)
"(Initial planned release date: 2018-04-17)

1) Send an email reminder ahead of time about the upcoming Stop Ship milestone date.

2) Review tickets on the release Kanban board to ensure all code changes have landed. Flag any related issues that are not yet Ready for CI.

3) Ensure all tickets have release notes, if needed. Add comments to issues without release notes, asking the author of the PR to add them or indicate that they aren’t needed.

4) Follow up with the Engineering lead for each component (e.g., in HipChat) to confirm current state and obtain a forecast for when all code will be in a build.

5) Send email indicating that the Stop Ship milestone has been achieved.
",Task,PUP-8644,['release'],Declare Stop Ship Line (code complete) milestone (Puppet Platform 5.5.1)
"(Initial planned release date: 2018-04-17)

1) Ensure “Versions & Dependencies” pages for Puppet Platform and puppet-agent are up to date in Confluence. Reach out to teams as needed to confirm that the fix versions listed are those that we intend to ship with the release.

2) For each component project of Puppet Platform and puppet-agent, ensure there is a next version if needed. Often this will be the next Z in an X.Y.Z series. However, if we are jumping to a new X or Y release that skips an existing Z version in JIRA, make sure those tickets are reassigned to the correct fix version, and the unneeded version is deleted. For example, if we have tickets with a fix version of 4.3.3, but we’re going from 4.3.2 to 4.4.0, then we need to reassign the tickets assigned to 4.3.3 and delete the 4.3.2 version from JIRA.

3) Create public filters for inclusion in the release notes and/or announcement. These allow easy tracking as new bugs come in for a particular version and allow everyone to see the list of changes in a release. Include links to the filters as a comment on this issue before resolving it.

4) Update the “master” filters for Puppet Platform 5.5.1 and puppet-agent 5.5.1 to reference the “Fixed in” filters created above.

5) Update the community feedback filter for Puppet Platform X.y to reference the “Introduced in” filter created above.
",Task,PUP-8643,['release'],Prepare JIRA for release (Puppet Platform 5.5.1)
"Puppet Platform 5.5.1 Release - 2018-04-17
",Epic,PUP-8642,[],"Puppet Platform 5.5.1 Release - 2018-04-17
"
"While the primary use of a Deferred is to defer the evaluation to catalog apply time it is very useful to also be able to resolve values when compiling:
* For the purpose of testing Deferred values
* To delay the evaluation of an expensive function until it is actually needed
* To delay a reference to a variable that may not yet exist

The same can be achieved without Deferred by instead of creating a Deferred the information would be encoded in a hash or array, and the receiver making a call to {{call}} or other functions (typically an ERB template) to get a variable value via indirect name reference.

See PUP-8635 for the Deferred data type.",New Feature,PUP-8641,[],Make call() function resolve Deferred values
"When {{Deferred}} values are placed in a catalog (assumes --rich_data) they should be resolved before applying the catalog.

This means that {{puppet agent}} and {{puppet apply}} needs to perform this resolution before proceeding with the existing behaviour.",New Feature,PUP-8640,[],Resolve Deferred values at catalog apply time
"What realistic option does a Puppet open source site have if the expiration on the CA master certificate is approaching, and one wants to smoothly transition to a new CA master certificate?

The only official documentation I can find that comes close to this is the following:

[https://puppet.com/docs/puppet/5.5/ssl_regenerate_certificates.html]

But that procedure is describing an apocalypse-level security event where all certificates must be treated as untrustworthy and discarded.

There is this:

[https://forge.puppet.com/puppetlabs/certregen]

…but that module hasn't been updated in almost a year, and doesn't express compatibility with Puppet 5

The only potential solution I can see is this:

[https://blog.flyingcircus.io/2017/09/01/how-to-renew-puppet-ca-and-server-certificates-in-place/]

Perhaps PE already has a smooth way to do this, but there needs to be a smooth way to do this for Puppet open source as well, without sending sites running open source scurrying to random third-party blog posts.

I realize this is both a very unsexy and very challenging issue to solve, but for the sites that need to solve it… it's a DEFCON 1 event.",New Feature,PUP-8639,[],need seamless way to replace expiring CA certificate
"h1.  The Problem 
You should not be able to accidentally include a class, resource, etc... on all nodes because of an incorrectly coded puppet module.  


*Actual Behavior:*

Writing an init.pp for the module testmod that looks like the following: 

{code}
class testmod {
  notify { 'hello_world':
    message => 'I am supposed to be here.'
  }
}

include testmod
{code}

Will cause testmod to be classified on all nodes as soon as testmod is parsed for any reason.  

h1.  Suggested Solution

We have a setting called [freeze_main|https://puppet.com/docs/puppet/5.5/configuration.html#freezemain] which sounds like it's supposed to provide a way to prevent this sort of behavior and it does for the simplest case but it seems to have an issue with our file resource default that sets backup => false in site.pp and with custom data types.  

I believe we should have a setting like freeze_main that allows the customer to enable the compiler to fail out if code is included outside of a class definition, defined type, etc...

We should have a way to add resource defaults either in site.pp or some other way since the most common reason I can think of to have code outside of a class definition is for resource defaults in site.pp.  

h1.  Customer Impact

The issue may seem small but the result on user's systems is extremely severe.  You apply puppet code to a node that isn't expecting it and it may be next to impossible to reverse those changes completely.  

If you apply certain firewall, security settings, or other low level settings you may actually take a node out of commission.  

h1.  Related tickets 

https://tickets.puppetlabs.com/browse/PUP-8536
https://tickets.puppetlabs.com/browse/PUP-2973
https://tickets.puppetlabs.com/browse/PE-893
https://tickets.puppetlabs.com/browse/PUP-8637",New Feature,PUP-8638,[],Puppet Compilation should fail if code is included outside of class definitions / node definitions / etc...
"The {{freeze_main}} setting throws an error when used with code containing type aliases.

Reproduction:

{code}
mkdir -p test/modules test/manifests
puppet module install --modulepath test/modules puppetlabs-stdlib
puppet module install --modulepath test/modules puppetlabs-haproxy
echo 'include haproxy; notify { ""test"": }' > test/manifests/site.pp
puppet apply --modulepath test/modules --freeze_main test/manifests/site.pp --noop
{code}

This error will be thrown:

{code}
Error: Evaluation Error: Error while evaluating a Type-Name, Cannot have code outside of a class/node/define because 'freeze_main' is enabled at /Users/reidmv/tmp/modules/haproxy/manifests/init.pp:123:3 on node halcyon.corp.puppetlabs.net
{code}

The line number reported is [this one|https://github.com/puppetlabs/puppetlabs-haproxy/blob/2.1.0/manifests/init.pp#L123]:

{code}
class haproxy (
  ...
  Stdlib::Absolutepath $config_dir                             = $haproxy::params::config_dir,
  ...
{code}",Bug,PUP-8637,[],freeze_main setting breaks when used with type aliases
"When a Particular Resource provider is defaulting to No-op or is part of a schedule which is not active, Puppet shouldn't prefetch any data relating to that provider in  order to speed up compilation, for example:

 
{code:java}schedule { 'narrow': 
range => '1:01 - 1:02', 
}

Package <| provider == 'pkgutil' |> { 
schedule => 'narrow', 
}{code}
 

this works in that the packages are skipped, the background provider tasks are still being completed:
{code:java}Prefetching pkgutil resources for package
Debug: Executing: '/opt/csw/bin/pkgutil -a'
Debug: Executing: '/opt/csw/bin/pkgutil -c'
Debug: /Package[sudo]: Not scheduled
Debug: /Package[sudo]: Resource is being skipped, unscheduling all events
Debug: /Package[name]: Not scheduled
Debug: /Package[name]: Resource is being skipped, unscheduling all events

{code}
 

 

 ",New Feature,PUP-8636,[],Don't prefetch if every resource using a provider is noop'd or no scheduled
"Add a data type {{Deferred}} that is used to describe a function call that is to be performed in the future (at some time when a resolution/call is wanted). The data type should be an Object and have the attributes {{name}} - the name of the function, and optional {{arguments}} an array with arguments to the function.

The data type is not parameterized. While it would be of interest to have a {{Deferred\[T]}} where {{T}} is the return type - this gets complicated as it is not possible in general to infer what the return type of a variable is because of overloading. We do not have such functionality (yet) in puppet and adding this could be done sometime in the future to ensure that the result of a deferred has a particular data type. This will most likely also mean that an instance of Deferred will need to have that type as  a type constraint. The same can however be achieved by making a deferred call to assert_type, and giving a Deferred as an argument.",New Feature,PUP-8635,[],Add a Deferred data type for lazy function call
"Currently Puppet as part of the install does a chown of the ssldir to puppet:puppet. 

A customer is currently asking if it is possible to disable this functionality.

Below is a description of the customer's use case.

""We only have a user called 'puppet' on a handful of our unix clients (relatively speaking - it is a few hundred), and for all other hosts the $ssldir is owned by root:root. We know why the GID isn't resolving (missing LDAP data) but as the use of a 'puppet' account on clients doesn't appear to gain us anything but causes the occasional agent installation failure (impacting our build automation) I wanted to look at preventing the chown operation during agent install."" 

 

 ",New Feature,PUP-8634,[],Chown of ssldir Causing Failures
"*Puppet Version: 5.5*
 *Puppet Server Version:* *2017 v3.2***
 *OS Name/Version: Centos version 7* 

Hello, We have puppet enterprise running in our environment , we have three complie masters which talks to MoM. every complie master is residing in islolated envrionment. 

now the concern is how can i point agents to talk to their Complie master from the start of agent installation on a new machine when provisioned in a environment. 

 

*Desired Behavior:*

 *how can i point agents to talk to their Complie master from the start of agent installation on a new machine when provisioned in a environment.*

*Actual Behavior:*

*now when i install puppet agent, it tries to reach all the three complie masters which is not right for cert sign and installation.*

 ",Bug,PUP-8633,[],Node agents connecting to specific Complie master
"Having created a new provider and wishing to apply a manifest to my new target:
{code:java}
bundle exec puppet device --verbose --trace --modulepath ~/projects --target=hue_hub --deviceconfig /Users/david.armstrong/test_manifests/device.conf --apply ~/test_manifests/hue_disco.pp{code}
returns
{code:java}
Notice: Compiled catalog for hue_hub in environment production in 0.09 seconds
Info: Applying configuration version '1522924613'
Info: Creating state file /Users/david.armstrong/.puppetlabs/opt/puppet/cache/devices/hue_hub/state/state.yaml
Error: Failed to apply catalog: No such file or directory @ dir_s_mkdir - /Users/david.armstrong/.puppetlabs/opt/puppet/cache/devices/hue_hub/state/state.yaml20180405-39306-c4hkf8.lock
{code}
as per: [https://confluence.puppetlabs.com/display/systemsEngineering/Cisco+IOS+Module+Development]

the target first needs registered with a puppet master before it can be managed.

 ",Improvement,PUP-8632,[],Puppet Device --apply fails to apply catalog to unregistered targets
"*Puppet Version:* 4.4 through 5.5 and HEAD
 *Puppet Server Version:* n/a
 *OS Name/Version:* all

We were extremely grateful to see {{skip_tags}} added as a configuration option. This has been tremendously useful. However in practice we've started to see problems when multiple teams make use of the tag for different purposes. Example:

skip_tags = monitoring_changes,app_deploy

These tags are used by two different teams to limit changes to things the other team are unaware of, and not responsible for managing.

*Desired Behavior:*

If {{tags}} includes a tag in {{skip_tags}} then it should override that tag individually, rather than requiring the entire skip tags to be provided sans the one tag. So if this command is run:

{{puppet agent --test --tags app_deploy}}

It should not make monitoring changes, and vice versa.

*Actual Behavior:*

A person must lookup the current {{skip_tags}} and remove the desired tag. This is a manual process that involves some human failures as skip_tags can vary from node to node. It also makes automation tricky.
{code}grep skip_tags /etc/puppetlabs/puppet/puppet.conf | split -d=  -f2 | awk... 
{code}",New Feature,PUP-8631,[],--tags should override individual --skip_tags
"(Initial planned release date: 2018-04-17)

1) Create versions and filters for the release in in JIRA. Ensure that the filters are shared with the ‘All Employees’ group.

2) Create or update the Kanban board for the release series. Ensure that the underlying filter for the board includes issues from the release filter and add a quick filter to highlight just those issues.

3) Create Release tickets (in the Project Central project) for the Puppet Platform and puppet-agent releases, with sub-tasks for each milestone (e.g., “String Freeze”, “Stop Ship Line”, “Ready to Ship”, and “General Availability (GA)”.

4) Create release pages for the Puppet Platform and puppet-agent releases in Confluence, under the appropriate “Upcoming Releases” parent page. Make sure the pages reference the release filters, tickets, and Kanban board as needed.

5) Update the “Versions & Dependencies” pages for Puppet Platform and puppet-agent with dependency versions for releases. Format the release versions in italics and link them to their corresponding release pages.

6) Add events for the release milestone dates to Group-Platform Google calendar. Ensure the description for each event includes a link to the release page.

7) Send an email to stakeholders (e.g., puppet-dev@googlegroups.com and discuss-platform@puppet.com) outlining the scope and timeline for the release.
",Task,PUP-8630,['release'],Communicate scope and timeline of next release (Puppet Platform 5.3.6)
"(Initial planned release date: 2018-04-17)

1) Update the release pages for Puppet Platform and puppet-agent in Confluence based on the release. Replace “Target Date” with “Release Date”, change language to past tense, and move the pages to the appropriate parent pages under “Current Releases”.

2) Update the “Versions & Dependencies pages for Puppet Platform and puppet-agent based on the release. Format the release versions in bold and move them to the appropriate tables under “Current Releases”.

3) Close any outstanding Milestone and Risk tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the Milestone tickets as needed to ensure they match the actual milestone dates.

4) Close the Release tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the tickets as needed to ensure they match the actual release date.

5) Close all tickets that have been resolved as part of the release. When using a bulk modify operation to transition the tickets to ‘Closed’ status in JIRA, be sure to select the appropriate resolution and disable notifications to avoid spamming watchers.

6) Make all tickets that were marked as Internal for the release public. When using bulk modify operation to change the value of the ‘level’ field for tickets to ‘None’ in JIRA, be sure to disable notifications to avoid spamming watchers.

7) Mark all versions that were shipped as part of the release as “released”. When doing so, be sure to update the description and release date of each version as needed based on what was shipped when.

8) Update the Kanban board for the release series. Remove the release filter from the underlying filter for the board and remove the quick filter for the release as well.
",Task,PUP-8629,['release'],Update Confluence and JIRA based on release (Puppet Platform 5.3.6)
"(Initial planned release date: 2018-04-17)

1) Ensure all prerequisite release tasks are complete.

2) Review the release Kanban board to ensure all tickets are resolved.

3) Ping release leads in ‘Platform Core’ HipChat room for go/no-go decision.

4) Send email indicating Ready To Ship milestone has been achieved.
",Task,PUP-8628,['release'],Declare Ready to Ship (go/no-go) milestone (Puppet Platform 5.3.6)
"(Initial planned release date: 2018-04-17)

Please paste the text of the announcement in the 'Send announcement' ticket.
If there are any links, it would be most helpful for the sender if they were already hyperlinked to the display text, so only a copy+paste to Gmail is necessary.
",Task,PUP-8627,['release'],Prepare release announcement (Puppet Platform 5.3.6)
"(Initial planned release date: 2018-04-17)

1) Send an email reminder ahead of time about the upcoming Stop Ship milestone date.

2) Review tickets on the release Kanban board to ensure all code changes have landed. Flag any related issues that are not yet Ready for CI.

3) Ensure all tickets have release notes, if needed. Add comments to issues without release notes, asking the author of the PR to add them or indicate that they aren’t needed.

4) Follow up with the Engineering lead for each component (e.g., in HipChat) to confirm current state and obtain a forecast for when all code will be in a build.

5) Send email indicating that the Stop Ship milestone has been achieved.
",Task,PUP-8626,['release'],Declare Stop Ship Line (code complete) milestone (Puppet Platform 5.3.6)
"(Initial planned release date: 2018-04-17)

1) Ensure “Versions & Dependencies” pages for Puppet Platform and puppet-agent are up to date in Confluence. Reach out to teams as needed to confirm that the fix versions listed are those that we intend to ship with the release.

2) For each component project of Puppet Platform and puppet-agent, ensure there is a next version if needed. Often this will be the next Z in an X.Y.Z series. However, if we are jumping to a new X or Y release that skips an existing Z version in JIRA, make sure those tickets are reassigned to the correct fix version, and the unneeded version is deleted. For example, if we have tickets with a fix version of 4.3.3, but we’re going from 4.3.2 to 4.4.0, then we need to reassign the tickets assigned to 4.3.3 and delete the 4.3.2 version from JIRA.

3) Create public filters for inclusion in the release notes and/or announcement. These allow easy tracking as new bugs come in for a particular version and allow everyone to see the list of changes in a release. Include links to the filters as a comment on this issue before resolving it.

4) Update the “master” filters for Puppet Platform 5.3.6 and puppet-agent 5.3.6 to reference the “Fixed in” filters created above.

5) Update the community feedback filter for Puppet Platform X.y to reference the “Introduced in” filter created above.
",Task,PUP-8625,['release'],Prepare JIRA for release (Puppet Platform 5.3.6)
"Puppet Platform 5.3.6 Release - 2018-04-17
",Epic,PUP-8624,[],"Puppet Platform 5.3.6 Release - 2018-04-17
"
"In PUP-8492 the empty function was moved from stdlib to puppet and it introduced a deprecation of calling {{empty(undef)}}. As discussed in PUP-8492, that deprecation is not wanted and it should be removed.
",Bug,PUP-8623,[],Remove deprecation of empty(undef) introduced in PUP-8492
"It is currently not possible to concatenate two instances of the {{Binary}} data type.
This should be allowed using operator {{+}}.",Improvement,PUP-8622,[],Allow concatenate with + on Binary type
It is currently not possible to specify a Binary data type with constraint on size. It should be parameterized the same way as String with a min and max size.,Improvement,PUP-8621,[],Binary data type should be parameterized with size
Improvements to the Host Type,Epic,PUP-8620,[],Host Type/Provider Improvements
"Describe steps to reproduce…
 * manifest.pp
{code}  file { '/Users/<user>/PUP7534/firstFile':
     content => 'hello world',
     ensure => file
   }{code}
 * bundle exec ./bin/puppet apply manifest.pp

 * md5 /Users/<user>/PUP7534/firstFile
 ** to get checksum

 * checksum.pp
{code} file { '/Users/<user>/PUP7534/targetFile':
    ensure  => 'file',
    checksum => 'md5',
    checksum_value => '5eb63bbbe01eeed093cb22bb8f5acdc3',
  }
{code}
 * bundle exec ./bin/puppet apply checksum.pp

*Desired Behavior:*

specifying checksum and checksum_value properties on a file resource causes puppet to use the corresponding file from filebucket to sync the file resource

*Actual Behavior:*

using checksum and checksum_value properties on a file resource result in an error: 'Checksum value is ignored unless content or source are specified'

*Acceptance Criteria:*
 * When checksum/checksum_value and content are specified
 ** compare checksum_value to file content on disk
 *** if out of sync 
 **** if content property
 ***** use content property value to update file content on disk
 **** else
 ***** use checksum_value to retrieve from filebucket
 * When checksum/checksum_value and source are specified
 ** this is fine
 ** if checksum doesn't match then look at source file (in_sync?)
 ** if no source fall back to file bucket
 * When one but not both of checksum or checksum_value are specified
 ** there should be a default for checksum so this isn't an issue
 * checksum type without value
 ** make sure nothing terrible happens here
 * source without checksum
 ** ?

 

 

 ",Bug,PUP-8619,[],File Resource: error when attempting to use checksum and checksum_value to retrieve from filebucket
"In the docs for installing the Puppet agent on Linux (https://puppet.com/docs/puppet/5.3/install_linux.html), step #4 says you can optionally set your server setting but doesn't tell you where the file lives to do that, instead just links to a reference of available other options to set.

I personally know that it goes in a file called puppet.conf, and so googling for that can get you this page, with this section on location: https://puppet.com/docs/puppet/5.3/config_file_main.html#location which tells you to consult another page for where the directory is.

I'd suggest consolidating this information on the ""Installing Puppet agent"" page since it's operating system specific: say to add it to the file `/etc/puppetlabs/puppet/puppet.conf`, which should allow people to keep going without consulting other sources.

This doesn't seem to apply to Windows since it uses a GUI installer but does seem to apply to the macOS instructions under ""Configure critical agent settings.""

Additionally, we could add a quick tip to the Config files location section that running `puppet config print confdir` should tell you what your confdir is set to on that node.",Task,PUP-8618,[],Puppet install docs don't say how to configure agent
"Some security tests are located here: [https://github.com/puppetlabs/puppet/blob/master/spec/integration/util/windows/security_spec.rb]

Security descriptor spec: [https://github.com/puppetlabs/puppet/blob/master/spec/unit/util/windows/security_descriptor_spec.rb]

Symbolic modes test (try to  include windows testing here): [https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/file/symbolic_modes.rb]

 ",Improvement,PUP-8617,[],SPIKE: Audit file permissions tests as necessary
"When upgrading a module on a private Forge the client crashes:

{{$ puppet module upgrade --module_repository=http://<customer>...com google-gstorage}}
{{Notice: Preparing to upgrade 'google-gstorage' ...}}
{{Notice: Found 'google-gstorage' (v0.2.0) in /home/nelsona/.puppetlabs/etc/code/modules ...}}
{{Error: undefined method `gsub' for false:FalseClass}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/forge.rb:240:in `decode_uri'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/forge.rb:110:in `fetch'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/module_tool/applications/upgrader.rb:93:in `run'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/face/module/upgrade.rb:73:in `block (3 levels) in <top (required)>'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/interface/action.rb+eval[wrapper]:264:in `upgrade'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/application/face_base.rb:247:in `main'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/application.rb:383:in `run_command'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/application.rb:375:in `block in run'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/util.rb:665:in `exit_on_fail'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/application.rb:375:in `run'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/util/command_line.rb:137:in `run'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/lib/puppet/util/command_line.rb:73:in `execute'}}
{{/home/nelsona/.rbenv/versions/2.5.0/lib/ruby/gems/2.5.0/gems/puppet-5.4.0/bin/puppet:5:in `<top (required)>'}}
{{/home/nelsona/.rbenv/versions/2.5.0/bin/puppet:23:in `load'}}
{{/home/nelsona/.rbenv/versions/2.5.0/bin/puppet:23:in `<main>'}}",Bug,PUP-8616,[],puppet module upgrade crashes
"get_format relies on the order that .find processes the hash to find the first entry to use. So the order of the hash which is insertion order matters.

There is a problem with {{Puppet::Pops::Type::StringConverter.sort_formats}} its passed an array which it sorts based on assignablity and rank order. This method on Ruby is not consistent in the order of the hash it ends up creating.

I had it process 3 entries from in the array, in the normal order and reverse order and then printed out the values:

{code: ruby}
   sort_formats(merged[-6..-4])
   sort_formats(merged[-6..-4].reverse) 
{code}

The array's after sorting look like this. These arrays should be sorted in the same order:

{noformat}
format_map:
key: Hash rank: 2
key: Array rank: 4
key: Binary rank: 0

format_map:
key: Binary rank: 0
key: Hash rank: 2
key: Array rank: 4
{noformat}

I think there are a couple issues with this part of the code:

{code}
        else
          # arbitrary order if disjunct (based on name of type)
          rank_a = type_rank(a)
          rank_b = type_rank(b)
          if rank_a == 0 || rank_b == 0
            a.to_s <=> b.to_s
          else
            rank_a <=> rank_b
          end
{code}

Why do we ignore the rank if any one of the key's has a rank of 0? 

Do we want a sort of this instead? where we use the rank if one of them is set and reverse the rank comparison so that high ranked items are higher?
Or should we be only using the {{a.to_s <=> b.to_s}} check when the ranks match

{code}
          if rank_a == 0 && rank_b == 0
            a.to_s <=> b.to_s
          else
            rank_b <=> rank_a
          end
{code}

",Bug,PUP-8615,[],sort_formats does not sort consistently with MRI Ruby which causes issues when find .find processes the hash to select a choice
Now that we are starting work to migrate to ruby 2.5.0 for puppet 6 we need to update travis and appveyor to test ruby 2.5.0 on the master branch of puppet.,Task,PUP-8614,"['ci', 'ruby', 'triaged']",Add ruby 2.5.0 to travis and appveyor test matrices for puppet
"JRuby's implementation of format/sprintf does not support '%a' and '%A' formatting of floating point numbers. 

JRuby issue:
https://github.com/jruby/jruby/issues/5122

{noformat}
$HOME/.rbenv/versions/jruby-9.1.15.0/bin/ruby -e 'puts Kernel.format(""%A"", 0.1)'
ArgumentError: malformed format string - %A
        % at org/jruby/RubyString.java:1195
  sprintf at org/jruby/RubyKernel.java:811
   <main> at -e:1
{noformat}",Task,PUP-8612,[],JRuby usage of format/sprintf does not support '%a' or '%A'
"*OS Name/Version: PE Master/Agent Version 2016.4.2 / Master RHEL 6.9 / Agent AIX 7.1*

Customer experienced high utilization of paging space on his agent which caused the following error during a puppet run:
{code:java}Could not prefetch cron provider 'crontab' target 'root': Could not read crontab for root: Not enough space - fork(2). Treating as empty
{code}
After the error occurred the customer's crontab was wiped and it left only the following:
{code:java}# HEADER: This file was autogenerated at 2017-11-09 13:20:05 -0500 by puppet. 
# HEADER: While it can still be managed manually, it is definitely not recommended. 
# HEADER: Note particularly that the comments starting with 'Puppet Name' should 
# HEADER: not be deleted, as doing so could cause duplicate cron jobs. 
<end>
{code}
Another agent run after the paging problems were fixed did not resolve the crontab and it had to be restored from a backup. After the file was present, subsequent puppet runs now correct the crontab entries.

*Desired Behavior:* When the error below occurs, crontab should not be wiped and should be left as is
{code:java}Could not prefetch cron provider 'crontab' target 'root': Could not read crontab for root: Not enough space - fork(2). Treating as empty
{code}
*Actual Behavior:* Crontab gets completely wiped when the error occurs during a puppet run.

 

 ",Bug,PUP-8611,[],Crontab gets erased after error during agent run
"Several places in Puppet call {{PuppetStack.stacktrace[0]}} to get their ""caller"". Most notably, log messages where the ""source"" is a Scope object _without_ an associated resource use that method to determine the ""source"" to log from. There are also some Puppet functions that use it (empty, create_resource, and more).

Those calls become quite slow (I saw up to 50ms) when the stack is large. While it's probably uncommon for the stack to grow that deep, _no_ caller currently uses anything but the top element of the stack, which means this is a straightforward opportunity for improvement.

It probably makes sense to either make that method lazy, which is a bit of a challenge as it's both a filter and a map, or to add a method that specifically returns the top element of the stack, which satisfies every current caller.",Bug,PUP-8610,[],PuppetStack.stacktrace is slow with a large stack
"The pinning of FFI to 1.9.18 done in PUP-8438 is slightly problematic as it means that Puppet cannot be run on Ruby 2.5. This is also causing some issues coordinating FFI versions with PDK and the ubergems like [https://rubygems.org/gems/puppet-module-win-default-r2.4]

 

There was initially some concern over the new gems as described in [https://github.com/puppetlabs/puppet/commit/d10b21f09107846d03fd8e2df6128f967207366c]

 

This ticket should validate the latest FFI, pick a minimum version, and bump the version in puppet-agent in addition to Puppet repo itself.",Task,PUP-8609,['Windows'],Bump FFI gem to ~> 1.9.22 to support Ruby 2.5
"As noted in BOLT-413, the printable representation for certain data types is very verbose. For example, {{TargetSpec}} defined as an alias in Bolt displays as
{code}
TargetSpec = Boltlib::TargetSpec = Variant[String[1], Object[{name => 'Target', attributes => {'uri' => String[1], 'options' => {type => Hash[String[1], Data], value => {}}}, functions => {'host' => Callable[[0, 0], String[1]], 'name' => Callable[[0, 0], String[1]], 'password' => Callable[[0, 0], Optional[String[1]]], 'port' => Callable[[0, 0], Optional[Integer]], 'protocol' => Callable[[0, 0], Optional[String[1]]], 'user' => Callable[[0, 0], Optional[String[1]]]}}], Array[Boltlib::TargetSpec]]
{code}
This can be seen by running {{bolt plan show canary}} in Bolt 0.18.1 (once we get BOLT-407 fixed).

I'd rather this use a succinct representation, like {{TargetSpec}} or {{TargetSpec = Bolt::TargetSpec}}.

I see two possibilities for fixing this:
- a way to define how the {{Bolt::TargetSpec}} type should be displayed via {{to_s}}
- provide the original parameter text from the plan declaration as part of the type returned via the {{params_type}} accessor on a {{plan}}.",Bug,PUP-8606,[],Module-defined data types are very verbose when displayed
"Move functions -unique-, -reject-, and {{sort()}} from stdlib to puppet and update them to use the 4.x function API. The new implementation must be backwards compatible but may add new features.

The {{reject()}} function is not essential since there is a more powerful and general {{filter()}} function in puppet. Will not move that function. The {{unique()}} function has already been moved to puppet.",Improvement,PUP-8605,[],Move sort function from stdlib to puppet
"Move String functions upcase, downcase, capitalize, camelcase, lstrip, rstrip, strip, chop, chomp from stdlib to puppet and update them to the 4.x function API. The new implementations must be backwards compatible but may add new features.

If possible implement these by using StringConverter functionality.",Improvement,PUP-8604,[],"Move String functions upcase, downcase, capitalize, camelcase, lstrip, rstrip, strip, chop, chomp from stdlib to puppet"
"The math functions abs, ceil, floor, round, min, max should be moved from stdlib to puppet and be modernized to the 4.x function API. They must be backwards compatible but can be extended in functionality where wanted (for example supporting array arguments if not already supported in current implementation).

",Improvement,PUP-8603,['Functions'],"Move math functions abs, ceil, floor, round, min, max from stdlib to puppet"
"Currently catalogs are post-processed by PDB to normalize them and to clean up certain (old?) constructs. As we now have validation (of some things) in the catalog that we did not use to have (dangling references to resources etc) it seems possible to produce catalogs that do not require as much post processing.

The work in this ticket is to list all of the validations and other requirements required to be able to minimize the amount of PDB post processing (if possible not require any at all).
Ping [~russell.mull]",Improvement,PUP-8602,[],Normalize/validate catalogs for PDB
"The 6.0 agent should request a catalog using a rich-data encoding by default.
The request rather than the current {{\--rich-data}} setting should control the format of the catalog. (The setting is still needed but it should default to true for command line execution).

An agent < 6.0 when talking to a server >= 6.0.0 not know how to request rich data format (now it assumes rich data if it has {{\--rich-data}} turned on.

I think it is safe to assume that we can simply ignore the {{\--rich-data}} flag on the agent side and state that in order to use rich-data you need to use a 6.y agent.

Further - in the current protocol, we change the encoding from JSON (the default) to PSON if we detect ASCII-8bit String data. With rich-data encoding we should not do this. There are options:
# (Magically) transform the ASCII-8bit String to a Binary - the agent will need to be able to deal with an instance of Binary (our File resource will be able to do so).
# Raise an error and tell user to use a Binary instead of an ASCII-8bit
# (Magically) deserialize a Binary to ASCII-8bit on the agent side to allow types and providers that are unaware of the Binary type work as they did before. (This has bad side effects further downstream in reports etc).

Number 2 is the preferred (non magical) solution.",Improvement,PUP-8601,[],agent should support rich data content negotiation
,Improvement,PUP-8600,[],plugin-sync the data-types from all modules
"To make data types defined in modules available to the agent the loaders needs to be configured to include information in the plugin-synced modules. 

(Another ticket defines the work to get the data types plugin-synced).",Improvement,PUP-8599,[],make data types defined in modules available to puppet agent
,Improvement,PUP-8598,[],make 4.x loaders available to puppet agent
"Serialization of rich data in JSON/YAML is currently using the tags:
{code}
__pcore_type__
__pcore_value__
{code}

Those are longer than they need to be for making them unique/non-clashing with normal attributes.

We should shorten those to:
{code}
__ptype
__pvalue
{code}

When writing, but continue to support the longer tags when reading.
",Improvement,PUP-8597,[],Modify rich data serialization to use shorter tags instead of __pcore_type__
"Currently PAL only supports ScriptCompiler, it should also support a CatalogCompiler.",New Feature,PUP-8596,[],Add support for CatalogCompiler in PAL
"The PAL (Puppet As a Library) was added in Puppet 5.5.0. This Epic is for continued work for PAL - supporting Bolt with high level API to puppet, but also evolving into the main way the language/compiler is used via a well defined public API.",Epic,PUP-8595,[],PAL API in 6.y
"In PUP-8237 injection of a compiler was added as a feature in the function API.
This needs to be documented in the 4.x function API specification.
",Improvement,PUP-8594,[],Specify injection of compiler in function API (added in PUP-8237)
"The existing hiera interpolation function {{alias}} is problematic to use. By adding a key {{alias}} in {{lookup_options}} for an _original-key_  a lookup should take that _alias-key_ and use it to lookup instead of the given original-key.

Details:
* The implementation must guard against circular aliases
* There is an option wrt handling of the other lookup_options:
## Use the options for _original-key_ and ignore those in _alias-key_
## ignore the options for _original-key_ and use those for the _alias-key_
## merge the options with _original-key_ at higher t
* If an _alias-key_ is in turn aliased, the process recurses

Option 3 allows for just specifying {{alias}} and getting the rest of the options from the aliased key.

We can also add advanced features:
* If the _alias-key_ is an array, the entries in that array are used as aliased lookups and the result is an array with those values.
* If the _alias-key_ is a hash, the keys are used as keys in the resulting hash where values are the looked up keys",New Feature,PUP-8593,[],Add alias to lookup_options and make it redirect to lookup of the alias
"{code}
❯ puppet config --section main print confdir >/dev/null
Resolving settings from section 'main' in environment 'production' {code}

I already know what section it's from; I don't need to have it print it.",Bug,PUP-8592,['customer0'],`puppet config --section main print` writes section info to stderr
"We want to investigate removing the Ruby CA/catalog serving from Puppet so that we only have one implementation of a Puppet master/CA and thus avoid some terrible conflict cases. In order to feel more confident about the difficulty of this change, try ripping some things out and testing it out to see what breaks.",Task,PUP-8591,[],Actually delete webrick
"When trying to use types with symbols the apply functionality in `puppet device` errors.
{noformat}Error: Unsupported data type: 'Symbol' on node csr1kv-local-1
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:832:in `deep_freeze'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:825:in `block in deep_freeze'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:825:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:825:in `deep_freeze'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:808:in `set_facts'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:811:in `set_node_parameters'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:157:in `block (2 levels) in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:157:in `block in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:260:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:153:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:306:in `block (2 levels) in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:304:in `block in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:232:in `block in benchmark'
/opt/puppetlabs/puppet/lib/ruby/2.4.0/benchmark.rb:308:in `realtime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:231:in `benchmark'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:302:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:54:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:198:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:262:in `block in main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:260:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:233:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:174:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:290:in `block (3 levels) in main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:260:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:289:in `block (2 levels) in main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:244:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:244:in `collect'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:244:in `block in main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:260:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:229:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:672:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'

{noformat}",Bug,PUP-8590,[],puppet device --apply does not support symbol facts
"When running puppet apply or puppet agent in noop mode, the output should list all the hiera keys listed in the module along with their values and also the hiera data path(s) they were found in.

In our scenario, we have a central hiera repository and the component modules do not have all the hiera data inside the module.

We can run puppet apply/agent with --debug flag and it shows the hiera keys/values in the output alongwith the paths but the output is too verbose and not easily readable.

The ask here is to have another flag with puppet apply/agent (let's call it --demgstify) to only lookup hiera keys required to run the module and list them along with their values and paths.

This will greatly help us troubleshooting puppet runs.",New Feature,PUP-8589,[],"Puppet apply or agent should list hiera keys, values and their paths"
"Currently, tasks are defined to only have one implementation file. In order to support cross-platform tasks, we need to have the ability to load multiple implementations for a task and dynamically determine which one to use on a given target.

The proposal for this is to allow multiple implementation files with names matching the task, but with different extensions. This includes a new metadata key {{implementation}} which specifies the supported implementations and which features are required on the target.

The TaskInstantiator needs to be updated to support this new metadata field and pass it along to Bolt.",New Feature,PUP-8588,[],Support multiple implementations when loading tasks
This is an epic for support of Rich Data in the Catalog for the purpose of supporting primarily the Binary data type and new features for late binding values.,Epic,PUP-8587,[],Rich Data support (Binary and others) in Puppet 6.y 
"During an agent run, if a feature is not available, notably {{msgpack}}, we print a scary looking message:

{noformat}
Debug: Dynamically-bound server lookup failed, falling back to server setting
Debug: Dynamically-bound port lookup failed; falling back to masterport setting
Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: file_metadata supports formats: json pson yaml
{noformat}

The ""Failed to load library"" sounds bad, but it isn't. It just means an optional feature isn't enabled, which is the normal/default case.

We should make the message less scary. We should only emit the message once, not everytime we make a {{file_metadata}} request.

Similarly, the ""Dynamically-bound server"" and ""port"" messages are repeated for every {{file_metadata}} request.

Similarly, if a type's property/parameter depends on a provider feature, and that provider feature isn't available, we repeat the same set of messages for every instance of that resource type. I think we should only emit the message once per resource type (and possibly once if the feature becomes true later in the run if the command, feature, etc becomes available):

{noformat}
Debug: /Firewall[a]: Provider iptables does not support features hop_limiting; not managing attribute hop_limit
Debug: /Firewall[a]: Provider iptables does not support features ishasmorefrags; not managing attribute ishasmorefrags
Debug: /Firewall[a]: Provider iptables does not support features islastfrag; not managing attribute islastfrag
Debug: /Firewall[a]: Provider iptables does not support features isfirstfrag; not managing attribute isfirstfrag
...
Debug: /Firewall[b]: Provider iptables does not support features hop_limiting; not managing attribute hop_limit
Debug: /Firewall[b]: Provider iptables does not support features ishasmorefrags; not managing attribute ishasmorefrags
Debug: /Firewall[b]: Provider iptables does not support features islastfrag; not managing attribute islastfrag
Debug: /Firewall[b]: Provider iptables does not support features isfirstfrag; not managing attribute isfirstfrag
{noformat}",Task,PUP-8586,[],Feature related debug messages are confusing and generate too much spam
The error message is not displayed unless --debug is passed.,Bug,PUP-8585,[],puppet device --resource should fail if non-existent target is given
When executing `puppet device` against multiple targets processing will stop if a CSR request or --waitforcert 0 is used.,Bug,PUP-8584,[],puppet device does not continue executing subsequent devices on cert request
"We're not entirely sure what causes this, but sometimes JrJackson seems to output numbers -> JSON strings. PuppetDB, at least, expects these to be numbers and will blow up on submitting reports. We probably need to add custom serialization logic after we figure out exactly what's going wrong.",Bug,PUP-8583,[],Fix JrJackson serialization of numbers so we can use it
"Append the vendored modules directory to the default basemodulepath visible across all environments.

Pluginsync should download modules' lib directories.
The compiler should be able to load types from the modules' lib directories.

The vendored modules directory should have the least precedence (per-environment modulepath, global modulepath, and pluginsync libdir) should all have higher priority, so that the vendored versions can be overrridden.

puppetserver: installing an updated module should override {{vendor_modules}} (from the puppet-agent package on the local host).
puppet agent: pluginsynced modules should override {{vendor_modules}}
puppet apply/resource: locally installed modules should override {{vendor_modules}}

The modules mount must resolve files in the same way that the autoloader does so that the same type (and its respective provider) used during compilation are pluginsynced to the agent.

It should be possible to remove the vendored modules directory from the either the basemodulepath or in a per-environment modulepath so that the vendored modules are ignored, eg. trying to compile a manifest should fail if the type is not installed using PMT.",Task,PUP-8582,[],Add vendor_modules to basemodulepath
Extract zone type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8581,[],Extract zone type/provider into a module
Extract zfs type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8580,[],Extract zfs type/provider into a module
Extract yumrepo type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8579,[],Extract yumrepo type/provider into a module
Extract sshkey and ssh_authorized_key type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8578,[],Extract sshkeys type/provider into a module
Extract selinux type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8577,[],Extract selinux type/provider into a module
Extract scheduled_task type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8576,[],Extract scheduled_task type/provider into a module
Extract network_device type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8575,[],Extract network_device type/provider into a module
Extract mount type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8574,[],Extract mount type/provider into a module
Extract macdslocal type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8573,[],Extract macdslocal type/provider into a module
Extract maillist type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8572,[],Extract maillist type/provider into a module
Extract mailalias type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8571,[],Extract mailalias type/provider into a module
Extract k5login type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8570,[],Extract k5login type/provider into a module
Extract host type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8569,[],Extract host type/provider into a module
Extract cron type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8568,[],Extract cron type/provider into a module
Extract augeas type/provider into a module per https://github.com/puppetlabs/puppet-specifications and https://docs.google.com/document/d/1v00xgnfnowAqedKZm-GzSjLYD5rRhToQicrk9Y1MK2E,Task,PUP-8567,[],Extract augeas type/provider into a module
"While the enhancements implemented in PUP-2868 are arguably good, because they make {{puppet config print}} less confusing for novice users, making {{puppet config print}} _unconditionally_ emit messages to stderr is undesirable, as the extraneous stderr messages can confuse programs which are using {{puppet config print}} non-interactively and are parsing the output.

Case in point: I have multiple cron jobs that use {{puppet config print}} to obtain Puppet configuration information. After upgrading to 5.5.0, I am now receiving messages like this on an hourly basis:

{noformat}
From: ""(Cron Daemon)"" <root@example.org>
To: root@example.org
Subject: Cron <root@myhost> run-parts /etc/cron.hourly
Date: Wed, 21 Mar 2018 13:01:01 -0400

/etc/cron.hourly/puppet-purge-reports:

Resolving settings from section 'master' in environment 'production'
{noformat}

Sure, I can rewrite the cron scripts in question to redirect stderr to {{/dev/null}}. But if I do this, I will lose legitimate error messages that {{puppet config print}} might generate. So simply discarding stderr entirely is not a good solution.

The real problem here is that PUP-2868 violated one of the core tenets of good user interface design, which is: if you are going to make something be verbose _by default_, then you *must* provide a mechanism to disable that verbosity.

Simply put, {{puppet config print}} needs a {{\-\-quiet}} option, which disables all output to stderr _except_ for error (and arguably warning) messages.

(Whether {{\-\-quiet}} should disable warnings is something of a religious argument, but in this case, I'm not sure it matters, as using {{\-\-section}} should prevent {{puppet config print}} from issuing any warnings.)

So, in summary, while making {{puppet config print}} verbose by default was arguably a good idea, there must be a mechanism to disable that verbosity, in cases where {{puppet config print}} is being used programmatically, and verbosity is unwanted.",New Feature,PUP-8566,[],"""puppet config print"" should only emit diagnostic info when run with verbose or higher"
,Epic,PUP-8565,[],Zone Type/Provider Improvements
"Currently `puppet device` delegates the collection of facts to the module being used.

This prevents custom facts from being used.

Investigate if it is possible to integrate custom facts into `puppet device`

 

Specifically customers want to be able to get the IP address of their IOS devices as a fact.",New Feature,PUP-8564,[],puppet device - add support for custom facts
"According to the documentation at [https://puppet.com/docs/puppet/5.4/configuration.html#certificaterevocation] the certificate_revocation option, when set to anything but false will cause the client to try to download the CRL.

If a user is using an external CA, then they should have the option to update the CRL file on the local system and set this to local so that the client can use the CRL placed using whatever method is deemed appropriate for the environment.",Bug,PUP-8563,[],The puppet agent should have a 'local' mode for CRL checking
"Hello,

we noticed that puppet runs take twice as long after updating to latest version. We did some research and noticed that ""time - file"" (–profile --summarize) doubled.

The puppetdb version had no effect on this.

Example node with agent 5.4.0 and server 5.2 :

time file : 163,63

Same node with agent 5.2 and server 5.1.4

time file : 80,54

 

visual:

!image.png!

Please let me know if you need further data.

also avail on slack as ""betriebsrat""",Bug,PUP-8562,[],File performance nearly twice as slow after update
"*Puppet Version: 5.4.0*
 *Puppet Server Version: 5.2.0*
 *OS Name/Version: CentOS 7.4.1708*

I am unable to find a way to set the ""log_format"" variable in nginx.conf using augeas. The problem seems to be the combination of quotes within quotes just doesn't seem to be possible.

The desired value I am trying to set exactly is:
{noformat}timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] ""$request"" $status $body_bytes_sent ""$http_referer"" ""$http_user_agent"" $request_time $upstream_response_time $pipe'{noformat}
Take careful note that I need to have the long single quoted string, but that this contains some double quoted strings. I have tried every possible combination I can think of for enclosing in single or double quoted strings in and for escaping then, but I have not successfully managed to set exactly what is required. I have tried so many different possible ways over the last 2 days that I am now convinced I haven't missed something and that this has to be a bug.

To describe some of the more obvious steps I have tried, lets store the initial variables like as following:
{code:puppet}
#The log title:
$log_title = 'timed_combined'

#Set-up the needed log_format string:
$log_format_str = '$remote_addr - $remote_user $http_x_unit_id [$time_local] ""$request"" $status $body_bytes_sent ""$http_referer"" ""$http_user_agent"" $request_time $upstream_response_time $pipe'
{code}
The initial most logical combination of options that I have tried are (elaborated here to try and make it clear):

*Attempt 1*
Escape the double quotes within the substring, then pass the variable in augeas with escaped quotes:
{code:puppet}
# Create the combined string
$use_log_format = regsubst(""${log_title} '${log_format_str}'"", '""', '\\""', 'G')

augeas { 'set-up_log_format':
    context => ""/files${conf_file}/http"",
    changes => [
        ""set log_format \""${use_log_format}\""""
    ]
}
{code}
Produces:
{noformat}
-    log_format  main  '$remote_addr - $remote_user [$time_local] ""$request"" '
-                      '$status $body_bytes_sent ""$http_referer"" '
-                      '""$http_user_agent"" ""$http_x_forwarded_for""';
+    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \""$request\"" $status $body_bytes_sent \""$http_referer\"" \""$http_user_agent\"" $request_time $upstream_response_time $pipe';
{noformat}
*Result:* Produces almost exactly what I want, but unfortunately the escapes have been passed through and retained. The result is confirmed when grep'ing the file:
{noformat}
root@devsvr2 ~]# grep log_format /etc/nginx/nginx.conf
    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \""$request\"" $status $body_bytes_sent \""$http_referer\"" \""$http_user_agent\"" $request_time $upstream_response_time $pipe';
{noformat}
Maybe I do not need the escapes? Let's try without...

*Attempt 2*
Don't escape the double quotes within the substring, but still pass the variable in augeas with escaped quotes:
{code:puppet}
# Create the combined string
$use_log_format = ""${log_title} '${log_format_str}'""

augeas { 'set-up_log_format':
    context => ""/files${conf_file}/http"",
    changes => [
        ""set log_format \""${use_log_format}\""""
    ]
}
{code}
Produces:
{noformat}
-    log_format  main  '$remote_addr - $remote_user [$time_local] ""$request"" '
-                      '$status $body_bytes_sent ""$http_referer"" '
-                      '""$http_user_agent"" ""$http_x_forwarded_for""';
+    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] ;
{noformat}
*Result:* As you might expect, the unescaped quotes cause the value to be truncated completely. How about we wrap it in single quotes in the augeas command instead? Let's try it...

*Attempt 3*
Single quotes in the augeas command instead of the escaped doubles:
{code:puppet}
# Create the combined string
$use_log_format = ""${log_title} '${log_format_str}'""

augeas { 'set-up_log_format':
    context => ""/files${conf_file}/http"",
    changes => [
        ""set log_format '${use_log_format}'""
    ]
}
{code}
Produces:
{noformat}
-    log_format  main  '$remote_addr - $remote_user [$time_local] ""$request"" '
-                      '$status $body_bytes_sent ""$http_referer"" '
-                      '""$http_user_agent"" ""$http_x_forwarded_for""';
+    log_format  timed_combined  ;
{noformat}
*Result:* Now we've lost the value altogether. Maybe I'd better escape those single quotes in the string too...

*Attempt 4*
*Single quotes in the augeas command, but add escapes to the single quotes that define the substring in the variable*
{code:puppet}
# Create the combined string
$use_log_format = ""${log_title} \\'${log_format_str}\\'""

augeas { 'set-up_log_format':
    context => ""/files${conf_file}/http"",
    changes => [
        ""set log_format '${use_log_format}'""
    ]
}
{code}
Produces:
{noformat}
-    log_format  main  '$remote_addr - $remote_user [$time_local] ""$request"" '
-                      '$status $body_bytes_sent ""$http_referer"" '
-                      '""$http_user_agent"" ""$http_x_forwarded_for""';
+    log_format  timed_combined  \'$remote_addr - $remote_user $http_x_unit_id [$time_local] ""$request"" $status $body_bytes_sent ""$http_referer"" ""$http_user_agent"" $request_time $upstream_response_time $pipe\';
{noformat}
*Result:* Oh wonderful! Now we have a the reverse of attempt 1 - the escaped single quotes have now been passed through to the final output. Again, confirming this is real and not just in the displayed output:
{noformat}
[root@devsvr2 ~]# grep log_format /etc/nginx/nginx.conf
    log_format  timed_combined  \'$remote_addr - $remote_user $http_x_unit_id [$time_local] ""$request"" $status $body_bytes_sent ""$http_referer"" ""$http_user_agent"" $request_time $upstream_response_time $pipe\';
{noformat}

As you can see, this is how I began. I tried adding various extra levels of escape and switching back and forth between single and double quotes, but nothing worked.

I then eventually tried to apply the same set-up manually using augtool, and it didn't take long to get a working result:
*Attempt 1:*
Set the line value, in double quotes, with no escapes:
{noformat}
augtool> set /files/etc/nginx/nginx.conf/http/log_format ""timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] ""$request"" $status $body_bytes_sent ""$http_referer"" ""$http_user_agent"" $request_time $upstream_response_time $pipe'""
{noformat}
*Produces:*
{noformat}
augtool> print /files/etc/nginx/nginx.conf/http/log_format
/files/etc/nginx/nginx.conf/http/log_format = ""timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $request_time $upstream_response_time $pipe'""
{noformat}
*Result:* Missing the double quotes in the output. Okay, I'll try escaping them:

*Attempt 2:*
Set the line value, in double quotes, and escape the double quotes in the substring:
{noformat}
augtool> set /files/etc/nginx/nginx.conf/http/log_format ""timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \""$request\"" $status $body_bytes_sent \""$http_referer\"" \""$http_user_agent\"" $request_time $upstream_response_time $pipe'""
{noformat}
*Produces:*
{noformat}
augtool> print /files/etc/nginx/nginx.conf/http/log_format
/files/etc/nginx/nginx.conf/http/log_format = ""timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \""$request\"" $status $body_bytes_sent \""$http_referer\"" \""$http_user_agent\"" $request_time $upstream_response_time $pipe'""
{noformat}
*Result:* Escapes are shown in the output value above, but when 'save' is run and we check the file on disk, we can see that it is actually correct:
{noformat}
[root@devsvr2 ~]# grep log_format /etc/nginx/nginx.conf
    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] ""$request"" $status $body_bytes_sent ""$http_referer"" ""$http_user_agent"" $request_time $upstream_response_time $pipe';
{noformat}

So, I guess the ultimate question is: Is this a bug, or is this the correct expected behaviour? If it is the latter, then this feature is becomes pretty unusable.

Before posting, I did a fair amount of searching for someone else with the exact same issue, and though I found plenty of comments/tickets/posts from people with similar issues, none were the exact same issue as mine; but I apologise now if the above for the slightest moment wastes someone's time.",Bug,PUP-8561,[],Augeas unable to handle escaped quotes within quotes
"The Puppet resource ""zpool"" (cf. 1) does not handle the attachment of ""cache"" (cf. 2) disks to the storage pool.

1. [https://puppet.com/docs/puppet/5.3/types/zpool.html]

[2. https://docs.oracle.com/cd/E19253-01/819-5461/gfxtd/index.html|https://docs.oracle.com/cd/E19253-01/819-5461/gfxtd/index.html]

 

*Desired Behavior:*

Declare a ""zpool"" in puppet manifest in this fashion :
{code:java}zpool { 'tank' :
ensure => present,
raidz  => ['da1 da2', ...],
spare  => ['...'],
cache  => ['daX,daY'],
}
{code}
*Actual Behavior:*

Error: Failed to apply catalog: no parameter named 'cache'

Cache attribute is not part of Puppet ""zpool"" resource.

 ",Improvement,PUP-8560,[],"Handle ""cache"" for zpool resource"
"_Basic Info_
 *Module Version:*
 *Puppet Version: 4.10.8*
 *OS Name/Version: RHEL 6.9*

The datatypes from indirect dependencies are not loaded. If you do so, this will result an error and the puppet-agent will fail with: 

*Error: Evaluation Error: Resource type not found: Stdlib::Absolutepath at /etc/puppetlabs/code/environments/production/modules/my_module2/manifests/init.pp:2:3 on node ...*

The functions, types, defined types can still be used without any problem. 

My expectation is that everything is treated the same way and that I only have to define the needed dependencies 

Example:

!image-2018-03-15-15-15-36-015.png!

In this case the datatype *Stdlib::Absolutepath* can not be used by the module *my_module*, but the function *abs* can be used

If I want to use the datatype *Stdlib::Absolutepath* in the module *my_module* I need also to specify the dependency on *stdlib*

!image-2018-03-15-15-13-13-281.png!

 *Desired Behavior:*

**Datatypes are also loaded using the dependencies

*Actual Behavior:*

Datatypes are not loaded using the dependencies

Testcase added
 * puppet apply site.pp will succeed because the module my_module has both dependencies on mystdlib and stdlib
 * puppet apply site2.pp will fail because the module mo_module has only a dependency on mystdlib because the mystdlib module already has the dependency on stdlib
 * puppet apply site3.pp will succeed because there's no datatype of the stdlib module used. Only the abs function is used.

 ",Bug,PUP-8559,[],puppet-agent : Datatypes not loaded when using dependencies
"The PMT has a {{--strict-semver}} command line argument (defaults to true), which makes it possible to disable strict mode. This behavior is only present in our vendored semantic_puppet code. So we need to remove the capability in 6 prior to unvendoring semantic_puppet.",Task,PUP-8558,[],Remove ability to enable non-strict mode in PMT
"The {{notify}} resource is useful for debugging and status tracking, but becomes an issue when you have automated tooling or procedures that indicate that puppet should be re-run any time it indicates a change.

Currently, the {{notify}} resource always indicates a change.  This default functionality can't be changed, since there might be code that relies on that.  Instead, I suggest adding a new parameter {{nochange}} which, if true, indicates the resource should not report itself as changed.

I will submit a PR for this shortly.",Improvement,PUP-8557,[],Allow `notify` resource to not signal a change
"The ""modulepath"" parameter in environment.conf should support the use of globs in the path specification, but currently does not.

The use of globs allows somewhat elegant solutions to problems not found in environments which require something more complex than a standard Puppet environment layout and workflow.",Improvement,PUP-8556,[],environment.conf modulepath should accept globs
"Ignore this, using it as an epic separator",Epic,PUP-8555,[],===============
"Problem:
When using PAL puppet settings may be unexpectedly be picked up from puppet's configuration directories.

Bolt has hacked around this problem by wrapping PAL calls with:
{noformat}
    def with_puppet_settings
      Dir.mktmpdir('bolt') do |dir|
        cli = []
        Puppet::Settings::REQUIRED_APP_SETTINGS.each do |setting|
          cli << ""--#{setting}"" << dir
        end
        Puppet.settings.send(:clear_everything_for_tests)
        Puppet.initialize_settings(opts)
        yield
      end
    end
{noformat}

Since PAL usage is likely to be separate from puppet's existing configuration this seems like a problem that should be solved in PAL itself. I'm not sure generally how PAL users want to interact with system puppet settings, if they need to initialize them in a non-empty state, reinitialize them, or are concerned with the global statefulness of them. 

For bolt's current usage a method to initialize empty puppet settings once for the duration of the process would be adequate.",New Feature,PUP-8553,[],PAL should be able to run with 'empty' puppet settings
"Currently, we maintain a list of platforms that dnf and systemd are default for. This is unsustainable, as we have to update this list for every new release. What we should be doing is have a blacklist defining which subset of platforms the older provider is default for (yum and upstart, respectively). This will reduce the long term maintenance costs for these two providers.

We already have something like this for upstart, where we have a list of ubuntu platforms that upstart should be the default service provider for. However, the tests fail when we remove the platform restrictions for ubuntu systemd. Older ubuntu versions like 12.04 show that systemd is the default, which is wrong. We need to be careful this does not happen.",Task,PUP-8552,"['linux', 'systemd', 'type_and_provider']","Make dnf default for fedora, and systemd default for ubuntu/debian"
The agent's HTTP connections handling has some bugs and is in need of some improvements.,Epic,PUP-8550,[],Agent HTTP connection improvements
"Lots of garbage is generated by the ValidTagRegex in tagging.rb, as on JRuby it's forced to rebuild the regular expression every time it is matched against a string of a different encoding.

 

One solution is to put a u on the end to force UTF-8 and not let it change. It will fail hard if it encounters something other than UTF-8 or ASCII. There is a test that fails when this change is applied and I'm not sure whether the test is wrong or the fix is wrong.

 

Another solution would be to make sure strings reaching that are almost always UTF-8 (an occasional cache invalidation won't hurt too much, but right now it seems to happen on every match).",Bug,PUP-8549,[],Reduce regular expression garbage in puppet
"We're running our Puppet tests with `apply` in docker containers. From time to time we're seeing strange errors which seem to come from apt source list files not being on disk as apt::update is triggered.

Apt doesn't know anything about the additional repository:
{code:java}root@9af454802315:/# ls -la /etc/apt/sources.list.d/zabbix.list
-rw-r--r-- 1 root root 114 Mar 14 05:49 /etc/apt/sources.list.d/zabbix.list
root@9af454802315:/# apt-cache policy zabbix-server-mysql
zabbix-server-mysql:
  Installed: 1:2.4.7+dfsg-2ubuntu2.1
  Candidate: 1:2.4.7+dfsg-2ubuntu2.1
  Version table:
 *** 1:2.4.7+dfsg-2ubuntu2.1 500
        500 https://mirror.syseleven.de/ubuntu xenial-updates/universe amd64 Packages
        100 /var/lib/dpkg/status
     1:2.4.7+dfsg-2ubuntu2 500
        500 https://mirror.syseleven.de/ubuntu xenial/universe amd64 Packages
root@9af454802315:/# apt-get update
Ign:1 http://apt.puppetlabs.com xenial InRelease
Hit:2 http://apt.puppetlabs.com xenial Release
Hit:3 https://mirror.syseleven.de/ubuntu xenial-backports InRelease
Hit:4 https://mirror.syseleven.de/ubuntu xenial-security InRelease
Hit:5 https://mirror.syseleven.de/ubuntu xenial-updates InRelease
Hit:6 https://mirror.syseleven.de/ubuntu xenial InRelease
Hit:8 http://repo.percona.com/apt xenial InRelease
Get:9 http://repo.zabbix.com/zabbix/3.0/ubuntu xenial InRelease [7093 B]
Get:10 http://repo.zabbix.com/zabbix/3.0/ubuntu xenial/main amd64 Packages [2444 B]
Fetched 9537 B in 1s (8328 B/s)
Reading package lists... Done
root@9af454802315:/# apt-cache policy zabbix-server-mysql
zabbix-server-mysql:
  Installed: 1:2.4.7+dfsg-2ubuntu2.1
  Candidate: 1:3.0.15-1+xenial
  Version table:
     1:3.0.15-1+xenial 500
        500 http://repo.zabbix.com/zabbix/3.0/ubuntu xenial/main amd64 Packages
 *** 1:2.4.7+dfsg-2ubuntu2.1 500
        500 https://mirror.syseleven.de/ubuntu xenial-updates/universe amd64 Packages
        100 /var/lib/dpkg/status
     1:2.4.7+dfsg-2ubuntu2 500
        500 https://mirror.syseleven.de/ubuntu xenial/universe amd64 Packages
{code}
But Puppet tells us that the file got placed before triggering apt::update, so apt should know about the repository:
{code:java}Notice: /Stage[main]/Zabbix::Repo/Apt::Source[zabbix]/Apt::Key[Add key: FBABD5FB20255ECAB22EE194D13D58E479EA5ED4 from Apt::Source zabbix]/Apt_key[Add key: FBABD5FB20255ECAB22
3D58E479EA5ED4 from Apt::Source zabbix]/ensure: created
Notice: /Stage[main]/Zabbix::Repo/Apt::Source[zabbix]/Apt::Setting[list-zabbix]/File[/etc/apt/sources.list.d/zabbix.list]/ensure: defined content as '{md5}f5c0f867946b96c7706d35083c118733'
Notice: /Stage[main]/Sys11mysql::Repo/Apt::Source[percona]/Apt::Key[Add key: 4D1BB29D63D98E422B2113B19334A25F8507EFA5 from Apt::Source percona]/Apt_key[Add key: 4D1BB29D63D98E422B2113B19334A25F8507EFA5 from Apt::Source percona]/ensure: created
Notice: /Stage[main]/Sys11mysql::Repo/Apt::Source[percona]/Apt::Setting[list-percona]/File[/etc/apt/sources.list.d/percona.list]/ensure: defined content as '{md5}fbbedc4eba5a288aa968a3d20e94bb36'
Notice: /Stage[main]/Apt::Update/Exec[apt_update]: Triggered 'refresh' from 1 event
Notice: /Stage[main]/Nagios::Nrpe/File[/etc/nagios/nrpe.cfg]/owner: owner changed 'root' to 'nagios'
Notice: /Stage[main]/Nagios::Nrpe/File[/etc/nagios/nrpe.cfg]/group: group changed 'root' to 'nagios'
Notice: /Stage[main]/Nagios::Nrpe/File[/var/cache/nagios_results]/ensure: created
Notice: /Stage[main]/Nagios::Nrpe/File[/usr/local/bin/sys11-nrpe]/ensure: defined content as '{md5}2deb57ccac742ed57bdd421266ef7a9b'
Notice: /Stage[main]/Zabbix::Server/Package[zabbix-server-mysql]/ensure: created
{code}
This seems to be a sync to disk problem. Futher debugging in [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type/file/content.rb#L124] showed that the `sync` ([https://ruby-doc.org/core-2.2.2/IO.html#method-i-sync]) parameter of the file object is set to 'false'. Should this be set to true?",Bug,PUP-8548,"['container', 'triaged', 'type_and_provider']",File isn't synced to disk
"As noted in PUP-8541 the Ruby YAML parser does not detect certain errors that the YAML specification defines as illegal. 

* keys must be unique and not overwrite
* faulty indentation not raising error

The issues needs to be reported to upstream projects (if they do not already have tickets for these problems). We need to wait for fixes as we must rely on the native implementation of YAML parsing or we would not have good performance.

Note that the problems are for invalid YAML that Ruby thinks is valid but for which it produces a bad result.

Example - this should be an error:
{code:yaml}
---
somevar: 1
somevar: 2
{code}

Example - this should be an error:
{code:yaml}
--- 
#someobj: 
  a: 1
  b: 2
somevar: 1
{code}",Bug,PUP-8547,[],MRI and JRuby Yaml parsers not compliant with spec wrt. errors
"*Puppet Version: 5.4.0*
 *Puppet Server Version: n/a*
 *OS Name/Version: macOS 10.13.3*

Puppet 5.4.0 using ruby 2.4.3 can't handle invalid plists.

If a plist contains and invalid comment (e.g., a comment with '–' in the text), CFPropertyList will fail to parse it, passing it on to a shell out to `plutil -convert xml1 -o /dev/stdout`. However, it seems some subsystem (I believe it may be ruby 2.4) doesn't allow operations on `/dev/stdout`

{{Warning: Cannot read file /Library/LaunchDaemons/badcomment.plist; Puppet is skipping it.\nDetails: Execution of '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/badcomment.plist' returned 1: <?xml version=""1.0"" encoding=""UTF-8""?>Warning: Cannot read file /Library/LaunchDaemons/badcomment.plist; Puppet is skipping it.\n}}

{{[...]}}

{{/dev/stdout: Operation not supported}}

To reproduce, add a comment containing '–' to any plist in /Library/LaunchDaemons, then run puppet.

*Desired Behavior:*

Puppet should handle the malformed plist and successfully call plutil.

*Actual Behavior:*

After CFPropertyList fails, the plutil call also fails.

 ",Bug,PUP-8545,[],puppet 5/ruby 2.4 can't handle invalid plists
"Remove the {{puppet master}} application, related webrick code in {{puppet/network/http/webrick*}}, and related unit tests. Verify all of the acceptance tests rely on {{puppetserver}}. Also remove the {{rack}} feature.",Task,PUP-8544,[],Remove webrick application and server
"*Puppet Version: 5.4.0*
 *OS Name/Version: All*

Reading the documentation, I believe the recommended way to access facts is through {{$facts}}, using [modern facts|https://puppet.com/docs/facter/3.9/core_facts.html#modern-facts].

However, some parts of the code base still relies on legacy facts. For example, see [provider/service/init.rb|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/service/init.rb#L7].

When writing a module which strictly relies on [modern facts|https://puppet.com/docs/facter/3.9/core_facts.html#modern-facts], this is bothering: the only way to make them work is to provide both [legacy|https://puppet.com/docs/facter/3.9/core_facts.html#legacy-facts] and modern facts. 

*Desired Behavior:*

Only relies modern facts.

*Actual Behavior:*

Still relies on legacy facts. Gives _weird_ errors, like this one:
{noformat}     Puppet::PreformattedError:
       Evaluation Error: Error while evaluating a Resource Statement, Could not autoload puppet/type/service: Could not autoload puppet/provider/service/gentoo: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass 
{noformat}

(i) Not using Gentoo: this misleading error is just a side effect of [this all to downcase|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/service/init.rb#L24] on an undefined legacy fact in my rspec-puppet mocked facts.",Bug,PUP-8543,[],Puppet partly relies on legacy facts
"Change documentation about the 'target' property for the 'yumrepo' provider

The 'target' property of the yumrepo provider does not work. To make it work would take a bit of work, which we want to do, but it would be best to wait until we've split the provider out of puppet. This ticket is to just change the documentation for 'target' for now and later we'll want to address PUP-2782 to make 'target' work correctly.

""The target parameter will be enabled in a future release and should not be used.""",Task,PUP-8542,[],document that the property 'target' for provider 'yumrepo' does not work
"PuppetServer/Hiera just ignores broken YAML files instead of hard failing on them.

The consequences can be as serious as compromised system and/or lost network access to host. I would consider that *critical* based on experience with the problem.

Below is broken sample from hierarchy for tests:

{code:yaml}
---
#classes:
 - cls1
 - cls2

somevar: 1
{code}
",Bug,PUP-8541,[],Hiera lookup must hard fail on invalid YAML
"*Puppet Version: 5.4.0*
 *Puppet Server Version:* *N/A*
 *OS Name/Version: CentOS 7*

When a class parameter is set to use the sensitive type, automatic class parameter lookup fails with a type checking error.

*Desired Behavior:*

The value stored in hiera should be automatically validated against the datatype specified within Sensitive[], or not type-validated if the inner type was not specified.

*Actual Behavior:*

Error: Evaluation Error: Error while evaluating a Function Call, Class[Cntlm]: parameter 'cntlm_password' expects a value of type Undef or Sensitive[String], got String (file: /tmp/modules/cntlm/examples/init.pp, line: 2, column: 5) on node localhost.localdomain

*Workaround:*

Remove the value as a class parameter, and use Sensitive(lookup()) within the body of the class.",Bug,PUP-8540,"['Hiera', 'hiera']",Type checking fails when a sensitive parameter is autoloaded from hiera (no automatic conversion)
"Getting the value pp_role in the trusted facts from Hiera is not working anymore.

I have this config in hiera.yaml
{code}
""env/%{environment}/%{trusted.extensions.'pp_role'}.yaml""
{code}
When I do a manual hiera lookup I get this result.
{code}
Path ""/etc/puppetlabs/code/environments/development/hieradata/env/development/.yaml""
          Original path: ""env/%{environment}/%{trusted.extensions.'pp_role'}.yaml""
          Path not found
{code}
You can see the result is empty.
The funny thing is when I lookup the trusted facts from within a manifest with notify I do get the expect result.
{code}
notify { ""I'm asking for the role ${trusted['extensions']['pp_role']}"": }

pp_role => role_rhel7template
{code}
Strange thing is that hiera trusted fact lookup below is working.
{code}
%{trusted.certname}.eyaml
{code}",Bug,PUP-8539,[],Hiera trusted fact lookup
"New versions of AIX have changed the behavior of the {{chpasswd}} command to report errors when the command syntax is incorrect. See the links below. 

http://www-01.ibm.com/support/docview.wss?uid=isg1IV95055
http://www-01.ibm.com/support/docview.wss?uid=isg1IJ04629

The change to behavior went into 7100-05-01-1731 and 7200-02-01-1731, so setting the password in these AIX versions will fail. This will also cause new user creations to fail on these SPs. 

The issue is that in  https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/aix.rb#L279 we use {{chpasswd -e -c username}}, where as the username is not a valid option to the command. Since the behavior change, customers have seen failures in the user resources on these new SPs. 


*Errors*

{code}
Debug: Executing: '/usr/bin/mkuser shell=/usr/bin/ksh minage=0 maxage=0 groups=patrol patrol'
Debug: Executing: '/bin/chpasswd -e -c patrol'
Error: Could not set 'present' on ensure: undefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix at /root/newuser.pp:10
Error: Could not set 'present' on ensure: undefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix at /root/newuser.pp:10
Wrapped exception:
undefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix
Error: /Stage[main]/Main/User[patrol]/ensure: change from absent to present failed: Could not set 'present' on ensure: undefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix at /root/newuser.pp:10
{code}
",Bug,PUP-8538,"['cs_pr_review', 'maintenance', 'triage']",AIX user resource fails with new service packs
"The following manifest errors when evaluated using {{puppet apply}}:
{code:puppet}
'cdf' =~ /^([a-z])(.*)/
notice($2)
{code}
The error is:
{code}
This '=~' expression has no effect. A value was produced and then forgotten (one or more preceding expressions may have the wrong form)
{code}
This is not correct since the result of the match is stored in numeric variables $1 ... $n and can be used.

Turning the comparison into an assignment, i.e.:
{code:puppet}
$x = 'cdf' =~ /^([a-z])(.*)/
notice($2)
{code}
yields the correct result:
{code}
Notice: Scope(Class[main]): df
{code}

",Bug,PUP-8537,['Language'],Validator incorrectly reports result of regexp match as being forgotten
"*Puppet Version:* 5.3.3
*Puppet Server Version:* 2017.3.2

If a module's class is prematurely closed in code, it will apply the remaining code to every node in an environment.

To reproduce the issue:

Create a module called testmod, and set testmod's init.pp to the following:

{code:puppet}
class testmod {
  notify { 'hello_world':
    message => 'I am supposed to be here.'
  }
}

file { '/badfile':
  ensure => 'present',
}

notify { 'I am not supposed to be here.': }
{code}

Create an environment for the module and two agents that are in that environment - in my case that is agent and xagent. Pin the class to one of the nodes (in this case xagent). Perform a puppet run on both nodes. You will see the xagent node respond like so:

{code:puppet}
[root@pe-201732-xagent /]# puppet agent -t
Notice: Local environment: 'production' doesn't match server specified node environment 'testmodenv', switching agent to 'testmodenv'.
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for pe-201732-xagent.puppetdebug.vlan
Info: Applying configuration version 'pe-201732-master.puppetdebug.vlan-testmodenv-5b8d49e0138'
Notice: /Stage[main]/Main/File[/badfile]/ensure: created
Notice: I am not supposed to be here.
Notice: /Stage[main]/Main/Notify[I am not supposed to be here.]/message: defined 'message' as 'I am not supposed to be here.'
Notice: I am supposed to be here.
Notice: /Stage[main]/Testmod/Notify[hello_world]/message: defined 'message' as 'I am supposed to be here.'
Notice: Applied catalog in 0.97 seconds
[root@pe-201732-xagent /]#
{code}

However the agent node that *does not have the class pinned to it* will also create badfile and notify:

{code:puppet}
[root@pe-201732-agent /]# puppet agent -t
Notice: Local environment: 'production' doesn't match server specified node environment 'testmodenv', switching agent to 'testmodenv'.
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for pe-201732-agent.puppetdebug.vlan
Info: Applying configuration version 'pe-201732-master.puppetdebug.vlan-testmodenv-5b8d49e0138'
Notice: /Stage[main]/Main/File[/badfile]/ensure: created
Notice: I am not supposed to be here.
Notice: /Stage[main]/Main/Notify[I am not supposed to be here.]/message: defined 'message' as 'I am not supposed to be here.'
Notice: Applied catalog in 0.85 seconds
{code}

*Desired behavior:*
From both a stability and a security standpoint, when interacting with incorrectly formatted classes such as this Puppet Server should prevent any additional code in that class from applying to nodes that do not have that class pinned to them.",Improvement,PUP-8536,[],"If a module's class is prematurely closed in code, it will apply the remaining code to every node in an environment"
"We added a rake task to check for ruby warnings in puppet#master, but it doesn't catch issues that are merged into older branches and then merged up to master. It would be better to catch the issues at PR time.

This ticket is to backport the warnings rake task and update the travis CI matrix to execute the new check.",Task,PUP-8535,[],Backport ruby warning rake task
The configtimeout setting is deprecated has been superseded by http_connect_timeout and http_read_timeout. It should be removed in 6.,Task,PUP-8534,[],Remove configtimeout setting
The ignorecache setting is deprecated and does nothing. Remove in 6,Task,PUP-8533,[],Remove dead ignorecache setting
"The agent's pluginsync behavior is controlled based on whether it is using a cached catalog or not. The pluginsync setting is deprecated, and should be removed in 6.",Task,PUP-8532,[],Remove pluginsync setting
The app_management setting is already deprecated and is always on. Remove it in 6.,Task,PUP-8531,[],Remove app_management setting
"The trusted_server_facts setting is already deprecated and does nothing (since trusted facts are always enabled). The setting should be removed in 6.

 ",Task,PUP-8530,[],Remove trusted_server_facts setting
"The data_binding_terminus and environment_data_provider settings are already deprecated and should be removed now that Hiera 5 is done.

 ",Task,PUP-8529,[],Remove data_binding_terminus setting
"The WriteOnlyYaml node terminus was deprecated in 4.10.5 in commit f0890af6656de0fc16c85230f0596644e9ebcd29. It should be removed in 6.

 ",Task,PUP-8528,[],Remove WriteOnlyYaml node terminus
"*Puppet Version: 5.4.0*
 *Puppet Server Version: 5.2.0*
 *OS Name/Version: CentOS 7.3*

Array merge in Hiera 5, using a hiera3_backend always throws the error: Could not run: Hiera type mismatch: expected Hash and got Array

In my case I use Redis hiera3_backend.

I add an Array to Redis as following:
{quote}massimiliano = ['I_am_from_Redis']
{quote}
I add an Array to Yaml:
{quote}massimiliano:
   - 'I_am_from_Yaml'
{quote}
and I run:
{quote}puppet lookup --merge deep --explain --node test-filesender.example.org massimiliano
{quote}
*Desired Behavior:*

get a merged array:
{quote}Merged result: [
   ""I_am_from_Redis"",
   ""I_am_from_Yaml""
 ]
{quote}
 

*Actual Behavior:*
{quote}puppet lookup --merge deep --explain --node test-filesender.example.org massimiliano
 Error: Could not run: Hiera type mismatch: expected Hash and got Array
{quote}
This is caused by _resolution_type_ currently not in use with hiera 5: 
{quote}def lookup(key, scope, order_override, resolution_type)
{quote}

Since it's not in use with Hiera5, it use Hash as default and I expect this issue to happen with every hiera3_backend. 

 

*Workaround:*

Determine the key_type on the fly: 
{quote}key_type = key.class
{quote}
and then:
{quote}case key_type
 when :Array
   raise Exception, ""Hiera type mismatch: expected Array and got #\{new_answer.class}""   unless new_answer.is_a? Array or new_answer.is_a? String
   answer ||= []
   answer = answer.concat(new_answer).uniq
 ....
{quote}
 

 ",Bug,PUP-8527,[],hiera5 cannot merge arrays from hiera3_backend
"(Initial planned release date: 2018-03-20)

1) Create versions and filters for the release in in JIRA. Ensure that the filters are shared with the ‘All Employees’ group.

2) Create or update the Kanban board for the release series. Ensure that the underlying filter for the board includes issues from the release filter and add a quick filter to highlight just those issues.

3) Create Release tickets (in the Project Central project) for the Puppet Platform and puppet-agent releases, with sub-tasks for each milestone (e.g., “String Freeze”, “Stop Ship Line”, “Ready to Ship”, and “General Availability (GA)”.

4) Create release pages for the Puppet Platform and puppet-agent releases in Confluence, under the appropriate “Upcoming Releases” parent page. Make sure the pages reference the release filters, tickets, and Kanban board as needed.

5) Update the “Versions & Dependencies” pages for Puppet Platform and puppet-agent with dependency versions for releases. Format the release versions in italics and link them to their corresponding release pages.

6) Add events for the release milestone dates to Group-Platform Google calendar. Ensure the description for each event includes a link to the release page.

7) Send an email to stakeholders (e.g., puppet-dev@googlegroups.com and discuss-platform@puppet.com) outlining the scope and timeline for the release.
",Task,PUP-8526,['release'],Communicate scope and timeline of next release (Puppet Platform 5.5.0)
"(Initial planned release date: 2018-03-20)

1) Update the release pages for Puppet Platform and puppet-agent in Confluence based on the release. Replace “Target Date” with “Release Date”, change language to past tense, and move the pages to the appropriate parent pages under “Current Releases”.

2) Update the “Versions & Dependencies pages for Puppet Platform and puppet-agent based on the release. Format the release versions in bold and move them to the appropriate tables under “Current Releases”.

3) Close any outstanding Milestone and Risk tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the Milestone tickets as needed to ensure they match the actual milestone dates.

4) Close the Release tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the tickets as needed to ensure they match the actual release date.

5) Close all tickets that have been resolved as part of the release. When using a bulk modify operation to transition the tickets to ‘Closed’ status in JIRA, be sure to select the appropriate resolution and disable notifications to avoid spamming watchers.

6) Make all tickets that were marked as Internal for the release public. When using bulk modify operation to change the value of the ‘level’ field for tickets to ‘None’ in JIRA, be sure to disable notifications to avoid spamming watchers.

7) Mark all versions that were shipped as part of the release as “released”. When doing so, be sure to update the description and release date of each version as needed based on what was shipped when.

8) Update the Kanban board for the release series. Remove the release filter from the underlying filter for the board and remove the quick filter for the release as well.
",Task,PUP-8525,['release'],Update Confluence and JIRA based on release (Puppet Platform 5.5.0)
"(Initial planned release date: 2018-03-20)

1) Ensure all prerequisite release tasks are complete.

2) Review the release Kanban board to ensure all tickets are resolved.

3) Ping release leads in ‘Platform Core’ HipChat room for go/no-go decision.

4) Send email indicating Ready To Ship milestone has been achieved.
",Task,PUP-8524,['release'],Declare Ready to Ship (go/no-go) milestone (Puppet Platform 5.5.0)
"(Initial planned release date: 2018-03-20)

Please paste the text of the announcement in the 'Send announcement' ticket.
If there are any links, it would be most helpful for the sender if they were already hyperlinked to the display text, so only a copy+paste to Gmail is necessary.
",Task,PUP-8523,['release'],Prepare release announcement (Puppet Platform 5.5.0)
"(Initial planned release date: 2018-03-20)

1) Send an email reminder ahead of time about the upcoming Stop Ship milestone date.

2) Review tickets on the release Kanban board to ensure all code changes have landed. Flag any related issues that are not yet Ready for CI.

3) Ensure all tickets have release notes, if needed. Add comments to issues without release notes, asking the author of the PR to add them or indicate that they aren’t needed.

4) Follow up with the Engineering lead for each component (e.g., in HipChat) to confirm current state and obtain a forecast for when all code will be in a build.

5) Send email indicating that the Stop Ship milestone has been achieved.
",Task,PUP-8522,['release'],Declare Stop Ship Line (code complete) milestone (Puppet Platform 5.5.0)
"(Initial planned release date: 2018-03-20)

1) Ensure “Versions & Dependencies” pages for Puppet Platform and puppet-agent are up to date in Confluence. Reach out to teams as needed to confirm that the fix versions listed are those that we intend to ship with the release.

2) For each component project of Puppet Platform and puppet-agent, ensure there is a next version if needed. Often this will be the next Z in an X.Y.Z series. However, if we are jumping to a new X or Y release that skips an existing Z version in JIRA, make sure those tickets are reassigned to the correct fix version, and the unneeded version is deleted. For example, if we have tickets with a fix version of 4.3.3, but we’re going from 4.3.2 to 4.4.0, then we need to reassign the tickets assigned to 4.3.3 and delete the 4.3.2 version from JIRA.

3) Create public filters for inclusion in the release notes and/or announcement. These allow easy tracking as new bugs come in for a particular version and allow everyone to see the list of changes in a release. Include links to the filters as a comment on this issue before resolving it.

4) Update the “master” filters for Puppet Platform 5.5.0 and puppet-agent 5.5.0 to reference the “Fixed in” filters created above.

5) Update the community feedback filter for Puppet Platform X.y to reference the “Introduced in” filter created above.
",Task,PUP-8521,['release'],Prepare JIRA for release (Puppet Platform 5.5.0)
"Puppet Platform 5.5.0 Release - 2018-03-20
",Epic,PUP-8520,[],Puppet Platform 5.5.0 Release - 2018-03-20
"Given an expression such as:
{code:puppet}
@("""")
This is heredoc $text
|-END
{code}
the lexer attempts to error with {{Issues::HEREDOC_MISSING_ENDTAG}}. Since there's no such issue, this instead results in a {{NameError}}. The correct issue to use here, given that there's no actual tag, would be {{Issues::HEREDOC_EMPTY_TAG}}.",Bug,PUP-8519,[],Lexer errors with non existing Issues::HEREDOC_MISSING_ENDTAG
"*Puppet Version: 4.10.10*
 *Puppet Server Version: 1.8.0*
 *OS Name/Version: Redhat 7*

install_options is ignored by yum check-update, when a custom yum.conf file is defined. This means ""ensure latest"" fails, because puppet does not see the latest packages from a custom repository.



Reproduced with the following package definition.
{noformat}
 install_options => ['--config=/etc/custom/yum.conf'],{noformat}
 

*Desired Behavior:*

Desired behavior should be:
{noformat}
Debug: Executing: '/bin/yum --config=/etc/custom/yum.conf check-update' {noformat}
*Actual Behavior:*

Install option is ignored, thus puppet fails to ""see"" newer packages that are defined with the custom --config file.
{noformat}
Debug: Executing: '/bin/yum check-update'  {noformat}",Bug,PUP-8518,"['package', 'redhat', 'triaged', 'type_and_provider', 'yum']",yum check-update does not support --config (install_options)
"I have built a new puppet environment based on the puppet 5 on RHEL-7.4 with SElinux in Permissive mode. I work in an environment that is not connected directly to the internet and as such maintain our own repository for puppet modules. My existing puppet 3.8.7 works as expected with this repository.

Using both puppet-agent 5.3.3-1 & 5.4.0-1 I have been unable to download and install puppet modules from our repository. I can navigate the repository using a browser with no issues.

The command and error I am getting is:
{code:java}
puppet module install --trace --module_repository=http<SERVER>:8080 puppetlabs-stdlib
Notice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...
Notice: Downloading from http://<SERVER>:8080 ...
Error: undefined method `gsub' for false:FalseClass
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/forge.rb:240:in `decode_uri'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/forge.rb:110:in `fetch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/semantic_puppet/lib/semantic_puppet/dependency.rb:81:in `block in fetch_releases'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/semantic_puppet/lib/semantic_puppet/dependency.rb:80:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/semantic_puppet/lib/semantic_puppet/dependency.rb:80:in `fetch_releases'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/semantic_puppet/lib/semantic_puppet/dependency.rb:157:in `block in fetch_dependencies'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/semantic_puppet/lib/semantic_puppet/dependency.rb:155:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/semantic_puppet/lib/semantic_puppet/dependency.rb:155:in `fetch_dependencies'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/semantic_puppet/lib/semantic_puppet/dependency.rb:55:in `query'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/module_tool/applications/installer.rb:220:in `build_dependency_graph'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/module_tool/applications/installer.rb:91:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/module_tool/applications/application.rb:11:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/face/module/install.rb:132:in `block (3 levels) in <top (required)>'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/interface/action.rb+eval[wrapper]:264:in `install'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/face_base.rb:247:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:665:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util command_line.rb:73:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
Error: try 'puppet help module install' for usage

{code}
This looks similar to PUP-8126

This case has reported as being closed so I am not sure if the bug in question has crept back into the code. with my 5.3.3 instance I noticed that there was lines of code missing from the instance of /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/forge.rb that was on my system. I manually added the missing lines to my file but this didn't fix the problem and updated to 5.4.0 in an attempt to resolve the issue.

All of the RPM's have been sourced from yum.puppetlabs.com/",Bug,PUP-8517,[],module install against local repository fails
,Epic,PUP-8516,[],Windows package Type/Provider Improvements
"Puppet has a series of benchmarks designed to time small portions of the puppet codebase. They live here: https://github.com/puppetlabs/puppet/tree/master/benchmarks

If we were to begin running these regularly against puppet and recording the results, we could use the results of those runs to spot regressions before they ship and before they impact other components further up the stack such as puppetserver where it can be more costly to diagnose.

/cc [~patrick] [~craig.gomes] [~josh]",Task,PUP-8515,[],Automate and record runs of puppet benchmarks
"Currently we have this lovely dance we need to go through if we need to define a parameter or property as sensitive. You can see examples of this in file.rb and exec.rb ([https://github.com/puppetlabs/puppet/commit/abd866a648a32d3895011d25af5d4b3d994669c8).] As it currently works, we can only set a specific instance as sensitive. We should be able to say all instances of a particular property/parameter are sensitive when defining it.

 ",Bug,PUP-8514,[],Puppet should have a way of defining properties or parameters for types as sensitive
"The following manifests fails with the error:
{code:java}
Error: Parameter 'ignore' is already set on File[/tmp/puppet-test] by #<Puppet::Resource::Type:0x00000003659930> at /tmp/foo.pp:3; cannot redefine at /tmp/foo.pp:13 on node bla{code}
Manifest:
{code:java}
File {
  ignore => '*.bak'
}
class foo {
  file{'/tmp/puppet-test':
    ensure => directory,
  }
  File['/tmp/puppet-test']{
    ignore => '*.bak2',
  }
}
include foo {code}
while the following one works fine:
{code:java}
File {
  ignore => '*.bak'
}
class foo {
  file{'/tmp/puppet-test':
    ensure => directory,
    ignore => '*.bak2',
  }
}
include foo{code}
 

This is just an example for a more complex case when the resource default is in _manifests/site.pp_ as suggested by docs, while the resource declaration happens in a module class, where later in the same class we would add the ignore parameter.",Bug,PUP-8513,[],"Cannot add a resource parameter, when a default resource declaration already defines this param"
"I would like to be able to use a different external node classifier based on environments, so I can test changes and then merge to the production branch.

 

It looks like a few tickets have been submitted about this:

PUP-4521 - Pass agent-requested environment to external node classifiers

PUP-4522 - Provide Facts for a classifier to select whether to enable overriding the environment

PUP-5032 - Update node terminus configured_environment to mirror agent_specified_environment

 

However I can't understand how I should access ""configured_environment"" or ""agent_specified_environment"" within the ENC script. It looks like the values are only available from manifests/site.pp. However, I need the values in the ENC so they can be used inside hiera.yaml.

 

My ideal solution would be to call the node classifier based on that variable, but I don't think this will be possible:
{code:java}external_nodes = $codedir/environments/${::agent_specified_environment}/bin/enc.rb{code}
 

I was told there can only be 1 ENC, but I can write a main one that is a wrapper script which can call the enc inside another environment directory. If that is the only way, then the wrapper would be: 
{code:java}external_nodes = $codedir/nodeclassifier/enc.rb
{code}
 

And that script would discover the agent_specified_environment, and then include the dev enc.rb, such as: 
{code:java}require ""$codedir/environments/${::agent_specified_environment}/bin/enc.rb""{code}
 

What are my options here? I tried pulling the environment value from puppetdb, but it's updated after the ENC is finished running, so the value is from the previous run. Any suggestion is appreciated.",New Feature,PUP-8512,[],Separate external node classifier per environment
"Currently when we compile a report of the puppet run, we include a bunch of metrics on how long it took to run certain parts of the puppet run. This is great getting this information, but we also provide a total time metric. This total is simply the sum of all the other times reported in the report. I don't have a lot of faith this is wholly accurate of reality. It relies on the assumption that we've collected run times for all aspects of the puppet run, and none of the time reported are subsets of other times reported. I feel like there is a better way of determining the total time it took to run puppet, and the current way is is too naive for what we need. This is going to take more investigation to flush out exactly the best way to solve this, and if my hunch is totally wrong or not.

 ",Bug,PUP-8511,[],Total time reported in report probably isn't reflective of reality
"There's currently no way of writing a custom {{new_function}} (the function responsible for creating an instance of a data type) when creating Ruby implementations of an {{Object}} data type. Such functions are needed when the default signature generated base on the attributes of the object is insufficient. One example of this is a {{new_function}} that accepts repeated parameters where the resulting array is expected to be stored in one attribute, or perhaps split based on type, and stored in several different attributes.
",New Feature,PUP-8510,[],Enable custom new_function for Object type implementations written in Ruby
,Improvement,PUP-8509,[],move the flatten() function from stdlib to puppet
"Make it possible to run tests writing using the Puppet Specification language (pspec) in the Ruby runtime.

This new feature will make it possible to validate the parser, lexer, validator and evaluator in Ruby using the same tests as are used when validating the corresponding functionality in the Go parser/evaluator and in the Java parser/evaluator.",New Feature,PUP-8508,[],Add pspec evaluator to Puppet
,Improvement,PUP-8507,[],move the join() function from stdlib to puppet
"A subset of puppet tests that contain the 'server' tag should be running in the agent pipeline. We need this so that we get platform coverage in these specific cases which we don't get when they're only running in the server pipeline.

{noformat}
remove 'server' tag
	tests/direct_puppet/supports_utf8.rb:      'server'
	tests/utf8/utf8-in-catalog.rb:      'server'
	tests/utf8/utf8-in-puppet-describe.rb:                           # (if it is, add 'server' tag
	tests/catalog_with_binary_data.rb:      'server'
	tests/language/binary_data_type.rb:    'server'
	tests/pluginsync/4420_pluginfacts_should_be_resolvable_on_agent.rb:    'server'
	tests/pluginsync/4847_pluginfacts_should_be_resolvable_from_applications.rb:    'server'
	tests/pluginsync/7316_apps_should_be_available_via_pluginsync.rb:    'server'
	tests/pluginsync/feature/pluginsync_should_sync_features.rb:    'server'

check for and remove confines as possible
	tests/utf8/utf8-in-catalog.rb:      'server'
{noformat}",Task,PUP-8505,[],re-enable server required tests to run in the agent pipeline
"Ruby 2.1 is EOL. Ruby 2.2 went EOL on March 18, 2018. We need to bump the {{Puppet::OLDEST_RECOMMENDED_RUBY_VERSION}} to 2.3 in preparation for Puppet 6.",Improvement,PUP-8504,[],Emit deprecation warning for ruby 2.1 and 2.2
"Create a new puppet application for managing agent keys, CSR and certificates. It should not rely on the indirector to make network requests.

This epic should leverage the work done in PUP-6828 (to simplify agent SSL initialization).",Epic,PUP-8503,[],Agent SSL CLI
"The puppet lookup command evaluates classes that are returned from the ENC when the {{--compile}} flag is not specified. This results in failures of the lookup command if the catalog cannot be compiled. 

 

*Reproduction Steps* 
 # Install PE or Puppetserver
 # Create a class like the one below.
 # Classify a node with the class in the classifier
 # Run {{puppet lookup anyhierakey --node <nodename>}}

A simple class to cause a failure in the lookup is below. 

 
{code}class test (
  String $myparam,
) {
  file {$myparam:
    ensure => absent,
  }
}
{code}
*Logs*

Using the steps above, we see this output from a lookup.
{code}# puppet lookup anything --node pe-201735-agent.puppetdebug.vlan --debug 
...
Debug: importing '/etc/puppetlabs/code/environments/production/modules/test/manifests/init.pp' in environment production
Debug: Automatically imported test from test into production
...
Error: Could not run: Evaluation Error: Error while evaluating a Resource Statement, Class[Test]: expects a value for parameter 'myparam'
{code}
*Workaround*

Add the {{--node_terminus plain}} to the command.
{code}# puppet lookup anything --node pe-201735-agent.puppetdebug.vlan --node_terminus plain
--- ""test""
{code}",Bug,PUP-8502,[],Puppet lookup always includes classes from the ENC
"As part of an effort to improve puppetserver performance, we want to start using Jackson when running in JRuby (see SERVER-2098). In order to make this change transparently in Puppet, we want to use the [multi_json gem|https://github.com/intridea/multi_json] to choose which backend to prefer at runtime, based on whether Jackson is installed. We need to update references to the built-in JSON gem to use multi_json instead. While we could confine this change to server-side code only, updating the references everywhere gives us the option to start using a faster library (e.g. [Oj|https://github.com/ohler55/oj]) agent-side as well in the future.",Task,PUP-8501,[],Switch to using multi_json
"It would be very useful if ""puppet lookup"" allowed setting fact overrides as direct arguments to a parameter.

When automating something that uses ""puppet lookup"", having to write a temporary file containing some facts, then deleting the file afterwards is a pain, and is potentially fragile.

If the facts could be specified directly, there would be no need for the file.

After some discussion - [~thomas.hallgren]'s idea of using {{\--facts}} with a dash to indicate ""read from stdin"" and that {{\--facts}} can be given multiple times on the command line to indicate in the order keys override each other. For example starting with a canned standard facts file overriding with input from stdin.

Special cases:
* if EOF is immediately read on stdin this is taken as an empty set of facts (rather than a YAML read error)
* -consider allowing dotted keys to only modify a nested fact value (you would otherwise have to specify full structure) - this could be added in a separate ticket.-

Original
------
It would be very useful if ""puppet lookup"" allowed setting fact overrides as direct arguments to a parameter.

When automating something that uses ""puppet lookup"", having to write a temporary file containing some facts, then deleting the file afterwards is a pain, and is potentially fragile.

If the facts could be specified directly, there would be no need for the file.

*Desired Behavior:*
{code:java}/opt/puppetlabs/bin/puppet lookup site_domain --environment boo --facts test_facts.yaml --node myhost.r00.zone1.foo.bar.com --node_terminus=plain --external_nodes=none --fact boo=test --fact test=boo --fact asdfasd=123
~~~8<~~~
$ echo $?
0{code}
*Actual Behavior:*
{code:java}/opt/puppetlabs/bin/puppet lookup site_domain --environment boo --facts test_facts.yaml --node myhost.r00.zone1.foo.bar.com --node_terminus=plain --external_nodes=none --fact boo=test --fact test=boo --fact asdfasd=123
Error: Could not parse application options: invalid option: --fact
$ echo $?
130
{code}
 

I've attached a patch which basically works, but I'm not very familiar with the code base, and so there's probably some style and other functional things I'm not considering.

I'd be happy to create a PR, but let's see the patch is even close first :)

Thanks.

 ",New Feature,PUP-8500,[],"puppet lookup cli should support adding facts as arguments, not just from a file."
"*Puppet Version: 5.4.0*
 *Puppet Server Version: n/a*
 *OS Name/Version: Ubuntu 16.04*

When running ""puppet lookup"" with both the ""–node"" and ""–facts"" arguments, it exits with an error:
{code:java}Error: Could not run: undefined method `add_extra_values' for nil:NilClass{code}
*Desired Behavior:*

It should return the correct value from hiera data, or at least not error even if no value is returned.

*Actual Behavior:*

 

 
{code:java}/opt/puppetlabs/bin/puppet lookup site_domain --environment boo --facts test_facts.yaml --node myhost.r00.zone1.foo.bar.com --node_terminus=plain --external_nodes=none --trace
Error: Could not run: undefined method `add_extra_values' for nil:NilClass
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/node.rb:167:in `add_extra_facts'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/lookup.rb:367:in `generate_scope'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/lookup.rb:327:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:665:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
{code}
 

 ",Bug,PUP-8499,[],"puppet lookup cli, using  --facts and --node simultaneously breaks"
"*Puppet Version:* 5.3.3
 *Puppet Server Version:* N/A

Upon creating some rspec-puppet tests for a new Puppet module, the following error was encountered:
{code:java}1) actora on centos-7-x86_64 with defaults should compile into a catalogue without dependency cycles
Failure/Error: it { should compile }
error during compilation: No title provided and ""actora"" is not a valid resource reference on node lt0772.local
{code}
As there was no traceback to a specific file/line provided, this one proved challenging to track down. 

In the end, the following code was at fault:
{code:java}## install actora rpm (which should install nodejs and npm)
package { $actora::package_name:
  ensure => $actora::version,
  notify => $actora::service_name,
  tag => ['actora::package']
}
{code}
The notify here resolves to {{'actora'}}.

A simple reproducer is:
{code:java}$ cat foo/manifests/init.pp
class foo () {
  notify { 'testing':
    notify => xyz,
  }
}
$ puppet apply -t --exec 'include foo'
Info: Loading facts
Error: No title provided and ""xyz"" is not a valid resource reference on node host.example.net{code}
Thanks to [~JohnsonEarls] for the reproducer.

 ",Improvement,PUP-8498,[],"Improve error for 'No title provided and ""foo"" is not a valid resource reference'"
,Improvement,PUP-8497,[],move the length() function from stdlib to puppet
The functions {{keys()}} and {{values()}} from stdlib should be moved to puppet and the 4.x function API.,Improvement,PUP-8496,[],move keys() and values() functions from stdlib to puppet
"*Puppet Version:*
 *Puppet Server Version:*
 *OS Name/Version:*

Detection of systemd fails on Ubuntu releases higher than 16.10

*Desired Behavior:*

disabling/enabling services should work as normal also on Ubuntu 17.04 and up.

As one can see here:

[https://github.com/puppetlabs/puppet/commit/ef342d4ced9bf7aa0489005119bf80a298d094f2]

Ubuntu is only supported up to 16.10 - why is this hardcoded in like this, instead of saying Ubuntu with releases from 15.04 and up use systemd, while those below use sysc-rc - the problem is now that puppet tries to use sysv-rc on Ubuntu 17.04 and up as well. 

*Actual Behavior:*

 

 

{{ubuntu1710 ~ # puppet resource service ipmievd enable='false'}}
{{dpkg: error: --compare-versions takes three arguments: <version> <relation> <version>}}{{Type dpkg --help for help about installing and deinstalling packages [*];}}
{{Use 'apt' or 'aptitude' for user-friendly package management;}}
{{Type dpkg -Dhelp for a list of dpkg debug flag values;}}
{{Type dpkg --force-help for a list of forcing options;}}
{{Type dpkg-deb --help for help about manipulating *.deb files;}}{{Options marked [*] produce a lot of output - pipe it through 'less' or 'more' !}}
{{Notice: /Service[ipmievd]/enable: enable changed 'true' to 'false'}}
{{service \{ 'ipmievd':}}
{{   enable => 'true',}}
{{}}}
{{ubuntu1710 ~ # lsb_release -a}}
{{No LSB modules are available.}}
{{Distributor ID: Ubuntu}}
{{Description: Ubuntu 17.10}}
{{Release: 17.10}}
{{Codename: artful}}
{{ubuntu1710 ~ #}}

 

 ",Bug,PUP-8495,"['community', 'type_and_provider']",Ubuntu 16.10 _AND NEWER_ use systemd provider as default
"One objective with formalizing all errors and warnings into an {{IssueCode}} with an associated argument {{Hash}}, is to make it possible to write tests asserting that the correct issues are raised and initialized with the correct arguments (as opposed to checking for specific pre-formatted messages which changes more often and differ from locale to locale).

At present though, such tests are impossible because classes like {{Puppet::ParseErrorWithIssue}} performs the formatting of the final message when the actual error is instantiated and throws away the arguments in the process. Left is just the formatted message and the issue_code. This must change. Instead of storing a formatted message and the issue_code, the error should store the actual issue and the associated argument hash. The actual formatting of the issue can take place when the message is requested.",Improvement,PUP-8494,[],Issue based errors are formatted too early and arguments are lost.
"According to https://github.com/puppetlabs/puppet/blob/5.4.x/lib/puppet/vendor.rb#L20-L24 any libraries that we vendor should not be modified from the original source. The intention is that a distro can swap in a system level package supplying the library and have it just work.

That is not possible with semantic_puppet. Here (https://github.com/puppetlabs/puppet/blob/5.4.x/lib/puppet/vendor/semantic_puppet/lib/semantic_puppet/version_range.rb#L65), you can see {{self.parse}} takes two arguments, one of which has a default. It has been that way since https://github.com/puppetlabs/puppet/commit/a723e23bd238ba5bf69e1d3e959b6aa93ec18211 which was released in 4.10.5. The original gem has a single arity version of {{self.parse}} (https://github.com/puppetlabs/semantic_puppet/blame/master/lib/semantic_puppet/version_range.rb#L64) in its latest release. Those methods are marked public in both cases.

If a distro removed the vendored copy, as we suggest should be possible in {{vendor.rb}}, any calls that pass two arguments to {{self.parse}} will fail with an arity mismatch as the upstream version only takes one argument.

If the behavior that exists in the vendored copy from puppet is desirable, it should be added to the source gem. Really we shouldn't be vendoring it at all, but if there are required changes to it they should be released in the source gem first before coming across to puppet's copy.",Bug,PUP-8493,[],The differences between the vendored semantic_puppet and the original make it impossible to swap in the original
,Improvement,PUP-8492,[],Move the empty() function from stdlib to puppet
"The most essential functions in stdlib should be moved to puppet code base.

* empty
* keys
* values
* join
* flatten
* length (instead of deprecated 'size')

This is of particular value when running scripts.",Epic,PUP-8491,[],Move essential functions from stdlib to puppet
The maintainers file lists several folks who aren't active participants on Puppet (including myself). They should be removed.,Task,PUP-8490,[],Remove departed maintainers from maintainers file
"Convert usage of [Puppet.features.microsoft_windows?|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/feature/base.rb#L17] to [Puppet::Util::Platform.windows?|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/platform.rb#L7] where appropriate.

We need to be careful when reviewing the usages, its ok to mock the usage of Puppet.features.microsoft_windows? however we should NOT be mocking out the Puppet::Util::Platform.windows?, so care must be taken to ensure the things we convert make sense and that we continue to have the proper testing coverage.",Task,PUP-8488,[],Convert usage of Puppet.features.microsoft_windows? to Puppet::Util::Platform.windows? where appropriate
This serves no purpose but to obfuscate code and I've measured it as a significant source of garbage.,Improvement,PUP-8487,[],Eliminate use of MethodHelper
"The use of exceptions here [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/parser/scope.rb#L530-L543] when running in :warning mode (the default) is slow on JRuby. With a single undefined variable referenced in my hiera hierarchy I found handling this without exceptions resulted in a 20% runtime improvement.

I suspect both the throw and the exceptions are unnecessary.",Improvement,PUP-8486,[],Warning for undefined variables is slow in jruby
Calls to confine for facts like {{operatingsystem}} end up trying to require a file {{operatingsystem.rb}} on every test before falling back to a fact value. Even a noop require is expensive and caching these negative lookups results in a significant reduction of garbage.,Improvement,PUP-8485,[],Cached failed confine lookups
"Search puppet's code base for all of the places where we branch based on {{RUBY_VERSION}}.

1. Remove code paths for < 2.
2. Trying to {{require 'puppet'}} should generate a {{LoadError}} if ruby < 2
3. Update {{Puppet::OLDEST_RECOMMENDED_RUBY_VERSION}} to whatever minimum makes sense.
4. Remove conditional logic for Puppet[:sourceaddress]",Bug,PUP-8484,[],Update ruby 1.9.3 code paths
"Update Gemfile, .gemspec, ext/project_data.yaml so that we:

1. Require ruby 2.0 or greater (or whatever minimum we decide on)
2. Update gem dependencies in cases where we are pinned to old versions for ruby 1.9.3 compatibility reasons, e.g. fast-gettext, addressable, ffi, etc

Attempting to install puppet as a gem, running puppet via bundler, or running module tests using a local checkout of puppet should all fail when using ruby < 2.
",Bug,PUP-8483,[],Update ruby and gem dependencies
"A formal representation of the Puppet AST is needed for multiple purposes:
 # The current output from {{puppet parser dump}} is undocumented and not distinct enough to fully represent the AST (the AST cannot be recreated from this dump since some information is lost).
 # A well documented and unambiguous format is required to make it API.
 # A format is needed to facilitate cross-platform test suites for the parser.",New Feature,PUP-8482,[],Create a formal representation of the AST that can replace the current dump format
"A large part of the puppet data type system is currently loaded as part of initializing an environment. This is partly caused by the design of the {{ImplementationRegistry}}. There can only be one instance and it must belong to the environment since new types can be provided by modules.

A simple change to the {{ImplementationRegistry}} where it is made parented the same way that loaders are, would make it possible to have an environment based registry that is parented by a static registry. That in turn means that most of the pcore initialization can be done statically, i.e. once for the lifetime of the process, rather than once per environment creation.",Improvement,PUP-8481,[],Load the major part of pcore types statically instead of per environment
"Currently, failonfail defaults to true UNLESS any other options are passed in to the execute command (even if they do not modify failonfail). In this case, failonfail will switch to false. This is unexpected and should not happen. Failonfail should always be true unless explicitely set to false.",Task,PUP-8480,[],"Puppet::Util::Execution.execute should always default failonfail to true, even if other options are set"
"*Puppet Version:* 5.3.4
 *Puppet Server Version:* 5.1.5
 *OS Name/Version:*

The [nagios_servicegroup|https://puppet.com/docs/puppet/5.3/type.html#nagiosservicegroup] resource type has a parameter {{alias}} which configures a parameter in the Nagios object (a human-readable name). In our previous version of Puppet Enterprise (2017.2, with Puppet 4.10) this worked.

It seems in Puppet 5, {{alias}} is also a [metaparameter|https://puppet.com/docs/puppet/5.3/metaparameter.html#alias] which prevents the above from working.

The obvious solution is to rename the {{alias}} parameter of {{nagios_servicegroup}} to something else, e.g. {{servicegroup_alias}} to avoid conflict.

*Desired Behavior:*

Puppet configures a Nagios service group which contains an alias directive.

*Actual Behavior:*

Puppet reports an error as it interprets the {{alias}} parameter as a metaparameter.

{code}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, Cannot alias Nagios_servicegroup[check_aaaa] to ""AAAA record"" at (file: /etc/puppetlabs/code/environments/1005_duplicate_servicegroups/modules/nagios/manifests/servicegroup.pp, line: 7); resource [""Nagios_servicegroup"", ""AAAA record""] already declared (file: /etc/puppetlabs/code/environments/1005_duplicate_servicegroups/modules/nagios/manifests/servicegroup.pp, line: 7) (file: /etc/puppetlabs/code/environments/1005_duplicate_servicegroups/modules/nagios/manifests/servicegroup.pp, line: 7, column: 3) on node monitor.resnet.bris.ac.uk
{code}",Bug,PUP-8479,[],nagios_servicegroup resource type has invalid parameter alias
"*Puppet Version: 4.10.5*
 *Puppet Server Version: PE 2016.4.4*
 *OS Name/Version: EL7*

When running `puppet agent --test`, if the process is sent a signal such INT or TERM, the run still returns a 0 exit code indicating a successful run with no changes.

*Desired Behavior:*

The process should return an exit code indicating the signal that it received.  For example, bash uses 128+n, where ""n"" is the signal number.  (see [http://tldp.org/LDP/abs/html/exitcodes.html])

*Actual Behavior:*

When pressing Ctrl-C during the run: 
{code:java}$ sudo /opt/puppetlabs/bin/puppet agent --test ; echo $?
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
^CNotice: Caught INT; exiting
0
{code}
When killing the process from another terminal:
{code:java}$ sudo /opt/puppetlabs/bin/puppet agent --test ; echo $?
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Notice: Caught TERM; exiting
0
{code}
 

 

 

 ",Bug,PUP-8478,[],Agent should not return 0 exit code if run was interrupted
"*Puppet Version: 5.4.0*
 *Puppet Server Version:*
 *OS Name/Version: RHEL 7.4*

The handling of selinux file parameters seems to have changed between 5.3.5 and 5.4.0.  Specifically, we are managing some .k5login files as type 'krb5_home_t':

{code:puppet}
  file { ""${basedir}/${name}/.k5login"": seltype => 'krb5_home_t' }
{code}

As of when we upgraded to v5.4.0, puppet has been trying to reset the parameters every run, e.g.:

{noformat}
Feb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::
Automation::User/K5login[/var/lib/foo/.k5login]/seluser) seluser changed  to 'user_u'
Feb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::
Automation::User/K5login[/var/lib/foo/.k5login]/selrole) selrole changed  to 'object_r'
Feb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::
Automation::User/K5login[/var/lib/foo/.k5login]/seltype) seltype changed  to 'krb5_home_t'
Feb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::
Automation::User/K5login[/var/lib/foo/.k5login]/selrange) selrange changed  to 's0'
{noformat}

Downgrading to 5.3.5 reverts the behavior - e.g. the values are no longer updated every run.

Note that selinux is off on these hosts anyway.

*Desired Behavior:  don't change every run*

*Actual Behavior:  tries to change every run*",Bug,PUP-8477,['regression'],selinux types are being set on every run
"An EPP comment preceded by any number of spaces or tabs will not produce those spaces or tabs on output:
{code:puppet}
inline_epp(""some   \t\t   <%#%>text"")) # returns 'sometext'
inline_epp(""some<%#%> text"")) # returns 'some text'
{code}
I can't find anything in the documentation that supports this. The code contains [this comment and a regexp|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/parser/epp_support.rb#L244-L245]. It would make sense if the regexp was anchored at the beginning of line (and if the behavior was documented) but it isn't.",Bug,PUP-8476,[],Incorrect handling of white space surrounding comments in EPP
"The parser creates a {{QualifiedName}} instead of a {{QualifiedReference}} when for the {{component}} of a {{CapabilityExpression}}. The validator then checks if the {{component}} conforms to {{Patterns::CLASSREF_EXT}} (which it does). The pattern asserts that the string starts with an upper-case letter and this makes the {{component}} a {{QualifiedReference}} per definition.

The parser should change and instead create the expected {{QualifiedReference}}.",Bug,PUP-8475,[],Parser creates QNAME for capability component although it must start with upper case
A {{QualifiedName}} is indistinguishable from a {{QualifiedReference}} in the output from the ModelTreeDumper since the dumper simply dumps the {{value}} attribute in both cases. For a {{QualifiedReference}} it ought to dump the {{cased_value}}.,Bug,PUP-8474,[],ModelTreeDumper looses character casing when dumping QualifiedReference
"A double quoted string containing interpolations is parsed into a {{ConcatenatedString}} expression. This expression contains segments that are either literal strings or expressions that represent interpolations.

A string that starts and ends with an interpolated expression, such as ""$x"" currently results in three segments:
 # The literal string """"
 # The {{TextExpression}} representing the variable $x
 # The literal string """"

The literal empty strings should be removed.

 ",Improvement,PUP-8473,[],Parser adds stray empty string segments to a concatenated string
The short forms added in PUP-7853 to declare {{Object}} data types are not currently permitted inside a {{TypeSet}} definition. They should be permitted there too.,Improvement,PUP-8472,[],The Object data type short form declaration should be allowed in a TypeSet
"A {{TypeSet}} that contains a type that references another type in the same set will not resolve correctly when loaded from disk using the module loader.

The reason is that the {{TypeParser}} prefers the loader associated with the loaded file over a loader passed as an argument. The {{TypeSet#resolve}} method is however counting on that the local loader that it provides (which enables unqualified access to the types contained in the {{TypeSet}}) is used.

 ",Bug,PUP-8471,[],TypeSet loading of internal references is broken
"*Puppet Version: 5.4.0*
 *Puppet Server Version: 5.2.0*
 *OS Name/Version: RHEL 7*

Breaking Change: https://tickets.puppetlabs.com/browse/PUP-8223

I also validated this is broken when using a puppet apply with this code.
{code:puppet}group { 'group1' :
 ensure => present,
 gid => '901',
 forcelocal => true,
 }

group { 'group2' :
 ensure => present,
 gid => '902',
 forcelocal => true,
 }

user { 'user1' :
 ensure => present,
 home => '/home/user1',
 uid => '900',
 gid => 'user1',
 comment => 'user1',
 shell => '/bin/bash',
 forcelocal => true,
 managehome => true,
 groups => ['group1', 'group2'],
 require => Group['group1', 'group2'],
 }
{code}
So far I have found two issues.

1) lusermod does not support -G
 # lusermod --help
 Usage: lusermod [OPTION...] user
 -i, --interactive prompt for all information
 -c, --gecos=STRING GECOS information
 -d, --directory=STRING home directory
 -m, --movedirectory move home directory contents
 -s, --shell=STRING set shell for user
 -u, --uid=NUM set UID for user
 -g, --gid=NUM set primary GID for user
 -l, --login=STRING change login name for user
 -P, --plainpassword=STRING plaintext password for the user
 -p, --password=STRING pre-hashed password for the user
 -L, --lock lock account
 -U, --unlock unlock account
 --commonname=STRING set common name for user
 --givenname=STRING set given name for user
 --surname=STRING set surname for user
 --roomnumber=STRING set room number for user
 --telephonenumber=STRING set telephone number for user
 --homephone=STRING set home telephone number for user

Help options:
 -?, --help Show this help message
 --usage Display brief usage message

2) the new code will not ""modify"" the user's groups in /etc/group because the user already exists.

*Desired Behavior:*  
 user type allowed to modify local users groups

*Actual Behavior:*

{noformat}
Error: UID 900 already exists, use allowdupe to force user creation
 Error: /Stage[main]/Localusers::Identities/User[user1]/groups: change from to 'group1,group2' failed: UID 900 already exists, use allowdupe to force user creation
{noformat}",Bug,PUP-8470,[],Unable to modify local user group membership with forcelocal
"Puppet 5.4's {{fqdn_rand}} function produces a different value than earlier versions for the same set of inputs. 

{noformat}
$ bx puppet apply -e '$value = fqdn_rand(30); notice(""$puppetversion: $value"")'
Notice: Scope(Class[main]): 5.4.0: 22
Notice: Compiled catalog for r1nc1m63jxi6u3e.delivery.puppetlabs.net in environment production in 0.04 seconds
{noformat}

{noformat}
$ bx puppet apply -e '$value = fqdn_rand(30); notice(""$puppetversion: $value"")'
Notice: Scope(Class[main]): 5.3.5: 5
Notice: Compiled catalog for r1nc1m63jxi6u3e.delivery.puppetlabs.net in environment production in 0.03 seconds
{noformat}

This is a problem because the values are often written into service configuration files. When they change, services get notified and restart.

We should restore the previous {{fqdn_rand}} behavior of calculating its seed value using MD5 when running on a non-FIPS enabled master. FIPS enabled masters should continue using SHA256.",Bug,PUP-8469,[],fqdn_rand should use md5 on non-fips enabled hosts
"+After requesting api via:+

{code} curl --cert /etc/puppetlabs/puppet/ssl/certs/foreman.pem  \
    --key /etc/puppetlabs/puppet/ssl/private_keys/foreman.pem  \
   --cacert /etc/puppetlabs/puppet/ssl/certs/ca.pem                     \  
   -H 'Accept: pson'      ""https://puppet:8140/puppet/v3/resource_types/*?kind=class&&environment=env
{code}

+I get:+

{code}
Failed to show puppet classes: 500 {""message"":""Server Error: Internal Error: Puppet Context ':loaders' missing"",""issue_kind"":""RUNTIME_ERROR"",""stacktrace"":[""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loaders.rb:101:in `loaders'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loaders.rb:50:in `find_loader'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:255:in `instantiate_FunctionDefinition'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:99:in `instantiate'"",""org/jruby/RubyArray.java:2407:in `collect'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:85:in `instantiate'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/hostclass.rb:17:in `instantiate'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:126:in `each'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/hostclass.rb:15:in `instantiate'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type_collection.rb:36:in `import_ast'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/type_loader.rb:130:in `load_files'"",""org/jruby/RubyArray.java:2407:in `collect'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/type_loader.rb:129:in `load_files'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/type_loader.rb:41:in `import_all'"",""org/jruby/RubyArray.java:1613:in `each'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/type_loader.rb:40:in `import_all'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/resource_type/parser.rb:62:in `search'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/resource_type/parser.rb:58:in `search'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:269:in `search'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:151:in `do_search'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `call'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `process'"",""org/jruby/RubyArray.java:1613:in `each'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:81:in `process'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:60:in `process'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'"",""/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:58:in `process'"",""file:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppetserver-lib/puppet/server/master.rb:42:in `handleRequest'"",""Puppet$$Server$$Master_1135067081.gen:13:in `handleRequest'"",""request_handler_core.clj:281:in `invoke'"",""jruby_request.clj:47:in `invoke'"",""jruby_request.clj:29:in `invoke'"",""request_handler_service.clj:38:in `handle_request'"",""request_handler.clj:3:in `invoke'"",""request_handler.clj:3:in `invoke'"",""core.clj:2493:in `invoke'"",""core.clj:294:in `invoke'"",""core.clj:128:in `invoke'"",""core.clj:134:in `invoke'"",""ringutils.clj:86:in `invoke'"",""master_core.clj:433:in `invoke'"",""ring.clj:21:in `invoke'"",""ring.clj:12:in `invoke'"",""comidi.clj:249:in `invoke'"",""jetty9_core.clj:424:in `invoke'"",""normalized_uri_helpers.clj:80:in `invoke'""]}
{code}

- Puppetmaster running on version 4.6.0
What can I do to fix this error?

thanks :)",Bug,PUP-8468,[],Failed to show puppet classes: 500 Api Request
"After a while a certain manifest started firing HTTP 500 on the puppetserver side, though nothing had changed.

clients were aborting catalog compilation with:

{code}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Method call, Broken pipe - <STDERR> at /srv/puppet/code/environments/production/modules/amodule/manifests/init.pp:16:35 on node node1.example.com
{code}

Server logs were showing the following:

{code}
2017-12-08 18:29:02,277 ERROR [qtp526724218-38738] [puppetserver] Puppet Evaluation Error: Error while evaluating a Method call, Broken pipe - <STDERR> at /srv/puppet/code/environments/production/modules/amodule/manifests/init.pp:16:35 on node node1.example.com
org/jruby/RubyIO.java:1457:in `write'
org/jruby/RubyIO.java:1428:in `write'
org/jruby/RubyKernel.java:1000:in `eval'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/ruby_function_instantiator.rb:22:in `create'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/module_loaders.rb:166:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:151:in `internal_load'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/loader.rb:53:in `load'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:304:in `call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:951:in `call_function_with_block'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:944:in `eval_CallMethodExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:358:in `eval_AssignmentExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `block in eval_BlockExpression'
org/jruby/RubyArray.java:1734:in `each'
org/jruby/RubyEnumerable.java:936:in `inject'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `eval_BlockExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:72:in `block in evaluate'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:71:in `block in evaluate'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:70:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:136:in `evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'
org/jruby/RubyArray.java:1734:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:384:in `evaluate_classes'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/include.rb:16:in `include'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'
/srv/puppet/code/environments/production/modules/site/configsets/manifests/types/immerx_10.pp:6:in `<eval>'
org/jruby/RubyKernel.java:1000:in `eval'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:307:in `block in call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:949:in `call_function_with_block'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:918:in `eval_CallNamedFunctionExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `block in eval_BlockExpression'
org/jruby/RubyArray.java:1734:in `each'
org/jruby/RubyEnumerable.java:936:in `inject'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `eval_BlockExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:72:in `block in evaluate'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:71:in `block in evaluate'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:70:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:136:in `evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'
org/jruby/RubyArray.java:1734:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:384:in `evaluate_classes'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/include.rb:16:in `include'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'
org/jruby/RubyKernel.java:1120:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'
/srv/puppet/code/environments/production/manifests/site.pp:121:in `<eval>'
org/jruby/RubyKernel.java:1000:in `eval'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:307:in `block in call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:949:in `call_function_with_block'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:918:in `eval_CallNamedFunctionExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `block in eval_BlockExpression'
org/jruby/RubyArray.java:1734:in `each'
org/jruby/RubyEnumerable.java:936:in `inject'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `eval_BlockExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:133:in `block in evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:953:in `with_guarded_scope'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:131:in `evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:505:in `evaluate_ast_node'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:168:in `block in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:168:in `block in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:263:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:153:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:297:in `block in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:295:in `block in compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:224:in `block in benchmark'
uri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/benchmark.rb:308:in `realtime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:293:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:52:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:195:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:121:in `do_find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `block in call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:263:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `block in process'
{code}

Restarting the puppetserver made the problem go away.

All hosts using that module were affected.

The offending line in the manifest looks like:

{code}
   $dump_sources = $hosts.map |$h| { ""https://${acustomfcuntion('somevalue',$h)}.example.com"" }
{code}",Bug,PUP-8467,[],Starting to get broken pipe (HTTP 500) on certain manifest - gone after restarting puppetserver
Update winston release ticket set to clarify platform pre- and post- release validation steps per comments in PUP-8428.,Task,PUP-8466,[],Update winston to clarify pre- and post- release validation smoke testing
"The puppet help face should do a better job of processing its arguments and giving useful user error messages:

{noformat}
$ bx puppet help agent thing
Error: Legacy subcommands don't take actions
Error: Try 'puppet help help help' for usage
$
{noformat}
",Task,PUP-8464,[],puppet help should process its arguments better
"Puppet currently has a large number of Ruby warnings that should be cleaned up as some of them are causing actual bugs.

How to find all of the Ruby warnings in the Puppet repo (this will be slow):
{noformat}
find lib spec -type f -name \*.rb | xargs -n1 ruby -wc > /dev/null
{noformat}

After all of the warnings have been removed, we should update Travis CI to run any Ruby file changed in a PR through ""{{ruby -wc}}"" to make sure that we don't reintroduce any warnings (or potential bugs that would have been caught by the warnings).",Task,PUP-8463,[],Remove existing warnings and run PRs through 'ruby -wc'
"When defining a parameter for a type, we have the ability to pass in an additional argument to define if this parameter is a boolean or not. The only extra thing this gets us is an automatic method to check the truthiness of the parameter, i.e., a method called {{myparam?}}. We have to manually define which parameters are valid with {{newvalues(:true, :false)}}. These should be automatically populated simply by specifying {{:boolean => true}} in the parameter definition",Task,PUP-8462,[],Including `:boolean => true` in a type parameter definition should automatically populate the values a user is allowed to specify for that parameter
"Puppet's way of launching the installer 

cmd.exe /c start /w install.exe

ignores the exit code of the installer and returns the exit code of cmd.exe instead",Bug,PUP-8461,[],When installing or upgrading an EXE package on Windows Puppet ignores its exit code
"{code:java}
Notice: /Stage[main]/Ssh_user/Ssh_user::foo_settings[foo-srvadm]/Ssh_authorized_key[foo-srvadm_rsa]/ensure: created
Debug: Flushing ssh_authorized_key provider target /home/foo-srvadm/.ssh/authorized_keys
Error: Puppet::Util::FileType::FileTypeFlat could not write /home/foo-srvadm/.ssh/authorized_keys: Permission denied @ rb_sysopen - /home/foo-srvadm/.ssh/authorized_keys
Error: /Stage[main]/Ssh_user/Ssh_user::foo_settings[foo-srvadm]/Ssh_authorized_key[foo-srvadm_rsa]: Could not evaluate: Puppet::Util::FileType::FileTypeFlat could not write /home/foo-srvadm/.ssh/authorized_keys: Permission denied @ rb_sysopen - /home/foo-srvadm/.ssh/authorized_keys
Notice: /Stage[main]/Ssh_user/Ssh_user::foo_settings[foo-srvadm]/Ssh_authorized_key[foo-srvadm_ed25519]/ensure: created
Debug: Flushing ssh_authorized_key provider target /home/foo-srvadm/.ssh/authorized_keys
Error: Puppet::Util::FileType::FileTypeFlat could not write /home/foo-srvadm/.ssh/authorized_keys: Permission denied @ rb_sysopen - /home/foo-srvadm/.ssh/authorized_keys
Error: /Stage[main]/Ssh_user/Ssh_user::foo_settings[foo-srvadm]/Ssh_authorized_key[foo-srvadm_ed25519]: Could not evaluate: Puppet::Util::FileType::FileTypeFlat could not write /home/foo-srvadm/.ssh/authorized_keys: Permission denied @ rb_sysopen - /home/foo-srvadm/.ssh/authorized_keys
{code}

No entry's under /var/log/audit/audit.log",Bug,PUP-8460,[],ssh_authorized_key key update will fail on CentOS 7.4
"*Puppet Version:* 5.3.x
*Puppet Server Version:* 5.1.x

We have various beaker acceptance tests to ensure agent and server-specified environments work as expected. Unfortunately they did not catch the regression introduced by PUP-8225 and fixed in PUP-8419. The reason is because the tests only verify that the agent eventually converges on the right environment, but doesn't test that the agent's initial node request succeeds and starts the agent off in the correct environment.

For example, the following test only verifies that the notify resource emits the correct environment, but the agent's not request should not have failed, and it shouldn't have had to switch environments based on the catalog's environment:

{noformat}
17:23:17 Begin ruby/puppet/acceptance/tests/environment/use_enc_environment.rb
...
17:23:44 u0nh9955a5qfx91.delivery.puppetlabs.net (redhat6-64-2) 01:23:44$ puppet agent --no-daemonize --onetime --server cuzrxlwd8pszvvb.delivery.puppetlabs.net --verbose
17:23:44   Warning: Unable to fetch my node definition, but the agent run will continue:
17:23:46   Warning: Could not intern from application/json: Could not find a directory environment named 'special' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?
17:23:46   Info: Retrieving pluginfacts
17:23:46   Info: Retrieving plugin
17:23:46   Info: Retrieving locales
17:23:46   Info: Caching catalog for u0nh9955a5qfx91.delivery.puppetlabs.net
17:23:46   Notice: Local environment: 'production' doesn't match server specified environment 'special', restarting agent run with environment 'special'
17:23:46   Info: Retrieving pluginfacts
17:23:46   Info: Retrieving plugin
17:23:46   Info: Retrieving locales
17:23:46   Info: Caching catalog for u0nh9955a5qfx91.delivery.puppetlabs.net
17:23:47   Info: Applying configuration version '1517448226'
17:23:47   Notice: expected_string
17:23:47   Notice: /Stage[main]/Main/Notify[expected_string]/message: defined 'message' as 'expected_string'
17:23:47   Notice: Applied catalog in 0.02 seconds
{noformat}

We also need to test that setting {{server_list}} also works (since we make a node request to see if the server is available).",Bug,PUP-8459,[],ENC acceptance tests didn't catch regression
"(Initial planned release date: 2018-02-15)

",Task,PUP-8458,['release'],Communicate scope and timeline of next release (Puppet Platform 5.3.5)
"(Initial planned release date: 2018-02-15)

",Task,PUP-8457,['release'],Update Confluence and JIRA based on release (Puppet Platform 5.3.5)
"(Initial planned release date: 2018-02-15)

",Task,PUP-8456,['release'],Declare Ready to Ship (go/no-go) milestone (Puppet Platform 5.3.5)
"(Initial planned release date: 2018-02-15)

# Walk through smoke testing all Platform components, installing it from packages as a user would.
#* See https://confluence.puppetlabs.com/display/systemsEngineering/Test+platform+5+package+artifacts+template
#  and https://confluence.puppetlabs.com/display/systemsEngineering/Test+platform+5+repository+template
   for examples.
",Task,PUP-8455,['release'],Manually smoke test all artifacts (Puppet Platform 5.3.5)
"(Initial planned release date: 2018-02-15)

",Task,PUP-8453,['release'],Declare Stop Ship Line (code complete) milestone (Puppet Platform 5.3.5)
"(Initial planned release date: 2018-02-15)

",Task,PUP-8452,['release'],Prepare JIRA for release (Puppet Platform 5.3.5)
"    Puppet Platform 5.3.5 Release - 2018-02-15
",Epic,PUP-8451,[],"    Puppet Platform 5.3.5 Release - 2018-02-15
"
"*Puppet Version: 5.3.3*
 *Puppet Server Version:* 
 *OS Name/Version: Centos7*

Before you ask, yes I have stdlib installed. :)

I have a really weird problem I can't duplicate in vagrant but I can duplicate in packer. We updated stdlib to use to_json_pretty so we could write hiera and have puppet do the nasty bit of writing out the json and we're getting ""Unknown function: 'to_json_pretty'"". Problem is I can find the rb on the filesystem, so I'm at a loss why it doesn't work.

Some other stuff worth mentioning - I'm calling that from within a defined type, but I'm not aware of anything in stdlib that shouldn't be available in a defined type. The code is dead simple and it's the standard pattern of ""define a hash, write files from it"".

Ideas?

EDIT: One of my coworkers created a ~/lib/puppet/functions/to_json_purdy.rb (a copy of to_json_pretty.rb) in the project and sure enough, it finds the to_json_purdy.rb file and works as advertised.

*Desired Behavior:*

using to_json_pretty on a hash should work for a file's contents.

*Actual Behavior:*

""Unknown function: 'to_json_pretty'""",Bug,PUP-8450,[],to_json_pretty doesn't work
"I am trying to diagnose a P1 customer issue however they are using Puppet Agent 1.10.8 (i.e. Puppet 4.10.8) however there are no 4.10.x windows packages available at [http://downloads.puppet.com/windows/] OR [http://downloads.puppet.com/windows/puppet5/]

Marked as critical as I cannot replicate the user's environment without the installation media for the puppet agent.

 

Note the last Pup 4.x agent listed as 1.9.3 on 9th March 2017

 

If there is another location for this media then the Puppet Docs need to be updated as this is the location users are directed to. (https://puppet.com/docs/puppet/4.10/install_windows.html)",Bug,PUP-8449,[],No Windows Agents available for download for Puppet Agent 1.10.x
"PUP-1916 added the ability to clean certificates that have not yet been signed, without having to manually sign/revoke them first. However, this only works if there is at least one signed certificate in the list of certificate names passed to ""puppet cert clean"".",Bug,PUP-8448,[],"""puppet cert clean"" only works if at least one cert has already been signed"
"The ""puppet man"" application was deprecated, and should be removed. Now is the time to remove it, and any remaining references to it.",Task,PUP-8446,[],"Remove ""puppet man"" face application"
"The ""puppet man"" face application is being deprecated in favor of ""puppet help"", and direct usage of the shipped man pages.

As such, we need to:
* Add a deprecation message to ""puppet man"" and its documentation to alert users to this.
* Remove references to ""puppet man"", ""puppet man man"", ""man puppet-man"", etc., and update them to point at ""puppet help"" or ""man puppet-<thing>"" if appropriate.
* Add mentions of setting {{MANPATH}} (and what to set it to include) so that the shipped man pages can be accessed via the {{man}} command.",Task,PUP-8445,[],"Deprecate ""puppet man"""
"Currently, {{puppet man}} without any arguments generates an error message.

{noformat}
% be ./bin/puppet man
Error: puppet man man takes 1 argument, but you gave 0
Error: Try 'puppet help man man' for usage
{noformat}

This should, instead, show the {{puppet man --help}} output.

{noformat}
% be ./bin/puppet man --help


USAGE: puppet man <action>

This subcommand displays manual pages for all Puppet subcommands. If the
`ronn` gem (<https://github.com/rtomayko/ronn/>) is installed on your
system, puppet man will display fully-formatted man pages. If `ronn` is not
available, puppet man will display the raw (but human-readable) source text
in a pager.

OPTIONS:
  --render-as FORMAT             - The rendering format to use.
  --verbose                      - Whether to log verbosely.
  --debug                        - Whether to log debug information.

ACTIONS:
  man    Display the manual page for a Puppet subcommand.

See 'puppet man man' or 'man puppet-man' for full help.
{noformat}",Task,PUP-8444,[],"Have ""puppet man"" default to ""--help"" when run without arguments"
"*Puppet Version:* 5.3.4
 *Puppet Server Version:* 5.1.4
 *OS Name/Version:* RHEL7.4

*Summary:* Catalogs fail to compile on puppet-server 5.1.5 when using puppet-agent 5.3.4. When puppet-agent is downgraded on puppet-server 5.1.5 compiles are successful. ** 

 

*Baseline/Working Example*

With puppet-agent 5.3.3 and puppet-server 5.1.5, I can successfully compile a catalog for my client.
{code:java}
[root@puppet5 ~]# rpm -q puppet-agent puppetserver
puppet-agent-5.3.3-1.el7.x86_64
puppetserver-5.1.5-1.el7.noarch{code}
Client:
{code:java}
[root@led ~]# rpm -q puppet-agent
puppet-agent-5.3.4-1.el7.x86_64
[root@led ~]# puppet agent -t --environment production --server puppet5.corp.com
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for led
Info: Unable to serialize catalog to json, retrying with pson
Info: Applying configuration version 'c30a9ad'
Notice: Applied catalog in 9.63 seconds{code}
 

*Broken Example*

Upgrading the agent on the server will prevent the server from compiling a catalog.
{code:java}
[root@puppet5 ~]# yum -y update puppet-agent
...
[root@puppet5 ~]# rpm -q puppet-agent puppetserver
puppet-agent-5.3.4-1.el7.x86_64
puppetserver-5.1.5-1.el7.noarch
[root@puppet5 ~]# systemctl restart puppetserver{code}
 

Client:
{code:java}
[root@led ~]# puppet agent -t --environment production --server puppet5.corp.com
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Retrieving locales
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, Class[Eash::Client]: expects a value for parameter 'pem' (file: /etc/puppetlabs/code/environments/production/.site/profile/manifests/common.pp, line: 42, column: 21) on node led.corp.com
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run{code}
 

*Why I think it's Hiera Related*

My hiera.yaml
{code:java}
[puppet5 ~]$ cat /etc/puppetlabs/code/hiera.yaml
# managed by puppet: modules/puppet/files/etc/puppetlabs/code/hiera.yaml/common.erb, called by: Class[Role::Infra::Puppet_server]
---
:backends:
  - modularfiles
  - eyaml
  - yaml

:hierarchy:
  - ""host/%{::fqdn}""
  - ""role/%{::role}""
  - ""hostgroup/%{::hostgroup}""
  - ""team/%{::team}""
  - ""enclave/%{::enclave}""
  - common

:yaml:
  :datadir: ""/etc/puppetlabs/code/environments/%{environment}/hieradata""

:eyaml:
  :datadir: ""/etc/puppetlabs/code/environments/%{environment}/hieradata""
  :pkcs7_private_key: /etc/puppetlabs/keys/private_key.pkcs7.pem
  :pkcs7_public_key:  /etc/puppetlabs/keys/public_key.pkcs7.pem
  :extension: 'yaml'

:merge_behavior: native{code}
Running puppet server in debug mode
{code:java}
[root@puppet5 ~]# puppetserver foreground --debug
...
2018-02-09 15:27:40,269 DEBUG [qtp194608888-66] [puppetserver] Puppet Lookup of 'telegraf::outputs'
  Searching for ""telegraf::outputs""
    Global Data Provider (hiera configuration version 3)
      Using configuration ""/etc/puppetlabs/code/hiera.yaml""
      Merge strategy hash
...
        Hierarchy entry ""yaml""
          Merge strategy hash
            Path ""/etc/puppetlabs/code/environments//hieradata/host/led.corp.com.yaml""
              Original path: ""host/%{::fqdn}""
              Path not found
            Path ""/etc/puppetlabs/code/environments//hieradata/role/infra::led.yaml""
              Original path: ""role/%{::role}""
              Path not found
            Path ""/etc/puppetlabs/code/environments//hieradata/hostgroup/.yaml""
              Original path: ""hostgroup/%{::hostgroup}""
              Path not found
            Path ""/etc/puppetlabs/code/environments//hieradata/team/infra.yaml""
              Original path: ""team/%{::team}""
              Path not found
            Path ""/etc/puppetlabs/code/environments//hieradata/enclave/ccs.yaml""
              Original path: ""enclave/%{::enclave}""
              Path not found
            Path ""/etc/puppetlabs/code/environments//hieradata/common.yaml""
              Original path: ""common""
              Path not found
...
2018-02-09 15:27:40,735 ERROR [qtp194608888-66] [puppetserver] Puppet Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, Class[Dns::Client]: expects a value for parameter 'server' (file: /etc/puppetlabs/code/environments/production/.site/profile/manifests/common.pp, line: 42, column: 2
1) on node led.corp.com
...{code}
As you can see the %\{environment} variable is not expanded

 

 ",Bug,PUP-8443,[],Topscope 'environment' can become nil when setting node parameters in a custom terminus
"In our puppet types, we are able to set defaults for parameters defined for each type. However, if a given parameter defaults to false, the code will take that for falsiness and not include that parameter as set, even though it should be. This originates at https://github.com/puppetlabs/puppet/blob/327b03a9e1ecdc7b925720a4eec59795f4456a56/lib/puppet/type.rb#L834, where {{value = parameter.default}} will return false and send us into the else block of that if statement, which removes our parameter from the list of parameters for our given resource.

This will likely result in some unexpected changes once we fix it.",Bug,PUP-8442,[],type parameters do not honor when default is set to false
"Puppet agent configured with `server_list` and an environment that does not exist locally, fails with a connection error:
{noformat}[tdevelioglu@traveler ~]$ cat /etc/puppetlabs/puppet/puppet.conf
[main]
ca_server = puppetserver-1001
disable_i18n = true
environment = testing
http_connect_timeout = 1
server_list = puppetserver-1002,puppetserver-1001
splay = true
strict_variables = true
vardir = /opt/puppetlabs/puppet/cache { mode = 0751 }

[tdevelioglu@traveler ~]$ ls -l /etc/puppetlabs/code/environments/
total 0
drwxr-xr-x 5 root root 74 Feb  8 11:46 production

[tdevelioglu@traveler ~]$ sudo puppet agent -t
Warning: Could not select a functional puppet master
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: Failed to open TCP connection to :0 (Connection refused - connect(2) for nil port 0)
Info: Retrieving pluginfacts
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Failed to open TCP connection to :0 (Connection refused - connect(2) for nil port 0)
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: Failed to open TCP connection to :0 (Connection refused - connect(2) for nil port 0)
Info: Retrieving plugin
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Failed to open TCP connection to :0 (Connection refused - connect(2) for nil port 0)
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Failed to open TCP connection to :0 (Connection refused - connect(2) for nil port 0)
Info: Loading facts
Error: Could not retrieve catalog from remote server: Failed to open TCP connection to :0 (Connection refused - connect(2) for nil port 0)
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
Error: Could not send report: Failed to open TCP connection to :0 (Connection refused - connect(2) for nil port 0){noformat}
 

Using `server` instead of `server_list`, prints a warning and continues:
{noformat}[tdevelioglu@traveler ~]$ cat /etc/puppetlabs/puppet/puppet.conf
[main]
ca_server = puppetserver-1001
disable_i18n = true
environment = testing
http_connect_timeout = 1
server = puppetserver-1002
splay = true
strict_variables = true
vardir = /opt/puppetlabs/puppet/cache { mode = 0751 }

[tdevelioglu@traveler ~]$ sudo puppet agent -t
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: Could not intern from application/json: Could not find a directory environment named 'testing' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Retrieving locales
Info: Loading facts
Info: Caching catalog for traveler{noformat}
 

With the environment locally present the issue gets resolved:
{noformat}[tdevelioglu@traveler ~]$ cat /etc/puppetlabs/puppet/puppet.conf
[main]
ca_server = puppetserver-1001
disable_i18n = true
environment = testing
http_connect_timeout = 1
server_list = puppetserver-1002,puppetserver-1001
splay = true
strict_variables = true
vardir = /opt/puppetlabs/puppet/cache { mode = 0751 }

[tdevelioglu@traveler ~]$ sudo mkdir /etc/puppetlabs/code/environments/testing

[tdevelioglu@traveler ~]$ sudo puppet agent -t
Info: Using configured environment 'testing'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Retrieving locales
Info: Loading facts
Info: Caching catalog for traveler
{noformat}
 ",Bug,PUP-8440,[],Puppet agent fails to run when using server_list and the local environment is missing.
"The data types {{Float}}, {{Integer}}, {{Timespan}}, and {{Timestamp}} in the Puppet type system can be specified with a lower and upper limit using the syntax {{T[min, max]}}. When using just one argument, {{T[x]}} the  {{Float}} and {{Integer}} will interpret this as {{T[x, <no limit>]}} whereas {{Timespan}} and {{Timestamp}} interprets it as {{T[x,x]}}. The latter interpretation is incorrect. {{Timespan}} and {{Timestamp}} must be changed to use the same semantics as {{Float}} and {{Integer}}.",Bug,PUP-8439,[],Default upper limit of Timestamp and Timespan data types is incorrectly set equal to lower limit
"Puppet currently specifies a dependency on FFI for Windows as {{~> 1.9.6}} which at this time will pull in FFI {{1.9.21}}

 

Until the {{1.9.19}} / {{1.9.20}} / {{1.9.21}} releases, Puppet had been consuming FFI {{1.9.18}}.

 

On Feb 6, 2018, the FFI maintainers released a FFI {{1.9.19}}, then an FFI {{1.9.20}}, failing to produce all the various platform specific gems that had been published. Both of these versions were yanked, and a {{1.9.21}} was released with all the platform specific gem versions.

 

However, there are a few problems with {{1.9.21}}:
 * The Windows gem has inexplicably doubled in size, even though the changes to the FFI code should have been minor
 * There are a number of problems compiling the gem now, on platforms where it previously worked (CentOS as noted by the Bolt team + about 10 tickets on the FFI GitHub issue tracker for a variety of other problems)

 

Bolt team has already pinned to {{<= 1.9.18}} as FFI is needed on all platforms. For Puppet, this isn't strictly a problem at the moment as Windows doesn't need to compile gems, but it feels safest at the moment to follow the same policy and pin to known working.

FFI {{1.9.21}}+ will be needed when Ruby 2.5 support is added, but for now, there are no fixes that Puppet needs in the newest versions, and we don't understand why the gem doubled. It's safest to pin to the old version until the new FFI maintainers have their process smoothed out, etc.

Also note that this is only needed for gem based workflows / the gem release - for instance, when modules consume the Puppet gem - the MSI package already pins to {{1.9.18}} at https://github.com/puppetlabs/puppet-agent/blob/master/configs/components/rubygem-ffi.rb#L2",Task,PUP-8438,['windows'],Pin FFI gem to 1.9.18 given current problems in FFI 1.9.21
"*Puppet Version:* 5.3.4 but it's been this way for a long time

When the agent downloads plugins/external facts/locales from the server it is supposed to delete/purge local files that don't exist on the master. That way the local cache doesn't grow unbounded as modules are updated over time on the master. That works most of the time, except if the file to be deleted matches the {{pluginsignore}} filter, then the file isn't removed.

{noformat}
$ touch  ~/.puppetlabs/opt/puppet/cache/lib/CVS
$ touch  ~/.puppetlabs/opt/puppet/cache/lib/CVS-too
$ bx puppet agent -t
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Notice: /File[/Users/josh/.puppetlabs/opt/puppet/cache/lib/CVS-too]/ensure: removed
Info: Retrieving locales
Info: Loading facts
Info: Caching catalog for localhost
Info: Applying configuration version '1518038052'
Notice: Applied catalog in 0.02 seconds
{noformat}

Note only CVS-too is deleted.",Bug,PUP-8437,[],Downloader doesn't remove local files if they are excluded by pluginsignore
"*Puppet Version: 5.3.4*
 *Puppet Server Version: n/a*
 *OS Name/Version:*

*Desired Behavior:*

Puppet should only ignore {{*.pot}} files when syncing {{locales}}, but not for {{plugins}} or {{pluginfacts}}.

*Actual Behavior:*

The default {{pluginsignore}} applies to all plugin related requests. We should instead exclude {{*.pot}} files in the same way we do for {{config.yaml}}, in the locales-specific downloader.

If you create an executable script named {{my.pot}} in the {{facts.d}} directory of a module, the agent won't download the file. On master:

{noformat}
$ echo <<END > ~/.puppetlabs/etc/code/environments/production/modules/acl/facts.d/my.pot
heredoc> #!/bin/sh
heredoc> echo ""foo=bar""
heredoc> END
$ chmod a+x  ~/.puppetlabs/etc/code/environments/production/modules/acl/facts.d/my.pot
{noformat}

On agent, the file isn't downloaded:

{noformat}
$ bx puppet agent -t
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Retrieving locales
Info: Loading facts
...
$ find  ~/.puppetlabs/opt/puppet/cache/facts.d
/Users/josh/.puppetlabs/opt/puppet/cache/facts.d
{noformat}",Bug,PUP-8436,[],puppet should only ignore pot files when syncing locales
"*Puppet Version: All*
 *Puppet Server Version: N/A*
 *OS Name/Version:* 

When managing a hosts entry and the hosts fiel does not exists you get a catalog error.

*Desired Behavior:* 

When managing hosts\{} resources and the hosts file does not exist it should either output a warning or create an empty hosts file and continue.

*Actual Behavior:*
{code:java}
[root@base ~]# puppet apply -e 'host{ ""abc"": ip => ""8.8.8.8""}'
Notice: Compiled catalog for base in environment production in 0.13 seconds
Error: undefined method `ancestors' for nil:NilClass{code}
{code:java}
[root@base ~]# puppet apply -e 'host{ ""abc"": ip => ""8.8.8.8""}' --debug --verbose --trace
...
...
Notice: Compiled catalog for base in environment production in 0.12 seconds
Debug: Puppet::Type::Host::ProviderParsed: file /etc/hosts does not exist
Debug: Puppet::Type::Host::ProviderParsed: file /etc/hosts does not exist
Debug: Puppet::Type::Host::ProviderParsed: file /etc/hosts does not exist
Error: undefined method `ancestors' for nil:NilClass
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/host.rb:68:in `block (3 levels) in <module:Puppet>'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:834:in `set_default'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2497:in `block in set_parameters'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2496:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2496:in `set_parameters'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2393:in `initialize'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:524:in `new'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:524:in `to_ral'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:633:in `block in to_catalog'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:625:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:625:in `to_catalog'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:506:in `to_ral'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:263:in `block in main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:306:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:225:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:170:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:662:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'{code}
 

 

 ",Bug,PUP-8435,[],"When no hosts file exists, puppet fails when trying to manage hosts{} resource."
"Puppet version: 5.3.4

We meant to remove {{gettext-setup}} as a puppet runtime dependency, but we store gem dependencies in 3 different places for different use cases, so it was missed. See https://github.com/puppetlabs/puppet/commit/53aa50aaf6347ac166620f08224d072552e57dc3#diff-8b7db4d5cc4b8f6dc8feb7030baa2478.

This is a problem because it increases the chances of running into PUP-8418 (if gettext-setup is ever required).",Bug,PUP-8432,[],Remove gettext-setup as a runtime gem dependency
"(Initial planned release date: 2018-02-13)

1. Create versions and filters for the release in in JIRA. Ensure that the filters are shared with the ‘All Employees’ group.

2. Create or update the Kanban board for the release series. Ensure that the underlying filter for the board includes issues from the release filter and add a quick filter to highlight just those issues.

3. Create Release tickets (in the Project Central project) for the Puppet Platform and puppet-agent releases, with sub-tasks for each milestone (e.g., “String Freeze”, “Stop Ship Line”, “Ready to Ship”, and “General Availability (GA)”.

4. Create release pages for the Puppet Platform and puppet-agent releases in Confluence, under the appropriate “Upcoming Releases” parent page. Make sure the pages reference the release filters, tickets, and Kanban board as needed.

5. Update the “Versions & Dependencies” pages for Puppet Platform and puppet-agent with dependency versions for releases. Format the release versions in italics and link them to their corresponding release pages.

6. Add events for the release milestone dates to Group-Platform Google calendar. Ensure the description for each event includes a link to the release page.

7. Send an email to stakeholders (e.g., puppet-dev@googlegroups.com and discuss-platform@puppet.com) outlining the scope and timeline for the release.

 ",Task,PUP-8431,['release'],Communicate scope and timeline of next release (Puppet Platform 5.4.0)
"(Initial planned release date: 2018-02-13)

1) Update the release pages for Puppet Platform and puppet-agent in Confluence based on the release. Replace “Target Date” with “Release Date”, change language to past tense, and move the pages to the appropriate parent pages under “Current Releases”.

2) Update the “Versions & Dependencies pages for Puppet Platform and puppet-agent based on the release. Format the release versions in bold and move them to the appropriate tables under “Current Releases”.

3) Close any outstanding Milestone and Risk tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the Milestone tickets as needed to ensure they match the actual milestone dates.

4) Close the Release tickets for the Puppet Platform and puppet-agent releases. Be sure to update due dates for the tickets as needed to ensure they match the actual release date.

5) Close all tickets that have been resolved as part of the release. When using a bulk modify operation to transition the tickets to ‘Closed’ status in JIRA, be sure to select the appropriate resolution and disable notifications to avoid spamming watchers.

6) Make all tickets that were marked as Internal for the release public. When using bulk modify operation to change the value of the ‘level’ field for tickets to ‘None’ in JIRA, be sure to disable notifications to avoid spamming watchers.

7) Mark all versions that were shipped as part of the release as “released”. When doing so, be sure to update the description and release date of each version as needed based on what was shipped when.

8) Update the Kanban board for the release series. Remove the release filter from the underlying filter for the board and remove the quick filter for the release as well.

 ",Task,PUP-8430,['release'],Update Confluence and JIRA based on release (Puppet Platform 5.4.0)
"(Initial planned release date: 2018-02-13) 

1. Ensure all prerequisite release tasks are complete.

2. Review the release Kanban board to ensure all tickets are resolved.

3. Ping release leads in ‘Platform Core’ HipChat room for go/no-go decision.

4. Send email indicating Ready To Ship milestone has been achieved.",Task,PUP-8429,['release'],Declare Ready to Ship (go/no-go) milestone (Puppet Platform 5.4.0)
"(Initial planned release date: 2018-02-13)

# Walk through smoke testing all Platform components, installing it from packages as a user would.
#* See https://confluence.puppetlabs.com/display/systemsEngineering/Test+platform+5+package+artifacts+template
#  and https://confluence.puppetlabs.com/display/systemsEngineering/Test+platform+5+repository+template
   for examples.
",Task,PUP-8428,['release'],Manually smoke test all artifacts (Puppet Platform 5.4.0)
"(Initial planned release date: 2018-02-13)

",Task,PUP-8427,['release'],Prepare release announcement (Puppet Platform 5.4.0)
"(Initial planned release date: 2018-02-13)

1) Send an email reminder ahead of time about the upcoming Stop Ship milestone date.

2) Review tickets on the release Kanban board to ensure all code changes have landed. Flag any related issues that are not yet Ready for CI.

3) Ensure all tickets have release notes, if needed. Add comments to issues without release notes, asking the author of the PR to add them or indicate that they aren’t needed.

4) Follow up with the Engineering lead for each component (e.g., in HipChat) to confirm current state and obtain a forecast for when all code will be in a build.

5) Send email indicating that the Stop Ship milestone has been achieved.

 ",Task,PUP-8426,['release'],Declare Stop Ship Line (code complete) milestone (Puppet Platform 5.4.0)
"(Initial planned release date: 2018-02-13)

1) Ensure “Versions & Dependencies” pages for Puppet Platform and puppet-agent are up to date in Confluence. Reach out to teams as needed to confirm that the fix versions listed are those that we intend to ship with the release.

2) For each component project of Puppet Platform and puppet-agent, ensure there is a next version if needed. Often this will be the next Z in an X.Y.Z series. However, if we are jumping to a new X or Y release that skips an existing Z version in JIRA, make sure those tickets are reassigned to the correct fix version, and the unneeded version is deleted. For example, if we have tickets with a fix version of 4.3.3, but we’re going from 4.3.2 to 4.4.0, then we need to reassign the tickets assigned to 4.3.3 and delete the 4.3.2 version from JIRA.

3) Create public filters for inclusion in the release notes and/or announcement. These allow easy tracking as new bugs come in for a particular version and allow everyone to see the list of changes in a release. Include links to the filters as a comment on this issue before resolving it.

4) Update the “master” filters for Puppet Platform 5.4.0 and puppet-agent 5.4.0 to reference the “Fixed in” filters created above.

5) Update the community feedback filter for Puppet Platform 5.y to reference the “Introduced in” filter created above.

 ",Task,PUP-8425,['release'],Prepare Confluence and JIRA for release (Puppet Platform 5.4.0)
"    Puppet Platform 5.4.0 Release - 2018-02-13
",Epic,PUP-8424,[],"    Puppet Platform 5.4.0 Release - 2018-02-13
"
"The problem is that customers using our Puppet and Puppet Enterprise packages cannot meet the FIPS 140-2 requirements because we roll our own OpenSSL and do not link against the OpenSSL provided with RHEL. This causes them to fail ""FISMA High"" compliance standards.

This epic is the place to gather the stream of work required to remediate this issue, although some implications (such as for puppet-server) will require tickets outside the PUP jira project.

See also PUP-7510 for FIPS-Enabled Puppet Agent",Epic,PUP-8423,[],FIPS-Enabled Puppet Server Side
"*Puppet Version:*
 *Puppet Server Version:*
 *OS Name/Version:*

Describe your issue in as much detail as possible…
 Describe steps to reproduce…

*Desired Behavior:*

*Actual Behavior:*

Please take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.

Examples:
 Run puppet agent with --test --trace --debug

Relevant sections of {{/var/log/puppetlabs/puppetserver/puppetserver.log}} or any applicable logs from the same directory.

For more detailed information turn up the server logs by upping the log level in the server's logback.xml

Relevant sections of configurations files (puppet.conf, hiera.conf, Server's conf.d, defaults/sysconfig)

For memory issues with server heap dumps are also helpful.",Improvement,PUP-8422,[],warning messages while puppet agent running on nodes. 
"When updating a yumrepo resource, yumrepo/inifile.rb blindly attempts to stat a list of files previously collected, with no error handling. 
This results in ruby errors like ""No such file or directory @ rb_file_s_stat - /etc/yum.repos.d/potato.repo"" if the list of files is out of date, and obviously resource failures. 
This can happen if /etc/yum.repos.d is managed + purged, or yum a plug-in decides to remove a file etc. 
Currently we're seeing the first agent run fail on every newly provisioned host because of this.

There is pretty simple fix, wrap the stat in an 'if Puppet::FileSystem.exist?(file)' to check if the file actually exists before trying to stat it. 
See https://github.com/puppetlabs/puppet/compare/master...jsmall3:jsmall3-yumrepo-store",Improvement,PUP-8421,"['el', 'fedora', 'linux', 'triaged', 'type_and_provider', 'type_yumrepo']",Add error handing to Yum provider
"The following file resource behaves incorrectly and results in a corrupt file:

{code}
   file { ""service installer"":
        path => '/usr/local/bin/cleo-service',
        ensure => 'present',
        mode => '0700',
        source => ""https://raw.githubusercontent.com/jthielens/versalex-ops/master/service/cleo-service"",
   }
{code}",Bug,PUP-8420,['regression'],Regression: puppet apply does not decompress response bodies for http file sources
"Hi there,

our puppet-agent got upgraded from 5.3.3 to 5.3.4 on all of our servers (Debian 8, Debian 9) and some of them throw a Warning at the beginning of their puppetrun.
{noformat}
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: Could not intern from application/json: Could not find a directory environment named 'my_custom_env' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?
{noformat}

""my_custom_env"" is located on my puppetserver under ""/opt"" somewhere so I don't know where ""/etc/puppetlabs/code/environments"" is coming from. Have you encountered this warning before? Do you know how to fix this?

best regards and thanks
Sebastian",Bug,PUP-8419,['regression'],Agent's node request fails if environment directory doesn't exist locally
"*Puppet Version:* 5.3.4
 *Puppet Server Version:* /
 *OS Name/Version:* CentOS7  docker container

My rspec tests are failing since I upgraded to puppet 5.3.4. Tests are working OK on 3.8.x and 5.3.3.

Error:
{code:java}Failures:
1) logstash main class should compile into a catalogue without dependency cycles
Failure/Error: it { should compile.with_all_deps }
TypeError:
no implicit conversion of nil into String
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/module.rb:316:in `join'
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/module.rb:316:in `has_translations?'
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/gettext/module_translations.rb:12:in `block in load_from_modulepath'
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/gettext/module_translations.rb:11:in `each'
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/gettext/module_translations.rb:11:in `load_from_modulepath'
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/node/environment.rb:444:in `use_text_domain'
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/indirector/catalog/compiler.rb:52:in `find'
# /usr/local/bundle/gems/puppet-5.3.4/lib/puppet/indirector/indirection.rb:198:in `find'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/adapters.rb:83:in `catalog'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/adapters.rb:161:in `catalog'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/support.rb:354:in `build_catalog_without_cache'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/support.rb:375:in `block in build_catalog'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/cache.rb:17:in `call'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/cache.rb:17:in `get'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/support.rb:374:in `build_catalog'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/support.rb:75:in `block in load_catalogue'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/support.rb:319:in `with_vardir'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/support.rb:69:in `load_catalogue'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/example/class_example_group.rb:7:in `catalogue'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/support.rb:10:in `block in subject'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/matchers/compile.rb:23:in `call'
# /usr/local/bundle/gems/rspec-puppet-2.6.9/lib/rspec-puppet/matchers/compile.rb:23:in `matches?'
# ./spec/classes/init_spec.rb:33:in `block (3 levels) in <top (required)>'
{code}
 

*Desired Behavior:*

Tests should pass without a problem.

*Actual Behavior:*

I get a 'no implicit conversion of nil into String' error for all tests

I hope this is a puppet bug. If not, please let me know which component is problematic and I'll open a bug there.",Bug,PUP-8418,[],TypeError no implicit conversion of nil into String in puppet 5.3.4
"Currently, the only way to update the cached catalog & synced modules is to do a ""live"" Puppet run ({{noop = false}}). It would be handy to be able to update the cached catalog & synced modules without having to run Puppet in enforcement mode.",New Feature,PUP-8417,[],Add ability to refresh cached catalog & synced moduled without applying resources
,Task,PUP-8416,[],Remove old acceptance code that now lives in beaker-puppet
"I create a defined resource which has optional parameters. But if one of the parameters isn't specified I get the following error:
{noformat}
Error while evaluating a Resource Statement, Profile::Mongodb::User[mongo_test_mongo_test_ro]:
expects a value for parameter 'password_hash' at /etc/puppetlabs/code/environments/xxx/modules/profile/manifests/mongodb/database.pp:48 on node test.xxx.net
{noformat}

The defined resource looks like follows:
{code:puppet}
define profile::mongodb::user (
  String           $username,
  String           $database,
  Optional[String] $password,
  Optional[String] $password_hash,
  Array            $roles          = ['readWrite'],
) {}
{code}",Bug,PUP-8415,['parameter'],Error is optional parameter is missing
"I recently made a change to a {{service}} resource definition to modify the {{restart}} command used by that service.  I wanted to verify this change without actually affecting any running system, so (with the change deployed to a testing Puppet environment), i went to a non-production system and ran {{puppet agent -t --noop --debug}}.

That run proceeded to show me the commands the {{service}} provider used to get the status of the services, but did _not_ show me the commands it would have run to process the refresh event that came to it.

Please see if it's possible to have the {{service}} provider display the full set of commands it would issue even during a {{--noop}} puppet run.",New Feature,PUP-8413,[],"Show refresh commands that the service provider would issue during ""noop"" run"
"Caveat: this functionality may already exist, since I'm still stuck in the iron age at version {{4.2.3}}.

I recently needed to identify exactly which provider was being used for the {{service}} resources on one of my agents.  I checked the catalog, but did not expect to see it there.  I _was_ hoping to see it in the report, but it was not there either.  It also was not in the {{--debug}} output of the puppet agent.  I ended up having to browse the ruby code for the various {{service}} providers and identify which one was default for my OS.

Would it be possible to improve the report generated by the puppet agent to include which provider was used for each resource?",New Feature,PUP-8412,[],"In the puppet report, provide details of which provider was used for each resource"
"If a resource type has title patterns, it would end up using the default regular expression instead of the specified pattern. For most resource types this is the default and no problem would be noticed.

We found this problem in code review as there was a typo in the implementation.",Bug,PUP-8411,[],types generated by puppet generate types with title patterns are handled the wrong way
"In some cases it's desirable to return a hash from a plan. It's easy to fall into syntax errors when doing this however. Either Declaring a hash with quoted string keys as the implicit return or passing a hash with quoted string keys to ""return"" without parens both result in a syntax error

Plans that seem like they should work:
{code}
plan foo {
  ....
  $result = run_task( ... )
  { 'result' => $result }
}

plan foo {
  return { 'result' => 10 }
}
{code}

workarounds
{code}
plan foo {
  ....
  $result = run_task( ... );
  { 'result' => $result }
}

plan foo {
return { result => 10 }
}

plan foo {
  return({ 'result' => 10 })
}
{code}
",Bug,PUP-8410,[],"It is difficult to return a hash from a plan, or function"
"When running {{puppet config print --all}} on the command line with {{environment_timeout}} set to {{unlimited}} in {{puppet.conf}}, the value for {{environment_timeout}} is listed as {{Infinity}}, which is not a valid setting (it can be a positive integer, 0, or `{{unlimited`}}). As a user if I saw this I would presume it was a valid setting.

When I try using {{Infinity}} as a setting value for {{environment_timeout}}, I get a not so helpful error message and stack trace.
{code}puppet apply --environment_timeout=Infinity -e ""notify{'foo':}""
/Users/matthaus/src/puppet/lib/puppet/settings/ttl_setting.rb:43:in `munge': Invalid 'time to live' format '""Infinity""' for parameter: environment_timeout (Puppet::Settings::ValidationError)
	from /Users/matthaus/src/puppet/lib/puppet/settings/ttl_setting.rb:25:in `munge'
	from /Users/matthaus/src/puppet/lib/puppet/settings.rb:1310:in `interpolate'
	from /Users/matthaus/src/puppet/lib/puppet/settings.rb:1082:in `value_sym'
	from /Users/matthaus/src/puppet/lib/puppet/settings.rb:1054:in `value'
	from /Users/matthaus/src/puppet/lib/puppet/settings/environment_conf.rb:87:in `environment_timeout'
	from /Users/matthaus/src/puppet/lib/puppet/environments.rb:414:in `entry'
	from /Users/matthaus/src/puppet/lib/puppet/environments.rb:345:in `get'
	from /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:131:in `module_directories'
	from /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:166:in `search_directories'
	from /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:100:in `files_to_load'
	from /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:220:in `files_to_load'
	from /Users/matthaus/src/puppet/lib/puppet/application.rb:212:in `available_application_names'
	from /Users/matthaus/src/puppet/lib/puppet/util/command_line.rb:90:in `find_subcommand'
	from /Users/matthaus/src/puppet/lib/puppet/util/command_line.rb:73:in `execute'
	from /usr/bin/puppet:5:in `<main>'
{code}
The simple reproducer here is:
{code}puppet config print --environment_timeout=unlimited environment_timeout
Infinity
{code}",Bug,PUP-8409,[],Puppet config print lists invalid value for environment_timeout when set to unlimited
"A community member found a handful of variable names that are misspelled. This is to correct those misspelled names.

{noformat}
-step ""should allow param class defaults to be overriden""
+step ""should allow param class defaults to be overridden""

-        fail(Issues::ILLEGAL_OVERRIDEN_TYPE, o, {:actual => r} )
+        fail(Issues::ILLEGAL_OVERRIDDEN_TYPE, o, {:actual => r} )

-  ILLEGAL_OVERRIDEN_TYPE = issue :ILLEGAL_OVERRIDEN_TYPE, :actual do
+  ILLEGAL_OVERRIDDEN_TYPE = issue :ILLEGAL_OVERRIDDEN_TYPE, :actual do

-    @non_convertable ||= [OpenSSL::ASN1::EndOfContent,
+    @non_convertible ||= [OpenSSL::ASN1::EndOfContent,

-  def canonalize_ifname(interface)
+  def canonicalize_ifname(interface)

-    attr_accessor :resource_list, :requires, :childs, :realizes
+    attr_accessor :resource_list, :requires, :children, :realizes
{noformat}",Task,PUP-8408,[],Fix misspelled variable and method names in puppet
"*Puppet Version:* 5.3.x
*Puppet Server Version:* n/a

Running puppet benchmarks fails:

{noformat}
$ bx rake benchmark:many_modules:run
mkdir -p /var/folders/8m/d6146zxd6bv_3h8y4ykvvxh40000gn/T/many_modules20180130-73932-2mw6bc
                 user     system      total        real
Run 1      rake aborted!
no implicit conversion of nil into String
/Users/josh/work/puppet/lib/puppet/module.rb:316:in `join'
/Users/josh/work/puppet/lib/puppet/module.rb:316:in `has_translations?'
/Users/josh/work/puppet/lib/puppet/gettext/module_translations.rb:12:in `block in load_from_modulepath'
/Users/josh/work/puppet/lib/puppet/gettext/module_translations.rb:11:in `each'
/Users/josh/work/puppet/lib/puppet/gettext/module_translations.rb:11:in `load_from_modulepath'
/Users/josh/work/puppet/lib/puppet/node/environment.rb:444:in `use_text_domain'
/Users/josh/work/puppet/lib/puppet/indirector/catalog/compiler.rb:52:in `find'
{noformat}

The issue is that puppet sets FastGettext.default_available_locales to nil to prevent FastGettext from selecting the best available default locale. Later puppet's Rakefile loads the gettext-setup gem. It sets FastGettext.default_available_locales to empty string (instead of nil). This activates the ""available locales"" machinery in FastGettext. Then GettextSetup.initialize tries to set the default locale, which due to the empty array causes the default locale to be set to nil.

{noformat}
(byebug) best_locale_in(new_locale)
nil
(byebug) new_locale
""en""
{noformat}

This is only an issue when running puppet via the Rakefile, e.g. benchmarks and {{rake parallel:spec}}, not when puppet is running from source, e.g. {{bundle exec puppet agent}} or from packages.",Bug,PUP-8407,[],Puppet benchmarks fail due to gettext-setup initialization
This means using it requires translation from bolt task output and does not align with our standard API data representation of hashes that use 'msg'. The error datatype should be updates to create data hashes that include {{msg}} not {{message}} keys and it should expect that key when it is instantiated from a hash.,Bug,PUP-8406,[],Puppet Error datatype uses 'message' not 'msg' as hash key
"When defining multiple levels of hierarchy in hiera.yaml (more than 3), and requesting hiera to lookup a key that is found on more than 3 levels, and lookup options for that key are configured to merge deep with a knockout prefix, the merge fails to knockout the key matching the higher precedence knockout.

Steps to reproduce:

{code:yaml}
hiera.yaml:
 version: 5
 defaults:         
   datadir: data
   data_hash: yaml_data

 hierarchy:
   - name: node specific data
     path: node/%{::site.node}.yaml

   - name: product data
     path: product/%{::site.product}.yaml

   - name: os data
     path: os/%{::os.family}.yaml

   - name: global data
     path: common.yaml
	
common.yaml:
  lookup_options:
    classes:
      merge:
        strategy: deep
        knockout_prefix: --
  classes:
    - profiles::motd
    - profiles::network

os/RedHat.yaml:
  classes:
    - profiles::yum

product/product.yaml
 classes:
   - profiles::application

node/node.yaml:
 classes:
   - --profiles::network
   - network
{code}

*Expected*

{code:java}
puppet lookup --knock-out-prefix '--' --merge deep classes
---
- profiles::motd
- profiles::yum
- profiles::application
- network
{code}

*Actual*

{code:java}
puppet lookup --knock-out-prefix '--' --merge deep classes
---
- profiles::motd
- profiles::network
- profiles::yum
- profiles::application
- network
{code}

Removing a layer from the hierarchy causes the merge to behave as expected. The difference being:

{code:java}
puppet lookup --knock-out-prefix '--' --merge deep classes | grep 'Found key:' | wc -l
4
{code}
vs
{code:java}
puppet lookup --knock-out-prefix '--' --merge deep classes | grep 'Found key:' | wc -l
3
{code}

*Verified Affected Versions*
Puppet 4.10.0
Puppet 4.10.9
Puppet 5.3.1",Bug,PUP-8405,[],Knock-out-prefix fails with more than 3 merges
"*Puppet Version:* 4.10.9
*Puppet Server Version:* 2.8.0
*OS Name/Version:* linux

Trying to use {{ssh_authorized_key}} when the parent folder of {{.ssh}} doesn't belong to the target user leads to a slightly misleading ""permission denied"" error during {{mkdir}}. This happens because {{ssh_authorized_key}} runs {{mkdir}} as the target user, which might not be directly clear. Especially since it's not the same behaviour as an explicit {{file}} resource with {{owner}} set to the same target user (create as root than {{chown}} to target user).

*Desired Behavior:*

Output of puppet run with {{--debug}}:

{code}
Debug: Creating /somefolder/.ssh as someuser
Error: /Stage[main]/Main/Ssh_authorized_key[someuser]: Could not evaluate: Permission denied @ dir_s_mkdir - /somefolder/.ssh
{code}

*Actual Behavior:*

Output of puppet run with {{--debug}}:

{code}
Debug: Creating /somefolder/.ssh
Error: /Stage[main]/Main/Ssh_authorized_key[someuser]: Could not evaluate: Permission denied @ dir_s_mkdir - /somefolder/.ssh
{code}
",Improvement,PUP-8404,[],ssh_authorized_key should mention effective uid on debug output
"*Puppet Version: {{puppet-agent-5.3.3.573.g26bbd71-x64.msi}}*
*Puppet Server Version: {{noarch 5.2.0.master-0.1SNAPSHOT.2018.01.27T1057.el7}}*
*OS Name/Version: Windows - All versions*

Failures on imaging acceptance tests on most or all Windows PA  acceptance suite runs.
Test case summary:
{noformat}
20:06:25               - Test Case Summary for suite 'tests' -
20:06:25        Total Suite Time: 5375.65 seconds
20:06:25       Average Test Time: 15.36 seconds
20:06:25               Attempted: 350
20:06:25                  Passed: 295
20:06:25                  Failed: 0
20:06:25                 Errored: 2
20:06:25                 Skipped: 52
20:06:25                 Pending: 1
20:06:25                   Total: 350
{noformat}

Test Cases:
* tests/direct_puppet/supports_utf8.rb - [Gist|https://gist.github.com/jcoconnor/e912b44911c66219df20223c06307499]
* tests/environment/variables_refreshed_each_compilation.rb - [Gist|https://gist.github.com/jcoconnor/d66b2d01f9015db4617f0b4810b86c99]

Jenkins log available at: https://jenkins-imaging.delivery.puppetlabs.net/view/Win-Acpt/job/imaging_win-2008r2_x86_64_vmware_vsphere.cygwin_run_pa_component_acceptance_tests_packer/1/consoleFull
",Bug,PUP-8403,[],Puppet Acceptance Test Failures in imaging testing
"Arista puppet acceptance failed on master last night with no space left on device:

https://jenkins-master-prod-1.delivery.puppetlabs.net/job/platform_puppet-agent_puppet-agent-integration-suite_daily-master/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=arista4-32a/74/console

A matrix reload didn't fix this. It only appears to happen on master at this point - arista cells on 1.10.x and 5.3.x runs from last night and yesterday were green.

I installed the puppet-agent package from that run on a fresh arista vm from the pooler, and disk usage on / went from 34% to 90% of its total ~300 Mb. This doesn't appear to be unusual - the 1.10.x agent is a similar size (only 1% difference in the result).",CI Blocker,PUP-8401,['transient'],Arista puppet acceptance tests fail with no space left on device
Need to disable the new rubocop Style/SafeNavigation:,Task,PUP-8400,[],new rubocop Style/SafeNavigation: needs to be disabled
"*Puppet Version:*2016.4.5
*Puppet Server Version:*
*OS Name/Version: Windows 2012 R2

*Test Setup*
A password and username in encrypted and stored in Hiera.
These are passed to example.pp which consists of:

{code:puppet}
exec{
command => ''examplecommand --username $testuser --password $testpass"",
path => facts[$path],
logoutput =>true
}
{code}

For some reason the above exec fails, the output displays failed password. The same applies when I try to create ps1 files from template and assign parameters within. All the information is displayed in puppet logs.
Is there a way to not log any error out(just a failure notice)/mask the password in log.

Want to know what is the best way to achieve this.

*Desired Behavior:*
Passwords not to be displayed in error log.

*Actual Behavior:*
Passwords from command/scripts from powershell on exec failure.

",Improvement,PUP-8399,[],Exec onlyif and unless should support sensitive data
Fix the indenting in the files objectadd.rb and pw.rb,Task,PUP-8398,[],Fix indenting in objectadd.rb and pw.rb
"We need to address a couple problems with the test:
* The test fails to work on amazon linux where the 'facter fqdn' which we use in the puppet code does not match up with the 'agent.hostname', so we need to really get the fqdn and use that when referencing the node
* The test direct_puppet/supports_utf8.rb fails on solaris11-64 boxes because LANG=C when you ssh over to run commands. Since puppet is showing the diff of a file with UTF-8 characters in it, it blows up because the Ruby has set default_external to a non-UTF-8 character set.
** Continue to skip platforms on 4.10.x
** This isn't a problem on 5.3.x and we should enable all the platforms to run on more if not all platforms
",Task,PUP-8397,[],review and fix direct_puppet/supports_utf8.rb test fails on solaris and cisco where LANG=C
"*Puppet Version:* 5.3.3
*Puppet Server Version:* 5.3.3
*OS Name/Version:* Ubuntu 16.04

Describe your issue in as much detail as possible…

In 16.04 when using puppet resource service, it bombs out if some of the services aren't using systemd, and trying to contact upstart, we should be handling this error better 

Describe steps to reproduce…

It seems that a vanilla install of Ubuntu 16.x is OK, however when intalling additional Ubuntu packages such as the GUI, we se this error

To reproduce

Install Ubuntu 16.04

Install the desktop packages


{code:java}
sudo apt-get update
sudo apt-get install ubuntu-desktop
reboot
{code}

Login via the GUI and open up a terminal or  SSH into the server

run puppet resource service 

and you will get the error 


{code:java}
Debug: Executing '/sbin/initctl list'
Error: Could not run: #<IO:0x00000000017b6cf8>
{code}

Debug run attached


*Desired Behavior:*

When the service cannot connect to jumpstart/returns it shouldn't break the command, the error should be handled and the services are returned 

*Actual Behavior:*

The command errors out 


Please take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.

Attached 


",Bug,PUP-8396,"['cs_pr_review', 'cspapercuts', 'linux', 'sadness', 'service', 'triaged', 'type_and_provider', 'ubuntu']",Puppet Resource Service fails on Debian/Ubuntu when non systemd service is called
"In Linux, Puppet typically runs as root (full privileges) and can leverage the exec resource's user parameter to run a command as a local user. 

In Windows, this parity is lacking and it's increasingly causing problems for Puppet users. It would be nice to run things as a local user.

This issue is further compounded by common Microsoft System Administration use cases, where various pieces of software are installed and run as domain service accounts. For instance, the SQL Server module does it with [some gnarly Ruby in a provider to set domain credentials in 3 places | https://github.com/puppetlabs/puppetlabs-sqlserver/blob/master/lib/puppet/provider/sqlserver_features/mssql.rb#L7-L8] by passing parameters to the installer. I suggest writing a custom installation provider for software requiring a service account is not a reasonable ask for a typical user who is an experienced Windows admin and nascent Puppet practitioner.

There is a large and growing amount of Microsoft enterprise software (SQL Server, SCOM, SCCM, SCVMM) that recommends or requires the use of a domain service account, and there's not currently a good way to address it. Feature parity (and perhaps going a little further to support Domain Accounts) would be a good start, especially if this exec allows users to get the automation done while we determine if other features are needed. (For instance, passing a Microsoft Domain user credential to the package resource).

Finally, field experience indicates this is complicated further by Mandatory Access Controls.  These deny the ability of any service running as LocalSystem to interact with the wider world using domain credentials and there are no workarounds to disable them that don't break the integrity of the operating system",New Feature,PUP-8395,[],Exec Parity for Windows
"*Puppet Version:* 5.3.4
*Puppet Server Version:* 2018.1.0-rc8
*OS Name/Version:* various

{{/opt/puppetlabs/puppet/cache/locales/config.yaml}} often changes despite no code changes being made. It appears to be random.

The only changes are the names of the project and package, and that swaps between powershell and mongodb.

This has been going on for a while; I think it was present in Hoyt.

*Desired Behavior:*

No changes to locales.

*Actual Behavior:*

{code}
Info: Retrieving locales
Debug: Dynamically-bound server lookup failed, falling back to server setting
Debug: Dynamically-bound port lookup failed; falling back to masterport setting
Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: file_metadata supports formats: json pson yaml
Debug: Using cached connection for https://puppet.ops.puppetlabs.net:8140
Debug: Caching connection for https://puppet.ops.puppetlabs.net:8140
Debug: Using cached connection for https://puppet.ops.puppetlabs.net:8140
Debug: Caching connection for https://puppet.ops.puppetlabs.net:8140
Debug: Executing: 'diff -u /opt/puppetlabs/puppet/cache/locales/config.yaml /tmp/puppet-file20180124-8206-1t5hn79'
Notice: /File[/opt/puppetlabs/puppet/cache/locales/config.yaml]/content: 
--- /opt/puppetlabs/puppet/cache/locales/config.yaml	2018-01-24 23:18:17.000000000 -0800
+++ /tmp/puppet-file20180124-8206-1t5hn79	2018-01-24 23:24:12.000000000 -0800
@@ -4,11 +4,11 @@
 gettext:
   # This is used for the name of the .pot and .po files; they will be
   # called <project_name>.pot?
-  project_name: puppetlabs-mongodb
+  project_name: puppetlabs-powershell
   # This is used in comments in the .pot and .po files to indicate what
   # project the files belong to and should bea little more desctiptive than
   # <project_name>
-  package_name: puppetlabs-mongodb
+  package_name: puppetlabs-powershell
   # The locale that the default messages in the .pot file are in
   default_locale: en
   # The email used for sending bug reports.

Debug: Using cached connection for https://puppet.ops.puppetlabs.net:8140
Debug: Caching connection for https://puppet.ops.puppetlabs.net:8140
Notice: /File[/opt/puppetlabs/puppet/cache/locales/config.yaml]/content: content changed '{md5}de7cdcbf7623f11daca5fa8cd11dc546' to '{md5}9560ee58ab338acc8caea792e44df8c9'
Debug: /File[/opt/puppetlabs/puppet/cache/locales/config.yaml]: The container /opt/puppetlabs/puppet/cache/locales will propagate my refresh event
Debug: Finishing transaction 48072140
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Loading external facts from /opt/puppetlabs/puppet/cache/facts.d
Debug: Facter: loading external fact directories from config file
{code}",Bug,PUP-8394,[],cache/locales/config.yaml not stable across runs
"I am trying to see what the {{tree_each}} function actually produces, to see how I could use it for complex tree transformations.

I went with the simplest approach first:
{noformat}
# t1.pp

$hash = {
  foo => bar,
  baz => [
    quux,
    { whatsit => whosit }
  ]
}

$tree = $hash.tree_each

$tree_array = Array($tree)
notice(inline_template('<% require ""pp""; pp @tree_array %>'))
{noformat}
The result was less than helpful:
{noformat}
$ puppet apply t1.pp
Error: Evaluation Error: Error while evaluating a Function Call, super: no superclass method `to_a' for #<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x0000000314be98>
Did you mean?  to_s at /home/vagrant/t1.pp:13:15 on node localhost
{noformat}

Next, I tried something [~henrik.lindberg] suggested:
{noformat}
# t2.pp

$hash = {
  foo => bar,
  baz => [
    quux,
    { whatsit => whosit }
  ]
}

$tree = $hash.tree_each

$tree_array = *$tree
notice(inline_template('<% require ""pp""; pp @tree_array %>'))
{noformat}
This gave me:
{noformat}
$ puppet apply t2.pp
[#<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x000000043feea0
  @containers_t=
   #<Puppet::Pops::Types::PVariantType:0x00000003451598
    @types=
     [#<Puppet::Pops::Types::PArrayType:0x00000003211df0
       @element_type=#<Puppet::Pops::Types::PAnyType:0x00000003204b00>,
       @size_type=nil>,
      #<Puppet::Pops::Types::PHashType:0x00000003211850
       @key_type=#<Puppet::Pops::Types::PAnyType:0x00000003204b00>,
       @size_type=nil,
       @value_type=#<Puppet::Pops::Types::PAnyType:0x00000003204b00>>,
      #<Puppet::Pops::Types::PObjectType:0x00000002c15de8
       @annotations=nil,
       @attributes={},
       @checks=nil,
       @equality=nil,
       @equality_include_type=true,
       @functions={},
       @name=nil,
       @parent=nil>]>,
  @current_path=[],
  @element_t=nil,
  @include_refs=false,
  @indexer_stack=[],
  @recursed=false,
  @root={""foo""=>""bar"", ""baz""=>[""quux"", {""whatsit""=>""whosit""}]},
  @value_stack=[{""foo""=>""bar"", ""baz""=>[""quux"", {""whatsit""=>""whosit""}]}],
  @with_containers=true,
  @with_root=true,
  @with_values=true>]
Notice: Scope(Class[main]):
Notice: Compiled catalog for localhost
{noformat}
Again, not very useful.

I tried passing the results of the {{*}} operator to the {{Array}} conversion...
{noformat}
# t3.pp

$hash = {
  foo => bar,
  baz => [
    quux,
    { whatsit => whosit }
  ]
}

$tree = $hash.tree_each

$tree_array = Array(*$tree)
notice(inline_template('<% require ""pp""; pp @tree_array %>'))
{noformat}
and got the same as the first attempt:
{noformat}
$ puppet apply t3.pp
Error: Evaluation Error: Error while evaluating a Function Call, super: no superclass method `to_a' for #<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x00000004b52878>
Did you mean?  to_s at /home/vagrant/t3.pp:13:15 on node localhost
{noformat}

Finally, I used a {{map}} to convert it to itself:
{noformat}
# t4.pp

$hash = {
  foo => bar,
  baz => [
    quux,
    { whatsit => whosit }
  ]
}

$tree = $hash.tree_each

$tree_array = $tree.map |$idx,$val| { [ $idx, $val ] }
notice(inline_template('<% require ""pp""; pp @tree_array %>'))
{noformat}
and this gave something useful:
{noformat}
$ puppet apply t4.pp
[[0, [[], {""foo""=>""bar"", ""baz""=>[""quux"", {""whatsit""=>""whosit""}]}]],
 [1, [[""foo""], ""bar""]],
 [2, [[""baz""], [""quux"", {""whatsit""=>""whosit""}]]],
 [3, [[""baz"", 0], ""quux""]],
 [4, [[""baz"", 1], {""whatsit""=>""whosit""}]],
 [5, [[""baz"", 1, ""whatsit""], ""whosit""]]]
Notice: Scope(Class[main]):
Notice: Compiled catalog for localhost
{noformat}

[~henrik.lindberg] told me to submit a ticket, so here I am. :)",Bug,PUP-8393,[],Standard Array conversions do not work on return value from tree_each function
"The behavior described in PUP-8263 is present in 4.10.x. The relevant code changes were checked into the parent ticket PUP-8225. All of the buggy code from PUP-8225 is present in 4.10.x, but is masked by an additional issue in that code base. Most likely all code from PUP-8225 needs to be back ported together.
",Task,PUP-8392,[],Back Port PUP-8225 into 4.10.z
"(Initial planned release date: 2018-01-31)

",Task,PUP-8391,['release'],Communicate scope and timeline of next release (Puppet Platform 5.3.4)
"(Initial planned release date: 2018-01-31)

",Task,PUP-8390,['release'],Update Confluence and JIRA based on release (Puppet Platform 5.3.4)
"(Initial planned release date: 2018-01-31)

",Task,PUP-8389,['release'],Declare Ready to Ship (go/no-go) milestone (Puppet Platform 5.3.4)
"(Initial planned release date: 2018-01-31)

",Task,PUP-8388,['release'],Prepare release announcement (Puppet Platform 5.3.4)
"(Initial planned release date: 2018-01-31)

",Task,PUP-8387,['release'],Declare Stop Ship Line (code complete) milestone (Puppet Platform 5.3.4)
"(Initial planned release date: 2018-01-31)

",Task,PUP-8386,['release'],Prepare JIRA for release (Puppet Platform 5.3.4)
"    Puppet Platform 5.3.4 Release - 2018-01-31
",Epic,PUP-8385,[],"    Puppet Platform 5.3.4 Release - 2018-01-31
"
"*Puppet Version:5.3.3*
*Puppet Server Version:5.3.3*
*OS Name/Version: Centos 6.9*

While running the test cases using a puppet user I am facing below test case failure.
Failures details:

  1) Puppet::Transaction when filtering with tags should propagate events correctly from a tagged container when running with tags
     Failure/Error: expect(Puppet::FileSystem.exist?(file1)).to be_truthy

       expected: truthy value
            got: false
     # ./spec/integration/transaction_spec.rb:371:in `block (3 levels) in <top (required)>'

Finished in 3.16 seconds (files took 1.09 seconds to load)
24 examples, 1 failure

Failed examples:

rspec ./spec/integration/transaction_spec.rb:344 # Puppet::Transaction when filtering with tags should propagate events correctly from a tagged container when running with tags

The same test case passes on when  run with a puppet user on RHEL 7.x

Thanks in advance
",Bug,PUP-8384,[],Test case failure observed 
"*Puppet Version: 5.3.3*
*Puppet Server Version: PE 2017.3*
*OS Name/Version: Ubuntu 16.4*

'puppet agent -t' changed /opt/puppetlabs/puppet/cache/facts.d]/mode to 0777. This happens on nodes with no custom code yet.

Here is the command line output:

Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Notice: /File[/opt/puppetlabs/puppet/cache/facts.d]/mode: mode changed '0755' to '0777'
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for puppet.local
Info: Applying configuration version '1516773686'
Notice: Applied catalog in 11.56 seconds
",Bug,PUP-8383,[],/opt/puppetlabs/puppet/cache/facts.d]/mode: mode changed '0755' to '0777'
"1) Check that the version number in source for puppet is correct

  version for puppet should be 4.10.10

  * check {{lib/puppet/version.rb}} for the {{PUPPETVERSION}} variable
  * check .gemspec for {{version}} variable

",Task,PUP-8382,[],Bump puppet version to 4.10.10
"*Puppet Version:4.10.x

When modifying users and passing in `--warndays` (a feature introduced in https://github.com/puppetlabs/puppet/commit/31089218e84e898e4b2388bf1ed98e08bf892968), the useradd module does not correctly handle this flag. It is supposed to use either `usermod` or `chage` depending on which aspect it is modifying, but the regex set up to catch this misses the warn days scenario (https://github.com/puppetlabs/puppet/blob/4d96086ac88b34f3ed78d61a14e246016db22b17/lib/puppet/provider/nameservice/objectadd.rb#L16). Currently, it only catches and properly handles those flags that deal with password age.

*Desired Behavior: When specifying option `:password_warn_days`, use command defined for `:password' or `:localpassword`.


*Actual Behavior: When passing in `:password_warn_days`, command is set to `:modify` or `:localmodify`.",Bug,PUP-8381,[],modifycmd does not correctly catch and handle the `password_warn_days` option
"The Puppet parser appears to consider a plan with a parameter with a leading underscore as valid, such as
{code}
plan test::foo(String $_arg) { }
{code}

https://puppet.com/docs/puppet/5.3/lang_reserved.html#parameters notes them as invalid for classes and defined types. I would've expected plans to behave the same, and we have design assumptions around reserving leading underscore names for meta params to {{run_plan}}. So this plan (for example) would be unrunnable in Bolt.

----

This description reflected an incorrect understanding of parameter naming. Leading underscores are only inaccessible from the global scope.",Bug,PUP-8380,[],Puppet considers plan with invalid parameter name as valid
"The translations string for this japanese string is wrong, it uses the wrong variable name:

{code}
#: ../lib/puppet/error.rb:68 ../lib/puppet/parser/compiler.rb:39
msgid ""%{message} on node %{node}""
msgstr ""ノード%{node}の%{msg}""
{code}

so you end up with untranslated variable names:
{code}
        Info: 設定された環境'puppet_agent_l4rs2vm1'を使用しています。
        Info: pluginfactsを取得しています。
        Info: pluginを取得しています。
        Info: localesを取得しています。
        Info: factsを読み込んでいます。
        Error: Facter: error while resolving custom fact ""i18ndemo_fact"": eputnam-i18ndemo fact: これはeputnam-i18ndemoからのカスタムファクトからのレイズです
        Error: リモートサーバからカタログを取得できませんでした: SERVERのエラー500 : サーバエラー: ノード%{node}の%{msg}
        Warning: 失敗したカタログではキャッシュを使用できません。
        Error: カタログを取得できませんでした; 実行をスキップしています。
{code}",Bug,PUP-8379,[],translation string uses wrong variable names
"*Puppet 5.4.0:*
*N/A:*
*Redhat7- FIPS mode:*

FIPS mode prohibits use of certain algorithms e.g. MD5 (as applicable to puppet currently) and any attempt to use them results in abrupt program termination or abort. While customers using Puppet agents on FIPS mode platforms should be aware of such limitations there might be un-intentional usages which will result in user un-friendly errors. 
We need to intercept any such prohibited usages at runtime and provide graceful error messages. 
Create a manifest with a file resource while setting its checksum attribute to md5 and attempt applying it on agent in fips mode. 

Expected: Provide a graceful error while disallowing the operation.

Actual: Error ""md5_dgst.c(82): OpenSSL internal error, assertion failed: Digest MD5 forbidden in FIPS mode!
Aborted""

",Task,PUP-8378,[],Intercept use of any prohibited algorithms/operations in FIPS mode to provide graceful error messages
"The test tests/i18n/modules/puppet_apply_unsupported_lang.rb is intended to verify that we can get all warning and error messages when we ask for an unsupported language on the system. In this case even if you don't ask for a different language then the default, we don't see the 'raise' message we're expecting from the custom fact:

{code}
      pfuqyhk1tw6udul.delivery.puppetlabs.net (solaris10-64-1) 08:49:51$ puppet apply -e ""class { 'i18ndemo': filename => '/tmp/provider.LpaqLb' }""
        Warning: This method is deprecated, please use the stdlib validate_legacy function,
                            with Stdlib::Compat::Absolute_Path. There is further documentation for validate_legacy function in the README. at [""/etc/puppetlabs/code/environments/production/modules/i18ndemo/manifests/init.pp"", 15]:
           (at /etc/puppetlabs/code/environments/production/modules/stdlib/lib/puppet/functions/deprecation.rb:28:in `deprecation')
        Warning: Scope(Class[I18ndemo]): Creating an i18ndemo file
        Notice: Compiled catalog for pfuqyhk1tw6udul.delivery.puppetlabs.net in environment production in 0.06 seconds
        Warning: /Stage[main]/I18ndemo/File[/tmp/provider.LpaqLb]: Ensure set to :present but file type is directory so no content will be synced
        Notice: Applied catalog in 0.02 seconds
{code}

The problem is that module is getting the openssl version available (which there isn't one in the path on the solaris 10 boxes). Since its its not set we don't raise.

{code}
opensslv = Facter::Util::Resolution.exec('openssl version')
    raise _('i18ndemo_fact: this is a raise from a custom fact from eputnam-i18ndemo') if opensslv
{code}

We should change the module to always raise an error and re-enable the test on solaris10
",Bug,PUP-8377,[],solaris 10 doesn't show raise from custom fact because module expects openssl in the path
"*Puppet Version:* 5.3.4

Please add a setting that causes the agent to switch to a specific environment, e.g. production, when the agent-specified environment does not exist.

Our workflow:

# Deploy a feature branch, e.g. change_ntp_server
# Switch a node over to the feature branch for development, e.g. {{sudo puppet config set --section agent environment change_ntp_server}}
# Run puppet, update branch, run puppet…
# Merge the feature branch into production
# Delete the feature branch
# Our custom puppet wrapper detects that the change_ntp_server environment no longer exists, and switches the environment back to production

I don't particularly care if it switches the environment for just that run, or changes it in the configuration file.

We are currently using a python script to wrap puppet, but I've ported it to Go and we'll deploy that soon: [puppetlabs-operations/puppet-cron|https://github.com/puppetlabs-operations/puppet-cron].",New Feature,PUP-8376,[],Revert to production when agent-specified environment doesn't exist
"Previous to the release of Amazon Linux v2, facter reported the version of Amazon Linux as a date-based string, e.g ""2017.09"". In Amazon Linux v2, this has changed to ""2.0"". 

The code changes previously made in Puppet's service provider code and acceptance tests have  incorrectly assumed that Amazon Linux v2 returns a version of ""2017.12"" and will need to be updated to work with ""2.0"" instead.",Bug,PUP-8375,[],"Amazon Linux v2 detection is broken (os.version is 2.0, not 2017.12)"
"When we execute commands to create, set, and modify something on the system, we should be maintaining a consistent environment. Currently, when we create that thing, we're passing in a custom environment (as defined in {{lib/puppet/provider/nameservice.rb}})

{code}
167   def create
168     if exists?
169       info _(""already exists"")
170       # The object already exists
171       return nil
172     end
173
174     begin
175       execute(self.addcmd, {:failonfail => true, :combine => true, :custom_environment => @custom_environment})
176       if feature?(:manages_password_age) && (cmd = passcmd)
177         execute(cmd)
178       end
179     rescue Puppet::ExecutionFailure => detail
180       raise Puppet::Error, _(""Could not create %{resource} %{name}: %{detail}"") % { resource: @resource.class.name, name: @resource.name, detail: detail }, detail.backtrace
181     end
182   end
{code}

but not when we set or delete with the same command
{code}
184   def delete
185     unless exists?
186       info _(""already absent"")
187       # the object already doesn't exist
188       return nil
189     end
190
191     begin
192       execute(self.deletecmd)
193     rescue Puppet::ExecutionFailure => detail
194       raise Puppet::Error, _(""Could not delete %{resource} %{name}: %{detail}"") % { resource: @resource.class.name, name: @resource.name, detail: detail }, detail.backtrace
195     end
196   end
.
.
.
299   def set(param, value)
300     self.class.validate(param, value)
301     cmd = modifycmd(param, munge(param, value))
302     raise Puppet::DevError, _(""Nameservice command must be an array"") unless cmd.is_a?(Array)
303     begin
304       execute(cmd)
305     rescue Puppet::ExecutionFailure => detail
306       raise Puppet::Error, _(""Could not set %{param} on %{resource}[%{name}]: %{detail}"") % { param: param, resource: @resource.class.name, name: @resource.name, detail: detail },     detail.backtrace
307     end
308   end
{code}

All of these execution environments should be consistent, if that is the desired behavior defined in the provider.",Bug,PUP-8374,[],NameService inconsistent with setting the environment in which commands are executed
"In order to facilitate use of the CLI {{puppet lookup}} by non-root users who want to perform a lookup in terms of a particular node without having to have a fully-trusted and PuppetDB-whitelisted certificate, it would be great if {{lookup}} would look for and use any PE RBAC tokens to obtain access when getting the facts from PuppetDB.
",Improvement,PUP-8373,[],Lookup CLI should use RBAC token if available for PuppetDB
"*Puppet Version:* Seen on Puppet 4.9.4 but should affect others.
*Puppet Server Version:* 2.7.2
*OS Name/Version:* CentOS 7.4.1708

Providers are being loaded by Puppet servers, resulting on suitability code to be executed (not in a lazy way) when this happens. An example of this is aptrpm or rpm providers that log in the masters the output of rpm -ql rpm and rpm --version respectively. The code executed can be found here:
* aptrpm.rb: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/aptrpm.rb#L15
* rpm.rb: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/rpm.rb#L54

To reproduce the problem it's only needed to restart a server and run puppet against it. The output of the run on the server should show something similar to:
{noformat}
2018-01-19 10:57:17,193 WARN  [qtp1025870989-67] [c.p.p.ShellUtils] Executed an external process which logged to STDERR: RPM version 4.11.3

2018-01-19 10:57:17,312 WARN  [qtp1025870989-67] [c.p.p.ShellUtils] Executed an external process which logged to STDERR: /bin/rpm
/etc/rpm
/usr/bin/rpm2cpio
/usr/bin/rpmdb
/usr/bin/rpmkeys
/usr/bin/rpmquery
/usr/bin/rpmverify
/usr/lib/rpm
/usr/lib/rpm/macros
/usr/lib/rpm/macros.d
/usr/lib/rpm/platform
/usr/lib/rpm/platform/aarch64-linux
/usr/lib/rpm/platform/aarch64-linux/macros
/usr/lib/rpm/platform/alpha-linux
/usr/lib/rpm/platform/alpha-linux/macros
/usr/lib/rpm/platform/alphaev5-linux
/usr/lib/rpm/platform/alphaev5-linux/macros
/usr/lib/rpm/platform/alphaev56-linux
/usr/lib/rpm/platform/alphaev56-linux/macros
{noformat}

*Desired Behavior:* The previous output shouldn't appear on the server logs as the code shouldn't be executed on the server side.

*Actual Behavior:* The output appears as the code is executed when the providers are loaded for the first time.
",Bug,PUP-8372,[],Providers being loaded on masters
"*Puppet Version:* 5.3.3
*Puppet Server Version:* 5.1.4
*OS Name/Version:* CentOS 7

Setting ""purge"" true in the Yumrepo resource causes unmanaged repositories do disappear. 
I put the following into one of my modules
 resources { 'yumrepo':
        purge => true,
        noop  => false,
    }


Then ran ""sudo /opt/puppetlabs/bin/puppet agent -t --noop""

*Desired Behavior:*
It should have printed a notification for each repository it wanted to remove, but not actually touched the files (due to the noop).


*Actual Behavior:*
All of the unmanaged repositories were destroyed (turned into empty files) as if the --noop had been omitted.




Please take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.

Examples:
Run puppet agent with --test --trace --debug

Relevant sections of {{/var/log/puppetlabs/puppetserver/puppetserver.log}} or any applicable logs from the same directory.

For more detailed information turn up the server logs by upping the log level in the server's logback.xml

Relevant sections of configurations files (puppet.conf, hiera.conf, Server's conf.d, defaults/sysconfig)

For memory issues with server heap dumps are also helpful.
",Bug,PUP-8371,[],YumRepo purge does not respect --noop
"Puppet runs generate a misleading error when hiera-eyaml is configured but not installed.

When hiera-eyaml is configured via {{lookup_key}} in hiera.yaml ...

{code}
---
version: 5
hierarchy:
  - name: ""Secret""
    lookup_key: eyaml_lookup_key
    paths:
      - ""common.eyaml""
    options:
      pkcs7_private_key: /etc/puppetlabs/puppet/keys/private_key.pkcs7.pem
      pkcs7_public_key:  /etc/puppetlabs/puppet/keys/public_key.pkcs7.pem
{code}

... but the hiera-eyaml gem is not installed in puppetserver (and/or the puppetserver service is not restarted after the install) the resulting error is inaccurate, as hiera-eyaml is does not need to be installed and does not execute on agents:

{code}
[root@pe-201731-agent ~]# puppet agent -t --server=pe-201731-agent-compile.puppetdebug.vlan
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Lookup using eyaml lookup_key function is only supported when the hiera_eyaml library is present on node pe-201731-agent.puppetdebug.vlan
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{code}

It appears that {{node <certname>}} is being appended to this error:

https://github.com/puppetlabs/puppet/blob/master/lib/puppet/functions/eyaml_lookup_key.rb#L9",Bug,PUP-8370,[],puppet runs generate a misleading error when hiera-eyaml is configured but not installed
"The test 'test/direct_puppet/supports_utf8.rb' is always skipped

{code}
  agents.each do |agent|
    if agent.platform =~ /^(eos-4-i386|cumulus-2\.5|osx|sles-10|)/
      # skip_test doesn't work in with_puppet_running_on blocks (tableflip)
      #   so we can't easily use expect_failure here
      skip_test 'PUP-6217'
    end
{code}

The regex ends with ""|"" so the empty entry will match anything so the test is being skipped on all platforms.",Task,PUP-8369,[],test direct_puppet/supports_utf8.rb is always skipped
"On a Windows Japanese box if you run 'puppet agent -t  --server no_such_host' the agent prints errors about incompatible encodings:

{code}
$ puppet.bat agent -t --server no_such_host
Warning: ノード定義を取得できませんが、agent実行を続行します:
Warning: Failed to open TCP connection to no_such_host:8140 (getaddrinfo: そのようなホストは不明です。 )
Info: pluginfactsを取得しています。
Warning: detail.class: SocketError
Warning: detail.to_s.encoding: ASCII-8BIT
Error: カタログ適用に失敗しました: incompatible character encodings: UTF-8 and ASCII-8BIT
Error: Puppet設定クライアントを実行できません: incompatible character encodings: UTF-8 and ASCII-8BIT
{code}


The underlying issue appears to be when an error has be rescued, and as the error string is ASCII-8BIT and the formatting of the string blows up:

{code}
  def eval_generate(resource)
    return false unless resource.respond_to?(:eval_generate)
    raise Puppet::DevError, _(""Depthfirst resources are not supported by eval_generate"") if resource.depthfirst?
    begin
      generated = replace_duplicates_with_catalog_resources(resource.eval_generate)
      return false if generated.empty?
    rescue => detail
      @resources_failed_to_generate = true
      #TRANSLATORS eval_generate is a method name and should be left untranslated
      resource.log_exception(detail, _(""Failed to generate additional resources using 'eval_generate': %{detail}"") % { detail: detail })
{code}

If you print out the class and string encoding value:
{code}
Warning: detail.class: SocketError
Warning: detail.to_s: Failed to open TCP connection to no_such_host:8140 (getaddrinfo: そのようなホストは不明です。 )
Warning: detail.to_s.encoding: ASCII-8BIT
{code}

Here is the stack trace:
{code}
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.1/lib/fast_gettext/vendor/string.rb:70:in `%'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.1/lib/fast_gettext/vendor/string.rb:70:in `%'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/additional_resource_generator.rb:64:in `rescue in eval_generate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/additional_resource_generator.rb:55:in `eval_generate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:112:in `block in evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:119:in `traverse'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:169:in `evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:231:in `block in apply'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:160:in `with_destination'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/report.rb:144:in `as_logging_destination'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:230:in `apply'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer/downloader.rb:13:in `evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer/plugin_handler.rb:19:in `download_plugins'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:450:in `download_plugins'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:118:in `get_facts'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:312:in `run_internal'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:225:in `block in run'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet.rb:260:in `override'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:199:in `run'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/agent.rb:59:in `block (5 levels) in run'
{code}",Bug,PUP-8368,[],Non-English windows puppet agent run fails with 'incompatible character encodings' when run against non-existent server
"The following puppet acceptance tests failed on solaris-11-sparc for the 5.3.x and master agent branches - it's unclear whether this affects 1.10.x, which is currently red because of other problems.

- tests/resource/zone.should_be_created_and_removed.rb
- tests/resource/zone.should_be_idempotent.rb
- tests/resource/zone.statemachine.rb
- tests/resource/zone.stepstates.rb

The log for master is here: https://jenkins-master-prod-1.delivery.puppetlabs.net/job/platform_puppet-agent_puppet-agent-integration-suite_daily-master/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=solaris11-SPARCa/67/console

And for 5.3.x: https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/Public%20Suites/view/5.3.x/view/Suite/job/platform_puppet-agent_puppet-agent-integration-suite_daily-5.3.x/74/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=solaris11-SPARCa/console

I tested a simple zone creation manifest on a machine with a known-passing agent installed, and it produced the same error, so it looks like this could be an environmental problem - below is some output from the zone creation test that suggests this is happening because of a download failure. I'll keep looking into this.

{code}
Error: Could not install zone: Execution of '/usr/sbin/zoneadm -z testzone install' returned 1: The following ZFS file system(s) have been created:
    rpool/tstzones
    rpool/tstzones/mnt
Progress being logged to /var/log/zones/zoneadm.20180117T195130Z.testzone.install
       Image: Preparing at /tstzones/mnt/root.

 Install Log: /system/volatile/install.1744/install_log
 AI Manifest: /tmp/manifest.xml.2TaGyd
  SC Profile: /usr/share/auto_install/sc_profiles/enable_sci.xml
    Zonename: testzone
Installation: Starting ...

        Creating IPS image
         Startup: Retrieving catalog 'solaris' ... Done
         Startup: Retrieving catalog 'puppetlabs.com' ... Done
         Startup: Caching catalogs ... Done
         Startup: Finished processing linked images.
         Startup: Refreshing catalog 'solaris' ... Done
         Startup: Refreshing catalog 'puppetlabs.com' ... Done
        Installing packages from:
            solaris
                origin:  http://pkg.oracle.com/solaris/release/
            puppetlabs.com
         Startup: Refreshing catalog 'solaris' ... Done
         Startup: Refreshing catalog 'puppetlabs.com' ... Done
        Planning: Solver setup ... Done
        Planning: Running solver ... Done
        Planning: Finding local manifests ... Done
        Planning: Fetching manifests:   0/277  0% complete
        Planning: Fetching manifests: 277/277  100% complete
        Planning: Package planning ... Done
        Planning: Merging actions ... Done
        Planning: Checking for conflicting actions ... Done
        Planning: Consolidating action changes ... Done
        Planning: Evaluating mediators ... Done
        Planning: Planning completed in 91.83 seconds
        Download:     0/47919 items    0.0/353.1MB  0% complete
        Download:   397/47919 items    4.5/353.1MB  1% complete (933k/s)
        Download:  1234/47919 items    9.3/353.1MB  2% complete (928k/s)
        Download:  1830/47919 items   17.2/353.1MB  4% complete (1.3M/s)
        Download:  2773/47919 items   23.4/353.1MB  6% complete (1.4M/s)
        Download:  3555/47919 items   31.3/353.1MB  8% complete (1.4M/s)
        Download:  4348/47919 items   36.1/353.1MB  10% complete (1.3M/s)
        Download:  5071/47919 items   41.9/353.1MB  11% complete (1.0M/s)
        Download:  5752/47919 items   47.3/353.1MB  13% complete (1.1M/s)
        Download:  6158/47919 items   57.4/353.1MB  16% complete (1.6M/s)
        Download:  6421/47919 items   62.3/353.1MB  17% complete (1.5M/s)
        Download:  6421/47919 items   64.9/353.1MB  18% complete (870k/s)
        Download:  6421/47919 items   67.7/353.1MB  19% complete (559k/s)
        Download:  6421/47919 items   71.0/353.1MB  20% complete (601k/s)
        Download:  6421/47919 items   74.2/353.1MB  21% complete (671k/s)
        Download:  6421/47919 items   75.9/353.1MB  21% complete (609k/s)
        Download:  6421/47919 items   78.4/353.1MB  22% complete (426k/s)
        Download:  6436/47919 items   80.4/353.1MB  22% complete (465k/s)
        Download:  6845/47919 items   90.1/353.1MB  25% complete (1.2M/s)
        Download:  7647/47919 items   97.6/353.1MB  27% complete (1.7M/s)
        Download:  8122/47919 items  103.3/353.1MB  29% complete (1.3M/s)
        Download:  9116/47919 items  105.1/353.1MB  29% complete (778k/s)
        Download: 10996/47919 items  106.6/353.1MB  30% complete (340k/s)
        Download: 11529/47919 items  114.1/353.1MB  32% complete (919k/s)
        Download: 12024/47919 items  120.3/353.1MB  34% complete (1.3M/s)
        Download: 12845/47919 items  124.5/353.1MB  35% complete (919k/s)
        Download: 13792/47919 items  131.3/353.1MB  37% complete (935k/s)
        Download: 14384/47919 items  139.0/353.1MB  39% complete (1.4M/s)
        Download: 14737/47919 items  145.6/353.1MB  41% complete (1.4M/s)
        Download: 15311/47919 items  153.5/353.1MB  43% complete (1.4M/s)
        Download: 16240/47919 items  160.1/353.1MB  45% complete (1.5M/s)
        Download: 17199/47919 items  166.1/353.1MB  47% complete (1.3M/s)
        Download: 17895/47919 items  170.7/353.1MB  48% complete (1.1M/s)
        Download: 18783/47919 items  176.1/353.1MB  49% complete (1.0M/s)
        Download: 19694/47919 items  182.2/353.1MB  51% complete (1.2M/s)
        Download: 20886/47919 items  190.5/353.1MB  53% complete (1.3M/s)
        Error occurred during execution of 'generated-transfer-1744-1' checkpoint.
        Failed Checkpoints:

        Checkpoint execution error:

                1: Framework error: code: 18 reason: transfer closed with 337204 bytes remaining to read
                URL: 'http://pkg.oracle.com/solaris/release/solaris/file/1/ecc539554841e7df0db0d16030163f3287715f49'
                2: Framework error: code: 18 reason: transfer closed with 336829 bytes remaining to read
                URL: 'http://pkg.oracle.com/solaris/release/solaris/file/1/ecc539554841e7df0db0d16030163f3287715f49' (happened 3 times)

Installation: Failed.  See install log at /system/volatile/install.1744/install_log
ERROR: auto-install failed.
Error: /Stage[main]/Main/Zone[testzone]/ensure: change from 'absent' to 'running' failed: Could not install zone: Execution of '/usr/sbin/zoneadm -z testzone install' returned 1: The following ZFS file system(s) have been created:
    rpool/tstzones
    rpool/tstzones/mnt
Progress being logged to /var/log/zones/zoneadm.20180117T195130Z.testzone.install
       Image: Preparing at /tstzones/mnt/root.
{code}",CI Blocker,PUP-8365,['transient'],Zone creation acceptance tests fail on Solaris 11 SPARC after failed package downloads
"Currently `puppet device` does not support the ability apply manifests/catalogs without a master, similar to using `puppet apply`.  

After reviewing the intricacies of adding device support directly into `puppet apply` it has been decided to add `--apply` functionality to `puppet device`",New Feature,PUP-8364,[],puppet device apply mode
"To ensure variables are refreshed each catalog compilation we use the facter's system_uptime fact (see [variables_refreshed_each_compilation test|https://github.com/puppetlabs/puppet/blob/a156ecd7c4b53b371e7a8f13923076955bf7a429/acceptance/tests/environment/variables_refreshed_each_compilation.rb#L33]). Unfortunately there's an issue with facter that may cause that fact not to be present on Windows systems (See FACT-1504). We should update this test to use a different, constantly changing variable - at least on windows.",CI Blocker,PUP-8363,[],Do not use system_uptime fact as a source of randomness in acceptance test
"*This is the placeholder for the ticket to support editing lists in a section (cloned from original ticket)*

The puppet config face has facility for creating settings, but not removing or updating lists of settings.

From the PR:

{code}
puppet config add [name] [value] will add to a comma separated list.
  `puppet config add reports store` -- (adds store to the reports list)
puppet config del [name] [value] will remove from a comma separated list
  `puppet config del reports store`  -- (deletes store from the list)
puppet config del [name] will remove a setting from puppet.conf
  `puppet config del reporturl` -- (removes reporturl from puppet.conf)
{code}",Improvement,PUP-8362,[],Add setting list add/remove functions to puppet config.
"Our man pages must be generated manually and are often out of sync when code changes are made to applications or puppet settings (defaults.rb). We should create a CI job in the per-component pipelines, similar to how we do localization.

1. We need to add {{ronn}} as a gem dependency, only when running from bundler, not when installing puppet as a gem. Similar to what we do for {{gettext-setup}}.
2. We need to run {{bundle exec rake gen_manpages}} to update the man pages
3. If that succeeds, run {{git add man -m ""...""}}
4. Ensure the job that does automatic merge ups always resolves the conflicts as {{ours}}.

/cc [~maggie], [~branan], [~jorie], [~garrett.guillotte]",Task,PUP-8361,[],Create a CI job to generate manpages
"Puppet Version: 2016.4.x 
Puppet Server Version: 2016.4.6
OS Name/Version: CentOS

I am working in an environment where users / groups are managed remotely via Samba. I'm trying to use the existing user documentation to manage some users locally but running into issues in understanding the documentation. The libuser ""feature"" seems relevant to what I want to accomplish but the documentation on this is extremely sparse on this page: https://puppet.com/docs/puppet/5.3/types/user.html#user-provider-features

Desired Behavior:

Improve existing documentation re: ""libuser"" and any associated requirements / dependencies. A few additional sentences explaining how the library can be used, any limitations, and on which particular Operating Systems it's supported would be extremely useful.

My understanding is that the current documentation is generated from source code and the associated in-line documentation will need to be updated in order to improve the documentation on the above page. ",Improvement,PUP-8360,[],Improve documentation of forcelocal and libuser on user resource documentation page
"Migrated from PUP-3020:

It should be possible to append a value to a list-type of setting. It should handle the case where the setting is not defined and is already defined with possibly an empty value.
It should be possible to remove a value from a list-type of setting. It should handle cases where the setting has more than one value, has only one value, or the value doesn't exist. Removing the last value should not remove the setting.

The delimiter for multiple values should depend on the setting type. For example, we use comma for report processors, but File::PATH_SEPARATOR for path settings.

Propose syntax like the following:

{noformat}
puppet config add <setting> <value> [--section <section>] will add to a list.
  `puppet config add reports store` -- (adds store to the reports list)
puppet config delete <setting> [value] [--section <section>] will remove from a list
  `puppet config delete reports store`  -- (deletes store from the list)
{noformat}

Some unanswered questions:

* Should the add/delete actions be specific to multivalued settings, e.g. delete will also be used to delete the single valued setting.
* Do we always append the value?
* Do we allow duplicate values?",Bug,PUP-8359,[],Provide actions to manage multi-valued attributes with puppet config
"*Puppet Version:* 1.10.0
*Puppet Server Version:* 2.7.2
*OS Name/Version:* CentOS 7.4

*Desired Behavior:* Masterful and Masterless should behave identically


*Actual Behavior:* Masterful breaks(doesn't identify Array during String.new), and Masterless is correct

Examples:
Prepared an EPP template for testing and found a difference between Masterful and Masterless results.
{code:puppet}
# testmodule/manifests/init.pp
  class testmodule {
    file { '/tmp/test.conf':
      ensure  => file,
      content => epp('testmodule/test.conf.epp')
    }
  }
# end of testmodule/manifests/init.pp
{code}

{code:puppet}
# testmodule/templates/test.conf.epp
  <%
     $formats = {
       Array => {format => '%(a', string_formats => { Integer => '%#x' } },
     }
     $str = String([1,2,3], $formats)
  -%>
  <%= $str %>
# end of testmodule/templates/test.conf.epp
{code}

When I apply testmodule to the node and run
(Masteful)
puppet agent -t
>>> [1, 2, 3]

(Masterless)
puppet apply -e 'include testmodule'
>>> (0x1, 0x2, 0x3)


I'm not sure if this affects Puppetserver in the new 5.x or not, I'll see if I can get around to testing that.",Bug,PUP-8358,[],String.new with custom Array format does not work
"Currently, puppet uses basic substring matching to determine which files are associated with a given task. That causes task files to be incorrectly associated with tasks in the case where the name of one task is a prefix of another task. For example:

{code}
$ ls tasks
foo.sh
foo.json
foobar.sh
foobar.json
{code}

In this case, all four files will match for task ""foo"", which will cause an error when trying to load that task (because a task is only allowed one executable file).

Puppet should ensure that it matches only at the file extension boundary, so {{foo.sh}} and {{foo.json}} are the only files associated with task ""foo"".",Bug,PUP-8357,[],Listing tasks incorrectly maps files to task names
"*Puppet Version: master branch (going into 5.4.0 release)
*Puppet Server Version:5.1.x (?)*
*OS Name/Version: N/A*

PUP-8141 adjusts use of md5 based on whether fips mode is enabled or not. Some of these changes in Puppet settings. FIPS mode detection was done using facter. However since Puppet is also used by Puppet Server and it does not have ability to load facter due to some missing dependencies and its use of an older version of facter (which do not have support for FIPS fact). It be noted that this is not an issue in production but on dev systems when running puppet server from sources. 

This ticket is to replace the use of facter to detect FIPS mode with a local method, which will duplicate the functionality in facter, to do the same. 
Temporarily a workaround was created in puppetserver per this PR: https://github.com/puppetlabs/puppetserver/pull/1597

",Task,PUP-8356,[],Replace use of facter for detecting fips mode with a local method 
"Good morning,

I've looked your service providers for both SysVinit and Systemd (Debian). In your implementation, you make use of *invoke-rc.d* command to know whether or not a service is enabled:

# https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/service/debian.rb#L41
# https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/service/systemd.rb#L104

*Problem:* If the *policyrcd-script-zg2* package is installed, you will always get *104*, even for unknown services...

*Howto reproduce*

*1.* Behavior without the *policyrcd-script-zg2* package installed:
{code:bash}
root@stretch:~# update-rc.d apache2 defaults
root@stretch:~# update-rc.d apache2 disable
insserv: warning: current start runlevel(s) (empty) of script `apache2' overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `apache2' overrides LSB defaults (0 1 6).
root@stretch:~# invoke-rc.d --quiet --query apache2 start
root@stretch:~# echo $?
101
{code}
That is the expected behavior.

*2.* Behavior with the *policyrcd-script-zg2* package installed:
{code:bash}
root@stretch:~# update-rc.d apache2 defaults
root@stretch:~# update-rc.d apache2 disable
insserv: warning: current start runlevel(s) (empty) of script `apache2' overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `apache2' overrides LSB defaults (0 1 6).
root@stretch:~# invoke-rc.d --quiet --query apache2 start
root@stretch:~# echo $?
104
{code}
With dummy (inexistent) package:
{code:bash}
root@stretch:~# invoke-rc.d --quiet --query dummy start
root@stretch:~# echo $?
104
{code}
From my point of view, you should just mimic Debian behavior as done in the systemd in the Debian /lib/systemd/systemd-sysv-install script:
{code:bash}
...
is-enabled)
        # exit with 0 if $NAME is enabled, non-zero if it is disabled
        ls $ROOT/etc/rc[S5].d/S??$NAME >/dev/null 2>/dev/null
        ;;
    *)
...
{code}",Bug,PUP-8355,"['debian', 'linux', 'service', 'systemd', 'triaged', 'type_and_provider']",Debian - SysVinit/Systemd service providers - Making use of the invoke-rc.d command to know whether or not a service is enabled can lead to unexpected results
"In exploring the issue described in PUP-8225, it was discovered that some of the node termini are not calling fact_merge()

*Desired Behavior:*
* Facts will be merged into a node, resulting in the ability to reference the facts in a manifest via $facts[<fact_name>]

*Actual Behavior:*
* Most likely, facts are not accessible in some cases, depending on the node terminus used
",Bug,PUP-8353,[],Investigate: Some of the node termini are not calling fact_merge (facts may not be accessible through a manifest when using these termini)
"*Puppet Version:* 5.3.x
*Ruby Version:* 2.4.3

Ruby 2.4.3 contains a backported fix to webrick. See https://github.com/ruby/ruby/commit/2e728d51e70ed3756ad760c687a08b8487b0112f 
 and https://github.com/ruby/ruby/compare/v2_4_2...v2_4_3#diff-5396c7bc1e5154a82bf825e6bf470f80 which breaks puppet master (webrick).

When an agent connects, the SSL handshake succeeds, but the connection fails as soon as the agent sends data. The puppet webrick log shows:

{noformat}
[2018-01-12 13:46:06] ERROR OpenSSL::SSL::SSLError: SSL_accept returned=1 errno=0 state=unknown state: unexpected record
	/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/webrick.rb:32:in `accept'
	/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/webrick.rb:32:in `block (2 levels) in listen'
{noformat}

While the agent reports:

{noformat}
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: SSL_read: decryption failed or bad record mac
{noformat}

If you revert ruby's /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/webrick.rb back to v2.4.2, then it works ok.",Bug,PUP-8352,[],Puppet's webrick master fails on Ruby 2.4.3
"Starting in Puppet 5, we now unset LD_LIBRARY_PATH via a wrapper script around puppet and facter.  Unfortunately, this causes problems when customers have the SCL version of pip installed on the system, as the custom LD_LIBRARY_PATH is required.

Repro:

1.  Install a base 2017.3.2 system
2.  Set up the SCL repo from CentOS extras: {{yum install centos-release-scl}}
3.  Install the SCL version of python27-pip: {{yum install python27-python-pip}}
4.  Enable the SCL version of python27:  {{source /opt/rh/python27/enable}}

At that point, numerous related problems surface:

Facter will fail on pe_postgresql_info: 

{code:bash}
# /opt/puppetlabs/bin/facter -p pe_postgresql_info |grep server_version
2018-01-12 09:13:58.272017 ERROR puppetlabs.facter - error while resolving custom fact ""pe_postgresql_info"": undefined method `[]' for nil:NilClass
{code}

The self.instances for the package provider will fail:

{code:bash}
# puppet resource package --trace
Error: Could not run: undefined method `[]' for nil:NilClass
{code}

Adding debug to the pip provider shows the error:

{code:bash}
# /opt/puppetlabs/bin/facter -p pe_postgresql_info --trace
/opt/rh/python27/root/usr/bin/python2: error while loading shared libraries: libpython2.7.so.1.0: cannot open shared object file: No such file or directory
2018-01-12 09:56:16.158237 ERROR puppetlabs.facter - error while resolving custom fact ""pe_postgresql_info"": undefined method `[]' for nil:NilClass
backtrace:
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:74:in `block (2 levels) in pip_version'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:72:in `each'
{code}

This can be worked around by commenting out the unset of LD_LIBRARY_PATH in the wrapper:

{code:bash}
# sed -ie 's/unset LD_LIBRARY_PATH/#unset LD_LIBRARY_PATH/' /opt/puppetlabs/puppet/bin/wrapper.sh
{code}",Bug,PUP-8351,[],PA-437 fix causes pip provider failures when SCL version is installed
"When using numeric formats such as {{%d}}, {{%o}}, {{%g}}, etc., puppet's {{sprintf()}} function will accept string values and automatically parse them into a number prior to formatting. The {{String.new()}} however, does not accept such combinations. This is an undesired inconsistency.

Example.
This works OK.
{code}
puppet apply -e 'notice(sprintf(""%o"", ""23""))'
Notice: Scope(Class[main]): 27
{code}
This doesn't
{code}
puppet apply -e 'notice(String(""23"", ""%o""))'
Error: Evaluation Error: Error while evaluating a Function Call, Illegal format 'o' specified for value of String type - expected one of the characters 'cCudspt' (line: 1, column: 8)
{code}
",Improvement,PUP-8350,[],Make StringConverter's numeric format specification accept and cast values of type String
"Investigate if we can introduce a warning when the provider is default rather than explicitly given.

Scheduled_task type and provider has been moved into its own module.

The Puppet project should introduce deprecation warnings indicating it will be removed in Puppet 6.",Task,PUP-8349,[],SPIKE scheduled_task : should we deprecate scheduled_task resource?
"We need to grep the puppet code base and find more of the locations that we report the file and line location information for an error and use the Puppet::Util::Errors.error_location() method to create the string so we are consistent.

For example:
{code}
16:03 $ grep -nr 'at line' lib
lib/puppet/settings/config_file.rb:86:        raise(Puppet::Error, _(""Illegal section '%{name}' in config file %{file} at line %{line}. The only valid puppet.conf sections are: [%{allowed_sections}]. Please use the directory environments feature to specify environments. (See https://docs.puppet.com/puppet/latest/reference/environments.html)"") % { name: section.name, file: file, line: section.line_number, allowed_sections: allowed_section_names.join("", "") })
lib/puppet/pops/issues.rb:779:    fl ? _(""%{msg}. First defined at line %{line}"") % { msg: msg, line: fl } : msg
lib/puppet/pops/issues.rb:789:    fl ? _(""%{msg}. First defined at line %{line}"") % { msg: msg, line: fl } : msg
lib/puppet/util/network_device/config.rb:55:            raise Puppet::Error, _(""Duplicate device found at line %{count}, already found at %{line}"") % { count: count, line: device.line } if devices.include?(name)
lib/puppet/util/network_device/config.rb:94:      raise Puppet::Error, _(""Invalid argument '%{var}' at line %{count}"") % { var: var, count: count }
lib/puppet/network/auth_config_parser.rb:32:          raise Puppet::ConfigurationError, _(""Missing or invalid 'path' before right directive at line %{count} of %{file}"") % { count: count, file: @file }
lib/puppet/network/auth_config_parser.rb:69:        _(""Invalid argument '%{var}' at line %{count}"") % { var: var, count: count }
lib/puppet/network/auth_config_parser.rb:80:        raise Puppet::ConfigurationError, _(""%{detail} at line %{count} of %{file}"") % { detail: detail, count: count, file: @file }, detail.backtrace
$
{code}

More cases to consider:
{code}
16:05 $ egrep -nr 'at .*file.*:.*line' lib
lib/puppet/settings/config_file.rb:86:        raise(Puppet::Error, _(""Illegal section '%{name}' in config file %{file} at line %{line}. The only valid puppet.conf sections are: [%{allowed_sections}]. Please use the directory environments feature to specify environments. (See https://docs.puppet.com/puppet/latest/reference/environments.html)"") % { name: section.name, file: file, line: section.line_number, allowed_sections: allowed_section_names.join("", "") })
lib/puppet/file_serving/configuration/parser.rb:43:          raise ArgumentError.new(_(""Invalid line '%{line}' at %{file}, line %{line_num}"") % { line: line.chomp, file: @file.filename, line_num: @count })
lib/puppet/file_serving/configuration/parser.rb:89:    raise ArgumentError.new(_(""%{mount} is already mounted at %{name} in %{file}, line %{line_num}"") % { mount: @mounts[name], name: name, file: @file, line_num: @count }) if @mounts.include?(name)
lib/puppet/util/logging.rb:184:          _(""\n   (at %{file}:%{line})"") % { file: file, line: line }
lib/puppet/parser/scope.rb:643:                   "" at #{position[:file]}:#{position[:line]}""
{code}",Task,PUP-8347,[],Find more places where we report the file or line information and convert them to use error_location()
"*Puppet Version:* 5.3.3, 3.8.7, 2.7.26

The documentation of the file type's {{content}} attribute is: ""The desired contents of a file, *as a string*.""

However an array of strings is also accepted. When content is set to an array, the last element of the array is used as content. I don't know if this behaviour is intended, it is not documented as far as I can tell. This behaviour is not new, I tested using Puppet 5.3, 3.8, 2.7 and got the same result with all of them.

*Desired Behavior:*
I would expect the following to result in an evaluation error due to content not being a String value:
{code}
file { '/tmp/foo':
  content => [""a\n"", ""b\n"", ""c\n""],
}
{code}

*Actual Behavior:*
File '/tmp/foo' is created with the content ""c\n"".",Bug,PUP-8346,[],File type content attribute accepts non-strings
"There are a few places in the code where we use a '\' to continue the line on the next line and in some of the places that we use it, it makes the code less readable.
Also address i18n strings while making changes",Task,PUP-8345,[],make code using '\' line continuation more readable and address i18n strings
"{quote}
Hey team!

A follow-up about upcoming puppet5 nightlies:

If your repo pulls from nightlies.pl.com for testing, you will need to update your paths after we make the switch to the new nightly repos. Currently, builds are in directories under the name of the component, e.g. http://nightlies.puppet.com/puppet-agent/<ref>. When we roll out new nightlies, paths will be similar to final-build paths, as on [apt|yum|downloads].pl.com, e.g. http://nightlies.puppet.com/puppet5-nightly/el/7/x86_64/<build>. 

Please let the RE team know if you have any questions or need help updating tests - you can find us in the 'release-new' HipChat room, or reply to this email.

Thanks!
{quote}",Task,PUP-8344,[],Switch to new nightly format for testing with puppetserver latest
"When enforcing a String data type for a class parameter:

{code:puppet}
class test::myclass(String $my_string = 'default') { 
  notify { ""notice ${my_string}"": }
}
{code}

If you provide a Regex data type, no exception is raised:

{code:puppet}
class { 'test::myclass':
  my_string => /my_regex/
}
{code}

",Bug,PUP-8343,[],"When enforcing String data type for a class param, a regex data type does not raise an error."
"Forked off of PUP-8288 to track adding the transaction_completed flag to the report schema for serialization/deserialization.  Broken out into a separate ticket targeted at master branch to minimize impact to our LTS release at 4.10.x, which the flag/partial fix was added to.",Bug,PUP-8342,[],Add transaction_completed to schema
"The Hiera interpolation function {{alias}} returns an empty string if the key referenced for lookup is not found.

In order to preserve the intent of {{alias}} and its usefulness in re-mapping key names in lookups it should return a not found condition like a direct lookup of a missing Hiera key would, and not an empty string.

For example, given:

{code:yaml}
---
test::key: ""%{alias('this_key_is_not_defined')}""
{code}

Assuming no other keys are present in Hiera than above, you'll get the following behavior:
{code}
$ puppet lookup --default mydefault --render-as json this_key_is_not_defined
""mydefault""
$
$ puppet lookup --default mydefault --render-as json test::key
""""
$
{code}

Alias not returning ""not found"" when the aliased key name is not found negatively impacts the usefulness of alias in re-mapping Hiera keys, particularly when using class automatic parameter lookups where parameter defaults are specified. Returning an empty string is a surprising and unexpected behavior.

I've tested this on Puppet 4.10.x and master and they both behave similarly.

Thank you.",Bug,PUP-8341,[],Lookup interpolation on alias to missing key should return not found
"The 'Puppet::Resource::Catalog.alias' method prints out the location of an error and should be updated to use Puppet::Util::Errors.error_location() instead so that we're being consistent:

{code}
  def alias(resource, key)
...
    if existing = @resource_table[newref]
      return if existing == resource
      resource_declaration = "" at #{resource.file}:#{resource.line}"" if resource.file and resource.line
      existing_declaration = "" at #{existing.file}:#{existing.line}"" if existing.file and existing.line
      #TRANSLATORS ""resource"" here is a Puppet type and should not be translated
      msg = _(""Cannot alias %{ref} to %{key}%{resource_declaration}; resource %{newref} already declared%{existing_declaration}"") % { ref: ref, key: key.inspect, resource_declaration: resource_declaration, newref: newref.inspect, existing_declaration: existing_declaration }
      raise ArgumentError, msg
    end
{code}",Task,PUP-8340,[],Update Puppet::Resource::Catalog.alias to use Puppet::Util::Errors.error_location()
"*Puppet Version:* Puppet 4 (at least) and up
*Puppet Server Version:* n/a
*OS Name/Version:* all

When running {{puppet apply}} with a file resource and source parameter, then puppet will load the entire file into memory, instead of streaming it.

This was noticed while researching why the bug described in PUP-7482 only affected {{puppet agent}} but not {{puppet apply}}.

*Desired Behavior:*

When managing files with a {{source}} parameter, puppet apply should always stream file content from all of the following sources

{{<absolute path>}} local file
{{file://<URI-encoded path>}} local file
{{puppet:///modules/mymodule}} local file
{{http?://host:port/path/to/file}} remote file

*Actual Behavior:*

{{puppet apply}} does not stream file content from http-based sources. See https://github.com/puppetlabs/puppet/blob/5.3.3/lib/puppet/type/file/source.rb#L274-L276.

At first glance it appears the {{Puppet::Type::File::ParameterSource#content}} method can be deleted entirely, and should always rely on {{chunk_file_from_disk}} or {{chunk_file_from_source}}.",Bug,PUP-8338,[],Puppet apply doesn't stream file content
"We just swapped out a Windows Server 2008 R2 with a Windows Server 2016. We have deduplication enabled on the 2016 server. We have a few Windows machines with Puppet Agent installed. Since swapping to the new server, any module that uses the package resource type errors out with this:

{code:java}
Error: DeviceIoControl(940, FSCTL_GET_REPARSE_POINT) returned unknown tag 0x80000013:  The operation completed successfully.
Error: /Stage[main]/Sophos::Install/Package[Sophos Anti-Virus]/ensure: change from 'absent' to 'present' failed: DeviceIoControl(940, FSCTL_GET_REPARSE_POINT) returned unknown tag 0x80000013:  The operation completed successfully.
{code}

The only thing I can find about that error is it has something to do with deduplication. I replaced an installation file with a newer one and ran the agent again. The application installed like it did before swapping servers.
It's not a big deal if this gets fixed for me or not. I'm fine excluding the folder with all my installations from being deduped. I just thought I'd bring it to your attention if this isn't known yet.

This is the code for the package resource type:
{code:java}
package { 'Sophos Anti-Virus':
  ensure => installed,
  source => ""//server.domain.com/installations/SophosInstallFull.exe""
}
{code}

",Bug,PUP-8337,[],Package source on Windows errors out on deduped installation files
"Given a rubygem / package with dependencies to other package. When I try do manage that package with Puppet all is fine. But when I apply the same manifest with Puppet executed via Bundler then I get an error (Installing a package w/o dependencies, i.e. rake, works). To my understanding installing Puppet with bundler is best practice when developing & testing modules, so this might have some relevance. Here’s my TPS report:

{code}
# Bad:
$ sudo bin/puppet apply --verbose --no-report foreground.pp
info: Applying configuration version '1352903073'
err: /Stage[main]//Package[foreground]/ensure: change from absent to latest failed: Could not update: Execution of '/usr/bin/gem install --include-dependencies --no-rdoc --no-ri foreground' returned 1: ERROR:  Error installing foreground:
foreground requires mixlib-cli (~> 1.2.2)
INFO:  `gem install -y` is now default and will be removed
INFO:  use --ignore-dependencies to install only the gems you list
at /Users/bjoern/Documents/puppet-zabbix_osx/foreground.pp:4
notice: Finished catalog run in 78.69 seconds
$ bin/puppet --version
2.7.19

# Good:
$ sudo puppet apply --verbose --no-report foreground.pp 
info: Applying configuration version '1352903176'
notice: Finished catalog run in 3.82 seconds
$ puppet --version
2.7.19

# Context:
$ ruby --version
ruby 1.8.7 (2011-12-28 patchlevel 357) [universal-darwin11.0]
$ bundle --version
Bundler version 1.2.1
$ cat foreground.pp 
package { 'foreground':
  ensure   => latest,
  provider => gem,
}
$ sw_vers 
ProductName:    Mac OS X
ProductVersion: 10.7.4
BuildVersion:   11E53
$ gem --version
1.8.24
{code}

PS: This might be a bug in bundler / rubygems / whatever, but I think it should at least be documented here.
",Bug,PUP-8335,[],Package update via Gem provider fails when running Puppet via bundler
"Remove the code files at:

* type - lib/puppet/type/scheduled_task.rb
* provider - lib/puppet/provider/scheduled_task/win32_taskscheduler.rb
* helper code - lib/puppet/util/windows/taskscheduler.rb
* related rspec and Beaker tests at https://github.com/puppetlabs/puppet/blob/master/spec/unit/provider/scheduled_task/win32_taskscheduler_spec.rb / https://github.com/puppetlabs/puppet/blob/master/spec/unit/type/scheduled_task_spec.rb AND acceptance/tests/resource/scheduled_task",Task,PUP-8333,[],Remove scheduled_task type and provider
"Update the  lib/puppet/pops/issue_reporter.rb to report errors and warnings in a translation friendly way.

{code}
      warnings_message = (emit_warnings && warnings.size > 0) ? "", and #{warnings.size} warnings"" : """"
      giving_up_message = ""Language validation logged #{errors.size} errors#{warnings_message}. Giving up""
{code}",Task,PUP-8331,[],Add translation for issue_reporter.rb error/warning count message
"*Puppet Version: 5.3.3*
*Puppet Server Version: 5.1.4*
*OS Name/Version: macOS 10.13.2*

puppet user provider fails with every puppet run or with puppet resource

*Desired Behavior:*

No error or error handling.

*Actual Behavior:*

Crash.

*Example:*

{code}
# puppet resource user admin --trace --debug
[..]
Debug: Executing: '/usr/bin/dscl -plist . readall /Groups'
Debug: Converting binary plist to hash
Debug: Converting binary plist to hash
Debug: Converting binary plist to hash
Debug: Converting binary plist to hash
Debug: Converting binary plist to hash
Error: Could not run: undefined method `unpack' for nil:NilClass
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:210:in `get_salted_sha512_pbkdf2'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:149:in `generate_attribute_hash'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:87:in `block in instances'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:86:in `collect'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:86:in `instances'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1164:in `block in instances'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1163:in `collect'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1163:in `instances'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/resource/ral.rb:14:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:195:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:216:in `find_or_save_resources'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:142:in `block in main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:263:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:137:in `main'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:366:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:666:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
{code}
",Bug,PUP-8330,"['macos', 'triaged', 'type_and_provider', 'user']",macOS agents fails to retrieve password hash
"*Puppet Version:* 4.10.1 - 5.3.3 (tested)

There is confusing behaviour around calling functions (new ruby API) from other modules depending of the existence and contents of the calling modules metadata.json file.

If a module contains a globally namespaced function, eg:

{code}
# <modulepath>/myfunc/lib/puppet/functions/foo.rb
Puppet::Functions.create_function(:foo) do
...
{code}

And another module contains a call to that function

{code}
# <modulepath>/callingmodule/manifests/init.pp
class callingmodule {
  foo()
}
{code}

We have been seeing cases of Puppet failing with the message

{code}
Error: Evaluation Error: Unknown function: 'foo'
{code}

It turns out this was due to metadata.json.  If callingmodule has no metadata.json then this code works, however, if metadata.json exists and the myfunc module is *not* listed as a dependency then I get the above error.  Adding myfunc as a dependency to callingmodule fixes the issue.

This may be desired behaviour(?), I can see the benefits in strictly enforcing dependency statements, though I can find no documentation that suggests that it is.

I think this is a valid issue, as the current behaviour makes it very hard to debug the cause of the issue - an error message such as the following would be much more useful;

{code}
Error: Evaluation Error: Function 'foo' from module 'myfunc' called but 'myfunc' is not found as a dependency in metadata.json
{code}

Puppet seems happy to disregard the fact that a module has no metadata.json file whatsoever but when one places a default metadata.json file in this error is a somewhat unexpected side effect that's far from obvious.


",Bug,PUP-8329,[],Functions not found when dependencies aren't listed.
"The {{mount}} resource should allow whitespace in the name.  Currently any whitespace returns the error;
{noformat}
""Error: Parameter name failed on Mount [testmount]: name must not contain whitespace""
{noformat}

Puppet should either allow whitespace in the name or recognise the  {{\040}} used in the fstab.  Currently {{\040}} is interpreted literally by Puppet;

{noformat}
""Could not evaluate: Execution of '/bin/mount /var/tmp/test\040mount' returned 1: mount: can't find /var/tmp/test\040mount i
n /etc/fstab""
{noformat}

",Improvement,PUP-8328,[],Mount resource does not allow whitespace in name
"The TypeParser uses the regular puppet parser to get a data type from a string with the definition of a data type (for example ""String[1]""). This is done because types can be complex expressions. Most use of data types is however very simple.  There is an opportunity to optimize the performance by checking for simple and common data types and skip lexing/parsing/validation etc.

Optimization could recognize all unparameterized data types, as well as the most common parameterized data types like:
* {{String\[1]}}
* {{Array\[1]}}
* {{Boolean\[false]}}, {{Boolean\[true]}}
* {{Optional\[String]}}, {{Optional\[Integer]}}, ...
",Improvement,PUP-8327,[],Optimize TypeParser for common data type string
"So I upgraded my Mac to High Sierra and now I've got a new unit test that is failing. It appears that I'm on the new APFS filesystem and it doesn't allows an invalid utf-8 encoding for the filename so the test fails.

{code}
Failures:

  1) Puppet::Indirector::JSON#search raises if the content contains binary
     Failure/Error: File.binwrite(subject.path(""foo#{binary}.bin"", ''), ""foo-binary"")
     Errno::EILSEQ:
       Illegal byte sequence @ rb_sysopen - /var/folders/41/jfjd_k_n0tdg_m_gn_m7ykfh0000gq/T/rspecrun20180105-46754-10h4tji/jsondir20180105-46754-1s9q9vu/indirector_testing/foo??.bin
     # ./spec/unit/indirector/json_spec.rb:206:in `binwrite'
     # ./spec/unit/indirector/json_spec.rb:206:in `block (3 levels) in <top (required)>'
     # util/rspec_runner:44:in `run'
     # util/rspec_runner:59:in `<main>'
Finished in 9.71 seconds (files took 3.05 seconds to load)

Finished in 2 minutes 11.5 seconds
23427 examples, 1 failure, 43 pending

Failed examples:
rspec ./spec/unit/indirector/json_spec.rb:202 # Puppet::Indirector::JSON#search raises if the content contains binary
{code}

Here you can see that its really the binwrite that is throwing EILSEQ

{code}
14:11 $ ruby --version
ruby 2.4.2p198 (2017-09-14 revision 59899) [x86_64-darwin17]
✔ ~/work/my_repos/puppet [5.3.x ↓·6|✚ 1…1⚑ 1]
14:11 $ irb
irb(main):001:0> binary = ""\xC0\xFF"".force_encoding(Encoding::BINARY)
=> ""\xC0\xFF""
irb(main):002:0> File.binwrite(""/tmp/foo#{binary}.bin"", ""foo-binary"")
Errno::EILSEQ: Illegal byte sequence @ rb_sysopen - /tmp/foo��.bin
	from (irb):2:in `binwrite'
	from (irb):2
	from /Users/eric.delaney/.rbenv/versions/2.4.2/bin/irb:11:in `<main>'
irb(main):003:0> binary.encoding
=> #<Encoding:ASCII-8BIT>
irb(main):004:0> string = ""/tmp/foo#{binary}.bin""
=> ""/tmp/foo\xC0\xFF.bin""
irb(main):005:0> File.binwrite(string, ""bin"")
Errno::EILSEQ: Illegal byte sequence @ rb_sysopen - /tmp/foo��.bin
	from (irb):5:in `binwrite'
	from (irb):5
	from /Users/eric.delaney/.rbenv/versions/2.4.2/bin/irb:11:in `<main>'
irb(main):006:0>
{code}

My mac is running on the new APFS filesystem:

{code}
✔ ~/work/my_repos/puppet [5.3.x ↓·6|✚ 1…1⚑ 1]
14:18 $ mount
/dev/disk1s1 on / (apfs, local, journaled)
devfs on /dev (devfs, local, nobrowse)
/dev/disk1s4 on /private/var/vm (apfs, local, noexec, journaled, noatime, nobrowse)
map -hosts on /net (autofs, nosuid, automounted, nobrowse)
map auto_home on /home (autofs, automounted, nobrowse)
✔ ~/work/my_repos/puppet [5.3.x ↓·6|✚ 1…1⚑ 1]
{code}",Bug,PUP-8326,[],MacOS 10.13 unit test fails on APFS file system when creating invalid UTF-8 file name
"h2. Problem

It appears to be impossible to have a trusted fact whose value is structured data or any data type other than a String.

h2. Desired Behavior

Given a {{csr_attributes.yaml}} like the below, I'd expect the value of {{pp_product}} to be a hash containing Strings, Booleans, and Arrays.

{code:yaml}
---
extension_requests:
  pp_role: test
  pp_product:
    owner: nate
    name: ""A test product""
    approved: true
    is_a_thing: false
    tiers:
      - one
      - two
      - blue
{code} 

h2. Actual Behavior

The value of the trusted fact for {{pp_product}} is stringified as shown in the Puppet Enterprise console:

!Bad Fact.png|thumbnail! 

In code, the $trusted variable also doesn't contain a {{tiers}} array. The errors message implies that pp_product is a String:

{code}
node default {
  $pp_product_tiers = $trusted['extensions']['pp_product']['tiers']
  notify { $pp_product_tiers: }
}
{code}

{code}
[root@pe-201732-agent ~]# puppet agent -t
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: A substring operation does not accept a String as a character index. Expected an Integer at /etc/puppetlabs/code/environments/production/manifests/site.pp:4:60 on node pe-201732-agent.puppetdebug.vlan
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{code}

Here's a {{puppet cert print}} of that agent's certificate. It looks like it *should* be structured data:

{code}
 X509v3 extensions:
            Netscape Comment:
                .(Puppet Ruby/OpenSSL Internal Certificate
            Puppet Node Role Name:
                ..test
            Puppet Node Product Name:
                .s{""owner""=>""nate"", ""name""=>""A test product"", ""approved""=>true, ""is_a_thing""=>false, ""tiers""=>[""one"", ""two"", ""blue""]}
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
{code}",Improvement,PUP-8325,[],Trusted facts can't be structured data
"In the Puppet code when we call ""raise EventLogError"" the string passed most likely should be internationalized.
",Task,PUP-8322,[],"18n add string decorations to ""raise EventLogError"" call"
"Need to update the how the warn_once() method and issue_deprecation_warning() method prints the file and line location information by using Puppet::Util::Errors.error_location and its i18n friendly output format.

Need to update strings passed to these methods.

{code}
  def warn_once(kind, key, message, file = nil, line = nil, level = :warning)
    return if Puppet[:disable_warnings].include?(kind)
    $unique_warnings ||= {}
    if $unique_warnings.length < 100 then
      if (! $unique_warnings.has_key?(key)) then
        $unique_warnings[key] = message
        call_trace =
        case MM.new(file, line)
        when SUPPRESS_FILE_LINE
          ''
        when FILE_AND_LINE
          _(""\n   (at %{file}:%{line})"") % { file: file, line: line }
        when FILE_NO_LINE
          _(""\n   (in %{file})"") % { file: file }
        when NO_FILE_LINE
          _(""\n   (in unknown file, line %{line})"") % { line: line }
        else
          _(""\n   (file & line not available)"")
        end
        send_log(level, ""#{message}#{call_trace}"")
      end
    end
  end
{code}",Task,PUP-8321,[],Update how warn_once and deprecation warnings print their location and i18n messages
"There are inconsistencies in how the result of a predicate block sent to the Puppet functions {{all}}, {{any}}, and {{filter}} is acted upon.

The {{filter}} function checks if the value returned from the block is exactly equal to the literal {{true}} whereas the {{all}} and {{any}} functions checks if it is truthy (i.e. not literal {{false}} or {{undef}}).

Although the inconsistency is also present in the documentation, it would be desirable if all iterative functions that uses a predicate block use the same behavior.

Proposed change:
Modify the {{filter}} function so that it also acts on truthy returns since this is also consistent with how {{if}} and {{unless}} works and also modify the documentation to state this.

This is a breaking change.",Improvement,PUP-8320,[],True/truthy inconsistencies between function filter() and functions all() and any()
"These errors were spotted when doing {{win-2012r2-fr-x86_64}} imaging acceptance testing.

Build Log is at: https://jenkins-imaging.delivery.puppetlabs.net/view/Win-vSphere/job/imaging_win-2012r2-fr_x86_64_vmware_vsphere.cygwin_acceptance_packer/12/consoleFull

Gist of build log is also saved at: https://gist.github.com/jcoconnor/f2392aeeb038c060d9c5e91f5cadd45c

{noformat}
01:36:50.996 Failed Tests Cases:
01:36:50.996   Test Case tests/windows/eventlog.rb reported: #<Beaker::DSL::Outcomes::FailTest: 
01:36:50.996 Event not found in Application event log
01:36:50.996 >
01:36:50.996     Test line: tests/windows/eventlog.rb:35:in `block (3 levels) in run_test'
01:36:50.997   Test Case tests/resource/group/should_query_all.rb reported: #<Beaker::DSL::Outcomes::FailTest: 
01:36:50.997 group Accès DCOM service de certificats found by puppet, not natively
01:36:50.997 >
01:36:50.997     Test line: tests/resource/group/should_query_all.rb:19:in `block (4 levels) in run_test'
01:36:50.997   Test Case tests/resource/user/should_query_all.rb reported: #<Beaker::DSL::Outcomes::FailTest: 
01:36:50.997 user Invité found by puppet, not natively
01:36:50.997 >
01:36:50.997     Test line: tests/resource/user/should_query_all.rb:21:in `block (4 levels) in run_test'
01:36:50.997 Errored Tests Cases:
01:36:50.997   Test Case tests/face/parser_validate.rb reported: #<Beaker::Host::CommandFailure: Host 'm5a0caz1vz71n0h' exited with 1 running:
01:36:50.998  chown Administrator:Administrators C:/cygwin64/tmp/parser_validate.nBctlx/parser_validate.pp
01:36:50.998 Last 10 lines of output were:
01:36:50.998 	chown: invalid group: 'Administrator:Administrators'>
01:36:50.998     Test line: tests/face/parser_validate.rb:30:in `block (4 levels) in run_test'
{noformat}",Bug,PUP-8319,['Engineering-Initiative'],Win-2012r2 FR Puppet Acceptance showing 4 test failures (localisation)
"currently you must use files with token, ca-cert, endpoints for use with:

classifier gem
puppet job
puppet query
puppet deploy

For use with containers for CI/CD purposes and other scripting tasks... it would be beneficial to use ENV variables or --parameter strings to provide the necessary information if the configuration files or token files aren't available.

[~carl][~ryan][~tom]",New Feature,PUP-8318,[],Allow client tools and classifier gem to support parameters
"*Puppet Version:* 5.3.2
*Puppet Server Version:* 5.1.3
*OS Name/Version:* Centos 7
*stdlib version*: 4.15.0

This code block:

{code:puppet}
  file_line { 'ListenIP_fix':
    ensure  => absent,
    path    => '/etc/zabbix/zabbix_agentd.conf',
    match   => '^ListenIP',
    require => Class['zabbix::agent'],
  }
{code}

By my reading of the file_line documentation, I would expect that this code works: https://forge.puppet.com/puppetlabs/stdlib#file_line

*Desired Behavior:*

{{file_line}} should not require {{line}} when {{ensure  => absent}} is set.

*Actual Behavior:*

{{Error: Validation of File_line[ListenIP_fix] failed: line is a required attribute at /tmp/packer-puppet-masterless/module-1/role/manifests/validation.pp:11}}
",Bug,PUP-8317,[],file_line matching on absent requires line
"In the Puppet code when we call Puppet.info() the string passed most likely should be internationalized.
",Task,PUP-8315,[],i18n add string decorations to Puppet.info calls
"In the Puppet code when we call ""raise ArgumentError"" the string passed most likely should be internationalized.
",Task,PUP-8314,[],"i18n add string decorations to ""raise ArgumentError"" call"
"In the Puppet code when we call ""raise DevError"" the string passed most likely should be internationalized.
",Task,PUP-8313,[],"i18n add string decorations to ""raise DevError"" calls"
"In the Puppet code when we call Puppet.err() and Puppet.warning() calls and raise InterpolationError strings passed most likely should be internationalized.
",Task,PUP-8312,[],i18n add string decorations to Puppet.err() and Puppet.warning() calls and raise InterpolationError strings
"We should streamline or break apart all of the package installation utilities in puppet.

Remove any unneeded or unused bits, break down what we can into atomic methods, ensure all installation happens with the newer install utilities provided by beaker (i.e., puppet5), remove any calls to old installation methods that should no longer be used.

The eventual goal will be to move these to beaker-puppet so they can be reused across multiple components. This will also allow us to update only one place when we switch to artifactory being the main source for packages. ",Task,PUP-8308,[],Streamline all package installation steps for puppet
"Puppet has code to enable ec2 testing, but the code here is very fragile. We need to figure out where this testing happens so we know the scope in which this code needs to be able to run. A lot of our newer testing utilities are necessarily only available internally. It appears we need to keep the ec2 logic executable externally as well.

We should also check to see if we can make this logic available for multiple components that require it (i.e., puppet and maybe also pxp-agent). Eventually it should be moved into beaker-puppet, but only in a form that has been deemed required. Once there, we'll be able to reuse it for multiple components. This eventual goal should be kept in mind for this initial work.",Task,PUP-8307,[],Investigate ec2 testing for puppet
"We need some way to sync local git changes with the host we are using to test those changes. This only applies to git-based testing. 

This will be very useful for iterative development.",Task,PUP-8306,[],Mechanism for syncing local git changes to remote testing host
"We currently have work scheduled to build out all required runtime components (ruby, openssl, etc), and make them available to grab during build time of puppet-agent. We should be able to leverage this to make our git-based testing faster and easier as well. This will be internal only for the moment (maybe, depending on Artifactory settings, once the package is consistently shipping to Artifactory), but that's fine.

We should replace the logic in 00_EnvSetup.rb that installs these runtime components from system packages with the runtime archive. This will alleviate a lot of headache for developers trying to test subcomponents with git.",Task,PUP-8305,[],Git testing should consume the runtime archive rather than install system packages
"Can I use puppet-strings gem without puppet itself? I need to parse manifests into a JSON that would contain classes and defined types, but without puppet itself. 

*Side note:* I am in an attempt to write a GUI tool that would parse puppet manifests, along with classes, defined types (including their parameters and docs on them), and then render a GUI window, so unexperienced users with puppet would be able to manage hieradata via drag-and-drop. To do so, I need to know what classes and defined types the manifests have.

Puppet-strings is an excellent solution to my problem, except with a note that it requires puppet itself, which might be inappropriate since the GUI might not have the puppet installed.

Thank you in advance.",Story,PUP-8302,"['parser', 'strings']",How to use puppet-strings outside of the puppet itself?
"While writing some code for the VS Code Extension I came across a simple error

If no types had been loaded yet then calls to 'Puppet::Type.eachtype' fail with 
{code}
NoMethodError: undefined method `each' for nil:NilClass
from C:/Source/puppet-vscode/server/.bundle/windows/ruby/2.3.0/gems/puppet-4.10.1-x64-mingw32/lib/puppet/metatype/manager.rb:39:in `eachtype'
{code}

This is due to the instance variable {{@types}} only being set upon the first module that gets loaded.  The clear_misses method has nil detection but not eachtype

https://github.com/puppetlabs/puppet/blob/892d7a9252698e44cde936b7334fca05952a4079/lib/puppet/metatype/manager.rb#L38-L45

Recommended solution:
Add a {{return if @types.nil?}} as the first line in the method.

This is a fairly low importance and low incidence as I'm using Puppet in a not a normal way but it's still a bug in the behaviour.",Bug,PUP-8301,[],Puppet::Type.eachtype raises an error instead of returning nil if no types are loaded
"If URL is redirect and server does not handle HEAD requests (like in that case Amazon API who returns 403 when URL after redirect gets HEAD request), Puppet fails with unhelpful message:

{noformat}
/opt/puppetlabs/bin/puppet apply /tmp/1.pp        
Notice: Compiled catalog for hydra.devrandom.pl in environment production in 0.01 seconds
Error: Could not retrieve information from environment production source(s) https://github.com/XANi/go-dpp/releases/download/v0.0.4/dpp.aarch64
Error: /Stage[main]/Main/File[/tmp/dpp]/ensure: change from 'absent' to 'present' failed: Could not retrieve information from environment production source(s) https://github.com/XANi/go-dpp/releases/download/v0.0.4/dpp.aarch64
{noformat}

no redirect file works fine
{code:puppet}
 File {
     ensure => present
     }

file { '/tmp/dpp':
    source => 'https://github.com/XANi/go-dpp/releases/download/v0.0.4/dpp.aarch64',
    mode => ""644"",
    checksum => ""sha256"",
    checksum_value => '6bda5ca841bf47d81283ee5b73b030c3b82e33e6817d8bb36a1e1006c1b5dd81',
    backup => false,
}
file { '/tmp/rnd':
    source => 'http://192.168.1.1/rnd',
    mode => ""644"",
    checksum => ""sha256"",
    checksum_value => '19248907fa84d23721987abf90f9f7cbac44c547fd38ef2c0ce31e194eb4d9ed',
    backup => false,
}
{code}

this was present in 4.8.x version too so it seems like something broken since http was added",Bug,PUP-8300,[],File resource can't handle HTTP redirects when server does not accept HEAD requests
"That worked in 4.8.x (the current Debian upstream package):


{code:puppet}
file { '/tmp/rnd':
        source => 'http://192.168.1.4/rnd',
        mode => ""644"",
        checksum => ""sha256"",
        checksum_value => '19248907fa84d23721987abf90f9f7cbac44c547fd38ef2c0ce31e194eb4d9ed',
        backup => false,
}
{code}

(apparently jira's own wysiwig editor can't preformat above block, I give up)

After checking with Puppetlab's 5.3.3 that causes nothing (file does not get created, *HTTP request does not happen*) and debug log returns

{noformat}
{{Debug: /Stage[main]/Main/File[/tmp/rnd]: Nothing to manage: no ensure and the resource doesn't exist}}
{noformat}

The same thing with non-http source works just fine 

adding ensure => present to the resource ""fixes"" it altho for some reason Puppet does 3 HEAD requests to server instead of one...

{noformat}
127.0.0.1 192.168.1.4 - [30/Dec/2017:11:17:08 +0100] ""HEAD /rnd HTTP/1.1"" 200 0 ""-"" ""Ruby""
127.0.0.1 192.168.1.4 - [30/Dec/2017:11:17:08 +0100] ""HEAD /rnd HTTP/1.1"" 200 0 ""-"" ""Ruby""
127.0.0.1 192.168.1.4 - [30/Dec/2017:11:17:08 +0100] ""HEAD /rnd HTTP/1.1"" 200 0 ""-"" ""Ruby""
127.0.0.1 192.168.1.4 - [30/Dec/2017:11:17:08 +0100] ""GET /rnd HTTP/1.1"" 200 1048576 ""-"" ""Ruby""}}
{noformat}
",Bug,PUP-8299,[],"File resource needs ""ensure"" if source is http url"
"For BOLT-261 we need a new Puppet error for when the user tries to run a plan that includes invalid task names. This error should be called {{INVALID_TASK_NAME}} with the message 
{code}
('%{name} is not a valid task name') % { name: name }
{code}
",Task,PUP-8298,[],Add new issue type INVALID_TASK_NAME
"*Puppet Version:*  4.10.8
*OS Name/Version:* FreeBSD 11.1-RELEASE (Affects Linux as well), with OpenSSL 1.0.2k

When Launching the puppetmaster rc.d script on FreeBSD, which uses $Puppet_Location/puppet/network/http/webrick.rb, webrick fails to accept SSL/TLS connections, due to a change upstream in Ruby.

https://bugs.ruby-lang.org/issues/14005

The issue occurs in webrick.rb, supplied by puppet.
webrick.rb:32 {
sock.accept
}
Due to the changes in Ruby, this should read:
sock.accept_nonblock

To reproduce, run a webrick puppetmaster with Ruby 2.3.6 or newer on any OS using OpenSSL.

*Desired Behavior:*
Webrick puppetmaster does the needful 

*Actual Behavior:*
Webrick puppetmaster outputs the following to logs:
[2017-12-25 21:30:26] ERROR OpenSSL::SSL::SSLError: SSL_accept returned=1 errno=0 state=SSLv3 read client hello B: unexpected record
        /usr/local/lib/ruby/site_ruby/2.3/puppet/network/http/webrick.rb:32:in `accept'
        /usr/local/lib/ruby/site_ruby/2.3/puppet/network/http/webrick.rb:32:in `block (2 levels) in listen'
        /usr/local/lib/ruby/2.3/webrick/server.rb:314:in `block in start_thread'

and the following on the client:
Error: /File[/var/puppet/lib]: Failed to generate additional resources using 'eval_generate': SSL_read: decryption failed or bad record mac                               

--
I am aware webrick is being deprecated, however it is still in use currently.
I have filed a separate bug with FreeBSD to change the default puppet pkg to use sysutils/puppetserver from the ports system.
https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=224623

",Bug,PUP-8297,[],Puppet webrick no longer functions in Ruby 2.3.6/2.4.3 and up
"hi People!
I cannot integrate an agent to the server. This is mandatory to send reports from this agent. please help!

from the puppet(foreman)server angle :
```bash
[root@foreman ludovic_palamede]# puppet cert generate slavepoc2.edc.carrefour.com -d
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Applying settings catalog for sections main, ssl, ca
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Using settings: adding file resource 'confdir': 'File[/etc/puppetlabs/puppet]{:path=>""/etc/puppetlabs/puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'codedir': 'File[/etc/puppetlabs/code]{:path=>""/etc/puppetlabs/code"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Failed to load library 'cfpropertylist' for feature 'cfpropertylist'
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: Facter: searching for custom fact ""operatingsystem"".
Debug: Facter: searching for operatingsystem.rb in /opt/puppetlabs/server/data/puppetserver/lib/facter.
Debug: Facter: searching for operatingsystem.rb in /opt/puppetlabs/server/data/puppetserver/facts.
Debug: Facter: fact ""facterversion"" has resolved to ""3.6.8"".
Debug: Facter: fact ""aio_agent_version"" has resolved to ""1.10.9"".
Debug: Facter: searching ""/opt/puppetlabs/facter/facts.d"" for external facts.
Debug: Facter: skipping external facts for ""/etc/facter/facts.d"": No such file or directory
Debug: Facter: skipping external facts for ""/etc/puppetlabs/facter/facts.d"": No such file or directory
Debug: Facter: no external facts were found.
Debug: Facter: resolving operating system facts.
Debug: Facter: resolving kernel facts.
Debug: Facter: fact ""kernel"" has resolved to ""Linux"".
Debug: Facter: fact ""kernelrelease"" has resolved to ""3.10.0-693.11.1.el7.x86_64"".
Debug: Facter: fact ""kernelmajversion"" has resolved to ""3.10"".
Debug: Facter: fact ""kernelversion"" has resolved to ""3.10.0"".
Debug: Facter: executing command: lsb_release -a
Debug: Facter: lsb_release was not found on the PATH.
Debug: Facter: fact ""osfamily"" has resolved to ""RedHat"".
Debug: Facter: fact ""operatingsystemmajrelease"" has resolved to ""7"".
Debug: Facter: fact ""operatingsystemrelease"" has resolved to ""7.4.1708"".
Debug: Facter: fact ""hardwaremodel"" has resolved to ""x86_64"".
Debug: Facter: fact ""architecture"" has resolved to ""x86_64"".
Debug: Facter: fact ""operatingsystem"" has resolved to ""CentOS"".
Debug: Facter: fact ""selinux"" has resolved to true.
Debug: Facter: fact ""selinux_enforced"" has resolved to false.
Debug: Facter: fact ""selinux_current_mode"" has resolved to ""permissive"".
Debug: Facter: fact ""selinux_config_mode"" has resolved to ""permissive"".
Debug: Facter: fact ""selinux_config_policy"" has resolved to ""targeted"".
Debug: Facter: fact ""selinux_policyversion"" has resolved to ""28"".
Debug: Facter: fact ""os"" has resolved to {
  architecture => ""x86_64"",
  family => ""RedHat"",
  hardware => ""x86_64"",
  name => ""CentOS"",
  release => {
    full => ""7.4.1708"",
    major => ""7"",
    minor => ""4""
  },
  selinux => {
    config_mode => ""permissive"",
    config_policy => ""targeted"",
    current_mode => ""permissive"",
    enabled => true,
    enforced => false,
    policy_version => ""28""
  }
}.
Debug: Puppet::Type::User::ProviderDirectoryservice: file /usr/bin/dsimport does not exist
Debug: Failed to load library 'ldap' for feature 'ldap'
Debug: Puppet::Type::User::ProviderLdap: feature ldap is missing
Debug: Puppet::Type::User::ProviderPw: file pw does not exist
Debug: Puppet::Type::User::ProviderUser_role_add: file roleadd does not exist
Debug: Failed to load library 'cfpropertylist' for feature 'cfpropertylist'
Debug: Puppet::Type::Group::ProviderDirectoryservice: file /usr/bin/dscl does not exist
Debug: Failed to load library 'ldap' for feature 'ldap'
Debug: Puppet::Type::Group::ProviderLdap: feature ldap is missing
Debug: Puppet::Type::Group::ProviderPw: file pw does not exist
Debug: Using settings: adding file resource 'vardir': 'File[/opt/puppetlabs/server/data/puppetserver]{:path=>""/opt/puppetlabs/server/data/puppetserver"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'logdir': 'File[/var/log/puppetlabs/puppetserver]{:path=>""/var/log/puppetlabs/puppetserver"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'statedir': 'File[/opt/puppetlabs/server/data/puppetserver/state]{:path=>""/opt/puppetlabs/server/data/puppetserver/state"", :mode=>""1755"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'rundir': 'File[/var/run/puppetlabs/puppetserver]{:path=>""/var/run/puppetlabs/puppetserver"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'libdir': 'File[/opt/puppetlabs/server/data/puppetserver/lib]{:path=>""/opt/puppetlabs/server/data/puppetserver/lib"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hiera_config': 'File[/etc/puppetlabs/puppet/hiera.yaml]{:path=>""/etc/puppetlabs/puppet/hiera.yaml"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'preview_outputdir': 'File[/opt/puppetlabs/server/data/puppetserver/preview]{:path=>""/opt/puppetlabs/server/data/puppetserver/preview"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'certdir': 'File[/etc/puppetlabs/puppet/ssl/certs]{:path=>""/etc/puppetlabs/puppet/ssl/certs"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'ssldir': 'File[/etc/puppetlabs/puppet/ssl]{:path=>""/etc/puppetlabs/puppet/ssl"", :mode=>""771"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'publickeydir': 'File[/etc/puppetlabs/puppet/ssl/public_keys]{:path=>""/etc/puppetlabs/puppet/ssl/public_keys"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'requestdir': 'File[/etc/puppetlabs/puppet/ssl/certificate_requests]{:path=>""/etc/puppetlabs/puppet/ssl/certificate_requests"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'privatekeydir': 'File[/etc/puppetlabs/puppet/ssl/private_keys]{:path=>""/etc/puppetlabs/puppet/ssl/private_keys"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'privatedir': 'File[/etc/puppetlabs/puppet/ssl/private]{:path=>""/etc/puppetlabs/puppet/ssl/private"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'localcacert': 'File[/etc/puppetlabs/puppet/ssl/certs/ca.pem]{:path=>""/etc/puppetlabs/puppet/ssl/certs/ca.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostcrl': 'File[/etc/puppetlabs/puppet/ssl/crl.pem]{:path=>""/etc/puppetlabs/puppet/ssl/crl.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'cadir': 'File[/etc/puppetlabs/puppet/ssl/ca]{:path=>""/etc/puppetlabs/puppet/ssl/ca"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'cacert': 'File[/etc/puppetlabs/puppet/ssl/ca/ca_crt.pem]{:path=>""/etc/puppetlabs/puppet/ssl/ca/ca_crt.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'cakey': 'File[/etc/puppetlabs/puppet/ssl/ca/ca_key.pem]{:path=>""/etc/puppetlabs/puppet/ssl/ca/ca_key.pem"", :mode=>""640"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'capub': 'File[/etc/puppetlabs/puppet/ssl/ca/ca_pub.pem]{:path=>""/etc/puppetlabs/puppet/ssl/ca/ca_pub.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'cacrl': 'File[/etc/puppetlabs/puppet/ssl/ca/ca_crl.pem]{:path=>""/etc/puppetlabs/puppet/ssl/ca/ca_crl.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'caprivatedir': 'File[/etc/puppetlabs/puppet/ssl/ca/private]{:path=>""/etc/puppetlabs/puppet/ssl/ca/private"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'csrdir': 'File[/etc/puppetlabs/puppet/ssl/ca/requests]{:path=>""/etc/puppetlabs/puppet/ssl/ca/requests"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'signeddir': 'File[/etc/puppetlabs/puppet/ssl/ca/signed]{:path=>""/etc/puppetlabs/puppet/ssl/ca/signed"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'capass': 'File[/etc/puppetlabs/puppet/ssl/ca/private/ca.pass]{:path=>""/etc/puppetlabs/puppet/ssl/ca/private/ca.pass"", :mode=>""640"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'serial': 'File[/etc/puppetlabs/puppet/ssl/ca/serial]{:path=>""/etc/puppetlabs/puppet/ssl/ca/serial"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'autosign': 'File[/etc/puppetlabs/puppet/autosign.conf]{:path=>""/etc/puppetlabs/puppet/autosign.conf"", :mode=>""664"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'cert_inventory': 'File[/etc/puppetlabs/puppet/ssl/ca/inventory.txt]{:path=>""/etc/puppetlabs/puppet/ssl/ca/inventory.txt"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'pluginfactdest': 'File[/opt/puppetlabs/server/data/puppetserver/facts.d]{:path=>""/opt/puppetlabs/server/data/puppetserver/facts.d"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: /File[/etc/puppetlabs/puppet]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet
Debug: /File[/etc/puppetlabs/puppet]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet
Debug: /File[/etc/puppetlabs/puppet]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet
Debug: /File[/etc/puppetlabs/puppet]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet
Debug: /File[/etc/puppetlabs/code]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/code
Debug: /File[/etc/puppetlabs/code]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/code
Debug: /File[/etc/puppetlabs/code]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/code
Debug: /File[/etc/puppetlabs/code]/selrange: Found selrange default 's0' for /etc/puppetlabs/code
Debug: /File[/opt/puppetlabs/server/data/puppetserver]/seluser: Found seluser default 'system_u' for /opt/puppetlabs/server/data/puppetserver
Debug: /File[/opt/puppetlabs/server/data/puppetserver]/selrole: Found selrole default 'object_r' for /opt/puppetlabs/server/data/puppetserver
Debug: /File[/opt/puppetlabs/server/data/puppetserver]/seltype: Found seltype default 'usr_t' for /opt/puppetlabs/server/data/puppetserver
Debug: /File[/opt/puppetlabs/server/data/puppetserver]/selrange: Found selrange default 's0' for /opt/puppetlabs/server/data/puppetserver
Debug: /File[/var/log/puppetlabs/puppetserver]/seluser: Found seluser default 'system_u' for /var/log/puppetlabs/puppetserver
Debug: /File[/var/log/puppetlabs/puppetserver]/selrole: Found selrole default 'object_r' for /var/log/puppetlabs/puppetserver
Debug: /File[/var/log/puppetlabs/puppetserver]/seltype: Found seltype default 'var_log_t' for /var/log/puppetlabs/puppetserver
Debug: /File[/var/log/puppetlabs/puppetserver]/selrange: Found selrange default 's0' for /var/log/puppetlabs/puppetserver
Debug: /File[/opt/puppetlabs/server/data/puppetserver/state]/seluser: Found seluser default 'system_u' for /opt/puppetlabs/server/data/puppetserver/state
Debug: /File[/opt/puppetlabs/server/data/puppetserver/state]/selrole: Found selrole default 'object_r' for /opt/puppetlabs/server/data/puppetserver/state
Debug: /File[/opt/puppetlabs/server/data/puppetserver/state]/seltype: Found seltype default 'usr_t' for /opt/puppetlabs/server/data/puppetserver/state
Debug: /File[/opt/puppetlabs/server/data/puppetserver/state]/selrange: Found selrange default 's0' for /opt/puppetlabs/server/data/puppetserver/state
Debug: /File[/var/run/puppetlabs/puppetserver]/seluser: Found seluser default 'system_u' for /var/run/puppetlabs/puppetserver
Debug: /File[/var/run/puppetlabs/puppetserver]/selrole: Found selrole default 'object_r' for /var/run/puppetlabs/puppetserver
Debug: /File[/var/run/puppetlabs/puppetserver]/seltype: Found seltype default 'var_run_t' for /var/run/puppetlabs/puppetserver
Debug: /File[/var/run/puppetlabs/puppetserver]/selrange: Found selrange default 's0' for /var/run/puppetlabs/puppetserver
Debug: /File[/opt/puppetlabs/server/data/puppetserver/lib]/seluser: Found seluser default 'system_u' for /opt/puppetlabs/server/data/puppetserver/lib
Debug: /File[/opt/puppetlabs/server/data/puppetserver/lib]/selrole: Found selrole default 'object_r' for /opt/puppetlabs/server/data/puppetserver/lib
Debug: /File[/opt/puppetlabs/server/data/puppetserver/lib]/seltype: Found seltype default 'lib_t' for /opt/puppetlabs/server/data/puppetserver/lib
Debug: /File[/opt/puppetlabs/server/data/puppetserver/lib]/selrange: Found selrange default 's0' for /opt/puppetlabs/server/data/puppetserver/lib
Debug: /File[/etc/puppetlabs/puppet/hiera.yaml]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/hiera.yaml
Debug: /File[/etc/puppetlabs/puppet/hiera.yaml]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/hiera.yaml
Debug: /File[/etc/puppetlabs/puppet/hiera.yaml]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/hiera.yaml
Debug: /File[/etc/puppetlabs/puppet/hiera.yaml]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/hiera.yaml
Debug: /File[/opt/puppetlabs/server/data/puppetserver/preview]/seluser: Found seluser default 'system_u' for /opt/puppetlabs/server/data/puppetserver/preview
Debug: /File[/opt/puppetlabs/server/data/puppetserver/preview]/selrole: Found selrole default 'object_r' for /opt/puppetlabs/server/data/puppetserver/preview
Debug: /File[/opt/puppetlabs/server/data/puppetserver/preview]/seltype: Found seltype default 'usr_t' for /opt/puppetlabs/server/data/puppetserver/preview
Debug: /File[/opt/puppetlabs/server/data/puppetserver/preview]/selrange: Found selrange default 's0' for /opt/puppetlabs/server/data/puppetserver/preview
Debug: /File[/etc/puppetlabs/puppet/ssl/certs]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/certs
Debug: /File[/etc/puppetlabs/puppet/ssl/certs]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/certs
Debug: /File[/etc/puppetlabs/puppet/ssl/certs]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/certs
Debug: /File[/etc/puppetlabs/puppet/ssl/certs]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/certs
Debug: /File[/etc/puppetlabs/puppet/ssl]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl
...
Debug: /File[/etc/puppetlabs/puppet/ssl/ca]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crt.pem]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/ca_crt.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crt.pem]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/ca_crt.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crt.pem]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/ca_crt.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crt.pem]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/ca_crt.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_key.pem]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/ca_key.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_key.pem]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/ca_key.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_key.pem]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/ca_key.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_key.pem]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/ca_key.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_pub.pem]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/ca_pub.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_pub.pem]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/ca_pub.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_pub.pem]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/ca_pub.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_pub.pem]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/ca_pub.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crl.pem]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/ca_crl.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crl.pem]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/ca_crl.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crl.pem]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/ca_crl.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crl.pem]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/ca_crl.pem
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/private
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/private
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/private
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/private
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/requests]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/requests
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private/ca.pass]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/private/ca.pass
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private/ca.pass]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/private/ca.pass
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private/ca.pass]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/private/ca.pass
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private/ca.pass]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/private/ca.pass
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/serial]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/serial
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/serial]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/serial
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/serial]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/serial
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/serial]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/serial
Debug: /File[/etc/puppetlabs/puppet/autosign.conf]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/autosign.conf
Debug: /File[/etc/puppetlabs/puppet/autosign.conf]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/autosign.conf
Debug: /File[/etc/puppetlabs/puppet/autosign.conf]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/autosign.conf
Debug: /File[/etc/puppetlabs/puppet/autosign.conf]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/autosign.conf
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/inventory.txt]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/puppet/ssl/ca/inventory.txt
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/inventory.txt]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/puppet/ssl/ca/inventory.txt
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/inventory.txt]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/puppet/ssl/ca/inventory.txt
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/inventory.txt]/selrange: Found selrange default 's0' for /etc/puppetlabs/puppet/ssl/ca/inventory.txt
Debug: /File[/opt/puppetlabs/server/data/puppetserver/facts.d]/seluser: Found seluser default 'system_u' for /opt/puppetlabs/server/data/puppetserver/facts.d
Debug: /File[/opt/puppetlabs/server/data/puppetserver/facts.d]/selrole: Found selrole default 'object_r' for /opt/puppetlabs/server/data/puppetserver/facts.d
Debug: /File[/opt/puppetlabs/server/data/puppetserver/facts.d]/seltype: Found seltype default 'usr_t' for /opt/puppetlabs/server/data/puppetserver/facts.d
Debug: /File[/opt/puppetlabs/server/data/puppetserver/facts.d]/selrange: Found selrange default 's0' for /opt/puppetlabs/server/data/puppetserver/facts.d
Debug: /File[/etc/puppetlabs/code/environments/production]/seluser: Found seluser default 'system_u' for /etc/puppetlabs/code/environments/production
Debug: /File[/etc/puppetlabs/code/environments/production]/selrole: Found selrole default 'object_r' for /etc/puppetlabs/code/environments/production
Debug: /File[/etc/puppetlabs/code/environments/production]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppetlabs/code/environments/production
Debug: /File[/etc/puppetlabs/code/environments/production]/selrange: Found selrange default 's0' for /etc/puppetlabs/code/environments/production
Debug: /File[/opt/puppetlabs/server/data/puppetserver/state]: Adding autorequire relationship with File[/opt/puppetlabs/server/data/puppetserver]
Debug: /File[/opt/puppetlabs/server/data/puppetserver/lib]: Adding autorequire relationship with File[/opt/puppetlabs/server/data/puppetserver]
Debug: /File[/etc/puppetlabs/puppet/hiera.yaml]: Adding autorequire relationship with File[/etc/puppetlabs/puppet]
Debug: /File[/opt/puppetlabs/server/data/puppetserver/preview]: Adding autorequire relationship with File[/opt/puppetlabs/server/data/puppetserver]
Debug: /File[/etc/puppetlabs/puppet/ssl/certs]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl]
Debug: /File[/etc/puppetlabs/puppet/ssl]: Adding autorequire relationship with File[/etc/puppetlabs/puppet]
Debug: /File[/etc/puppetlabs/puppet/ssl/public_keys]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl]
Debug: /File[/etc/puppetlabs/puppet/ssl/certificate_requests]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl]
Debug: /File[/etc/puppetlabs/puppet/ssl/private_keys]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl]
Debug: /File[/etc/puppetlabs/puppet/ssl/private]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl]
Debug: /File[/etc/puppetlabs/puppet/ssl/certs/ca.pem]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/certs]
Debug: /File[/etc/puppetlabs/puppet/ssl/crl.pem]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crt.pem]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_key.pem]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_pub.pem]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/ca_crl.pem]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/requests]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/signed]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/private/ca.pass]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca/private]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/serial]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/etc/puppetlabs/puppet/autosign.conf]: Adding autorequire relationship with File[/etc/puppetlabs/puppet]
Debug: /File[/etc/puppetlabs/puppet/ssl/ca/inventory.txt]: Adding autorequire relationship with File[/etc/puppetlabs/puppet/ssl/ca]
Debug: /File[/opt/puppetlabs/server/data/puppetserver/facts.d]: Adding autorequire relationship with File[/opt/puppetlabs/server/data/puppetserver]
Debug: /File[/etc/puppetlabs/code/environments/production]: Adding autorequire relationship with File[/etc/puppetlabs/code]
Debug: Finishing transaction 41879640
Debug: Using cached certificate for ca
Debug: Runtime environment: puppet_version=4.10.9, ruby_version=2.1.9, run_mode=master, default_encoding=UTF-8
Info: Creating a new SSL key for slavepoc2.edc.carrefour.com
Info: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml
Info: Creating a new SSL certificate request for slavepoc2.edc.carrefour.com
Info: Certificate Request fingerprint (SHA256): 07:C3:19:2A:44:0C:6D:3A:75:77:E6:66:E3:3E:C4:27:9D:E3:D5:6F:38:15:59:E1:C5:BD:4B:F3:0D:12:0B:22
Notice: slavepoc2.edc.carrefour.com has a waiting certificate request
Debug: Using cached certificate for ca
Info: authstore: defaulting to no access for slavepoc2.edc.carrefour.com
Debug: Using cached certificate for ca
Debug: Using cached certificate_request for slavepoc2.edc.carrefour.com
Notice: Signed certificate request for slavepoc2.edc.carrefour.com
Notice: Removing file Puppet::SSL::CertificateRequest slavepoc2.edc.carrefour.com at '/etc/puppetlabs/puppet/ssl/ca/requests/slavepoc2.edc.carrefour.com.pem'
Notice: Removing file Puppet::SSL::CertificateRequest slavepoc2.edc.carrefour.com at '/etc/puppetlabs/puppet/ssl/certificate_requests/slavepoc2.edc.carrefour.com.pem'
[root@foreman ludovic_palamede]# puppet cert list -a
+ ""foreman.edc.carrefour.com""   (SHA256) EF:B0:CE:BD:65:3F:6C:7A:CE:92:2C:2C:E4:D2:18:99:57:AD:02:DA:CE:69:1F:C5:7E:51:DE:CC:CF:1F:30:08
+ ""slavepoc2.edc.carrefour.com"" (SHA256) 58:D9:CB:69:8E:0C:B2:01:4E:1F:60:83:79:FD:A3:86:CE:9A:45:64:5F:8E:3A:B1:B7:56:69:95:47:A4:1B:D8
```

from the agent

```bash
[root@slavepoc2 phenix_adm]# /opt/puppetlabs/bin/puppet resource service puppet ensure=running
Notice: /Service[puppet]/ensure: ensure changed 'stopped' to 'running'
service { 'puppet':
  ensure => 'running',
}
[root@slavepoc2 phenix_adm]# /opt/puppetlabs/bin/puppet agent --test
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=foreman.edc.carrefour.com]
Info: Retrieving pluginfacts
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=foreman.edc.carrefour.com]
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=foreman.edc.carrefour.com]
Info: Retrieving plugin
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=foreman.edc.carrefour.com]
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=foreman.edc.carrefour.com]
Error: Could not retrieve catalog from remote server: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=foreman.edc.carrefour.com]
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
Error: Could not send report: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [certificate revoked for /CN=foreman.edc.carrefour.com]
```",Bug,PUP-8296,[],puppet(foreman)server which cannot communicate with agent (vice-versa)
"+Note: the issue does not occur if the service has run at least once within machine up time, regardless whether it is stopped or disabled after that.+

*Steps to reproduce:*
# Disable service that run as NT Service\servicename (e.q. NT Service\SqlIaaSExtension)
# Reboot machine
# Create new group with NT Service\SqlIaaSExtension as member
{code:java}
group { 'testgroup123':
 name => 'testgroup123',
 ensure => present,
 members => ['NT Service\SQLIaaSExtension'],
}
{code}
# Puppet run throws error below
 !image.png|thumbnail! 
",Bug,PUP-8295,[],"Group resource cannot resolve virtual account ""NT Service\Servicename"""
"*Puppet Version:* 5.3.3
*Puppet Server Version:* N/A
*OS Name/Version:* N/A

The Puppet Strings-generated docs for the [{{unique}} function|https://puppet.com/docs/puppet/5.3/function_strings_prefer_v4.html#unique] include a Markdown error resulting in a broken codeblock and formatting.

*Desired Behavior:*

The formatting is correct and the page renders correctly on the docs site.

*Actual Behavior:*

The formatting is wrong and the page renders incorrectly on the docs site.",Bug,PUP-8292,[],Bad Markdown in 'unique' function breaks Strings-generated reference
"Data types with a range min/max should prefer the shortest output when dealing with a value that is {{default}}. For String, Array and Tuple the {{default}} for min is {{0}} and this should be displayed instead of {{default}}. For Integer and Float, the default value is a large value (that users will not recognize as ""min-int"" and ""max-int"" for example - and for those {{default}} should be used instead of numeric output.

Note that {{Tuple}} already uses {{0}}, while {{Array}} and {{String}} does not.",Improvement,PUP-8291,[],Data types with min range should prefer shortest min in string form
"*Puppet Version:* 5.3.3
*Puppet Server Version:* N/A
*OS Name/Version:* N/A

When passing data to a resource that declares a parameter as {{Sensitive}} the value must be manually cast to {{Sensitive}}. Please allow values matching type {{T}} to be automatically cast to values of {{Sensitive\[T]}}.

In particular, this would be helpful for automatic parameters.

Right now {{Sensitive}} is too much of a pain. Automatic casts would remove that cost and allow me to start using it everywhere.

*Desired Behavior:*

{code}
❯ puppet apply -e 'define foo ( Sensitive $p ) { } foo { ""f"": p => ""secret"" }'
Notice: Compiled catalog for marla.local in environment production in 0.02 seconds
Notice: Applied catalog in 0.01 seconds
{code}

*Actual Behavior:*

{code}
❯ puppet apply -e 'define foo ( Sensitive $p ) { } foo { ""f"": p => ""secret"" }' 
Error: Evaluation Error: Error while evaluating a Resource Statement, Foo[f]: parameter 'p' expects a Sensitive value, got String  at line 1 on node marla.local
{code}",Improvement,PUP-8290,[],Allow auto-conversion to Sensitive data type
"*Puppet Version:*
Tested on 4.x and 5.x

*Puppet Server Version:*
tested on 4.x and 5.x

*OS Name/Version:*
All

Using an all numeric environment in puppet causes the following error on the client
Error: Could not initialize global default settings: undefined method `to_sym' for 8675309:Fixnum

If that value is placed within quotes on the client the server returns the following error:
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Error 500 on SERVER: Server Error: undefined method `match' for 8675309:Fixnum
Did you mean?  catch

*Desired Behavior:*
Using an all numeric environment name complies with the regular expression supplied in the documentation.

*Actual Behavior:*
All numeric environment name is not functioning

Please take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.

puppet agent with --test --trace --debug
Error: Could not initialize global default settings: undefined method `to_sym' for 8675309:Fixnum
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:550:in `parse_config'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:597:in `parse_config_files'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:264:in `initialize_global_settings'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:133:in `do_initialize_settings_for_run_mode'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:127:in `initialize_settings'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:67:in `block in execute'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:540:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:66:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'",Bug,PUP-8289,[],All numeric environment names cause error on client and server
"Forked off of PUP-7630, to handle only the issue that overall success is reported when an exception is not caught inside transaction.evaluate.

Actually affects versions as far back as  pup 4.0.0-rc1.",Bug,PUP-8288,[],Exceptions during transaction evaluate reported as success
"There are a bunch of cases where we raise errors that we need to review and look to convert over to decorated I18N strings. Here is a good starting list of places to start looking

* Puppet::ParseError
* Puppet::ResourceError


",Task,PUP-8286,[],i18n review and add decoration to cases where we raise errors as appropriate
"*Puppet Version:* 5.3.3
*Puppet Server Version:* N/A, running agent only
*OS Name/Version:* Ubuntu 16.04

While trying to document what {{puppet filebucket --bucket}}/{{-b}} does, I've noticed some unexpected or inconsistent behavior. If this behavior is by design, it isn't sufficiently explained in any user-facing documentation.

*Steps to reproduce:*

1. Create a test file: {{touch /tmp/testfile}}
2. Back up the file to the local filebucket: {{puppet filebucket -l backup /tmp/testfile}}
3. Back up the same file to a filebucket on a specific path: {{puppet filebucket -b /tmp/testbucket backup /tmp/testfile}}
4. Back up a new file to that same new filebucket: {{touch /tmp/testfile2; puppet filebucket -b /tmp/testbucket backup /tmp/testfile2}}

*Desired Behavior:*

The default local filebucket at /opt/puppetlabs/puppet/cache/bucket contains /tmp/testfile.

Puppet creates a filebucket at /tmp/testbucket, and that filebucket contains /tmp/testfile and /tmp/testfile2.

The documentation explains what --bucket is expected to do.

*Actual Behavior:*

The function and behavior of {{--bucket}} are not documented, so I don't know what the true expected behavior is. It is listed with the flags in the command's help text and man page, but with no context explaining what it does or is expected to do. See also PUP-5206 and PUP-5392.

{code}
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# touch /tmp/testfile
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l backup /tmp/testfile
/tmp/testfile: d41d8cd98f00b204e9800998ecf8427e
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# ls bucket
d
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l list
d41d8cd98f00b204e9800998ecf8427e 2017-12-21 11:55:44 /tmp/testfile
{code}

This is as expected. After backing up the file to the default local filebucket, however, I can't back up the same file to a bucket at a different path, and puppet produces no output suggesting that the file wasn't backed up to the specified bucket path, or why.

The new bucket isn't created, but Puppet doesn't state this, so subsequently running {{puppet filebucket -b /tmp/testbucket list}} fails unexpected with a file not found error:

{code}
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket backup /tmp/testfile
/tmp/testfile: d41d8cd98f00b204e9800998ecf8427e
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# echo $?
0
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket list
Error: Could not run: File not found
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# ls -la /tmp/testbucket
ls: cannot access '/tmp/testbucket': No such file or directory
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l list
d41d8cd98f00b204e9800998ecf8427e 2017-12-21 11:55:44 /tmp/testfile
{code}

But if I back up a file not already in the local filebucket to the specified path, it creates a new filebucket at that path and backs up the file to that filebucket instead of the default local filebucket, which is what I expect would happen:

{code}
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# touch /tmp/testfile2
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket backup /tmp/testfile2
/tmp/testfile2: d41d8cd98f00b204e9800998ecf8427e
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket list
d41d8cd98f00b204e9800998ecf8427e 2017-12-21 12:00:41 /tmp/testfile2
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l list
d41d8cd98f00b204e9800998ecf8427e 2017-12-21 11:55:44 /tmp/testfile
{code}

Furthermore, even when /tmp/testbucket exists, I still can't backup the first /tmp/testfile to it. and Puppet returns a successful result without reporting which bucket received the file. So for all I get back from Puppet, I'd expect /tmp/testfile to be in /tmp/testbucket, but it isn't:

{code}
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket backup /tmp/testfile
/tmp/testfile: d41d8cd98f00b204e9800998ecf8427e
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# echo $?
0
root@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket list
d41d8cd98f00b204e9800998ecf8427e 2017-12-21 12:00:41 /tmp/testfile2
{code}

The above commands produce the same output using {{-b}} or {{--bucket}}.

None of the documentation explains that a new local filebucket can be created by using the {{--bucket}}/{{-b}} flag, a path, and a file not already backed up to the local filebucket.

Also, if the above behavior is not a bug, none of the documentation explains a file already backed up to the default local filebucket can't be backed up to a bucket specified by {{--bucket}}, and the command output doesn't explain that {{--bucket}} was ignored or why, making it difficult to figure out why the file isn't backed up to the specified filebucket.

Adding this ticket as a blocker to PUP-5392 because the suggested fix is to explain how to manage puppetserver's filebucket using {{--bucket}}, but I'm not sure how using {{--bucket}} would consistently work in that context.",Bug,PUP-8285,[],filebucket backup with an alternate bucket may not backup
"*Puppet Version:* Bolt

Puppet Tasks can only accept parameters as JSON. However it should be valid in task metadata to use puppet types that *may* be assignable to JSON like bare {{Hash}}. Puppet seems to be rejecting these

{code}
Error: Failed to load metadata for task example_tasks::hash_get: Task initializer has wrong type, entry 'parameters' entry 'data' entry 'type' expects a Type[Data] value, got Type[Hash] in /Users/adreyer/src/puppetlabs/puppetconf_modules/example_tasks/tasks/hash_get.json
{code}


*Desired Behavior:*

Task metadata that gives parameters types that may be assignable to {{Data}} should be considered valid.

*Actual Behavior:*

Puppet refuses to load tasks that use types which are not assignable to {{Data}} like {{Hash}}
",Bug,PUP-8283,[],Puppet rejects tasks with valid non-Data types like 'Hash'
"*Puppet Version: vendored 
branch = feature_puppet-tasks

Describe your issue in as much detail as possible…
Describe steps to reproduce…

*Desired Behavior:*


*Actual Behavior:
Given the following plan
{code:title=modules/foo/plans/init.pp}
plan foo() {
  notice 'I am the init plan for the foo module'
}
{code}

And I use 'bolt plan show', I get the following.
{code}
[root@p0dv972ia1yz1v1 ~]# bolt plan show --modulepath ~/modules
   (at /usr/local/share/gems/gems/bolt-9.9.afe6bdc/vendored/puppet/lib/puppet.rb:130:in `<module:Puppet>')
Error: The code loaded from /root/modules/foo/plans/init.pp produced plan with the wrong name, expected foo::init, actual foo on node p0dv972ia1yz1v1.delivery.puppetlabs.net
Failure while reading plans
{code}

If I attempt to run this plan it works correctly.  
{code}
[root@p0dv972ia1yz1v1 ~]# bolt plan run foo --modulepath ~/modules
Notice: Scope(<module>/foo/plans/init.pp, 2): I am the init plan
{code}

There is a second related issue where both list_task and list_plan methods return objects that don't remove the {{init}} part of the task and plan names.

",Bug,PUP-8271,[],init plans in bolt do not load correctly from 'bolt plan show'
"Using {{bolt task show}} on the following metadata file results in some strange artifacts
{code}
{
  ""description"": ""Do a thing."",
  ""parameters"": {
    ""foo"": {
      ""description"": ""The foo"",
      ""type"": ""String[1]""
    }
  }
}
{code}

results in

{code}
PARAMETERS:
- foo: String[1, default]
    The foo
{code}

I'm not sure where {{default}} is coming from. It doesn't seem to happen in all the examples I try however.",Bug,PUP-8270,[],PAL task_signature adds 'default' to some type descriptions
"Acceptance test failure https://cinext-jenkinsmaster-enterprise-prod-1.delivery.puppetlabs.net/job/enterprise_pe-orchestrator-client_intn-van-sys_irving/97/SLAVE_LABEL=beaker,TEST_TARGET=centos7-64.mdc-osx1011-64client.a-redhat7-64af-64af-64af,UNEEDED=UNEEDED/testReport/junit/(root)/tests_job/plan_rb/

{code:title=/etc/puppetlabs/code/environments/plan_dakgj3/manifests/site.pp}

site {
  plan { ""plan_dakgj3"":
    nodes       => {
      Node[""v5mxsg11vm4ogwc.delivery.puppetlabs.net""] => Plan::Node_file[""node_file_plan_dakgj3""],
    }
  }
{code}

{code:title=Server_Error}
ndocka1xg1rqbk0.delivery.puppetlabs.net (redhat7-64-1) 15:31:12$ /opt/puppetlabs/client-tools/bin/puppet-job plan --environment plan_dakgj3 --nodes v5mxsg11vm4ogwc.delivery.puppetlabs.net
  Failed to submit plan: puppetlabs.orchestrator/request-failure: Server Error: Evaluation Error: Illegal Resource Type expression, expected result to be a type name, or untitled Resource, got String at /etc/puppetlabs/code/environments/plan_dakgj3/manifests/site.pp:3:3 in environment plan_dakgj3
{code}",Bug,PUP-8269,[],Application management 'plan' not working
Modify the AIO 010_Install.rb step to call beaker's new {{install_from_build_data_url}} method to install puppet-agent on each host. This should work for all supported platforms including those without a package manager. We should add a gem dependency (from the acceptance Gemfile) on beaker-puppet since we're directly relying on methods provided by that gem. Also need to bump our beaker-hostgenerator dependency because we rely on {{packaging_platform}} when installing the package.,Improvement,PUP-8268,[],Install packages using beaker-puppet's puppet5 methods
"Rewrite the following acceptance tasks to leverage beaker subcommands:

{noformat}
rake ci:test:aio
rake ci:test:gem
rake ci:test:git
rake ci:test:quick
{noformat}

We should document what the supported options are for each tasks, e.g. {{SHA}}, {{OPTIONS}}, etc.

This depends on BKR-1268, so we'll need to bump our minimum beaker dependency.",Improvement,PUP-8267,[],Rewrite acceptance rake tasks to leverage beaker subcommand support
"We currently install PDB in [acceptance/suites/pre-suites/foss|https://github.com/puppetlabs/puppetserver/blob/master/acceptance/suites/pre_suite/foss/35_install_pdb.rb] and in [acceptance/suites/tests|https://github.com/puppetlabs/puppetserver/blob/5.1.x/acceptance/suites/tests/00_smoke/puppetdb_integration.rb]. We run both of those at least in our [Smoke Acceptance Tests|https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppetserver/view/all/job/platform_puppetserver_integration-system_no-conditional_smoke-5.1.x/].

The installation method in the pre-suite was meant to test against builds of the 4.x series (PC1) while the method in the tests was meant to test against latest release via the module. The method within the tests is probably the more robust and preferred one, but there may need to be further discussion within the ticket/with QA. ",CI Blocker,PUP-8266,[],Consolidate PDB testing/setup within Puppet acceptance
The {{ExecutionResult}} and {{Target}} data types must be removed from Puppet core or the loader will always find them instead of the types added to boltlib.,Sub-task,PUP-8265,[],Remove ExecutionResult and Target from Puppet core
"I'm not sure how this happens but it's possible to see Schedule and Filebucket resources that are not contained by any class.

I think this might be happening here:

https://github.com/puppetlabs/puppet/blob/5.3.3/lib/puppet/resource/catalog.rb#L321-L332

Here is a snippet of a report where one of these events is skipped:

{code:json}
         ""status"": ""skipped"",
          ""timestamp"": ""2017-12-18T18:00:20.303+00:00"",
          ""resource_type"": ""Schedule"",
          ""resource_title"": ""hourly"",
          ""property"": null,
          ""corrective_change"": false,
          ""new_value"": null,
          ""old_value"": null,
          ""message"": null,
          ""file"": null,
          ""line"": null,
          ""containment_path"": [
            ""Schedule[hourly]""
          ],
          ""containing_class"": null
        },
{code}

These events also show up in the event viewer without a containing class.",Bug,PUP-8264,[],Schedule and Filebucket resources have a null containing class
"*Puppet Version: 5.2*

This ticket addresses the test with inverted logic mentioned in PUP-8225. The test logic is indeed inverted, but does not address the reported bug. The behavior associated with the test is described here.

Describe steps to reproduce…
# get a PE installation set up: ./frankenbuilder 2017.3 --install - -agent
# Set up environments: facter_env, agent_conf_env, master_says_so
## in each environment add 2 files to the manifest:
### {code}file {'/tmp/env_param.txt':                                   
  ensure  => present,                                             
  mode    => '0644',                                                  
  content => $::environment,  
} {code}
### {code} file {'/tmp/env_fact.txt':                                   
  ensure  => present,                                              
  mode    => '0644',                                                 
  content => $facts[""environment""],  
}{code}
# On agent machine: /etc/facter/facts.d/facter_facts.txt:  environment=facter_env
# On agent machine: /etc/puppetlabs/puppet/puppet.conf: environment = agent_conf_env
# Set the environment for this node to 'master_says_so' in PE
# On agent machine {code}puppet agent -t{code}
# view the contents of /tmp/env_fact.txt' and /tmp/env_param.txt
# view the contents of /opt/puppetlabs/puppet/cache/client_data/catalog/<agent>.delivery.puppetlabs.net.json and note the environment value

*Desired Behavior:*
* the contents of /tmp/env_fact.txt are 'facter_env'
* the contents of /tmp/env_param.txt are 'master_says_so'
* the environment value in the .json log referenced in steps to repro is 'master_says_so'

*Actual Behavior:*
* the contents of /tmp/env_fact.txt are 'facter_env'
* the contents of /tmp/env_param.txt are 'facter_env'
* the environment value in the .json log referenced in steps to repro is 'master_says_so'
",Sub-task,PUP-8263,[],environment parameter out of sync with actual environment determined by ENC
"In Puppet 4.10.9, the behavior of non-existent Solaris SMF services changed, and at least one PE customer with a large Solaris install base has reported that this is preventing them from upgrading within the LTS series. 

Previously, non-existent Solaris SMF services reported their state as :stopped, and could be defined as :stopped in Puppet code, to ensure that unwanted services were not running, even if they were not installed. 

In Puppet 4.10.9, this behavior was changed to cause non-existent Solaris SMF services to report a state of :absent. A change like this should probably not be included in our LTS releases. Reverting the commits related to this change should be sufficient to resolve this issue for our customers.  ",Bug,PUP-8262,[],Non-existent Solaris SMF services are no longer defined as :stopped (LTS breaking change)
"In the process of fixing PE-22951, we've had to revert a bunch of code related to the Solaris SMF provider, including a commit which consolidated the SMF acceptance tests for efficiency:

https://github.com/puppetlabs/puppet/commit/b539fe581f372514e28f4c7e095d81dc8b0f500c

Once PE-22951 is fixed, this ticket is to track the work of re-consolidating those SMF tests that were split up again when reverting the above commit. ",Improvement,PUP-8261,"['solaris', 'testing', 'triaged']",Restore refactored Solaris SMF acceptance tests to consolidate them
"I have a custom type called registry_key with an eval_generate method which can purge values.  The resource types created by eval_generate are {{registry_value}} which is now a type with compound namevars.  When creating an instance of the type, it is required to pass a title (compound namevar types appear to need _something_ simple as a resource key)

This is fine and all works ok.... however in a proper puppet run the generated resources do not appear in the catalog correctly.

I've tracked it down to:
https://github.com/puppetlabs/puppet/blob/master/lib/puppet/transaction/additional_resource_generator.rb#L66

{code}
 made = Hash[generated.map(&:name).zip(generated)]
{code}

It appears that this code takes each resources :name method and does ""something"" with it.  The issue becomes that the compound namevar types return `nil` for it's name which then screws up the catalog.

After digging into the Puppet::Type type I found a commit (https://github.com/puppetlabs/puppet/commit/607d7c6afec7ab73203382676cc98b6d52898e1d) from Luke back in 2006 which was converting the Puppet::Type name method into title.  It appears that additional_resource_generator.rb was never updated to reflect this.

Also there are quotes in the code from that commit
{code}
+    # For now, leave the 'name' method functioning like it used to.  Once 'title'
+    # works everywhere, I'll switch it.
{code}
Currently:
https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type.rb#L2535-L2543

Would it be safe to switch it now after 12 years?

",Bug,PUP-8260,[],Using eval_generate with a compound name_vars without a name appears to not work
"If invalid metadata is found, {{list_tasks}} will throw an exception. We'd like to be able to log tasks that have invalid metadata (in a more controlled method, i.e. catch the exception and print a summary) while still presenting a list of valid tasks. With the current implementation of {{list_tasks}} we can't do that.",Bug,PUP-8259,[],PAL list_tasks doesn't return useful results unless all task metadata is valid
"When using the following configuration options together:

{code}
[agent]
use_cached_catalog = true
noop = true
{code}

Cached catalogs settings are ignored and a new catalog is compiled every run.  It is desirable to use both of these items together if you are controlling the rollout of changes (cached catalogs) and having to do so during change windows (noop); but still want the ability to remediate drift against the original catalog (cached catalogs; `puppet agent -t`).  

",Bug,PUP-8258,[],Cached catalogs settings are ignored if noop is set to true
"As mentioned in PUP-4866 & PUP-6152, there is [support for using long file names|https://msdn.microsoft.com/en-us/library/aa365247(v=vs.85).aspx#maxpath] greater than 260 characters in Windows by using the ""\\?\"" prefix.

Unfortunately, this doesn't quite work with Ruby's normal file path handling, as it also uses ""/"" on Windows as the path separator, and this needs to be converted to ""\"" for the ""\\?\"" prefix to work. Because of the requirement to translate ""/"" to ""\"" on the final file path for the ""\\?\"" LFN prefix to work, we should probably be putting the LFN support directly in to {{Puppet::FileSystem::Windows}}, and making sure that we are not using the native Ruby file path handling methods (Eg: {{File.expand_path}}, {{File.join}}, etc.) anywhere, and are using the {{Puppet::FileSystem}} versions instead.",Bug,PUP-8257,['windows'],Puppet::FileSystem::Windows should support LFN
"I cannot generate and sign an agent to integrate it to foreman. Why ?
here is the generating :
Debug: /File[/etc/puppetlabs/code/environments/production]: Adding autorequire relationship with File[/etc/puppetlabs/code]
Debug: Finishing transaction 27127840
Debug: Using cached certificate for ca
Debug: Runtime environment: puppet_version=4.10.9, ruby_version=2.1.9, run_mode=master, default_encoding=UTF-8
Info: Creating a new SSL key for slavepoc.edc
Info: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml
Info: Creating a new SSL certificate request for slavepoc.edc.
Info: Certificate Request fingerprint (SHA256): 17:EE:1C:9B:F5:9D:2A:80:23:F5:31:77:32:20:19:57:4E:7C:DB:8F:B9:6D:67:A6:B0:33:F1:36:A7:FD:63:85
Notice: slavepoc.edc. has a waiting certificate request
Debug: Using cached certificate for ca
Info: authstore: defaulting to no access for slavepoc
Debug: Using cached certificate for ca
Debug: Using cached certificate_request for slavepoc.edc
Notice: Signed certificate request for slavepoc.edc
Notice: Removing file Puppet::SSL::CertificateRequest slavepoc.edc at '/etc/puppetlabs/puppe.pem t/ssl/ca/requests/slavepoc.edc.pem'
Notice: Removing file Puppet::SSL::CertificateRequest slavepoc.edc at '/etc/puppetlabs/puppet/ssl/certificate_requests/slavepoc.edc.pem'


and Here the signing :
[root@foreman ludovic_palamede]# puppet cert sign slavepoc.edc
Error: Could not find CSR for: ""slavepoc.edc"".

The agent cannot ",Bug,PUP-8256,[],automatically removing my cert after generating it
"The format of {{gem list --local}} changed with the recent Rubygems 2.7.0 release. It now indicates default Gems, which looks like this:

{noformat}
$ gem list --local

*** LOCAL GEMS ***

bigdecimal (default: 1.2.8)
bundler (default: 1.16.0, 1.15.1)
deep_merge (1.0.1)
did_you_mean (1.0.0)
...
{noformat}

This confuses the {{gem}} package provider as it now views the string {{default:}} as part of the version number. Puppet then tries to install the desired version on every Puppet agent run (for example when using the puppetlabs-ruby module):

{noformat}
Notice: /Stage[main]/Ruby::Dev/Package[bundler]/ensure: ensure changed ['default:', '1.15.1'] to '1.16.0'
{noformat}

I have implemented a naive fix for this in https://github.com/antaflos/puppet/commit/4edfeeb9a8f2546539b1c9f544440a5d30d9f55a but I am not sure if this change in Rubygems has any other implications and if my fix for this is good enough.

For reference, this is the output of {{gem env}} on an affected node:

{noformat}
RubyGems Environment:
  - RUBYGEMS VERSION: 2.7.3
  - RUBY VERSION: 2.3.1 (2016-04-26 patchlevel 112) [x86_64-linux-gnu]
  - INSTALLATION DIRECTORY: /var/lib/gems/2.3.0
  - USER INSTALLATION DIRECTORY: /home/ant/.gem/ruby/2.3.0
  - RUBY EXECUTABLE: /usr/bin/ruby2.3
  - EXECUTABLE DIRECTORY: /usr/local/bin
  - SPEC CACHE DIRECTORY: /home/ant/.gem/specs
  - SYSTEM CONFIGURATION DIRECTORY: /etc
  - RUBYGEMS PLATFORMS:
    - ruby
    - x86_64-linux
  - GEM PATHS:
     - /var/lib/gems/2.3.0
     - /home/ant/.gem/ruby/2.3.0
     - /usr/lib/x86_64-linux-gnu/rubygems-integration/2.3.0
     - /usr/share/rubygems-integration/2.3.0
     - /usr/share/rubygems-integration/all
  - GEM CONFIGURATION:
     - :update_sources => true
     - :verbose => true
     - :backtrace => false
     - :bulk_threshold => 1000
  - SHELL PATH:
     - /usr/local/sbin
     - /usr/local/bin
     - /usr/sbin
     - /usr/bin
     - /sbin
     - /bin
     - /snap/bin
{noformat}",Bug,PUP-8255,[],gem package provider broken with Rubygems 2.7.x
"It has been requested that we keep decorate sentences for translation. This means that paragraphs, multiple sentences, should be separate decorated sentences that are joined together.",Task,PUP-8254,[],Split paragraphs into sentences for translation
"Trying to use {{ExecutionResult#ok_nodes}} or {{error_nodes}}, or call {{TypeFactory.error.instance?}} directly to check for an error result, results in an error
{code}
NoMethodError: undefined method `module_for_type' for nil:NilClass
  /bolt/vendored/puppet/lib/puppet/pops/types/p_object_type_extension.rb:27:in `create'
  /bolt/vendored/puppet/lib/puppet/pops/types/puppet_object.rb:18:in `_pcore_type'
  /bolt/vendored/puppet/lib/puppet/pops/types/type_calculator.rb:512:in `infer_Object'
  /bolt/vendored/puppet/lib/puppet/pops/visitor.rb:48:in `block in visit_this'
  /bolt/vendored/puppet/lib/puppet/pops/visitor.rb:42:in `each'
  /bolt/vendored/puppet/lib/puppet/pops/visitor.rb:42:in `visit_this'
  /bolt/vendored/puppet/lib/puppet/pops/visitor.rb:82:in `visit_this_0'
  /bolt/vendored/puppet/lib/puppet/pops/types/type_calculator.rb:252:in `infer'
  /bolt/vendored/puppet/lib/puppet/pops/types/type_calculator.rb:271:in `infer_set'
  /bolt/vendored/puppet/lib/puppet/pops/types/iterable.rb:77:in `block in on'
  /bolt/vendored/puppet/lib/puppet/pops/types/iterable.rb:77:in `map'
  /bolt/vendored/puppet/lib/puppet/pops/types/iterable.rb:77:in `on'
  /bolt/vendored/puppet/lib/puppet/pops/types/execution_result.rb:72:in `iterator'
  /bolt/lib/bolt/outputter.rb:21:in `unwrap_execution_result'
...
{code}
unless I call it from within a script_compiler (via PAL). That seems like it shouldn't be necessary.",Bug,PUP-8253,[],Should be possible to separate errors from ok results in ExecutionResult without compiler
As part of the PUP-8131 the translation string used by the i18n test tests/i18n/check_puppet_run_message.rb was updated. Part of the test was disabled so that it wouldn't fail. Until the translation string can be updated and the test appropriately updated.,Task,PUP-8252,[],re-enable i18n test after translation updated for 5.3.4 release
"We are using puppet to manage resources in the cloud. Our setup is build in such a way that we use puppet apply for each unique project that we manage. The runs happen from a small pool of machines.

We now like to use the power of PuppetDB and therefore have added the necessary puppetdb configuration: 
- a puppetdb.conf in the puppet configuration dir that points to the puppetdb server
- added the --storeconfigs parameter to the puppet apply command
- added the --node_name_value parameter to give each puppet apply its own unique name and able to reuse the node's certificate without having to create a certificate for each unique apply.

So far so good, the PuppetDB integration works and I am able to do puppetdb_query's from within my puppetcode.

However, I noticed an issue with our custom facts. Whenever I tried to update or add/remove a fact after the first run with storeconfigs enabled, it won't work. In puppetdb I can see the facts, but they are not modified after a run.
I've tried to setup a routes.yaml (but I guess that doesn't work because this is masterless) and I tried setting --facts_terminus=puppetdb but that didn't help either.

Is this setup supported and if so, am I missing something?
",Bug,PUP-8251,[],Custom facts not updated/added when running puppet apply with node_name_value and storeconfigs
"When we execute a long running command through a puppet exec, with logoutput set to 'true', it is buffering the output of the command that is executed. For example, when we run 'terraform apply' in a puppet Exec statement, terraform regularly prints ""still creating... 1m"" and counts. That output is displayed on the screen only when the whole exec-command is completed, and not printed in between.

It would be really nice if it would be an option, or a default when this logoutput would be printed when received, in stead of at the end of the execution.",Improvement,PUP-8250,[],Do not buffer output of Exec commands
"If you load the eputnam-i18ndemo module which has a fact that causes and error that has a Japanese translation, when its run on OSX the error is replaced by ""invalid byte sequence in US-ASCII""

{code}
xh734nh8owpuouo:~ root# puppet module install eputnam-i18ndemo
Notice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...
Notice: Downloading from https://forgeapi.puppet.com ...
Notice: Installing -- do not interrupt ...
/etc/puppetlabs/code/environments/production/modules
└─┬ eputnam-i18ndemo (v0.2.0)
  ├── puppetlabs-stdlib (v4.21.0)
  └── puppetlabs-translate (v1.1.0)
xh734nh8owpuouo:~ root# LANGUAGE=ja_JP puppet facts
Error: Facter: error while resolving custom fact ""i18ndemo_fact"": invalid byte sequence in US-ASCII
{code}

Instead of the expected Japanese string (which should look like this pattern)

{code}
        assert_match(/Error:.*eputnam-i18ndemo fact: これはeputnam-i18ndemoからのカスタムファクトからのレイズです/, result.stderr, 'missing translation for raise from ruby fact')
{code}

This also appears, for example, on the Japanese Windows pooler image. If you install the module, then attempt to uninstall it, the uninstall will fail with a similar error, and a trace like the one in the comments.",Bug,PUP-8249,[],"Certain environments return ""invalid byte sequence in <locale>"" when parsing module PO files"
"Amazon Linux 2017.12 is based on el-7, and we'll be using our el-7 packages for this platform rather than creating a separate one. The os.name fact returns ""Amazon"" for this platform, and we need to set systemd as the default puppet service provider for this platform.",New Feature,PUP-8248,[],Make systemd the default service provider for Amazon Linux 2017.12
"The Puppet::Pops::Parser::Locator attempts to cache line location information, but it ends up calling local variables {{prev_line}} etc that shadow the accessor methods of the same name.

Even after fixing the code, e.g.

{code:ruby}
        self.prev_offset = offset
        self.prev_line = line_nbr
{code}

The caching mechanism does not appear to work even when using unlimited environment timeouts. Given a manifest:

{code:puppet}
file { '/tmp/testing':
  ensure => present,
}
{code}

I get the following instrumented output which shows it keeps getting cache misses:

{noformat}
Debug: Evaluating match for Route /.*/
Notice: Locator cache miss offset=25 => line number=2
Notice: Locator cache miss offset=0 => line number=1
Notice: Compiled catalog for localhost in environment production in 0.00 seconds
{noformat}

This ticket is to fix the cache implementation and add tests that it works. Currently the Locator unit tests only show that it can handle multibyte input.

Second issue is we seem to collect locator information for puppet data types on every request. Since those are immutable, why not do that once and freeze the results for the lifetime of the process?

{noformat}
Notice: Locator string=Annotation, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Any, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::CatalogEntryType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::NumericType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::NumericType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::CollectionType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::StructElement, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::CollectionType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::CatalogEntryType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false
Notice: Locator string=Puppet::Resource::Param, file=, index=, char_offsets=false
Notice: Locator string=Puppet::Resource::Param, file=, index=, char_offsets=false
Notice: Locator string=Any, file=, index=, char_offsets=false
Notice: Locator string=RichDataKey, file=, index=, char_offsets=false
Notice: Locator string=RichData, file=, index=, char_offsets=false
{noformat}",Bug,PUP-8247,[],Parser locator doesn't cache anything and doesn't appear to work.
"This ticket is a result of PUP-7482.

Puppet does not allow callers to specify which CA certs should be trusted when making SSL connections (see PUP-5069). As a result, there are three places where we create SSL connections, and configure the {{X509::Store}}:

{noformat}
1. puppet/network/http/factory
2. puppet/util/http_proxy
3. puppet/forge/repository
{noformat}

There are several inconsistencies as a result:

1. persistent connections are used for 1, but not 2
2. We send ""Ruby"" as the user-agent for 2
3. We don't send the X-PUPPET-VERSION header for 2
4. 1 and 2 handle proxy settings differently.",Task,PUP-8246,[],Consolidate http client connection implementations
"Trying to require puppet_pal fails because it uses ruby 2 syntax:

{noformat}
bx ruby -e ""require 'puppet_pal'""
-e:1:in `require': /Users/josh/work/puppet/lib/puppet_pal.rb:501: syntax error, unexpected tLABEL, expecting ')' (SyntaxError)
      configured_by_env: false,
                        ^
/Users/josh/work/puppet/lib/puppet_pal.rb:501: Can't assign to false
/Users/josh/work/puppet/lib/puppet_pal.rb:502: Can't assign to nil
/Users/josh/work/puppet/lib/puppet_pal.rb:503: Can't assign to nil
/Users/josh/work/puppet/lib/puppet_pal.rb:504: Can't assign to nil
/Users/josh/work/puppet/lib/puppet_pal.rb:505: Can't assign to nil
/Users/josh/work/puppet/lib/puppet_pal.rb:584: syntax error, unexpected tLABEL
      modulepath:    [],
                 ^
/Users/josh/work/puppet/lib/puppet_pal.rb:586: Can't assign to nil
/Users/josh/work/puppet/lib/puppet_pal.rb:631: syntax error, unexpected tLABEL
      modulepath:    nil,
                 ^
/Users/josh/work/puppet/lib/puppet_pal.rb:631: Can't assign to nil
	from -e:1:in `<main>'
{noformat}",Bug,PUP-8245,[],puppet pal doesn't support ruby 1.9
PUP-8225 could have been avoided if the Lint/UselessAssignment rubocop check was enabled. We should enable the check and fix whatever warnings/errors are generated.,Task,PUP-8244,[],Enable Lint/UselessAssignment rubocop check
"See additional details in MODULES-1996 / PUP-6447.


The basic gist is that internal calls to {{read}}, like the one made by template loading with {{Puppet::FileSystem.read_preserve_line_endings}}, do not specify the ""allow bom"" flag when reading UTF-8 files.

This should be a straightforward addition that allows templates (for instance PowerShell templates that were once PS1 files created by PowerShell ISE that have a leading BOM) to properly remove the leading BOM.",Improvement,PUP-8243,"['utf-8', 'windows']",Allow ERB templates to be tolerant of a leading BOM
"The {{COMMITTERS.md}}, and {{CONTRIBUTING.md}} documents are very out of date. We should review them to remove dead links, and to update it with what the current practice & expectations are.",Task,PUP-8241,[],Update contributor documents
"Via [~williams.geoff] on DOCUMENT-779:

*expected result*

When applying a puppet manifest and its EPP template using CRLF line endings to generate a file, the generated file should also use CRLF line endings.

When using a CRLF escape sequence in ERB or EPP templates ({{\r\n}}), Puppet should replace the sequence with a CRLF line ending in the generated file.

This is documented at [Handling line endings on Resource tips and Examples: File on Windows|https://puppet.com/docs/puppet/5.3/resources_file_windows.html#handling-line-endings]:

* If a file resource uses the content or source attributes, Puppet will write the file in “binary” mode, using whatever line endings are present in the content.
** If the manifest, template, or source file is saved with CRLF line endings, Puppet will use those endings in the destination file.
** If the manifest, template, or source file is saved with LF line endings, you can use the {{\r\n}} escape sequence to create literal CRLFs.

*actual result*

Following the instructions produces one long line of text instead of text with CRLF line breaks, and {{\r\n}} appears literally in the output instead of being replaced with a CRLF line break.

*test case*

test.pp:

{code}
file { ""c:/test.txt"":
  content => epp(""c:/test.epp"")
}
{code}

test.epp:

{code}
line 1
line 2
:P
{code}

test.txt (result)

{code}
line 1line 2:P
{code}

Files were created in notepad to get the line endings. See the attachment.

Escape codes in the template:

test.epp:

{code}
line 1\r\n
line 2\r\n
:P\r\n
{code}

test.txt output:

{code}
line 1\r\nline 2\r\n:P\r\n
{code}

How to run testcase (save to c:\):

{code}
puppet apply c:\test.pp
{code}

*workaround*
Traditional *erb* templates' {{template()}} handle CRLF line endings as documented and expected, although these also result in literal {{\r\n}} in the output, which still conflicts with the documentation.",Bug,PUP-8240,[],ERB and EPP templates handle CRLF line endings inconsistently
,Sub-task,PUP-8239,[],Add description of Error data type to Puppet specifications
Cannot find any specification for the key/value data types for hiera and the older deprecated aliases. Please add those to the specifications repo.,Improvement,PUP-8238,[],Update lang spec with RichDataKey (and the LookupKey and LookupValue aliases)
"It is of value to be able to get to the current compiler in a function in a way that is defined by an API. Currently, the compiler is typically obtained by calling {{compiler}} on {{scope}}, but this is not good (for many reasons).

We should support this the same way as injection of closure scope is handled; by allowing the compiler to be injected as a parameter. We have the need for three different such injections:

* compiler_param - any compiler is ok
* script_compiler_param - only script compiler is ok
* catalog_compiler_param - only catalog (classic) compiler is ok

Those should be supported on a regular function (i.e. not require 'internal function' type).

When used, the current compiler should be obtained from the puppet context, and if it does not match the expected kind of compiler a relevant error should be raised (""Only available when"":  ""compiling a catalog"", ""evaluating scripts"").

As a follow on, all functions that use {{scope.compiler}} should be modified to use this mechanism.

(The specification of the 4.x function API also needs to be updated).
",Improvement,PUP-8237,[],Add injection of compiler in function API
,Task,PUP-8236,[],drop feature branch from github
"When calling any of the logging functions they output information about the scope the call to log came from. When compiling a catalog the scope information is the name of the resource (class, define), but when running tasks there is no such resource - scope will instead use the path to the file where the logging call takes place. 

Those paths can be quite long and clutters the output (makes it hard to read). The logic already shortens paths that are ""in the environment"", but should also do that for paths into a module.

See TODO comment in {{Scope.to_s}}",Improvement,PUP-8235,[],When running with --tasks Scope.to_s should shorten paths to modules
"I've been very unseccesful in attempting to unit test a module that includes a hiera-eyaml data source defined in my layer 3 hiera.yaml defined hierarchy.

I've tried overriding the EYAML_CONFIG, configurign rspec `hiera_config`  to use a different hiera.yaml in my test fixture, providing facts/params values directly in my .spec, and even providing a dockerized environment complete with fake keys in an attempt to replicate the conditions of all real environemnts in a a way that unit testing can be done.

It seems that when it comes to overrides, nothing is capable of overriding the data-sources defined in the modules `hiera.yaml`.  This means that any data source which relies on the puppetserver will basically make unit testing impossible.

I've opened issues in both rspec-puppet and hiera-eyaml, but it's likely the heart of this problem may rest in puppet core language, so I'm opening an issue here as well.

Here are the issues opened with rspec-puppet and hiera-eyaml:
- https://github.com/voxpupuli/hiera-eyaml/issues/253 (Impossible to test puppet 5 module with layer 3 eyaml data sources)
- https://github.com/voxpupuli/hiera-eyaml/issues/252
- https://github.com/rodjek/rspec-puppet/issues/626 (hiera_config doesn't override puppet 5 layer 3 `hiera.yaml`)",Bug,PUP-8234,[],layer 3 data sources can not be overriden for unit testing purposes
"Right now we have this great set of utilities for selinux at lib/puppet/util/selinux.rb, and they have some default information. But lib/puppet/type/file/selcontext.rb uses it's own utility to find defaults. We should move that into the util file so we can use it elsewhere as well.

https://github.com/puppetlabs/puppet/blob/51636c065e0625b32af2cd98f2060eb7428704f5/lib/puppet/type/file/selcontext.rb#L40

Namely, we should be able to take advantage of this code in other types that include selinux, like 5klogin.",Task,PUP-8233,['selinux'],Add ability to retrieve default context to util/selinux.rb
"This ticket tracks the agent-side work of PUP-7779 ""Re-implement `puppet facts upload`"".

In order to allow facts to be uploaded from the agent to the server, we need to re-add two components that were removed in Puppet 4.0 as part of PUP-2560:

  - The {{Puppet::Node::Facts::Rest}} indirector terminus which translates {{save}} requests for facts into REST API calls that send a PUT payload to the Puppet Server.

  - The {{upload}} action of the {{puppet facts}} face. This action loads facts from the {{facter}} terminus and then saves then using the {{rest}} terminus.

Out of scope:

The implementation removed in PUP-2560 included some settings related to the ""inventory service"". These settings should not be restored and {{puppet facts upload}} should instead the server specified by the {{agent}} section of puppet.conf.",Improvement,PUP-8232,[],Re-add the puppet facts upload face and REST facts terminus
"Steps to reproduce

1. Create Group ""TestGroup"" with ""IIS AppPool\DefaultAppPool"" as a member
{code}group { 'TestGroup':
    name            => 'TestGroup',
    ensure          => present,
    members         => ['IIS AppPool\DefaultAppPool'],
    auth_membership => false,
}
{code}
2. Re-run the same manifest
{code}group { 'TestGroup':
    name            => 'TestGroup',
    ensure          => present,
    members         => ['IIS AppPool\DefaultAppPool'],
    auth_membership => false,
}
{code}
3. Once the group exists on the system, Puppet fails to resolve the virtual account properly and generates an error like:
{code}""Could not resolve name: DefaultAppPool""{code}",Bug,PUP-8231,['customer-escalation'],Managing an existing Windows Group resource may error when any of its members is a virtual account (like IIS AppPool\DefaultAppPool or NT Service\Dhcp)
Making https://docs.google.com/a/puppet.com/spreadsheets/d/1WlxG0-pVDK3LqlPHhzI8yuZFmwlioTvEEtIL3EBEhRI/edit?usp=sharing a reality.,Epic,PUP-8230,[],Puppet Platform Release Process Improvements
"One of the [commits for PUP-7864|https://github.com/puppetlabs/puppet/commit/2bc0bb869914cb33aa0078c3f9fe1fddaaefe16c] caused a regression in the puppet system loader because it assumed that 'puppet/lib' would always be reachable using 'lib'. The regression was caught in acceptance tests where the 'puppet/lib' folder is renamed to 'site_ruby'.
",Bug,PUP-8229,[],Regression in Puppet system loader
"Sometime after Nov 27, a change was made that has broken puppet-agent CI acceptance testing on our 1.10.x branch. All tests which require puppetserver (2.8.0) are failing for all platforms. This is due to the fact that puppetserver is not able to start. For example, on an Ubuntu 16.04 host, the error is:

{noformat}
04:54:27 jdty96b8eu51icu.delivery.puppetlabs.net (redhat7-64-1) 12:54:27$ puppet resource service puppetserver ensure=running
04:54:27   Error: Systemd start for puppetserver failed!
04:55:00   journalctl log for puppetserver:
04:55:00   -- Logs begin at Sat 2017-12-02 02:16:24 PST, end at Sat 2017-12-02 04:55:00 PST. --
04:55:00   Dec 02 04:54:28 jdty96b8eu51icu systemd[1]: Starting puppetserver Service...
04:55:00   Dec 02 04:54:28 jdty96b8eu51icu puppetserver[10248]: OpenJDK 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0
04:55:00   Dec 02 04:54:59 jdty96b8eu51icu puppetserver[10248]: ArgumentError: wrong number of arguments calling `push_application_context` (1 for 2)
04:55:00   Dec 02 04:54:59 jdty96b8eu51icu puppetserver[10248]: initialize_puppet at file:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppetserver-lib/puppet/server/puppet_config.rb:44
04:55:00   Dec 02 04:54:59 jdty96b8eu51icu puppetserver[10248]: initialize at file:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppetserver-lib/puppet/server/master.rb:29
{noformat}

Full console output from that build can be found at:

https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/1.10.x/view/Suite/job/platform_puppet-agent_puppet-agent-integration-suite_daily-1.10.x/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=ubuntu1604-64a/39/consoleFull

",CI Blocker,PUP-8228,[],puppetserver 2.8.0 fails to start  - wrong number of arguments calling `push_application_context`
"Enforcing change using ""puppet resource"" or ""puppet apply"" causes the transactionstore.yaml file to be overwritten. This is often done as part of our integrations plus is common puppet usage among customers. The loss of the tx store mans that corrective change is not correctly identified on the run immediately afterwards. The next run causes the agent to restore the tx store again.

Step 1 - After a run the tx store looks as expected
!step1-after-puppet-run-the-txstore-looks-good.png|thumbnail!
Step 2 - Enforce a change with puppet resource and the tx store is overwritten
!step2-puppet-resource-enforcement-overwrites-txstore.png|thumbnail!
Step 3 - The next agent run restores the expected tx store
!step3-agreen-run-restores-txstore.png|thumbnail!
Step 4 - Same issue using puppet apply, also doesn't matter if the enforcement succeeds or fails
!step4-puppet-apply-breaks-too.png|thumbnail!

The proposed fix is to modify the agent to load and store the transaction file only for agent runs, not puppet resource/apply, and consider making that behaviour configurable. We should also document that if you use ""puppet resource"" to modify a resource that is also managed by the agent, this is considered an out-of-band change and reported as corrective (e.g. agent creates file foo, user removes file foo using ""puppet resource"", agent recreates file foo and considers it a corrective change).

Here's the original description explaining how this manifests in the wild.

{quote}
Just had this happen during demo of 2017.3.0. I have a simple apache role with profiles and demo drift remediation by removing the index.html and having puppet heal it.

https://github.com/puppetlabs/puppet-vro-starter_content/blob/production/site/profile/manifests/sample_website/linux.pp#L36-L39

But on the first noop run, it shows that ""intentional changes"" would be needed, and then enforcement shows ""intentional changes"". When I did the same thing again, it showed ""corrective changes"". Baffling. Also, the node graph did not update with colors representing corrective or intentional change (separate ticket coming).

!Screen Shot 2017-10-19 at 8.34.57 AM.png|thumbnail!

explanation of above:
* first run (bottom) is initial provisioning (intentional change makes sense)
* second run is green, (no changes makes sense)
* third run is after I executed {{rm -f /var/www/sample_website/index.html}} in an ssh session on the target machine. Shows intentional noop changes needed! Should be corrective noop!
* fourth run is intentional change, wrong, should be corrective.
* fifth run is after I executed {{rm -f /var/www/sample_website/index.html}} again. Got corrective noop this time, which is correct.
* sixth run is enforcement of corrective change, which is correct.
{quote}",Bug,PUP-8227,[],Enforcement via 'puppet resource/apply' overwrites transactionstore.yaml
"Puppet 5 fixed an issue where stale facts were used for catalog requests if a master had a cold cache (PUP-3438 and PUP-7198). The fix was to merge facts submitted by the agent back into the node object instead of pulling facts from the cache. However, the merge is overwriting the environment returned by the ENC, which causes nodes to behave incorrectly if an {{environment}} fact is present.

h2. Reproduction Case

 - Install PE 2017.3.2.

 - Log into the PE console and verify that the classifier sets the master node environment to {{production}} via the ""Production environment"" Environment Group.

 - Copy the production environment to a new directory environment called {{facter_env}}:

{code:bash}
cp -r /etc/puppetlabs/code/environments/production /etc/puppetlabs/code/environments/facter_env
chown -R pe-puppet /etc/puppetlabs/code/
{code}

 - Set {{environment}} and as an external fact:

{code:bash}
mkdir -p /etc/facter/facts.d

cat << 'EOF' > /etc/facter/facts.d/facter_facts.txt
environment=facter_env
EOF
{code}

  - Run {{puppet agent -t}}

h3. Outcome

The agent switches to {{facter_env}} despite the ENC setting:

{noformat}
[root@pe-201732-master production]# puppet agent -t
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for pe-201732-master.puppetdebug.vlan

Notice: Local environment: 'production' doesn't match server specified environment 'facter_env', restarting agent run with environment 'facter_env'

Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for pe-201732-master.puppetdebug.vlan
Info: Applying configuration version '1512410109'
Notice: Applied catalog in 13.11 seconds
{noformat}

h3. Expected Outcome

The agent should stay in production:

{noformat}
[root@pe-201732-master production]# puppet agent -t

Info: Using configured environment 'production'

Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for pe-201732-master.puppetdebug.vlan
Info: Applying configuration version '1512409900'
Notice: Applied catalog in 12.26 seconds
{noformat}",Bug,PUP-8225,[],"An ""environment"" fact will overwrite values from the ENC in Puppet 5"
"Using these commands, ""puppet certificate find"" actually appears to be trying to retrieve the fqdn certificate. The generate works as expected and the cert cn=cwood123 is available for signing at the puppet CA.

puppet certificate generate --ca-location remote --ca_server puppetmaster2.mydomain.com cwood123

puppet certificate find --ca-location remote --ca_server puppetmaster2.mydomain.com cwood123

With --debug output on the second command, I see the following right before the ""does not match the agent's private key"" error which seems odd.


Debug: Finishing transaction 19331580
Info: Creating a new SSL key for myhost.mydomain.com
Debug: Using cached certificate for ca
Debug: Creating new connection for https://puppetmaster2.mydomain.com:8140
Info: Caching certificate for myhost.mydomain.com
",Bug,PUP-8224,[],puppet certificate find ignores requested cert name
"The user and group resources do not use local commands when modifying a user or group.  This can result in failure to make changes to locally added user or groups if that user or group already exists in LDAP.

Example error:
{noformat}
2017-11-21 09:19:49 -0500 Puppet (err): Could not set gid on group[munge]: Execution of '/usr/sbin/groupmod -g 73 munge' returned 4: groupmod: GID '73' already exists
2017-11-21 09:19:49 -0500 /Stage[main]/Munge::User/Group[munge]/gid (err): change from 486 to 73 failed: Could not set gid on group[munge]: Execution of '/usr/sbin/groupmod -g 73 munge' returned 4: groupmod: GID '73' already exists
{noformat}

Using lgroupmod on this particular system was only way to allow Puppet to continue to function.

{noformat}
lgroupmod -g 73 munge
{noformat}

This issue presented itself when Puppet was told to set munge UID/GID after the package had already auto-created the user/group with different UID/GID.  The module that adds the user/group uses forcelocal=>true

https://github.com/treydock/puppet-munge/blob/master/manifests/user.pp

I propose that both user and group resources respect forcelocal for all types of operations.
",Improvement,PUP-8223,['Community'],User and group modifications should respect forcelocal
"Been using Puppet for ~ 5 years now.  Had a user come up and ask me something that I didn't think twice about.   They asked where the time stamps were for each thing puppet was doing.  

Lo and behold, I can't find timestamps on the things Puppet is doing.  We can see timestamps for the report time, time stamps for some notices, and time stamps in event viewer, by beyond that, no other time stamps (like if you ran puppet manually).   The event viewer helps, but I figured if it can create a timestamp of when each action is occurring, that Puppet itself should be able to do the same.   

I mentioned this to a few people on #windows in slack, and they agreed it would be a nice auditing feature to have.  

Maybe something like this:

{code:java}
Debug: Checking the existence of registry value: Registry_value[HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters\Type](provider=registry)
Debug: Checking the existence of registry value: Registry_value[HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Config\AnnounceFlags](provider=registry)
Debug: Checking the existence of registry value: Registry_value[HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient\SpecialPollInterval](provider=registry)
{code}

to this:


{code:java}
Debug (07:23:34): Checking the existence of registry value: Registry_value[HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters\Type](provider=registry)
Debug (07:23:47): Checking the existence of registry value: Registry_value[HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Config\AnnounceFlags](provider=registry)
Debug (07:24:02): Checking the existence of registry value: Registry_value[HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient\SpecialPollInterval](provider=registry)
{code}

just as an example.

Please consider this feature.",New Feature,PUP-8222,[],puppet timestamping for every event
"When the PAL API TaskSignature#runnable_with? was implemented the feature found in the similar {{callable_with?}} methods for other signatures that yields a type mismatch error to a given block was forgotten.

This should be implemented so that a user of the API does not have to construct that error message manually.",Bug,PUP-8221,[],TaskSignature#runnable_with? should yield type mismatch error
"The handling of trusted facts in the lookup CLI is somewhat unclear. In this ticket we need to discuss and decide on how it should handle trusted information and if something needs to change.

See background in PUP-7507.",Bug,PUP-8220,[],"Handle lookup CLI ""trusted"" in a better way"
"If there are 0 files to delete, we still emit a notice message: {{Tidying 0 files}}. The resource should be ""insync"" if there aren't any files to delete.",Bug,PUP-8219,[],Tidy should only log a notice if there are changes to be made
"First of all, our Puppet installation has been around for at least two year or so. The subject node has been part of it since the beginning. Everything worked fine until some upgrade (hard to trace, as we have them on semi-automatic mode).

Since about a month or so ago receiving the following error:
{code}
> sudo puppet agent -t
Info: Using configured environment 'corporate'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: A duplicate resource was found while collecting exported resources, with the type and title Host[__PUPPETNODE__] on node __PUPPETNODE__
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{code}

All settings are described via Hiera. Its hierarchy as follows:
{code}
hierarchy:
  - name: ""Nodes""
    path: ""nodes/%{::trusted.certname}.yaml""
  - name: ""Role 1""
    path: ""roles/%{::role_1}.yaml""
  - name: ""Role 2""
    path: ""roles/%{::role_2}.yaml""
  - name: ""Role 3""
    path: ""roles/%{::role_3}.yaml""
  - name: ""Role 4""
    path: ""roles/%{::role_4}.yaml""
  - name: ""Groups""
    path: ""groups/%{::group}.yaml""
    # compatibility
  - name: ""Roles""
    path: ""roles/%{::role}.yaml""
  - name: ""Virtual""
    path: ""virtual_%{::is_virtual}.yaml""
  - name: ""OS""
    path: ""os_%{::operatingsystem}.yaml""
  - name: ""OS Realese""
    path: ""os_%{::operatingsystem}_%{::operatingsystemmajrelease}.yaml""
  - name: ""Environment""
    path: ""env_%{environment}.yaml""
  - name: ""Common Defaults""
    path: ""common.yaml""
{code}

The subject node falls under the following environment:
- ::trusted.certname - __PUPPETNODE__
- ::role_[1-4] - not set
- ::group - _dev_vm_
- ::is_virtual - true
- ::operatingsystem - Debian
- ::operatingsystemmajrelease - 8
- environment - corporate

__PUPPETNODE__.yaml practically contains just 5 lines:
{code}
dev_username: ""first_lastname""

sudo::configs:
  'teamlead':
      'content' : ""teamlead ALL=(ALL:ALL) NOPASSWD: ALL, !SU, !SHELLS, !SUDO""
      'ensure'  : 'present'

bacula::client::password: '...'

nslcd::ldap_search_bases:
  - OU=..

samba::server::netbios_name: 'DEV-USERNAME'
{code}


There 10+ other nodes that fall under _dev_vm_ category and which ARE working fine. The same template node YAML configuration files.

A debug log (attached) doesn't show anything extraordinary. ",Bug,PUP-8218,[],Error 500 on SERVER: Server Error: A duplicate resource was found while collecting exported resources
"when running a puppet cert list -a
some signed cert entries appears with a trailing ""**"" (two star characters),
there does not appear to be any documentation that describes what this signifies.
Are these entries that have been autosigned? or does it mean that there are extensions in the cert?

Please update the documentation to describe what this signifies.",Improvement,PUP-8217,['beginner'],"puppet cert list documentation doesnt describe what ""**"" means"
"The documentation for configuring a Hiera 5 hierarchy level can be found [here|https://puppet.com/docs/puppet/5.2/hiera_config_yaml_5.html#configuring-a-hierarchy-level-general-format]. In these docs, the {{uris}} key is described as appropriate for _""\[...\] any kind of data source. Hiera doesn’t ensure URIs are resolvable before calling the backend, and doesn’t need to understand any given URI schema.""_

However, in implementation the {{uris}} key is not implemented this way, and seems to require that values match a preconception of what a URI is.

{code}
---
version: 5

defaults:
  datadir: ""data""

hierarchy:
  - name: 'Consul backend'
    lookup_key: consul_lookup_key
    uris:
      - ""/v1/kv/configuration/%{fqdn}""
      - ""/v1/kv/configuration/common""
{code}

{code}
[cloud-user@master-of-puppets-aws-1 work]$ puppet lookup --hiera_config=hiera.yaml --modulepath=modules test --explain
Error: Could not run: Lookup of key 'lookup_options' failed: The Lookup Configuration at '/home/cloud-user/work/hiera.yaml' has wrong type, entry 'hierarchy' index 0 entry 'uri' exp
ects a match for Pcore::URI = Pattern[/(?x-mi:
        ([a-zA-Z][\-+.a-zA-Z\d]*):                           (?# 1: scheme)
        (?:
           ((?:[\-_.!~*'()a-zA-Z\d;?:@&=+$,]|%[a-fA-F\d]{2})(?:[\-_.!~*'()a-zA-Z\d;\/?:@&=+$,\[\]]|%[a-fA-F\d]{2})*)                    (?# 2: opaque)
        |
           (?:(?:
             \/\/(?:
                 (?:(?:((?:[\-_.!~*'()a-zA-Z\d;:&=+$,]|%[a-fA-F\d]{2})*)@)?        (?# 3: userinfo)
                   (?:((?:(?:[a-zA-Z0-9\-.]|%\h\h)+|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\[(?:(?:[a-fA-F\d]{1,4}:)*(?:[a-fA-F\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:(?:[a-fA-F\d]{1,4}:)*[a-fA-F\d]{1,4})?::(?:(?:[a-fA-F\d]{1,4}:)*(?:[a-fA-F\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))?)\]))(?::(\d*))?))? (?# 4: host, 5: port)
               |
                 ((?:[\-_.!~*'()a-zA-Z\d$,;:@&=+]|%[a-fA-F\d]{2})+)                 (?# 6: registry)
               )
             |
             (?!\/\/))                           (?# XXX: '\/\/' is the mark for hostport)
             (\/(?:[\-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*(?:;(?:[\-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*)*(?:\/(?:[\-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*(?:;(?:[\-_.!~*'()a-zA-Z\d:@&=+$,]|%[a-fA-F\d]{2})*)*)*)?                    (?# 7: path)
           )(?:\?((?:[\-_.!~*'()a-zA-Z\d;\/?:@&=+$,\[\]]|%[a-fA-F\d]{2})*))?                 (?# 8: query)
        )
        (?:\#((?:[\-_.!~*'()a-zA-Z\d;\/?:@&=+$,\[\]]|%[a-fA-F\d]{2})*))?                  (?# 9: fragment)
      )/], got '/v1/kv/configuration/common'
{code}

As a custom backend author, I read the documentation for {{uris}} as a standardized key that I can use to specify ""levels"" for my backend, where the format and validation of strings representing levels is left to me. However, the implementation prevents this.

There should be a standard key that can be used to describe levels, for which format and validation of entries is left to the backend. If {{uris}} is already this key, the undocumented type checking is a bug that needs to be removed before it can be effectively used. ",Bug,PUP-8216,[],"Hiera 5 ""uris"" hierarchy parameter inappropriately type-checked"
"{{\--skip_tags foo::bar}} splits the tag on the namespace separator {{::}} and expands to skip the set {{['foo::bar', 'foo', 'bar']}}. Because resources are tagged with all parent tags, this means that every resource in the `foo` namespace is skipped when {{\--skip_tags foo::bar}} is used. The same expansion issue was addressed for the {{\--tags}} flag in PUP-4495, but it appears that the expansion logic for {{\--tags}} and {{\--skip_tags}} is separate.",Bug,PUP-8215,[],Tag filtering for skip_tag incorrectly expanded
"Today, we support two lookup interpolation functions: {{hiera()}} and {{scope()}}. See the docs [here|https://puppet.com/docs/hiera/3.3/variables.html#the-hiera-lookup-function].

In order to more clearly shift perception of using these interpolations to a modern lookup-aware perspective, it should be possible to specify {{lookup()}} as a lookup interpolation function rather than the possibly inaccurate term {{hiera()}}. The behavior of {{lookup()}} may be similar or equivalent to the current behavior of {{hiera()}}.

{code}
---
wordpress::database_server_uri: ""http://%{lookup('instances::mysql::public_hostname')}:443""
{code}

There is some relevant discussion in HI-487.

_Note: this ticket assumes we will continue to support the functionality. The only logical alternative is to choose not to continue to support the functionality, in which case rather than modernizing the UX by moving from {{hiera()}} to {{lookup()}}, we would need to deprecate {{hiera()}}._",Improvement,PUP-8214,[],Support {{lookup()}} lookup interpolation function
"A common error in enterprise environments is a mismatch between the server setting on the agent and the common name of the master's cert / its dns alt names.

Today, if this situation occurs the error message the agent prints is as clear as mud. For example:

{code}
# You can't tell, but for this run server=master.tld
# 
[root@aws-1 ssl]# puppet agent -t
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=master-1.tld]
Info: Retrieving pluginfacts
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=master-1.tld]
...
{code}

This error message is INCREDIBLY unhelpful. There's kinda-sorta a reference to the master's certificate being {{master-1.tld}}, but you can't see in the message that the configured server is {{master.tld}}. There's also no reference to other valid alt names.

What we want:

The error message should clearly state something along the lines of

{code}
Error: Unable to validate server certificate. Expected ""master.tld"":
  server certificate common name ""master-1.tld"" does not match
  server certificate alt name ""puppet"" does not match
  server certificate alt name ""master"" does not match
  server certificate alt name ""master-alt.tld"" does not match
{code}",Bug,PUP-8213,[],Error message for certificate name mismatch is clear as mud
"The {{Variant}} type when used as just {{Variant}} (no list of types) has an implementation that uses {{all?}} to check if all types in a RHS variant can be assigned to the LHS type. This fails when the RHS Variant is empty.

An empty {{Variant}} should only be assignable from a {{Variant}} as the only meaningful interpretation of a {{Variant}} without any types to perform an OR matching operation on is that it means ""all types that are actually {{Variant}}"".

If an empty {{Variant}} was to be interpreted as {{Variant\[Any}}}, then it is essentially the same as {{Any}}, and that is surprising.

If it was to be an error to use {{Variant}} as an expression, we need to change the entire implementation how parameterized types are formed using the AST. (It has one expression that evaluates to the base {{Variant}} type, followed by an ""at"" expression {{\[T1, T2,...]}} that constrains/widens/defines the type instance that will be created.

When fixing this, there are numerous tests that include the {{Variant}} in the list of ""all types"", and this change will require a special section of tests for the {{Variant}} type.
",Bug,PUP-8212,[],The Variant type without any types matches in strange ways
"When a user already exists on the system the managehome attribute for the user resource does not create the homedir: 

Tested locally on same version and managehome =true/yes doesn't create the home dir.

{code}
user {'john' :
  ensure     => present,
  managehome => yes,
  }
user {'john' :
  ensure     => present,
  managehome => true,
  }
{code}

The docs say that if ensure=present it should be created:
""Whether to manage the home directory when managing the user. This will create the home directory when ensure => present""

Puppet resource user <name> says homedir is present

{code}
user { 'john':
  ensure           => 'present',
  gid              => 1002,
  home             => '/home/john',
  password         => '!!',
  password_max_age => 99999,
  password_min_age => 0,
  shell            => '/bin/bash',
  uid              => 1002,
}
[root@pe-201732-master home]# pwd
/home
[root@pe-201732-master home]# ls -al
total 4
drwxr-xr-x.  3 root    root      20 Mar  9  2016 .
dr-xr-xr-x. 18 root    root    4096 Nov 15 16:23 ..
drwx------   3 vagrant vagrant  107 Nov 28 13:34 vagrant
[root@pe-201732-master home]#
{code}

If puppet creates user from scratch it works but not for existing users",Task,PUP-8211,[],Document managehome with respect to existing users
"Hi

When trying to install foreman (using foreman-installer), I receive an error regarding puppet.

/var/lib/gems/1.9.1/gems/puppet-5.3.3/lib/puppet.rb:56:in `<module:Puppet>': uninitialized constant Puppet::Settings (NameError)

I have tried to remove and reinstall puppet and foreman, but it doesnt change the result.

Thank you
",Bug,PUP-8210,[],uninitialized constant Puppet::Settings
"Puppet agent does not log service's ""enable"" change as it does for ""ensure"", e.g.
(/Stage[main]/Profile::Os/Service[vis]/ensure) ensure changed 'stopped' to 'running'

I would expect it to log any state change, not just ensure.",Bug,PUP-8209,[],Service's enable state change not logged
"When testing loading of types to find those that are task types it was discovered that  'Task' and 'GenericTask' appeared multiple times in the returned result.

That indicates that something is wrong with how discover searches for types.",Bug,PUP-8206,[],loader.discover(:type) returns multiple instances of the same thing
"The puppet code base has a directory named ""tasks"" that contains rake tasks.
When trying to discover all data types and --tasks is on, the loader will try to load those as if they were instances of Task.

This fails miserably in task_instantiator with the following stack trace:
{code}
     Failure/Error: constants['executable'] = Pathname(task_source).relative_path_from(Pathname(loader.path) + 'tasks').to_s

     Puppet::Error:
       no implicit conversion of nil into String on node henrik2
     # ./lib/puppet/pops/loader/task_instantiator.rb:95:in `initialize'
     # ./lib/puppet/pops/loader/task_instantiator.rb:95:in `Pathname'
     # ./lib/puppet/pops/loader/task_instantiator.rb:95:in `create_task_type_from_hash'
     # ./lib/puppet/pops/loader/task_instantiator.rb:31:in `create_task_type'
     # ./lib/puppet/pops/loader/task_instantiator.rb:26:in `create'
     # ./lib/puppet/pops/loader/module_loaders.rb:222:in `instantiate'
     # ./lib/puppet/pops/loader/module_loaders.rb:198:in `find'
     # ./lib/puppet/pops/loader/base_loader.rb:161:in `internal_load'
     # ./lib/puppet/pops/loader/base_loader.rb:42:in `load_typed'
     # ./lib/puppet/pops/loader/module_loaders.rb:117:in `block (2 levels) in discover'
     # ./lib/puppet/pops/loader/module_loaders.rb:114:in `each'
     # ./lib/puppet/pops/loader/module_loaders.rb:114:in `block in discover'
     # ./lib/puppet/pops/loader/module_loaders.rb:113:in `each'
     # ./lib/puppet/pops/loader/module_loaders.rb:113:in `discover'
     # ./lib/puppet/pops/loader/base_loader.rb:28:in `discover'
     # ./lib/puppet/pops/loader/module_loaders.rb:121:in `discover'
     # ./lib/puppet/pops/loader/dependency_loader.rb:28:in `block in discover'
     # ./lib/puppet/pops/loader/dependency_loader.rb:28:in `each'
     # ./lib/puppet/pops/loader/dependency_loader.rb:28:in `discover'
     # ./lib/puppet_pal.rb:213:in `list_loadable_kind'
     # ./lib/puppet_pal.rb:265:in `list_tasks'
     # ./spec/unit/puppet_pal_2pec.rb:674:in `block (7 levels) in <top (required)>'
     # ./lib/puppet_pal.rb:611:in `call'
     # ./lib/puppet_pal.rb:611:in `block (2 levels) in main'
     # ./lib/puppet/parser/script_compiler.rb:47:in `block in compile'
     # ./lib/puppet/context.rb:65:in `override'
     # ./lib/puppet.rb:263:in `override'
     # ./lib/puppet/parser/script_compiler.rb:42:in `compile'
     # ./lib/puppet_pal.rb:609:in `block in main'
     # ./lib/puppet/context.rb:65:in `override'
     # ./lib/puppet.rb:263:in `override'
     # ./lib/puppet_pal.rb:578:in `main'
     # ./lib/puppet_pal.rb:341:in `block in with_script_compiler'
     # ./lib/puppet/context.rb:65:in `override'
     # ./lib/puppet.rb:263:in `override'
     # ./lib/puppet_pal.rb:338:in `with_script_compiler'
     # ./spec/unit/puppet_pal_2pec.rb:674:in `block (6 levels) in <top (required)>'
     # ./lib/puppet_pal.rb:506:in `call'
     # ./lib/puppet_pal.rb:506:in `block in in_environment_context'
     # ./lib/puppet/context.rb:65:in `override'
     # ./lib/puppet.rb:263:in `override'
     # ./lib/puppet_pal.rb:498:in `in_environment_context'
     # ./lib/puppet_pal.rb:398:in `in_tmp_environment'
     # ./spec/unit/puppet_pal_2pec.rb:673:in `block (5 levels) in <top (required)>'
{code}

It fails because loader.path is nil. The real problem is that it should not try to load tasks from puppet in that location.",Bug,PUP-8204,[],loader.discover(:type) with --tasks on crashes because it tries to load rake tasks in puppet
"The PAL API needs to have a method to find all loadable elements of a particular kind (:function, :type, :plan, etc...). Of special interest are naturally 'tasks' and 'plans'.  Tasks are just data types, so they require filtering.",Bug,PUP-8203,[],add ability to enumerate loadable element by kind to PAL API
"Add a helper to the PAL API to load a task, and to enumerate all available tasks.",Improvement,PUP-8202,[],PAL: add helper to load a task and enumerate tasks
"While updating puppet.com links in the Puppet repo, I noticed that https://github.com/puppetlabs/puppet/blob/master/MAINTAINERS is out of date.

Will Hopper, Hailee Kenney, Adrien Thebo, John Duarte, and Moses Mendoza are still listed as maintainers of puppetlabs/puppet on the 4.10.x branch. Moses, Hailee, Adrien, and John are still listed on master. Some new team members are not listed.",Bug,PUP-8201,[],MAINTAINERS file needs maintenance
"The last official docs on running Puppet from source were for [Puppet 3.8|https://docs.puppet.com/puppet/3.8/from_source.html]. These are linked to from the Puppet repo's README.

Are there official docs for running Puppet from source for any newer versions of Puppet? Should there be? If so, what platforms should those docs cover? 

Should these docs exist as part of the versioned Puppet documentation, or in the GitHub repo? Should the docs team own them as user-facing docs, or should Platform own them as developer docs?",Bug,PUP-8200,[],No docs to run Puppet 4 or 5 from source
"If a task declares a parameter that is also a metadata key, such as {{description}}, Puppet will fail to load the task.

With BOLT-66:
{code}
$ bolt task run echo message='{""a"": 1}' -n node --modulepath site
Error: attribute Echo[description] is defined as both a constant and an attribute on node mylaptop
{code}",Bug,PUP-8199,['docs_reviewed'],Parameters in Task metadata should not collide with metadata keys
"Per PR #6379, many links to the Puppet website in the Puppet source and repo docs still point to puppetlabs.com or docs.puppetlabs.com. Many of these navigate a series of redirects to current content, while some point to outdated content or no longer work.",Bug,PUP-8198,[],Update outdated links to Puppet website
"Tasks will run and accept any arguments if no metadata is provided. However, if a metadata file is present then it requires a parameters key; that violates the [specification|https://github.com/puppetlabs/puppet-specifications/tree/master/tasks#task-metadata].

An example of the error given (using BOLT-66) is
{code}
$ bolt task run echo message='{""a"": 1}' foo=1 -n node1 --modulepath site
Error: The metadata for task echo has wrong type, expects a value for key 'parameters' in site/echo/tasks/init.json on node mylaptop
Task parameters did not match
{code}",Bug,PUP-8197,[],Parameters property in Task metadata should be optional
"We have some data types for logrotate parameters that verify if the mail parameter (https://github.com/voxpupuli/puppet-logrotate/blob/d55a64e670aa192fe6257289b023e706d24c41e7/manifests/rule.pp#L238) is either false (Boolean) or a valid email address.

{code}
mail            => Optional[Variant[false ,Sys11lib::Type::Email]],
{code}

This works with puppet-4.10.1, but puppet-5.3 throws:
{code}
Error while evaluating a Type-Name, The expression <Variant[false,Sys11lib::Type::Email]> is not a valid type specification.
{code}

How do we specify a subtype of a Boolean with Puppet5 (that is compatible with Puppet4)?",Bug,PUP-8196,[],Variant does not accept false as type with puppet-5 anylonger
"The PAL API should have a method to register data type implementations. This should be allowed to allow an application to register application specific data types that exist in the top data type name space.

Usage of registering top namespace names should only be done if it is totally unacceptable to namespace the types. There are a few valid reasons:
* the data type will later migrate to puppet and when that occurs code should be backwards compatible (although it is possible to register an alias to make it backwards compatible - i.e. namespaces from the start, alias is the namespaced mapping to the non namespaced once the data type has moved).
* it is an integral part of an application where there conceptually is no natural module like namespace that can be used. (This could be the result of having painted yourself into a corner by having a module named after the application that is a puppet module that manages the application - and thus not being part of the application itself).

Registered data types must:
* comply with rules of being an {{Object}} data type. (They must serialize as objects)
* not come with logic that messes with the type inference making such objects appear as Scalar or other core data types

The implementor of a top name space data type must make a reservation for the name in the puppet specification's repository before starting to use that name. This to ensure that the name is not used for some other conflicting purpose by accident.

Thus, unless having very strong reasons to register a top name space data type - just don't!
Registering data types in a module name space (other than {{::Puppet}}) is perfectly fine (while ensuring that it does not squat on a module namespace).

For a use case see: PUP-8190",New Feature,PUP-8195,[],Add ability to register data type implementations in the PAL API
"While processing a request, the puppet master outputs dozens of lines like this one:
{code}
[pid  3536] open(""/opt/puppetlabs/puppet/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.0/lib/fast_gettext/vendor/empty.mo"", O_RDONLY|O_CLOEXEC) = 13
{code}

This is most likely coming from modules that have a {{locales}} directory but no translations for the selected locale. FastGettext will create a dummy empty translation file for it [to load|https://github.com/grosser/fast_gettext/blob/master/lib/fast_gettext/translation_repository/mo.rb#L41] and read. We should see if there is a way we can avoid most of these reads.

One idea is to not create translation repositories (which load translation -- or empty.mo -- files lazily) for modules that don't have translations for the selected locale. We don't currently support changing the locale at runtime, so checking for the relevant locale directory before creating the repository might be sufficient.",Improvement,PUP-8191,[],Reduce FastGettext's reads of empty.mo
While bolt is experimental these types should be packaged with bolt so we can iterate on them faster. Eventually they may move back into puppet. ,New Feature,PUP-8190,[],Move ExecutionResult and Target type into boltlib
"--render-as is a documented option to puppet config print, and if you use it, it is validated (so a value like json is accepted, but foo is not). However, it does not seem to have an effect.

{noformat}
puppet config print --section main --render-as json
{noformat}
outputs values, but not in a json format.

{noformat}
puppet config print --section main --render-as foo
{noformat}
outputs ""Error: Could not parse application options: I don't know how to render 'foo'""",Bug,PUP-8189,[],--render-as broken in puppet config print
"The \--render-as option is in puppet config print's documentation and is validated, but has no effect. {{puppet config print}} should be able to opt out of having {{\--render-as}} shown in its help in favor of showing a new option {{\--format}} to align with {{puppet facts}}. The new {{\--format}} option will need to be created.

For example, 
{code:bash}
puppet config print --render-as json
{code}
runs successfully, but does not output json.

{code:bash}
puppet config print --render-as foo
{code}
outputs ""Error: Could not parse application options: I don't know how to render 'foo'""

The {{\--format}} types to support are {{json}}, {{yaml}}, and {{flat}} (the default, also the current output).",Bug,PUP-8188,[],--render-as broken in puppet config print
"I have been using the {{puppet master --compile}} application to test compiling catalogs for each of my nodes before moving forward with upgrading from my old 4.2.3 Puppet server.

For one particular role, the 5.x {{puppet master --compile}} fails to output the catalog.  The last two lines it produces are:
{noformat}
2017-11-21 00:39:23 +0000 Puppet (notice): Compiled catalog for hostname.example.com in environment production in 18.80 seconds
2017-11-21 00:39:24 +0000 Puppet (err): Failed to compile catalog for node hostname.example.com: source sequence is illegal/malformed utf-8
{noformat}

I believe this message is being generated in {{/opt/puppetlabs/puppet/lib/ruby/vendor/puppet/application/master.rb}} line 172, in the {{compile}} method:
{noformat}
      puts JSON::pretty_generate(catalog.to_resource, :allow_nan => true, :max_nesting => false)
{noformat}

When I switch this to {{PSON::pretty_generate}}, it works fine.

This is being caused by a {{File}} resource trying to install an executable binary program via the {{content}} parameter - when I remove that particular {{File}} resource from the compilation, it completes without a problem.

I can't tell if this will be a problem when I move to an agent/server model, so this troubles me.  If this is a global problem, then it's definitely a high priority regression.  If it only affects the {{puppet master --compile}} application, then it's lower priority, but still problematic, as the {{File}} resource implicitly allows for binary content based on the https://puppet.com/docs/puppet/5.3/types/file.html comment that ""On Windows, note that file contents are managed in binary mode; Puppet never automatically translates line endings.""
",Bug,PUP-8187,['beginner'],`puppet master compile` fails to save the catalog with arbitrary binary data in file resources
"Backport the fix in PUP-8181 to 4.10.x (break in iteration of hash), and also backport fixes to the {{reduce}} function.",Bug,PUP-8186,[],Backport fixes for the break() feature from Puppet 5.x
"When using Puppet::Pal to evaluate string, file, or parsed model, the methods does not instantiate the definitions (functions, plans, etc). The only way to get definitions is to define the environment with a main manifest.

The evaluating methods should also instantiate the definitions.",Bug,PUP-8185,[],The PAL API evaluation methods does not instantiate definitions
"If you backup a file to a local filebucket, and list its contents you'll see (once PUP-5606 is fixed):

{noformat}
$ bx puppet filebucket list -l 
549c165e620be535764e782eb1e4e83f 2017-11-16 15:27:39 /private/tmp/foo
{noformat}

But if the same file is backed up a remote filebucket hosted by puppetserver, and you list its contents, the leading slash is lost:

{noformat}
[root@ymjl00zn52sxdxm ~]# /opt/puppetlabs/puppet/bin/puppet filebucket list  --bucket /opt/puppetlabs/server/data/puppetserver/bucket/
549c165e620be535764e782eb1e4e83f 2017-11-16 17:12:06 private/tmp/foo
{noformat}

The client appears to be sending the correct HTTP request, note the double slash:

{noformat}
Info: Computing checksum on file /tmp/foo
<- ""HEAD /puppet/v3/file_bucket_file/md5/549c165e620be535764e782eb1e4e83f//private/tmp/foo?environment=production& HTTP/1.1\r\nAccept: application/octet-stream\r\nX-Puppet-Version: 5.3.3\r\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\r\nUser-Agent: Puppet/5.3.3 Ruby/2.4.1-p111 (x86_64-darwin15)\r\nHost: ymjl00zn52sxdxm.delivery.puppetlabs.net:8140\r\n\r\n""
-> ""HTTP/1.1 404 Not Found\r\n""
-> ""Date: Fri, 17 Nov 2017 01:12:06 GMT\r\n""
-> ""Content-Type: application/json;charset=utf-8\r\n""
-> ""X-Puppet-Version: 5.3.0\r\n""
-> ""Content-Length: 143\r\n""
-> ""Server: Jetty(9.4.z-SNAPSHOT)\r\n""
-> ""\r\n""
Conn keep-alive
<- ""PUT /puppet/v3/file_bucket_file/md5/549c165e620be535764e782eb1e4e83f//private/tmp/foo?environment=production& HTTP/1.1\r\nAccept: application/octet-stream\r\nX-Puppet-Version: 5.3.3\r\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\r\nContent-Type: application/octet-stream\r\nUser-Agent: Puppet/5.3.3 Ruby/2.4.1-p111 (x86_64-darwin15)\r\nHost: ymjl00zn52sxdxm.delivery.puppetlabs.net:8140\r\nContent-Length: 38\r\n\r\n""
<- ""Tsdfadsasdfasdhis is the old content\n\n""
-> ""HTTP/1.1 200 OK\r\n""
-> ""Date: Fri, 17 Nov 2017 01:12:06 GMT\r\n""
-> ""Content-Type: application/octet-stream;charset=iso-8859-1\r\n""
-> ""X-Puppet-Version: 5.3.0\r\n""
-> ""Content-Length: 0\r\n""
-> ""Server: Jetty(9.4.z-SNAPSHOT)\r\n""
-> ""\r\n""
reading 0 bytes...
-> """"
{noformat}

Webrick has the same problem too.",Bug,PUP-8184,[],Remote filebuckets lose the leading slash
"Previously `puppet device` required --user=root to create certificates.  This has been fixed, but the man page was not updated.",Task,PUP-8183,[],Update puppet device documentation for --user
"Ticket PUP-7608 was created against Puppet 5.0.  This same issue also affects Puppet 4, and is a behavioral change from earlier Puppet 4 versions.

Given a single hiera file containing
{noformat}
---
foo:
  - this is a test
  - this is another test
  - this is a test
{noformat}

In Puppet 4.2.3, {{hiera_array(""foo"")}} will return a two-element array:
{noformat}
$ puppet apply -t --noop -e '$foo = hiera_array(""foo""); notice(""${::clientversion}: ${foo}"")'
Info: Loading facts
Info: Loading facts
Info: Loading facts
Notice: Scope(Class[main]): 4.2.3: [this is a test, this is another test]
Notice: Compiled catalog for foo.example.com in environment production in 0.32 seconds
Info: Applying configuration version '1510798433'
Notice: Applied catalog in 0.02 seconds
{noformat}
However, in Puppet 4.10.8, it returns all three elements, including the duplicated element:
{noformat}
$ puppet apply --strict=off -t --noop -e '$foo = hiera_array(""foo""); notice(""${::clientversion}: ${foo}"")'
Info: Loading facts
Info: Loading facts
Info: Loading facts
Notice: Scope(Class[main]): 4.10.8: [this is a test, this is another test, this is a test]
Notice: Compiled catalog for foo.example.com in environment production in 0.13 seconds
Info: Applying configuration version '1510798413'
Notice: Applied catalog in 0.04 seconds
{noformat}",Bug,PUP-8182,[],Lookup unique merge doesn't deduplicate with a single layer - backport PUP 7608 to 4.10.z
"break() fails with an illegal context error within hash iteration outside any function

It may be that I simply need to use a function and call it a day... I am, however, surprised that this doesn't work, and I wonder if this is by design or by accident.

{code:puppet}
# test2.pp

$test_hash = {
  'Linus'   => 'Torvalds',
  'Richard' => 'Stallman',
  'Dennis'  => 'Ritchie',
}

$test_hash.each |String $first, String $last| {
  if $last == 'Stallman' {
    notice(""YES"")
    break()
  }
  else {
    notice(""NO"")
  }
}
{code}

{code:bash}
$ puppet apply test2.pp
Notice: Scope(Class[main]): NO
Notice: Scope(Class[main]): YES
Error: break() from context where this is illegal at /tmp/test2.pp:12 on node <node>
{code}


I've tried the same thing with {{return()}}:
{code:bash}
$ puppet apply test2.pp
Notice: Scope(Class[main]): NO
Notice: Scope(Class[main]): YES
Error: return() from context where this is illegal at /tmp/test2.pp:13 on node <node>
{code}

If I run {{break()}} within a class, I get the same error.

If I run {{return()}} within a class, it breaks out of the entire class rather than just the lambda in the {{.each}} loop:
{code:puppet}
# test3.pp

class test_class {
  $test_hash = {
    'Linus'   => 'Torvalds',
    'Richard' => 'Stallman',
    'Dennis'  => 'Ritchie',
  }

  $test_hash.each |String $first, String $last| {
    if $last == 'Stallman' {
      notice(""YES"")
      return()
    }
    else {
      notice(""NO"")
    }
  }

  notice(""OUT OF THE LOOP"")
}

include ::test_class
{code}

{code:bash}
$ puppet apply test3.pp
Notice: Scope(Class[Test_class]): NO
Notice: Scope(Class[Test_class]): YES
Notice: Compiled catalog for <node> in environment production in 0.26 seconds
Notice: Applied catalog in 0.45 seconds
{code}


Edit: Issue may be confined to hashes. I'm trying `map` like in the language doc's examples (https://puppet.com/docs/puppet/5.3/function.html#break). The array example works fine. The hash example breaks.
{code:bash}
# test4.pp

class test_class {
  $data = [1,2,3]
  notice $data.map |$x| {
    if $x == 3 {
      break()
    }
    $x*10
  }

  $data_hash = { 'a' => 1, 'b' => 2, 'c' => 3 }
  notice $data_hash.map |$key, $value| {
    if $value == 3 {
      break()
    }
    $value*10
  }

  notice(""OUT OF THE LOOP"")
}

include ::test_class
{code}
{code:bash}
$ puppet apply test4.pp
Notice: Scope(Class[Test_class]): [10, 20]
Error: break() from context where this is illegal at /tmp/test4.pp:15 on node <node>
{code}


Example of a workaround using a function and {{return()}}:
{code:puppet}
# test5.pp
function has_two($data) {
  $data.each |$key, $value| {
    if $value == 2 {
      return(true)
    }
  }

  return(false)
}

$data = { 'a' => 1, 'b' => 2, 'c' => 3 }
if has_two($data) {
  notice ""YES""
}
else {
  notice ""NO""
}
{code}

{code:bash}
$ puppet apply test5.pp
Notice: Scope(Class[main]): YES
Notice: Compiled catalog for <node> in environment production in 0.16 seconds
Notice: Applied catalog in 0.49 seconds
{code}",Bug,PUP-8181,[],break() fails with illegal context error within hash iteration outside any function
"This is trivial to work around, but it threw me off when I first saw it and figured I would write it up really quick in case someone else comes across the same.

Some resources will fail when running `puppet agent --test` if your current working directory is within an sshfs mount. 

Here are relevant error messages from two resources failing in this way, vcsrepo and nfs:

{noformat}
Error: /Stage[main]/Nfs::Client::Service/Service[rpcbind]/enable: change from false to true failed: Could not enable rpcbind: 
Notice: /Stage[main]/Nfs::Client/Anchor[nfs::client::end]: Dependency Service[rpcbind] has failures: true

Error: /Stage[main]/Backdat::Install/Vcsrepo[/opt/backdat]: Could not evaluate: Permission denied @ dir_chdir - /mnt/puppetenv
{noformat}

Could be related to PUP-5915, but I'm not certain.

Here is the detailed trace:

{noformat}
tylar@mycomputer:/mnt/my-sshfs-mount$ sudo puppet agent --test --trace
Info: Using configured environment 'test'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for mycomputer.mydomain.edu
Info: Applying configuration version '1511820289'
Error: Could not enable rpcbind: 
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/execution.rb:235:in `execute'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/command.rb:23:in `execute'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:221:in `block in has_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:422:in `block in create_class_and_instance_method'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/service/systemd.rb:47:in `systemctl_change_enable'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/service/systemd.rb:125:in `enable'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/service.rb:55:in `block (3 levels) in <module:Puppet>'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:487:in `set'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:561:in `sync'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:236:in `sync'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:134:in `sync_if_needed'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:88:in `block in perform_changes'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `perform_changes'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:21:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:230:in `apply'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:246:in `eval_resource'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block (2 levels) in evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:507:in `block in thinmark'
/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:506:in `thinmark'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block in evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:118:in `traverse'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:154:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:142:in `as_logging_destination'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:224:in `block in benchmark'
/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:170:in `apply_catalog'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:343:in `run_internal'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:221:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:306:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:195:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (4 levels) in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (3 levels) in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:98:in `with_client'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:42:in `block (2 levels) in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:65:in `run_in_fork'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:41:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:39:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:353:in `onetime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:331:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:662:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
Error: /Stage[main]/Nfs::Client::Service/Service[rpcbind]/enable: change from false to true failed: Could not enable rpcbind: 
Notice: /Stage[main]/Nfs::Client/Anchor[nfs::client::end]: Dependency Service[rpcbind] has failures: true
Warning: /Stage[main]/Nfs::Client/Anchor[nfs::client::end]: Skipping because of failed dependencies
Error: /Stage[main]/Backdat::Install/Vcsrepo[/opt/backdat]: Could not evaluate: Permission denied @ dir_chdir - /mnt/my-sshfs-mount
/opt/puppetlabs/puppet/cache/lib/puppet/provider/vcsrepo.rb:43:in `chdir'
/opt/puppetlabs/puppet/cache/lib/puppet/provider/vcsrepo.rb:43:in `at_path'
/opt/puppetlabs/puppet/cache/lib/puppet/provider/vcsrepo/git.rb:132:in `working_copy_exists?'
/opt/puppetlabs/puppet/cache/lib/puppet/type/vcsrepo.rb:138:in `retrieve'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1070:in `retrieve'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1098:in `retrieve_resource'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:300:in `from_resource'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:20:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:230:in `apply'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:246:in `eval_resource'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block (2 levels) in evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:507:in `block in thinmark'
/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:506:in `thinmark'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block in evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:118:in `traverse'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:154:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:142:in `as_logging_destination'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:224:in `block in benchmark'
/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:170:in `apply_catalog'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:343:in `run_internal'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:221:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:306:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:195:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (4 levels) in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (3 levels) in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:98:in `with_client'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:42:in `block (2 levels) in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:65:in `run_in_fork'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:41:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:39:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:353:in `onetime'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:331:in `run_command'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `block in run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:662:in `exit_on_fail'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'
/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
Info: Stage[main]: Unscheduling all events on Stage[main]
Notice: Applied catalog in 3.31 seconds
{noformat}",Bug,PUP-8180,['agent'],puppet agent -t fails from within sshfs working directory 
"I have found an issue in windows 10 using the pip3 provider. In the puppet agent execution we noticed the error message:

*""change from absent to present failed: Could not set 'present' on ensure: Could not locate command pip3""*

I have manually tried to copy the pip3.exe to pip3 and the issue was solved.

Checking the puppet code I did a PR with my proposed changes:
https://github.com/puppetlabs/puppet/pull/6366

Thanks.",Bug,PUP-8179,"['Community', 'Windows']",pip3 provider fails on windows 10
"It is currently not possible to produce a green run of the Puppet acceptance tests using {{ci:test:git}}. Running with the latest on a redhat7-64 master produces 3 failures and 6 errors (see below).

Since redhat7-64 runs the tests using 2.0.0, and since that produces an abundance of warnings, I tried other platforms as well. None of the platforms I tried made it through the setup phase.

sles12-64 ends with:
{code}
o8p5yfbezerxl5f.delivery.puppetlabs.net (sles12-64-1) 15:03:22$ cd /tmp/puppet.GFJe3B && bundle install --system --binstubs /usr/bin
    bash: bundle: command not found
{code}

sles11-64 ends with:
{code}
You need to install git to be able to use gems from git repositories. For help
installing git, please refer to GitHub's tutorial at
https://help.github.com/articles/set-up-git
{code}

fedora25 ends with:
{code}
Error: Transaction check error:
    file /usr/share/ruby/json.rb from install of rubygem-json-1.8.3.1-64.fc25.x86_64 conflicts with file from package ruby-libs-2.3.1-58.fc25.x86_64
{code}

debian9 ends with:
{code}
Package libjson-ruby is not available, but is referred to by another package.
  This may mean that the package is missing, has been obsoleted, or
  is only available from another source
  E: Package 'libjson-ruby' has no installation candidate
{code}

On redhat7-64, all tests run but 3 fails and 6 errors although master is known to be green in QA:
{code}
              - Test Case Summary for suite 'tests' -
       Total Suite Time: 5446.40 seconds
      Average Test Time: 16.02 seconds
              Attempted: 340
                 Passed: 268
                 Failed: 3
                Errored: 6
                Skipped: 62
                Pending: 1
                  Total: 340

      - Specific Test Case Status -
        
Failed Tests Cases:
  Test Case ./tests/ensure_puppet-agent_paths.rb reported: #<Beaker::DSL::Outcomes::FailTest: 
Failed to find expected symbolic link '/usr/bin/puppet' on agent 'mtvvlbq0n5wzi43.delivery.puppetlabs.net'
>
    Test line: ./tests/ensure_puppet-agent_paths.rb:176:in `block (3 levels) in run_test'

  Test Case ./tests/language/server_set_facts.rb reported: #<Minitest::Assertion: mtvvlbq0n5wzi43.delivery.puppetlabs.net: $server_facts should error if overwritten.
Expected /Error.*Attempt to assign to a reserved variable name: 'server_facts'/ to match ""\e[1;33mWarning: Support for ruby version 2.0.0 is deprecated and will be removed in a future release. See https://docs.puppet.com/puppet/latest/system_requirements.html#ruby for a list of supported ruby versions.\n   (at /usr/local/share/ruby/site_ruby/puppet.rb:133:in `<module:Puppet>')\e[0m\n\e[1;33mWarning: Unable to fetch my node definition, but the agent run will continue:\e[0m\n\e[1;33mWarning: Connection refused - connect(2)\e[0m\n\e[1;31mError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)\e[0m\n\e[1;31mError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: Connection refused - connect(2)\e[0m\n\e[1;31mError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)\e[0m\n\e[1;31mError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Connection refused - connect(2)\e[0m\n\e[1;31mError: /File[/opt/puppetlabs/puppet/cache/locales]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)\e[0m\n\e[1;31mError: /File[/opt/puppetlabs/puppet/cache/locales]: Could not evaluate: Could not retrieve file metadata for puppet:///locales: Connection refused - connect(2)\e[0m\n\e[1;31mError: Could not retrieve catalog from remote server: Connection refused - connect(2)\e[0m\n\e[1;33mWarning: Not using cache on failed catalog\e[0m\n\e[1;31mError: Could not retrieve catalog; skipping run\e[0m\n\e[1;31mError: Could not send report: Connection refused - connect(2)\e[0m\n"".>
    Test line: ./tests/language/server_set_facts.rb:37:in `block (5 levels) in run_test'

  Test Case ./tests/modules/build/build_basic.rb reported: #<Minitest::Assertion: Unexpected warning was detected!.
</Warning:/> expected to not match
<""\e[1;33mWarning: Support for ruby version 2.0.0 is deprecated and will be removed in a future release. See https://docs.puppet.com/puppet/latest/system_requirements.html#ruby for a list of supported ruby versions.\n   (at /usr/local/share/ruby/site_ruby/puppet.rb:133:in `<module:Puppet>')\e[0m\n\e[mNotice: Building /tmp/nginx for release\e[0m\nModule built: /tmp/nginx/pkg/puppetlabs-nginx-0.0.1.tar.gz\n"">.>
    Test line: ./tests/modules/build/build_basic.rb:53:in `block (2 levels) in run_test'

Errored Tests Cases:
  Test Case ./tests/agent/agent_parses_json_catalog.rb reported: #<Beaker::Host::CommandFailure: Host 'mtvvlbq0n5wzi43.delivery.puppetlabs.net' exited with 1 running:
 puppet agent --test --server boi8qet3cbu8uph.delivery.puppetlabs.net
Last 10 lines of output were:
	Info: Retrieving plugin
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Connection refused - connect(2)
	Info: Retrieving locales
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Could not evaluate: Could not retrieve file metadata for puppet:///locales: Connection refused - connect(2)
	Error: Could not retrieve catalog from remote server: Connection refused - connect(2)
	Warning: Not using cache on failed catalog
	Error: Could not retrieve catalog; skipping run
	Error: Could not send report: Connection refused - connect(2)>
    Test line: ./tests/agent/agent_parses_json_catalog.rb:18:in `block (3 levels) in run_test'

  Test Case ./tests/i18n/check_puppet_run_message.rb reported: #<Beaker::Host::CommandFailure: Host 'mtvvlbq0n5wzi43.delivery.puppetlabs.net' exited with 1 running:
 env LANGUAGE=""ja_JP"" puppet agent -t --server boi8qet3cbu8uph.delivery.puppetlabs.net
Last 10 lines of output were:
	Info: Retrieving plugin
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Connection refused - connect(2)
	Info: Retrieving locales
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Could not evaluate: Could not retrieve file metadata for puppet:///locales: Connection refused - connect(2)
	Error: Could not retrieve catalog from remote server: Connection refused - connect(2)
	Warning: Not using cache on failed catalog
	Error: Could not retrieve catalog; skipping run
	Error: Could not send report: Connection refused - connect(2)>
    Test line: ./tests/i18n/check_puppet_run_message.rb:23:in `block (4 levels) in run_test'

  Test Case ./tests/i18n/enable_option_disable_i18n.rb reported: #<Beaker::Host::CommandFailure: Host 'mtvvlbq0n5wzi43.delivery.puppetlabs.net' exited with 1 running:
 env LANGUAGE=""ja_JP"" puppet agent -t --config '/tmp/puppet_conf_test.4gSdb0' --server 'boi8qet3cbu8uph.delivery.puppetlabs.net'
Last 10 lines of output were:
	Info: Retrieving plugin
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Connection refused - connect(2)
	Info: Retrieving locales
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Could not evaluate: Could not retrieve file metadata for puppet:///locales: Connection refused - connect(2)
	Error: Could not retrieve catalog from remote server: Connection refused - connect(2)
	Warning: Not using cache on failed catalog
	Error: Could not retrieve catalog; skipping run
	Error: Could not send report: Connection refused - connect(2)>
    Test line: ./tests/i18n/enable_option_disable_i18n.rb:35:in `block (4 levels) in run_test'

  Test Case ./tests/i18n/translation_fallback.rb reported: #<Beaker::Host::CommandFailure: Host 'mtvvlbq0n5wzi43.delivery.puppetlabs.net' exited with 1 running:
 env LANG=""hu_HU"" LANGUAGE="""" puppet agent -t --server boi8qet3cbu8uph.delivery.puppetlabs.net
Last 10 lines of output were:
	Info: Retrieving plugin
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Connection refused - connect(2)
	Info: Retrieving locales
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2)
	Error: /File[/opt/puppetlabs/puppet/cache/locales]: Could not evaluate: Could not retrieve file metadata for puppet:///locales: Connection refused - connect(2)
	Error: Could not retrieve catalog from remote server: Connection refused - connect(2)
	Warning: Not using cache on failed catalog
	Error: Could not retrieve catalog; skipping run
	Error: Could not send report: Connection refused - connect(2)>
    Test line: ./tests/i18n/translation_fallback.rb:10:in `block (4 levels) in run_test'

  Test Case ./tests/lookup/hiera3_custom_backend.rb reported: #<Beaker::Host::CommandFailure: Host 'boi8qet3cbu8uph.delivery.puppetlabs.net' exited with 1 running:
 cat /etc/puppetserver/conf.d/puppetserver.conf
Last 10 lines of output were:
	cat: /etc/puppetserver/conf.d/puppetserver.conf: No such file or directory>
    Test line: ./tests/lookup/hiera3_custom_backend.rb:16:in `block (2 levels) in run_test'
  Test Case ./tests/node/check_woy_cache_works.rb reported: #<Beaker::Host::CommandFailure: Host 'boi8qet3cbu8uph.delivery.puppetlabs.net' exited with 1 running:
 chmod 644 /tmp/check_woy_cache_works.eJBq1Q/auth.conf
Last 10 lines of output were:
	chmod: cannot access ‘/tmp/check_woy_cache_works.eJBq1Q/auth.conf’: No such file or directory>
    Test line: ./tests/node/check_woy_cache_works.rb:119:in `block (2 levels) in run_test'
{code}",Bug,PUP-8178,[],Issues when attempting to run puppet acceptance tests using git
"As part of supporting module translations, we added a default mountpoint to Puppet for serving module translation files. However, this mountpoint will not be available on older versions of Puppetserver, so when an agent tries to query it, Puppetserver throws an error:
{code}
Error: /File[/Users/josh/.puppetlabs/opt/puppet/cache/locales]: Failed to generate additional resources using 'eval_generate': Error 500 on SERVER: Server Error: Not authorized to call search on /file_metadata/locales with {:rest=>""locales"", :links=>""follow"", :recurse=>true, :source_permissions=>""ignore"", :ignore=>["".svn"", ""CVS"", "".git"", "".hg"", ""*.pot"", ""config.yaml""], :checksum_type=>""sha256""}
{code}

We need to handle this gracefully, since it is not really an error (it just means module translations won't be available agent-side). We cannot simply catch the exception, since at the [downloader level|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/configurer/plugin_handler.rb] the error has already been caught and logged as part of the [HTTP handler|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/rest.rb#L309]. So ideally we should prevent the query from being made in the first place, dependent on the version of Puppetserver being queried.

The server version is currently not available [beyond the HTTP layer|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/rest.rb#L264]. Two options to explore for making it available include:
1) adding something to Puppet's [context object|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/context.rb]
2) creating a setting to skip downloading locale files

The context gives us a lifecycle for the data and tight control over it (no user can enable translation downloading by accident). However, a setting would give us the option to support people turning off translation downloads if they should prove problematic in certain use cases.",Bug,PUP-8177,['i18n'],Older server version errors when an agent tries to download from the locales mountpoint
"_Basic Info_
*Module Version:* N/A
*Puppet Version:* puppetlabs-release-pc1-1.1.0-5.el7.noarch, puppet-agent-1.10.0-1.el7.x86_64

*OS Name/Version:* CentOS Linux release 7.2.1511 (Core)

OS Version
==========
CentOS Linux release 7.2.1511 (Core) 

uname -a output
===============
Linux xxx.sjc01.prod.colovore.net 3.10.0-327.22.2.el7.x86_64 #1 SMP Thu Jun 23 17:05:11 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux


packages
========
acl-2.2.51-12.el7.x86_64
aic94xx-firmware-30-6.el7.noarch
alsa-firmware-1.0.28-2.el7.noarch
alsa-lib-1.0.28-2.el7.x86_64
alsa-tools-firmware-1.0.28-2.el7.x86_64
apr-1.4.8-3.el7.x86_64
apr-util-1.5.2-6.el7.x86_64
audit-2.4.1-5.el7.x86_64
audit-libs-2.4.1-5.el7.x86_64
augeas-libs-1.4.0-2.el7.x86_64
authconfig-6.2.8-10.el7.x86_64
autogen-libopts-5.18-5.el7.x86_64
avahi-autoipd-0.6.31-15.el7_2.1.x86_64
avahi-libs-0.6.31-15.el7_2.1.x86_64
basesystem-10.0-7.el7.centos.noarch
bash-4.2.46-19.el7.x86_64
bc-1.06.95-13.el7.x86_64
bind-libs-9.9.4-38.el7_3.3.x86_64
bind-libs-lite-9.9.4-38.el7_3.3.x86_64
bind-license-9.9.4-38.el7_3.3.noarch
bind-utils-9.9.4-38.el7_3.3.x86_64
binutils-2.23.52.0.1-55.el7.x86_64
biosdevname-0.6.2-1.el7.x86_64
boost-system-1.53.0-26.el7.x86_64
boost-thread-1.53.0-26.el7.x86_64
btrfs-progs-3.19.1-1.el7.x86_64
bzip2-libs-1.0.6-13.el7.x86_64
ca-certificates-2015.2.6-70.1.el7_2.noarch
centos-logos-70.0.6-3.el7.centos.noarch
centos-release-7-2.1511.el7.centos.2.10.x86_64
chkconfig-1.3.61-5.el7_2.1.x86_64
cifs-utils-6.2-9.el7.x86_64
coreutils-8.22-15.el7_2.1.x86_64
corosync-2.4.0-4.el7.x86_64
corosynclib-2.4.0-4.el7.x86_64
cpio-2.11-24.el7.x86_64
cpp-4.8.5-11.el7.x86_64
cracklib-2.9.0-11.el7.x86_64
cracklib-dicts-2.9.0-11.el7.x86_64
cronie-1.4.11-14.el7_2.1.x86_64
cronie-anacron-1.4.11-14.el7_2.1.x86_64
crontabs-1.11-6.20121102git.el7.noarch
cryptsetup-libs-1.6.7-1.el7.x86_64
cups-libs-1.6.3-26.el7.x86_64
curl-7.29.0-25.el7.centos.x86_64
cyrus-sasl-lib-2.1.26-20.el7_2.x86_64
dbus-1.6.12-13.el7.x86_64
dbus-glib-0.100-7.el7.x86_64
dbus-libs-1.6.12-13.el7.x86_64
dbus-python-1.1.1-9.el7.x86_64
device-mapper-1.02.107-5.el7_2.5.x86_64
device-mapper-event-1.02.107-5.el7_2.5.x86_64
device-mapper-event-libs-1.02.107-5.el7_2.5.x86_64
device-mapper-libs-1.02.107-5.el7_2.5.x86_64
device-mapper-persistent-data-0.5.5-1.el7.x86_64
dhclient-4.2.5-42.el7.centos.x86_64
dhcp-common-4.2.5-42.el7.centos.x86_64
dhcp-libs-4.2.5-42.el7.centos.x86_64
diffutils-3.3-4.el7.x86_64
dmidecode-2.12-9.el7.x86_64
dnsmasq-2.66-14.el7_1.x86_64
dracut-033-360.el7_2.1.x86_64
dracut-config-rescue-033-360.el7_2.1.x86_64
dracut-network-033-360.el7_2.1.x86_64
e2fsprogs-1.42.9-7.el7.x86_64
e2fsprogs-libs-1.42.9-7.el7.x86_64
ebtables-2.0.10-13.el7.x86_64
elfutils-libelf-0.163-3.el7.x86_64
elfutils-libs-0.163-3.el7.x86_64
elrepo-release-7.0-2.el7.elrepo.noarch
epel-release-7-9.noarch
ethtool-3.15-2.el7.x86_64
eventlog-0.2.13-4.el7.x86_64
expat-2.1.0-8.el7.x86_64
file-5.11-31.el7.x86_64
file-libs-5.11-31.el7.x86_64
filesystem-3.2-20.el7.x86_64
findutils-4.5.11-5.el7.x86_64
fipscheck-1.4.1-5.el7.x86_64
fipscheck-lib-1.4.1-5.el7.x86_64
firewalld-0.3.9-14.el7.noarch
fping-3.10-4.el7.x86_64
freeradius-3.0.4-7.el7_3.x86_64
freeradius-ldap-3.0.4-7.el7_3.x86_64
freeradius-utils-3.0.4-7.el7_3.x86_64
freetype-2.4.11-11.el7.x86_64
fxload-2002_04_11-16.el7.x86_64
gawk-4.0.2-4.el7.x86_64
gcc-4.8.5-11.el7.x86_64
gdbm-1.10-8.el7.x86_64
GeoIP-1.5.0-11.el7.x86_64
gettext-0.18.2.1-4.el7.x86_64
gettext-libs-0.18.2.1-4.el7.x86_64
glib2-2.42.2-5.el7.x86_64
glibc-2.17-157.el7_3.1.x86_64
glibc-common-2.17-157.el7_3.1.x86_64
glibc-devel-2.17-157.el7_3.1.x86_64
glibc-headers-2.17-157.el7_3.1.x86_64
glib-networking-2.42.0-1.el7.x86_64
gmp-6.0.0-12.el7_1.x86_64
gnupg2-2.0.22-3.el7.x86_64
gnutls-3.3.8-14.el7_2.x86_64
gobject-introspection-1.42.0-1.el7.x86_64
gpgme-1.3.2-5.el7.x86_64
gpg-pubkey-352c64e5-52ae6884
gpg-pubkey-4bd6ec30-4c37bb40
gpg-pubkey-ef8d349f-57b6233e
gpg-pubkey-f4a80eb5-53a7ff4b
gpm-libs-1.20.7-5.el7.x86_64
grep-2.20-2.el7.x86_64
groff-base-1.22.2-8.el7.x86_64
grub2-2.02-0.34.el7.centos.x86_64
grub2-tools-2.02-0.34.el7.centos.x86_64
grubby-8.28-17.el7.x86_64
gsettings-desktop-schemas-3.14.2-1.el7.x86_64
gssproxy-0.4.1-13.el7.x86_64
gzip-1.5-8.el7.x86_64
hardlink-1.0-19.el7.x86_64
hiera-1.3.4-5.el7.noarch
hostname-3.13-3.el7.x86_64
hwdata-0.252-8.1.el7.x86_64
info-5.1-4.el7.x86_64
initscripts-9.49.30-1.el7_2.2.x86_64
iproute-3.10.0-54.el7_2.1.x86_64
iprutils-2.4.8-1.el7.x86_64
iptables-1.4.21-16.el7.x86_64
iputils-20121221-7.el7.x86_64
irqbalance-1.0.7-5.el7.x86_64
ivtv-firmware-20080701-26.el7.noarch
ivykis-0.36.2-2.el7.x86_64
iwl1000-firmware-39.31.5.1-43.el7.noarch
iwl100-firmware-39.31.5.1-43.el7.noarch
iwl105-firmware-18.168.6.1-43.el7.noarch
iwl135-firmware-18.168.6.1-43.el7.noarch
iwl2000-firmware-18.168.6.1-43.el7.noarch
iwl2030-firmware-18.168.6.1-43.el7.noarch
iwl3160-firmware-22.0.7.0-43.el7.noarch
iwl3945-firmware-15.32.2.9-43.el7.noarch
iwl4965-firmware-228.61.2.24-43.el7.noarch
iwl5000-firmware-8.83.5.1_1-43.el7.noarch
iwl5150-firmware-8.24.2.2-43.el7.noarch
iwl6000-firmware-9.221.4.1-43.el7.noarch
iwl6000g2a-firmware-17.168.5.3-43.el7.noarch
iwl6000g2b-firmware-17.168.5.2-43.el7.noarch
iwl6050-firmware-41.28.5.1-43.el7.noarch
iwl7260-firmware-22.0.7.0-43.el7.noarch
iwl7265-firmware-22.0.7.0-43.el7.noarch
jansson-2.4-6.el7.x86_64
json-c-0.11-4.el7_0.x86_64
kbd-1.15.5-11.el7.x86_64
kbd-legacy-1.15.5-11.el7.noarch
kbd-misc-1.15.5-11.el7.noarch
kernel-3.10.0-327.22.2.el7.x86_64
kernel-headers-3.10.0-514.16.1.el7.x86_64
kernel-tools-3.10.0-327.22.2.el7.x86_64
kernel-tools-libs-3.10.0-327.22.2.el7.x86_64
kexec-tools-2.0.7-38.el7_2.1.x86_64
keyutils-1.5.8-3.el7.x86_64
keyutils-libs-1.5.8-3.el7.x86_64
kmod-20-5.el7.x86_64
kmod-libs-20-5.el7.x86_64
kpartx-0.4.9-85.el7_2.5.x86_64
krb5-libs-1.13.2-12.el7_2.x86_64
less-458-9.el7.x86_64
libacl-2.2.51-12.el7.x86_64
libaio-0.3.109-13.el7.x86_64
libarchive-3.1.2-10.el7_2.x86_64
libassuan-2.1.0-3.el7.x86_64
libattr-2.4.46-12.el7.x86_64
libbasicobjects-0.1.1-27.el7.x86_64
libblkid-2.23.2-26.el7_2.2.x86_64
libcap-2.22-8.el7.x86_64
libcap-ng-0.7.5-4.el7.x86_64
libcollection-0.6.2-27.el7.x86_64
libcom_err-1.42.9-7.el7.x86_64
libcroco-0.6.8-5.el7.x86_64
libcurl-7.29.0-25.el7.centos.x86_64
libdaemon-0.14-7.el7.x86_64
libdb-5.3.21-19.el7.x86_64
libdb-utils-5.3.21-19.el7.x86_64
libdrm-2.4.60-3.el7.x86_64
libedit-3.0-12.20121213cvs.el7.x86_64
libestr-0.1.9-2.el7.x86_64
libevent-2.0.21-4.el7.x86_64
libffi-3.0.13-16.el7.x86_64
libgcc-4.8.5-11.el7.x86_64
libgcrypt-1.5.3-12.el7_1.1.x86_64
libgomp-4.8.5-11.el7.x86_64
libgpg-error-1.12-3.el7.x86_64
libgudev1-219-19.el7_2.11.x86_64
libidn-1.28-4.el7.x86_64
libini_config-1.3.0-27.el7.x86_64
libldb-1.1.26-1.el7.x86_64
libmnl-1.0.3-7.el7.x86_64
libmodman-2.0.1-8.el7.x86_64
libmount-2.23.2-26.el7_2.2.x86_64
libmpc-1.0.1-3.el7.x86_64
libndp-1.2-6.el7_2.x86_64
libnet-1.1.6-7.el7.x86_64
libnetfilter_conntrack-1.0.4-2.el7.x86_64
libnfnetlink-1.0.1-4.el7.x86_64
libnfsidmap-0.25-15.el7.x86_64
libnl3-3.2.21-10.el7.x86_64
libnl3-cli-3.2.21-10.el7.x86_64
libpath_utils-0.2.1-27.el7.x86_64
libpcap-1.5.3-8.el7.x86_64
libpciaccess-0.13.4-2.el7.x86_64
libpipeline-1.2.3-3.el7.x86_64
libproxy-0.4.11-8.el7.x86_64
libpwquality-1.2.3-4.el7.x86_64
libqb-1.0-1.el7_3.1.x86_64
libref_array-0.1.5-27.el7.x86_64
libselinux-2.2.2-6.el7.x86_64
libselinux-python-2.2.2-6.el7.x86_64
libselinux-ruby-2.2.2-6.el7.x86_64
libselinux-utils-2.2.2-6.el7.x86_64
libsemanage-2.1.10-18.el7.x86_64
libsepol-2.1.9-3.el7.x86_64
libsmbclient-4.4.4-12.el7_3.x86_64
libsoup-2.48.1-3.el7.x86_64
libss-1.42.9-7.el7.x86_64
libssh2-1.4.3-10.el7_2.1.x86_64
libstdc++-4.8.5-4.el7.x86_64
libsysfs-2.1.0-16.el7.x86_64
libtalloc-2.1.6-1.el7.x86_64
libtasn1-3.8-2.el7.x86_64
libtdb-1.3.8-1.el7_2.x86_64
libteam-1.17-6.el7_2.x86_64
libtevent-0.9.28-1.el7.x86_64
libtirpc-0.2.4-0.8.el7.x86_64
libtool-ltdl-2.4.2-22.el7_3.x86_64
libunistring-0.9.3-9.el7.x86_64
libuser-0.60-7.el7_1.x86_64
libutempter-1.1.6-4.el7.x86_64
libuuid-2.23.2-26.el7_2.2.x86_64
libverto-0.2.5-4.el7.x86_64
libverto-tevent-0.2.5-4.el7.x86_64
libwbclient-4.4.4-12.el7_3.x86_64
libxml2-2.9.1-6.el7_2.3.x86_64
libxslt-1.1.28-5.el7.x86_64
libyaml-0.1.4-11.el7_0.x86_64
linux-firmware-20150904-43.git6ebf5d5.el7.noarch
lm_sensors-3.4.0-4.20160601gitf9185e5.el7.x86_64
lm_sensors-libs-3.4.0-4.20160601gitf9185e5.el7.x86_64
log4cxx-0.10.0-16.el7.x86_64
logrotate-3.8.6-12.el7.x86_64
lsof-4.87-4.el7.x86_64
lsscsi-0.27-3.el7.x86_64
lua-5.1.4-14.el7.x86_64
lvm2-2.02.130-5.el7_2.5.x86_64
lvm2-libs-2.02.130-5.el7_2.5.x86_64
lzo-2.06-8.el7.x86_64
make-3.82-21.el7.x86_64
man-db-2.6.3-9.el7.x86_64
mariadb-libs-5.5.47-1.el7_2.x86_64
mozjs17-17.0.0-12.el7.x86_64
mpfr-3.1.1-4.el7.x86_64
nagios-common-4.2.4-2.el7.x86_64
nagios-plugins-2.1.4-2.el7.x86_64
nagios-plugins-all-2.1.4-2.el7.x86_64
nagios-plugins-breeze-2.1.4-2.el7.x86_64
nagios-plugins-by_ssh-2.1.4-2.el7.x86_64
nagios-plugins-cluster-2.1.4-2.el7.x86_64
nagios-plugins-dhcp-2.1.4-2.el7.x86_64
nagios-plugins-dig-2.1.4-2.el7.x86_64
nagios-plugins-disk-2.1.4-2.el7.x86_64
nagios-plugins-disk_smb-2.1.4-2.el7.x86_64
nagios-plugins-dns-2.1.4-2.el7.x86_64
nagios-plugins-dummy-2.1.4-2.el7.x86_64
nagios-plugins-file_age-2.1.4-2.el7.x86_64
nagios-plugins-flexlm-2.1.4-2.el7.x86_64
nagios-plugins-fping-2.1.4-2.el7.x86_64
nagios-plugins-game-2.1.4-2.el7.x86_64
nagios-plugins-hpjd-2.1.4-2.el7.x86_64
nagios-plugins-http-2.1.4-2.el7.x86_64
nagios-plugins-icmp-2.1.4-2.el7.x86_64
nagios-plugins-ide_smart-2.1.4-2.el7.x86_64
nagios-plugins-ircd-2.1.4-2.el7.x86_64
nagios-plugins-ldap-2.1.4-2.el7.x86_64
nagios-plugins-load-2.1.4-2.el7.x86_64
nagios-plugins-log-2.1.4-2.el7.x86_64
nagios-plugins-mailq-2.1.4-2.el7.x86_64
nagios-plugins-mrtg-2.1.4-2.el7.x86_64
nagios-plugins-mrtgtraf-2.1.4-2.el7.x86_64
nagios-plugins-mysql-2.1.4-2.el7.x86_64
nagios-plugins-nagios-2.1.4-2.el7.x86_64
nagios-plugins-nt-2.1.4-2.el7.x86_64
nagios-plugins-ntp-2.1.4-2.el7.x86_64
nagios-plugins-ntp-perl-2.1.4-2.el7.x86_64
nagios-plugins-nwstat-2.1.4-2.el7.x86_64
nagios-plugins-oracle-2.1.4-2.el7.x86_64
nagios-plugins-overcr-2.1.4-2.el7.x86_64
nagios-plugins-perl-2.1.4-2.el7.x86_64
nagios-plugins-pgsql-2.1.4-2.el7.x86_64
nagios-plugins-ping-2.1.4-2.el7.x86_64
nagios-plugins-procs-2.1.4-2.el7.x86_64
nagios-plugins-real-2.1.4-2.el7.x86_64
nagios-plugins-rpc-2.1.4-2.el7.x86_64
nagios-plugins-sensors-2.1.4-2.el7.x86_64
nagios-plugins-smtp-2.1.4-2.el7.x86_64
nagios-plugins-snmp-2.1.4-2.el7.x86_64
nagios-plugins-ssh-2.1.4-2.el7.x86_64
nagios-plugins-swap-2.1.4-2.el7.x86_64
nagios-plugins-tcp-2.1.4-2.el7.x86_64
nagios-plugins-time-2.1.4-2.el7.x86_64
nagios-plugins-ups-2.1.4-2.el7.x86_64
nagios-plugins-users-2.1.4-2.el7.x86_64
nagios-plugins-wave-2.1.4-2.el7.x86_64
nano-2.3.1-10.el7.x86_64
ncurses-5.9-13.20130511.el7.x86_64
ncurses-base-5.9-13.20130511.el7.noarch
ncurses-libs-5.9-13.20130511.el7.x86_64
net-snmp-libs-5.7.2-24.el7_3.2.x86_64
net-snmp-utils-5.7.2-24.el7_3.2.x86_64
nettle-2.7.1-4.el7.x86_64
net-tools-2.0-0.17.20131004git.el7.x86_64
NetworkManager-1.0.6-30.el7_2.x86_64
NetworkManager-libnm-1.0.6-30.el7_2.x86_64
NetworkManager-team-1.0.6-30.el7_2.x86_64
NetworkManager-tui-1.0.6-30.el7_2.x86_64
NetworkManager-wifi-1.0.6-30.el7_2.x86_64
newt-0.52.15-4.el7.x86_64
newt-python-0.52.15-4.el7.x86_64
nfs-utils-1.3.0-0.33.el7_3.x86_64
nrpe-2.15-7.el7.x86_64
nspr-4.11.0-1.el7_2.x86_64
nss-3.21.0-9.el7_2.x86_64
nss-softokn-3.16.2.3-14.2.el7_2.x86_64
nss-softokn-freebl-3.16.2.3-14.2.el7_2.x86_64
nss-sysinit-3.21.0-9.el7_2.x86_64
nss-tools-3.21.0-9.el7_2.x86_64
nss-util-3.21.0-2.2.el7_2.x86_64
ntp-4.2.6p5-25.el7.centos.2.x86_64
ntpdate-4.2.6p5-25.el7.centos.2.x86_64
numactl-libs-2.0.9-6.el7_2.x86_64
openldap-2.4.40-9.el7_2.x86_64
openssh-6.6.1p1-25.el7_2.x86_64
openssh-clients-6.6.1p1-25.el7_2.x86_64
openssh-server-6.6.1p1-25.el7_2.x86_64
openssl-1.0.1e-51.el7_2.5.x86_64
openssl-libs-1.0.1e-51.el7_2.5.x86_64
os-prober-1.58-5.el7.x86_64
p11-kit-0.20.7-3.el7.x86_64
p11-kit-trust-0.20.7-3.el7.x86_64
pacemaker-1.1.15-11.el7_3.4.x86_64
pacemaker-cli-1.1.15-11.el7_3.4.x86_64
pacemaker-cluster-libs-1.1.15-11.el7_3.4.x86_64
pacemaker-libs-1.1.15-11.el7_3.4.x86_64
pam-1.1.8-18.el7.x86_64
pam-devel-1.1.8-18.el7.x86_64
parted-3.1-23.el7.x86_64
passwd-0.79-4.el7.x86_64
pciutils-3.2.1-4.el7.x86_64
pciutils-libs-3.2.1-4.el7.x86_64
pcre-8.32-15.el7_2.1.x86_64
pcs-0.9.152-10.el7.centos.3.x86_64
perl-5.16.3-286.el7.x86_64
perl-Carp-1.26-244.el7.noarch
perl-Compress-Raw-Bzip2-2.061-3.el7.x86_64
perl-Compress-Raw-Zlib-2.061-4.el7.x86_64
perl-constant-1.27-2.el7.noarch
perl-Data-Dumper-2.145-3.el7.x86_64
perl-DBI-1.627-4.el7.x86_64
perl-Encode-2.51-7.el7.x86_64
perl-Exporter-5.68-3.el7.noarch
perl-File-Path-2.09-2.el7.noarch
perl-File-Temp-0.23.01-3.el7.noarch
perl-Filter-1.49-3.el7.x86_64
perl-Getopt-Long-2.40-2.el7.noarch
perl-HTTP-Tiny-0.033-3.el7.noarch
perl-IO-Compress-2.061-2.el7.noarch
perl-libs-5.16.3-286.el7.x86_64
perl-macros-5.16.3-286.el7.x86_64
perl-Net-Daemon-0.48-5.el7.noarch
perl-parent-0.225-244.el7.noarch
perl-PathTools-3.40-5.el7.x86_64
perl-PlRPC-0.2020-14.el7.noarch
perl-Pod-Escapes-1.04-286.el7.noarch
perl-podlators-2.5.1-3.el7.noarch
perl-Pod-Perldoc-3.20-4.el7.noarch
perl-Pod-Simple-3.28-4.el7.noarch
perl-Pod-Usage-1.63-3.el7.noarch
perl-Scalar-List-Utils-1.27-248.el7.x86_64
perl-Socket-2.010-3.el7.x86_64
perl-Storable-2.45-3.el7.x86_64
perl-Text-ParseWords-3.29-4.el7.noarch
perl-threads-1.87-4.el7.x86_64
perl-threads-shared-1.43-6.el7.x86_64
perl-TimeDate-2.30-2.el7.noarch
perl-Time-HiRes-1.9725-3.el7.x86_64
perl-Time-Local-1.2300-2.el7.noarch
pinentry-0.8.1-14.el7.x86_64
pkgconfig-0.27.1-4.el7.x86_64
plymouth-0.8.9-0.24.20140113.el7.centos.x86_64
plymouth-core-libs-0.8.9-0.24.20140113.el7.centos.x86_64
plymouth-scripts-0.8.9-0.24.20140113.el7.centos.x86_64
policycoreutils-2.2.5-20.el7.x86_64
polkit-0.112-7.el7_2.x86_64
polkit-pkla-compat-0.1-4.el7.x86_64
popt-1.13-16.el7.x86_64
postfix-2.10.1-6.el7.x86_64
postgresql-libs-9.2.18-1.el7.x86_64
ppp-2.4.5-33.el7.x86_64
procps-ng-3.3.10-5.el7_2.x86_64
psmisc-22.20-11.el7.x86_64
pth-2.0.7-23.el7.x86_64
puppet-agent-1.10.0-1.el7.x86_64
puppetlabs-release-pc1-1.1.0-5.el7.noarch
pygobject3-base-3.14.0-3.el7.x86_64
pygpgme-0.3-9.el7.x86_64
pyliblzma-0.5.3-11.el7.x86_64
python-2.7.5-34.el7.x86_64
python2-pip-8.1.2-5.el7.noarch
python34-3.4.5-3.el7.x86_64
python34-devel-3.4.5-3.el7.x86_64
python34-libs-3.4.5-3.el7.x86_64
python34-pip-8.1.2-5.el7.noarch
python34-setuptools-19.2-3.el7.noarch
python3-rpm-macros-3-17.el7.noarch
python-backports-1.0-8.el7.x86_64
python-backports-ssl_match_hostname-3.4.0.2-4.el7.noarch
python-clufter-0.59.5-2.el7.x86_64
python-configobj-4.7.2-7.el7.noarch
python-decorator-3.4.0-3.el7.noarch
python-iniparse-0.4-9.el7.noarch
python-libs-2.7.5-34.el7.x86_64
python-lxml-3.2.1-4.el7.x86_64
python-netifaces-0.10.4-3.el7.x86_64
python-perf-3.10.0-327.22.2.el7.x86_64
python-pycurl-7.19.0-17.el7.x86_64
python-pyudev-0.15-7.el7_2.1.noarch
python-rpm-macros-3-17.el7.noarch
python-setuptools-0.9.8-4.el7.noarch
python-slip-0.4.0-2.el7.noarch
python-slip-dbus-0.4.0-2.el7.noarch
python-srpm-macros-3-17.el7.noarch
python-urlgrabber-3.10-7.el7.noarch
pyxattr-0.5.1-5.el7.x86_64
qrencode-libs-3.4.1-3.el7.x86_64
qstat-2.11-13.20080912svn311.el7.x86_64
quota-4.01-14.el7.x86_64
quota-nls-4.01-14.el7.noarch
rdma-7.2_4.1_rc6-2.el7.noarch
readline-6.2-9.el7.x86_64
resource-agents-3.9.5-82.el7_3.9.x86_64
rootfiles-8.1-11.el7.noarch
rpcbind-0.2.0-38.el7.x86_64
rpm-4.11.3-17.el7.x86_64
rpm-build-libs-4.11.3-17.el7.x86_64
rpm-libs-4.11.3-17.el7.x86_64
rpm-python-4.11.3-17.el7.x86_64
rsync-3.0.9-17.el7.x86_64
rsyslog-7.4.7-12.el7.x86_64
ruby-2.0.0.648-29.el7.x86_64
ruby-augeas-0.5.0-1.el7.x86_64
ruby-devel-2.0.0.648-29.el7.x86_64
rubygem-bigdecimal-1.2.0-25.el7_1.x86_64
rubygem-io-console-0.4.2-25.el7_1.x86_64
rubygem-json-1.7.7-25.el7_1.x86_64
rubygem-psych-2.0.0-25.el7_1.x86_64
rubygem-rdoc-4.0.0-29.el7.noarch
rubygem-rgen-0.6.6-2.el7.noarch
rubygems-2.0.14.1-29.el7.noarch
ruby-irb-2.0.0.648-29.el7.noarch
ruby-libs-2.0.0.648-29.el7.x86_64
ruby-shadow-1.4.1-23.el7.x86_64
samba-client-4.4.4-12.el7_3.x86_64
samba-client-libs-4.4.4-12.el7_3.x86_64
samba-common-4.4.4-12.el7_3.noarch
samba-common-libs-4.4.4-12.el7_3.x86_64
sed-4.2.2-5.el7.x86_64
selinux-policy-3.13.1-60.el7_2.7.noarch
selinux-policy-targeted-3.13.1-60.el7_2.7.noarch
setup-2.8.71-6.el7.noarch
shadow-utils-4.1.5.1-18.el7.x86_64
shared-mime-info-1.1-9.el7.x86_64
slang-2.2.4-11.el7.x86_64
snappy-1.1.0-3.el7.x86_64
sqlite-3.7.17-8.el7.x86_64
sudo-1.8.6p7-21.el7_3.x86_64
syslog-ng-3.5.6-3.el7.x86_64
systemd-219-19.el7_2.11.x86_64
systemd-libs-219-19.el7_2.11.x86_64
systemd-sysv-219-19.el7_2.11.x86_64
sysvinit-tools-2.88-14.dsf.el7.x86_64
tar-1.26-29.el7.x86_64
tcpdump-4.5.1-3.el7.x86_64
tcp_wrappers-7.6-77.el7.x86_64
tcp_wrappers-libs-7.6-77.el7.x86_64
teamd-1.17-6.el7_2.x86_64
telnet-0.17-60.el7.x86_64
tftp-5.2-13.el7.x86_64
tncfhh-0.8.3-16.el7.x86_64
tncfhh-libs-0.8.3-16.el7.x86_64
tncfhh-utils-0.8.3-16.el7.x86_64
trousers-0.3.13-1.el7.x86_64
tuned-2.5.1-4.el7_2.3.noarch
tzdata-2016f-1.el7.noarch
ustr-1.0.4-16.el7.x86_64
util-linux-2.23.2-26.el7_2.2.x86_64
vim-common-7.4.160-1.el7.x86_64
vim-enhanced-7.4.160-1.el7.x86_64
vim-filesystem-7.4.160-1.el7.x86_64
vim-minimal-7.4.160-1.el7.x86_64
virt-what-1.13-6.el7.x86_64
which-2.20-7.el7.x86_64
wpa_supplicant-2.0-17.el7_1.x86_64
xerces-c-3.1.1-8.el7_2.x86_64
xfsprogs-3.2.2-2.el7.x86_64
xinetd-2.3.15-13.el7.x86_64
xz-5.1.2-12alpha.el7.x86_64
xz-libs-5.1.2-12alpha.el7.x86_64
yum-3.4.3-132.el7.centos.0.1.noarch
yum-metadata-parser-1.1.4-10.el7.x86_64
yum-plugin-fastestmirror-1.1.31-34.el7.noarch
zlib-1.2.7-15.el7.x86_64

_Describe your issue in as much detail as possible..._

*Desired Behavior:*

Timeout when an md5 on a file takes too long, with an error that states what the file is.

*Actual Behavior:*

If you recursively update a directory in which there is a symlink to /dev/urandom, puppet hangs. This is caused by puppet trying to do an md5 hash on a file that has no end.

It hangs indefinitely without an error message.

This was noticed when trying to create a custom module for freeradius. The Centos 7 freeradius package creates a /etc/raddb/certs/random file which symlinks to /dev/urandom during installation.

We got around the problem using an ignore statement, but we wasted a few days trying to figure out the cause.

Please take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.",Bug,PUP-8176,[],Puppet Hangs when recursing directories with link to /dev/urandom in the tree
"Problem -: Puppet run fails on windows server 2016 after installing role - remote desktop session host.

 ************************************************************************************************
 Error: /File[C:/ProgramData/PuppetLabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': getaddrinfo: No such host is known.
 Error: /File[C:/ProgramData/PuppetLabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: getaddrinfo: No such host is known.
 Info: Retrieving plugin
 Error: /File[C:/ProgramData/PuppetLabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': getaddrinfo: No such host is known.
 Error: /File[C:/ProgramData/PuppetLabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: getaddrinfo: No such host is known.
 Info: Loading facts
 Error: Could not retrieve catalog from remote server: getaddrinfo: No such host is known.
 Warning: Not using cache on failed catalog
 Error: Could not retrieve catalog; skipping run
 Error: Could not send report: getaddrinfo: No such host is known.
  
 *************************************************************************************************
 
 
 
 
Observations :

1) Puppet run is successfully executed before the installation of role - remote desktop session host.
2) Immediately after installation of RD session host puppet execution fails. 
3) Puppet communicates on port 8140 with master which is verified and open.


Puppet execution is verified with windows server 2008 which is working fine with the RD session host role. ﻿",Bug,PUP-8175,"['puppe', 'puppet-agent', 'windows']", facing problem with puppet-agent on window server 2016.
"Currently, I have 4 pip packages on infinite install, due to the hyphen character being in the package name instead of an underscore in the package name.
During install of the package, the name uses an underscore.
After the package is installed, the package name returns with a hyphen instead of an underscore.

Examples I have come across include:
smart_open
int_date
cx_Oracle
pandas_oracle

I am sure there are more out there...

The python documentation states that ""All comparisons of distribution names MUST be case insensitive, and MUST consider hyphens and underscores to be equivalent."" source: https://www.python.org/dev/peps/pep-0426/#name

My update attempts to resolve this problem by gsubing all hyphens for underscores in the @resource:name and provider_pip.name to make hyphens and underscores equivalent.",Bug,PUP-8174,[],pip provider package install loop
"While trying to set up a package installation on Windows 7 OS, the file resource works finely and transfers the file from the server to the node, but the package resource keeps receiving the error ""Incorrect Function"". I have tried with codeblocks installer and firefox installer, same result. Have tried with install_options for silent installation on both and without it, same result.

I have read about a possible bug here: https://projects.puppetlabs.com/issues/21496

Although I am not sure if it is still a bug or am I doing something wrongly. I wish I could get any help.",Bug,PUP-8173,"['install_options', 'installation', 'installer', 'package', 'puppet-agent', 'resources']",Puppet 3.8.7 on Windows - Package .exe Installation - Incorrect Function 
"If hostA has a manifest that includes these two stanzas:
{quote}@@host {$::fqdn:
 ip => $::ipaddress,
 host_aliases => $::hostname,
 tag => $stratum,
 before => [],
 }
{quote}
and
{quote}Host <| |> -> Service['lsf']
{quote}
Then puppetserver/agent exports these to puppetdb such that any machine realizing Host<<| |>> must also have defined an 'lsf' service or the catalogue will fail to compile.

This is unexpected behaviour. And is not documented AFAICT as a consequence of using chained deps in the docs: [https://puppet.com/docs/puppet/4.10/lang_relationships.html#caveats-when-chaining-resource-collectors]

Here is an actual example from a JSON query from puppetdb (edited to remove confidential information):
{noformat}puppet/:0 root@puppet:manifests$ curl -G -H  ""Accept: application/json"" 'http://localhost:8080/pdb/query/v4/resources' --data-urlencode 'query= [""and"" ,[""="",""certname"",""xxxxxxxxxxx""],[""="",""exported"", true]]' --data-urlencode 'pretty=true'
[ {
  ""tags"" : [ ""xxxxxxxxx"", ""host"", ""class"", ""xxx::collect_hostnames"", ""xxx::all_machines"", ""all_machines"", ""all_machines_really"", ""xxx"", ""app-dev"", ""xxx::all_machines_really"", ""collect_hostnames"", ""default"", ""node"" ],
  ""file"" : ""/etc/puppetlabs/code/environments/international_aws_test/site_data/xxx/manifests/collect_hostnames.pp"",
  ""type"" : ""Host"",
  ""title"" : ""xxxxxxxxxxxxxxxxxxxxxxxxxxx"",
  ""line"" : 58,
  ""resource"" : ""f38eac2870292d6fb49999286c67dd181c3bca61"",
  ""environment"" : ""international_aws_test"",
  ""certname"" : ""xxxxxxxxxxxxxxx"",
  ""parameters"" : {
    ""ip"" : ""10.102.0.223"",
    ""tag"" : ""app-dev"",
    ""before"" : [ ""Service[lsf]"" ],
    ""host_aliases"" : ""ssh""
  },
  ""exported"" : true
} ]
puppet/:0 root@puppet:manifests$ puppet --version
4.10.6
puppet/:0 root@puppet:manifests$
{noformat}
I've not noticed this behavour in puppet v3.

Please could it be confirm if this is expected behaviour or not.

If it is could the docs be updated with an extra caveat to cover this?
If this is not expected behaviour please could this be fixed?

An optional way to stop this chained dep being exported would be appechiated.",Bug,PUP-8172,['puppet'],Puppet 4.10.6 exporting chained dep to puppetdb
"Currently it is not possible to use a signature returned from something that is callable with named arguments to check against a set of arguments. This because there is only a {{callable_with?}} method that assumes that the call is made with positional arguments.

This makes it impossible to use this for  task plan argument checking,

The solution is to handle this in the PAL API in a way that is more convenient for a user. The {{function_signature}} and {{plan_signature}} should return PAL specific objects that allows interaction with the signature(s) as the underlying details are too generic. The PAL 'signature' objects should have a simple way to answer {{callable_with?}} that suits the respective callable type. They should also have a way to get the detailed information for further introspection for a user that wants for instance the details per overloaded dispatch in a function.",New Feature,PUP-8171,[],PAL: add support for easy checking if function or plan is callable with a given set of arguments
"It is of value to be able to parse the puppet language and get back an AST. There should be two methods available:

* parse_string
* parse_file

Both returning an AST (or raising an error if the parsed source is not valid).

And then two methods for evaluation:

* evaluate(ast)
* evaluate_literal(ast)

",New Feature,PUP-8170,[],Add support for parsing in the PAL API
"Getting the tokens from the lexer is of value for various applications using puppet as a library.
There should be two methods available:
* lex_string
* lex_file

Both returning an Array of tokens. On a lexical error an error is raised.",New Feature,PUP-8169,[],Add support for Lexing in the PAL API
"In order to make it possible to use Puppet as a library you need to know a lot about the inner workings of puppet. In order to make this simpler we have created an API known as PAL (short for ""Puppet As a Library""). 

This work was done as part of support tasks and plans and integration with Bolt. See linked predocs for what is currently available on the feature branch with task support (to be merged back into puppet).

This epic is for additional work on the Puppet PAL - not necessarily exclusively for supporting Bolt.",Epic,PUP-8168,[],Puppet as a Library (PAL) features for Puppet 5.y
"A behavior change introduced in PUP-6797 for the SMF service provider breaks existing code for customers that are upgrading. The SMF provider now sets a service as _absent_ instead of _stopped_ when the service is not found on the system. The service provider does not check for the existence of the service when trying to stop the service. The result is that configuring an absent service to be stopped will error out, where as it previously succeeded. 

The issue is not with the _absent_ change, but rather that the _stop_ is run against the _absent_ service. Below is an easy reproduction case. 

Install any agent 4.9.0+ and apply the following manifest. 

{code}
# cat test.pp
service {'svc:/system/console-login:terma':
ensure => stopped,
enable => false,
provider => 'smf',
}
{code}

The resulting output is as follows.

{code}
Debug: Executing: '/usr/bin/svcs -H -o state,nstate svc:/system/console-login:terma'
Debug: Service[svc:/system/console-login:terma](provider=smf): Could not get status on service svc:/system/console-login:terma Execution of '/usr/bin/svcs -H -o state,nstate svc:/system/console-login:terma' returned 1: svcs: Pattern 'svc:/system/console-login:terma' doesn't match any instances
Debug: Executing: '/usr/sbin/svcadm disable -s svc:/system/console-login:terma'
Error: Could not stop Service[svc:/system/console-login:terma]: Execution of '/usr/sbin/svcadm disable -s svc:/system/console-login:terma' returned 1: svcadm: Pattern 'svc:/system/console-login:terma' doesn't match any instances
Error: /Stage[main]/Main/Service[svc:/system/console-login:terma]/ensure: change from absent to stopped failed: Could not stop Service[svc:/system/console-login:terma]: Execution of '/usr/sbin/svcadm disable -s svc:/system/console-login:terma' returned 1: svcadm: Pattern 'svc:/system/console-login:terma' doesn't match any instances
{code}

What I would expect is that since the service is marked as absent per [this commit|https://github.com/puppetlabs/puppet/commit/3d7a3c4c1c6697047ae356c8765928f68618bc69#diff-aacae589790e4f5cfb9e267afbffa294] and then the stop service should not be run since the service is absent. The service resource does not provide an _absent_ value to the _ensure_ parameter. ",Bug,PUP-8167,[],Service SMF provider tries to stop absent service
"An epic to capture improvements to Puppet's management of local users and groups in a directory (e.g. LDAP, Active Directory) environment.",Epic,PUP-8166,[],Managing local users/groups in a directory environment
An epic to capture improvements to Puppet's management of packages on Debian (and Debian-based systems).,Epic,PUP-8165,[],Debian package management improvements
An epic to capture improvements to Puppet's management of zpools and zfs.,Epic,PUP-8164,[],ZFS/Zpool type/provider improvements
An epic to capture improvements to Puppet's management of users and groups on macOS. ,Epic,PUP-8163,[],macOS user/group management improvements
An epic to capture improvements to Puppet's management of packages on macOS. ,Epic,PUP-8162,[],macOS package management improvements
An epic to capture improvements to Puppet's management of users and groups on AIX. ,Epic,PUP-8161,[],AIX user/group provider improvements
An epic to capture improvements to Puppet's management of packages on FreeBSD. ,Epic,PUP-8160,[],FreeBSD package management improvements
An epic to capture improvements to Puppet's management of packages on AIX. ,Epic,PUP-8159,[],AIX package management improvements
An epic to capture improvements to Puppet's management of client-side yum repository configuration.,Epic,PUP-8158,[],Yumrepo type/provider improvements
An epic to capture improvements to Puppet's management of RPM packages using 'yum' and 'dnf'.,Epic,PUP-8157,[],Yum/DNF package provider improvements
An epic to capture improvements to Puppet's management of packages on Solaris.,Epic,PUP-8156,[],Solaris package management improvements
An epic to capture improvements to Puppet's management of services on Solaris.,Epic,PUP-8155,[],Solaris service management improvements
An epic to capture improvements to Puppet's management of users and groups on SUSE Linux. ,Epic,PUP-8154,[],SUSE user/group management improvements
An epic to capture improvements to Puppet's management of services on SUSE Linux. ,Epic,PUP-8153,[],SUSE service management improvements
An epic to capture improvements to Puppet's management of services on Microsoft Windows. ,Epic,PUP-8152,[],Windows service management improvements
An epic to capture improvements to Puppet's management of users on Microsoft Windows. ,Epic,PUP-8151,[],Windows user management improvements
An epic to capture improvements to Puppet's management of packages on Microsoft Windows. ,Epic,PUP-8150,[],Windows package provider improvements
An epic to capture improvements to Puppet's management of RPM packages using the 'rpm' binary. ,Epic,PUP-8149,[],RPM package provider improvements
"+Background+: As part of FIPS work, puppet agent was being tested against the puppet agent's acceptance tests on a FIP enabled system with the digest_algorithm set to sha256 (md5, the default digest algorithm, is not allowed in FIPS). That had some failures. Details of that work are in PA-1277.

In order to have a baseline of which of the agent acceptance tests fail when using sha256 digest_algorithm *while not in FIPS mode* did a run of agent acceptance tests while setting the algorithm on both agent and the master nodes. 

The first run was done in this manner:  Do a clean run of agent acceptance tests while preserving the hosts. Update the digest algorithm on both nodes to sha256. Re-run the whole suite of agent acceptance tests on the preserved hosts. It results in 24 failed and 34 errored tests - which are not seen during the first clean/baseline run. Log captured in acceptance_run_preserved_sha256_nofips_2017-07-26-15_19_57.log (tar'ed)

In order to account for concerns around starting on a _dirty state_ in the above attempt, following was done: 
Used beaker to provision and install agent and master nodes and ran only one test (puppet_apply_basics.rb) with the hosts preserved. Adjusted the digest_algorithm to sha256 on both nodes. Ran full suite of agent acceptance tests. That yielded 23 failed and 35 errored test cases.  Log captured in acceptance_run_preserved_sha256_nofips_2017-07-31-20_30_31.log (tar'd). 

This is to investigate whether the tests have any assumptions on the digest algorithm or there are some genuine issues either on agent or on server when using sha256. 

",Bug,PUP-8148,[],Puppet acceptance tests fail when using sha256 hash alg
"Some types, like the {{Enum}} will allow iteration over the type parameters. E.g. it's legal to write:
{code:puppet}
Enum['a', 'b'].each |$tp| { ... }
{code}
However, if an alias is declared for this type, then that alias is not iterable:
{code:puppet}
type Custom = Enum['a', 'b']
Custom.each |$tp| { ... } # Error
{code}

",Bug,PUP-8147,[],An aliased type should inherit the traits of the type that it is an alias for
"If a class has many parameters and you want to make all hash parameters have hash or deep merge and all array parameters to have unique merge while all non collection values have first found strategy then it is not possible to define all of that with one pattern for the class itself. Instead you would need to individually list all keys, or be very clever with the use of suffixes on the parameter names (for example plural 's', or 'list' for arrays, and 'map' or 'hash' on hashes) and the pattern match on those.

It would be great to be able to specify some kind of combined pattern 'first+unique+hash/deep'. and that they apply to the respective data type being found.

This only applies for a pattern based lookup_options since everywhere else the lookup is for a  single key - although there is no harm in having this as a ""i don't know what the type is"" but please merge/unique hashes and arrays...",New Feature,PUP-8146,[],consider combined merge strategies for lookup_option with patterns
"When backing up a file resource to filebucket where the file path contains spaces, see manifest snippit:

{code}
class space {
	file { 'C:\Test space\space.txt':
 	 ensure => 'file',
	 content => 'testing',
	}
}
{code}



 the following error occurs:


{code}
Info: Computing checksum on file C:/Test space/space.txt
Error: Could not back up C:/Test space/space.txt: Error 500 on SERVER: Server Error
Error: Could not back up C:/Test space/space.txt: Error 500 on SERVER: Server Error
Error: /Stage[main]/Space/File[C:\Test space\space.txt]/content: change from '{md5}d41d8cd98f00b204e9800998ecf8427e' to
'{md5}ae2b1fca515949e5d54fb22b8ed95575' failed: Could not back up C:/Test space/space.txt: Error 500 on SERVER: Server E
rror
{code}


The following is a stack trace from the puppetserver

{code}

2017-11-10 16:26:54,060 WARN  [qtp1046413756-73] [o.e.j.s.HttpChannel] /puppet/v3/file_bucket_file/md5/d41d8cd98f00b204e9800998ecf8427e/C:/Test%20space/space.txt
javax.servlet.ServletException: java.net.URISyntaxException: Illegal character in path at index 80: file:////puppet/v3/file_bucket_file/md5/d41d8cd98f00b204e9800998ecf8427e/C:/Test space/space.txt
	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)
	at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:454)
	at org.eclipse.jetty.server.handler.RequestLogHandler.handle(RequestLogHandler.java:56)
	at org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:169)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)
	at org.eclipse.jetty.server.Server.handle(Server.java:564)
	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:317)
	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)
	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:279)
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:110)
	at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:278)
	at org.eclipse.jetty.io.ssl.SslConnection$3.succeeded(SslConnection.java:148)
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:110)
	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)
	at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:128)
	at org.eclipse.jetty.util.thread.Invocable$InvocableExecutor.invoke(Invocable.java:222)
	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:294)
	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:199)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:672)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:590)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.net.URISyntaxException: Illegal character in path at index 80: file:////puppet/v3/file_bucket_file/md5/d41d8cd98f00b204e9800998ecf8427e/C:/Test space/space.txt
	at java.net.URI$Parser.fail(URI.java:2848)
	at java.net.URI$Parser.checkChars(URI.java:3021)
	at java.net.URI$Parser.parseHierarchical(URI.java:3105)
	at java.net.URI$Parser.parse(URI.java:3053)
	at java.net.URI.<init>(URI.java:588)
	at bidi.bidi$just_path.invokeStatic(bidi.cljc:191)
	at bidi.bidi$just_path.invoke(bidi.cljc:187)
	at clojure.core$update.invokeStatic(core.clj:5960)
	at clojure.core$update.invoke(core.clj:5952)
	at bidi.bidi$match_pair.invokeStatic(bidi.cljc:200)
	at bidi.bidi$match_pair.invoke(bidi.cljc:195)
	at bidi.bidi$match_route_STAR_.invokeStatic(bidi.cljc:382)
	at bidi.bidi$match_route_STAR_.invoke(bidi.cljc:380)
	at bidi.bidi$match_route.invokeStatic(bidi.cljc:389)
	at bidi.bidi$match_route.doInvoke(bidi.cljc:385)
	at clojure.lang.RestFn.applyTo(RestFn.java:142)
	at clojure.core$apply.invokeStatic(core.clj:650)
	at clojure.core$apply.invoke(core.clj:641)
	at puppetlabs.comidi$eval22182$wrap_with_route_metadata__22187$fn__22188$fn__22190.invoke(comidi.clj:334)
	at puppetlabs.trapperkeeper.services.webserver.jetty9_core$ring_handler$fn__32216.invoke(jetty9_core.clj:426)
	at puppetlabs.trapperkeeper.services.webserver.jetty9_core.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a.handle(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)
	at clojure.lang.Reflector.invokeInstanceMethod(Reflector.java:28)
	at puppetlabs.trapperkeeper.services.webserver.normalized_uri_helpers$eval31793$normalize_uri_handler__31798$fn__31799$fn__31800.invoke(normalized_uri_helpers.clj:74)
	at puppetlabs.trapperkeeper.services.webserver.normalized_uri_helpers.proxy$org.eclipse.jetty.server.handler.HandlerWrapper$ff19274a.handle(Unknown Source)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)
	at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:190)
	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253)
	at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:170)
	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:219)
	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126)
	... 20 common frames omitted
2017-11-10 16:26:54,679 INFO  [qtp1046413756-72] [puppetserver] Puppet 'store_report' command for pe-201731-agent-win2012 submitted to PuppetDB with UUID 03d74b92-ed58-4a1d-bdaa-c9547da0feb3
{code}

",Bug,PUP-8145,[],Spaces in file resource paths break filebucket
"The documentation for the [`first|unique|hash`](https://puppet.com/docs/puppet/5.3/hiera_merging.html#strategy--firstuniquehash) merge strategy is brief, and does not explain usage or functionality of the merge strategy in a similar way to the documentation for the other merge strategies.

The entirety of the current documentation for this strategy is one sentance:

> Same as the string versions of these merge behaviors.

This doesn't tell me anything, since obviously it's not the same, or it wouldn't be an additonal option. Mainly, I believe it's implying that hiera will try to select the appropriate strategy based on the data-type. However that raises the question of how the `unique` or `hash` strategy would be applied to a key when `first` is also present (which ignores all merge's entirely).",Improvement,PUP-8144,[],Merge Strategy 'first|unique|hash' documentation is unclear
"The service resource with the init provider in puppet 5.3.3 does not work for all services in Solaris. The service start is called, however the service is never started. This is a regression from 4.10.8. The following is always seen, however the script is never fully called and the service does not start. 

{code}
Debug: Executing: '/etc/init.d/splunk status'
Debug: Executing: '/usr/bin/ctrun -l none /etc/init.d/splunk start'
Notice: /Stage[main]/Main/Service[splunk]/ensure: ensure changed 'stopped' to 'running'
{code}

Calling the init script manually will successfully start the service and produce an exit code of 0. 

Init based services on Solaris 10 use `ctrun` to create a new contract. It looks like the ctrun contract lifetime may be the issue as it is configured to immediately orphan the contract. When the contract is immediately orphaned and the service takes several seconds to start the service may be aborted. I am not sure why this behavior changed from 4.10.8 to 5.3.3 as the code is the same, so it may have to do with the new ruby version. 

I did some basic testing on this and found that if we switch the lifetime to {{child}} instead of {{none}} in the [init provider|https://github.com/puppetlabs/puppet/blob/5.3.3/lib/puppet/provider/service/init.rb#L174], the init script is successfully run and services is started in it's own contract. 

{code}
[process contract 137]
  3955  splunkd -p 8089 start
    3956  splunkd -p 8089 start
      3996  /opt/splunk/bin/splunkd instrument-resource-usage -p 8089
      3997  /opt/splunk/bin/python -O /opt/splunk/lib/python2.7/site-packages/splunk/appser
{code}

Since we expect that the init script return, it would make sense to utilize the {{child}}, but I am uncertain of the overall impact of this change. From the man page:


{noformat}
child
   ctrun exits when the command exits, regardless of whether the contract is empty.
contract
   ctrun exits only when the contract exits. This is the default.
none
   ctrun exits immediately, orphaning the contract.
{noformat}
",Bug,PUP-8143,[],Some Solaris Init services are not functional with Puppet 5
"There are a couple of instances where MD5 is being hard coded in puppet. FIPS compliant versions of agents need to use one of the FIPS approved algorithms instead. 
Following places need to be changed: 
1. Agents processing file resources specifying http as their source need to be able to accept checksums computed using hash alg other than md5. 
2. fqdn_rand 
3. Files synched to agents via the plugin-sync mechanism are checksummed using md5. That needs to be overridden to use a FIPS approved alg.  ",Task,PUP-8141,[],Replace hardcoded use of md5 for FIPS compliance 
"The Puppet::Face class does not define a useful text representation for use in some error messages --- I.E. {{NoMethodError}}. This makes errors involving missing methods on Puppet Faces especially difficult to track down. Puppet Faces allow multiple versions, so these errors are easy to create by third-party modules defining a new Face version that other Puppet components don't expect.

h2. Reproduction Case.

  - Install the latest puppet-agent 4.10.x on CentOS 7:

{code:bash}
rpm -Uvh http://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm
yum install -y puppet-agent
{code}

  - Create a module containing a Puppet Face that can fail due to multiple versions:

{code:bash}
mkdir -p /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/application
cat <<EOF > /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/application/foo.rb
require 'puppet/application/face_base'

class Puppet::Application::Foo < Puppet::Application::FaceBase
end
EOF

mkdir -p /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/face
cat <<EOF > /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/face/foo.rb
Puppet::Face.define(:foo, '0.0.1') do
  action :bar do
    when_invoked do |*args|
      puts ""Bar action called!""
    end
  end

  action :baz do
    when_invoked do |*args|
      puts ""Baz action called!""
      Puppet::Face[:foo, :current].bar
    end
  end
end

Puppet::Face.define(:foo, '0.0.2') do
  action :bim do
    when_invoked do |*args|
      puts ""Bim action called!""
    end
  end
end
EOF
{code}

  - Run the face to generate a failure: {{/opt/puppetlabs/puppet/bin/puppet foo baz}}

h3. Outcome

The error message indicates no {{baz}} method is avaiailble, but provides no clue that Face versions are coming into play:

{noformat}
# /opt/puppetlabs/puppet/bin/puppet foo baz
Baz action called!
Error: undefined method `bar' for #<Puppet::Interface:0x00000004668948>
Error: Try 'puppet help foo baz' for usage
{noformat}

h3. Expected Outcome

The error message should include the face name and version number, as provided by the {{to_s}} method of the Puppet::Interface class:

{noformat}
# /opt/puppetlabs/puppet/bin/puppet foo baz
Baz action called!
Error: undefined method `bar' for Puppet::Face[:foo, v0.0.2]:Puppet::Interface
Error: Try 'puppet help foo baz' for usage
{noformat}",Bug,PUP-8140,['cs_pr_review'],NoMethodErrors involving Puppet::Face instances do not have a useful error message
"I have a customer who noticed the following spelling mistake:

{code}
""To fix this, remove the certificate from both the master and the agent and then start a puppet run, which will automatically regenerate a certficate.""
{code}

This is found in: https://github.com/puppetlabs/pe-puppet/blob/08c4fbbdc7f82b7a6a3e1f10485dd6b5508665d6/lib/puppet/ssl/host.rb
",Bug,PUP-8139,[],Spelling Error in Error Message
This ticket addresses an oversight in the implementation of PUP-8117. The {{TypeCalculator}} should of course infer {{true}} to {{Boolean\[true]}} and false to {{Boolean\[false]}}. They are presently just inferred as {{Boolean}},Bug,PUP-8138,[],Ruby true and false should be inferred to corresponding parameterized Boolean data type
"The run_script function does not accept arguments and does not pass anything on to the Bolt executor. As a result, any attempt to use run_script fails.

The run_script function should accept a variable number of {{String}} arguments. The data type is {{String}} because the arguments are basically arguments as given on a command line and such can only be strings.",Bug,PUP-8137,[],run_script function does not accept arguments
"During a Demo to a partner with the noop/enforcing of a simple comment field change the partner identified that the notify output of puppet apply --noop and without noop is not the same. With noop the value is in '' and in enforce not. Please see example output from my console:

[root@centos6a ~]# cat root.pp
user { 'root':
  ensure           => 'present',
  comment          => 'New value for root',
}
[root@centos6a ~]# puppet resource user root
user { 'root':
  ensure           => 'present',
  comment          => 'root',
  gid              => '0',
  home             => '/root',
  password         => '$1$v4K9E8Wj$gZIHJ5JtQL5ZGZXeqSSsd0',
  password_max_age => '99999',
  password_min_age => '0',
  shell            => '/bin/bash',
  uid              => '0',
}
[root@centos6a ~]# puppet apply root.pp --noop
Notice: Compiled catalog for centos6a.pdx.puppetlabs.demo in environment production in 0.11 seconds
Notice: /Stage[main]/Main/User[root]/comment: current_value root, should be New value for root (noop)
Notice: Class[Main]: Would have triggered 'refresh' from 1 events
Notice: Stage[main]: Would have triggered 'refresh' from 1 events
Notice: Finished catalog run in 0.09 seconds
[root@centos6a ~]# puppet apply root.pp
Notice: Compiled catalog for centos6a.pdx.puppetlabs.demo in environment production in 0.13 seconds
Notice: /Stage[main]/Main/User[root]/comment: comment changed 'root' to 'New value for root'
Notice: Finished catalog run in 0.27 seconds",Bug,PUP-8135,[],Output of notify message in simulation (noop) is not similar to enforcing notify message
"Because bolt restricts which metadata fields are allowed, it will currently fail to run plans that invoke tasks which specify ""sensitive"" parameters. That field should be added to the list of allowed fields and validated to be a boolean if present.

This ticket does _not_ cover any work to actually redact sensitive data from logs, _only_ to allow the tasks to be run.",Improvement,PUP-8134,[],Don't reject tasks which specify sensitive parameters
"I have a customer who has the following code:
{code}
package { 'Python-3.5.2-puppet-0.x86_64.rpm' : 
ensure => present, 
provider => 'rpm', 
install_options => ['-Uvh'], 
source => '/nfs/packages/ga/Python/Python-3.5.2-puppet-0.x86_64.rpm', 
}
{code}

If the package is already installed the ensure will try and install it again. No matter what the current condition is, a -i flag will be passed to the RPM which causes the following:

{code}
Debug: Prefetching rpm resources for package 
Debug: Executing: '/bin/rpm --version' 
Debug: Executing '/bin/rpm -qa --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n'' 
Debug: Executing: '/bin/rpm -q Python-3.5.2-puppet-0.x86_64 --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n' 
Debug: Executing: '/bin/rpm -q Python-3.5.2-puppet-0.x86_64 --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n --whatprovides' 
Debug: Executing: '/bin/rpm -i -Uvh /nfs/packages/ga/Python/Python-3.5.2-puppet-0.x86_64.rpm' 
Error: Execution of '/bin/rpm -i -Uvh /nfs/packages/ga/Python/Python-3.5.2-puppet-0.x86_64.rpm' returned 1: Preparing... ################################################## 
package Python-3.5.2-0.x86_64 is already installed 
Error: /Stage[main]/Mtsi_python3/Package[Python-3.5.2-puppet-0.x86_64]/ensure: change from absent to present failed: Execution of '/bin/rpm -i -Uvh /nfs/packages/ga/Python/Python-3.5.2-puppet-0.x86_64.rpm' returned 1: Preparing... 
################################################## 
package Python-3.5.2-0.x86_64 is already installed 
{code}

The user found this in 2016.4.2 and I was able to recreate in 2017.2.2. 

If we always do `rpm -i` and also allow users to pass other flags that might conflict with the -i option as well. 
",Bug,PUP-8132,[],Package Resource Always Uses -i Flag and Errors out if Already Installed
"The Puppet::Util.benchmark method adds to the message (msg) passed into the method. We should instead find all usages of the method and append the 'in %{seconds} to the string passed in so that it can be included in the original translation message rather than appended separately. (like it as below)

object.send(level, msg + (_("" in %0.2f seconds"") % seconds))

Making this change will cause the test tests/i18n/check_puppet_run_messages.rb to fail until translation is completed and the translation string in the test is updated (as needed).",Task,PUP-8131,[],Calls to Puppet::Util.benchmark should include a 'in %{seconds} seconds' in there message
,Sub-task,PUP-8130,[],Produce pre-docs for new type URI
,Task,PUP-8129,[],Update language specification with Init[T] type
"A new {{URI}} parameterized data type should be added. The type is described as:

{code:puppet}
type IntegerParameter = Variant[Type[Init[Integer]],Type[Undef],Type[NotUndef]]
type StringParameter = Variant[String,Regexp,Type[Enum],Type[Pattern],Type[Undef],Type[NotUndef]]
type URI = Object[
  type_parameters => {
    'scheme' => StringParameter,
    'user_info' => StringParameter,
    'host' => StringParameter,
    'port' => IntegerParameter,
    'path' => StringParameter,
    'query' => StringParameter,
    'fragment' => StringParameter,
    'opaque' => StringParameter,
  },
  attributes => {
    'scheme' => String,
    'user_info' => { type => Optional[String], value => undef },
    'host' => { type => Optional[String], value => undef },
    'port' => { type => Optional[Integer[0,default]], value => undef },
    'path' => { type => Optional[String], value => undef },
    'query' => { type => Optional[String], value => undef },
    'fragment' => { type => Optional[String], value => undef },
    'opaque' => { type => Optional[String], value => undef },
  }
]
{code}
and {{'opaque'}} is mutually exclusive to all other attributes except {{'scheme'}}.

An instance can be assembled from the individual parts (provided as a hash) or parsed from a string and make the parts available as instance attributes.

The {{URI}} data type is parameterized so that it can constrain both what parts may or may not contain and what those parts in turn must match. Since the parts are well known by name, e.g.:
{code}
                       hierarchical
        ┌───────────────────┴─────────────────────┐
                    authority               path
        ┌───────────────┴───────────────┐┌───┴────┐
  abc://username:password@example.com:123/path/data?key=value&key2=value2#fragid1
  └┬┘   └───────┬───────┘ └────┬────┘ └┬┘           └─────────┬─────────┘ └──┬──┘
scheme      userinfo         host     port                  query         fragment

  urn:example:mammal:monotreme:echidna
  └┬┘ └──────────────┬───────────────┘
scheme             opaque
{code}
*Examples:*
Allow any http/https URI without query or fragments (scheme comparisons must always be case-insensitive):
{code:puppet}
URI[scheme => Enum[http,https,true], query => Undef, fragment => Undef]
{code}
Require that the URI has an absolute path:
{code:puppet}
URI[path => /^\// ]
{code}
or conversely, require it to be relative:
{code:puppet}
URI[path => /^[^/]/ ]
{code}",New Feature,PUP-8128,[],Add URI data type
"For better translations we should look at how we add the location information to an error in 'ExternalFileError'. Instead of using words like 'at', 'at line', and 'in' we should change to something like '(file:line:pos)'. Then we have no words to translate while still providing the location information.

I think replacing the output with the below. Based on which variables are set the names on the left, would cause the output on the right:
{code}
file line pos -> (file:line:pos)
file line -> (file:line)
line pos -> (line:pos)
line -> (line)
{code}

An example with all location information set
{code}
Error: Something went wrong (/Users/eric.delaney/work/my_repos/puppet/foo.pp:1:9)
Error: Something went wrong (/Users/eric.delaney/work/my_repos/puppet/foo.pp:1)
Error: Something went wrong (1:9)
Error: Something went wrong (1)
{code}

Places that need to be updated:
./puppet/error.rb - ExternalFileError -> to_s
./puppet/parser/resource.rb - def merge(resource)
./puppet/pops/validation.rb - DiagnosticFormatterPuppetStyle
./puppet/util/errors.rb - Puppet::Util::Errors -> def error_context
./puppet/util/log.rb - Puppet::Util::Log -> to_s line 403

Some of the code that needs to be updated:
{code}
  module ExternalFileError
    # This module implements logging with a filename and line number. Use this
    # for errors that need to report a location in a non-ruby file that we
    # parse.
    attr_accessor :line, :file, :pos

    # May be called with 3 arguments for message, file, line, and exception, or
    # 4 args including the position on the line.
    #
    def initialize(message, file=nil, line=nil, pos=nil, original=nil)
      if pos.kind_of? Exception
        original = pos
        pos = nil
      end
      super(message, original)
      @file = file unless (file.is_a?(String) && file.empty?)
      @line = line
      @pos = pos
    end
    def to_s
      msg = super
      @file = nil if (@file.is_a?(String) && @file.empty?)
      if @file and @line and @pos
        ""#{msg} at #{@file}:#{@line}:#{@pos}""
      elsif @file and @line
        ""#{msg} at #{@file}:#{@line}""
      elsif @line and @pos
          ""#{msg} at line #{@line}:#{@pos}""
      elsif @line
        ""#{msg} at line #{@line}""
      elsif @file
        ""#{msg} in #{@file}""
      else
        msg
      end
    end
  end
{code}",Bug,PUP-8127,[],Refactor error location strings to not use words for better I18n support
"
After an upgrade to 5.3.3  {{puppet module install --module_repository}} does not work anymore as documented at https://puppet.com/docs/puppet/5.3/modules_installing.html#installing-from-another-module-repository



{code}
puppet --version
5.3.2

puppet module install --module_repository http://myforge.local.lan/ puppetlabs/stdlib
WARN: Clearing out unresolved specs.
Please report a bug if this causes problems.
Notice: Preparing to install into /home/cmaser/.puppetlabs/etc/code/modules ...
Notice: Downloading from http://myforge.local.lan/ ...
Notice: Installing -- do not interrupt ...
/home/cmaser/.puppetlabs/etc/code/modules
└── puppetlabs-stdlib (v4.21.0)

{code}



{code}
$ puppet --version
5.3.3

$ puppet module install --module_repository http://myforge.local.lan/ puppetlabs/stdlib
Notice: Preparing to install into /home/cmaser/.puppetlabs/etc/code/modules ...
Notice: Created target directory /home/cmaser/.puppetlabs/etc/code/modules
Notice: Downloading from http://pocu-forge.server.lan/ ...
Error: undefined method `gsub' for false:FalseClass
Error: Try 'puppet help module install' for usage
{code}",Bug,PUP-8126,[],puppet module install --module_repository broken in 5.3.3
"If we add a custom backend in /etc/puppetlabs/code/environments/vagrant/hiera.yaml (attached) and run {{puppet apply /dev/null}} we get...

{{Error: Evaluation Error: Error while evaluating a Resource Statement, Unable to find 'lookup_key' function named 'hiera_mysql' in /etc/puppetlabs/code/environments/vagrant/hiera.yaml on node xenial.vagrant}}

Looking at strace, it appears module functions are not being loaded.

hiera_mysql function is puppet module from https://github.com/crayfishx/hiera-mysql deployed at /etc/puppetlabs/code/environments/vagrant/modules/hiera-mysql
",Bug,PUP-8125,[],Hiera 5 Custom Backends don't work with puppet apply
"Looking at https://puppet.com/docs/puppet/5.0/release_notes.html there was a language deprecation that was missed.

In Puppet 4, the following code works as expected and prints '{{does it work yes}}'

{code}
class foo ( 
  $var1 = 'does it work',
  $var2 = ""${foo::var1} yes""
) { 
  notice($var2)
}

include 'foo'
{code}

In Puppet 5, the same code only prints ' {{yes}}'

Apparently, there was a change in the parser that means that local names can only be used when referencing earlier parameters.

The corrected code would be:

{code}
class foo ( 
  $var1 = 'does it work',
  $var2 = ""${var1} yes""
) { 
  notice($var2)
}

include 'foo'
{code}

CCing [~henrik.lindberg] for validation that this is not a regression instead of a documentation bug",Bug,PUP-8124,['regression'],Class parameter scope is not used when resolving qualified names
"Since 4.10, upper case chars have been allowed in classnames so long as they match the following regex:

\A[a-z][a-z0-9_]*\Z

the only stipulation on case is that the class must start with a lowercase letter, see the documentation below:
https://puppet.com/docs/puppet/4.10/lang_reserved.html#classes-and-defined-resource-types

However in testing, i have modified the service class within the puppetlabs-ntp module, including filename and all class calls and declarations to ntp::serVice, when applying the init.pp example in this module i am presented with:

{code}
Error: Evaluation Error: Error while evaluating a Function Call, Could not find class ::ntp::service for hoytrc at /etc/puppetlabs/code/environments/production/modules/ntp/manifests/init.pp:132:3 on node hoytrc
{code}

note the reference to :ntp::service for line 132 of init.pp which is declared as:

{code}
  contain ntp::serVice
{code}

it looks like there is some backend downcasing which is in conflict with expected behaviour.

tested in PE2017.2.2 and PE2017.3.1 


Original case reported from the field:


{code} 
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Resource Statement, Could not find declared class splunk::apps::windows_TA_ad at /var/puppet/svn/env/modules/splunk/manifests/init_search.pp:25:6 on node itu302.acs.kadaster.nl 
Warning: Not using cache on failed catalog 
{code}

This is a class that defines a Splunk search-node. The last step is the installation of additional Splunk apps. The array $splunk_apps contains the names of Splunk apps to be installed (e.g., [ ""unix_app"", ""sa_nix"", ""pa_nmon_light"", ""windows_TA_ad"" ]). The apps have corresponding puppet-class.

{code} 
# Class splunk::init_search 
class splunk::init_search ($splunk_apps=hiera(splunk_server_apps)) {

# include the params file so the there defined variables are available throughout the module 
include splunk::params 
$ar = prefix( $splunk_apps, 'splunk::apps::' )

# flow control 
anchor{'splunk::init_search::begin':} 
-> class{'splunk::prereq_storage':} 
-> class{'splunk::swap':} 
-> class{'splunk::prereq':} 
-> class{'splunk::packages':} 
-> class{'splunk::install_proxy':} 
-> class{'splunk::search::install':} 
-> class{'splunk::splunk_nonroot':} 
-> class{'splunk::install':} 
-> class{'splunk::install_deplclient':} 
-> class{'splunk::search::config':} 
~> class{'splunk::service':} 
-> anchor{'splunk::init_search::end':}

Anchor['splunk::init_search::begin'] 
-> Class['splunk::search::config'] 
-> class{$ar: } 
-> Anchor['splunk::init_search::end']

} 
{code}",Improvement,PUP-8123,[],Document that Upper case in filenames for autoloaded things like classes does not work
"We need to review the PO file and source code of puppet looking for strings where we build up a list of things where we include  sentence fragment in the repeated list and determine if this should be change to allow for better translations

For example the below code includes a sentence fragment ""which depends on"" which will be hard to translate into Japanese, We should create a list of cases, review them and determine which ones we want to change string in.

lib/puppet/module_tool/errors/shared.rb

{code}_(""    which depends on '%{name}' (%{version})"") % { name: m[:name], version: v(m[:version]) }{code}
{code}
      dependency_list = @source[1..-1].map do |m|
        #TRANSLATORS This message repeats as separate lines as a list under the heading ""You specified '%{name}' (%{version})\n""
        _(""    which depends on '%{name}' (%{version})"") % { name: m[:name], version: v(m[:version]) }
      end.join("",\n"")

      msg_variables = { requested_module: @requested_module, version: v(@requested_version), module_name: @module_name,
                        name: @source.first[:name], dependency_list: dependency_list }
      _(<<-EOM).chomp % msg_variables
Could not install module '%{requested_module}' (%{version})
  No version of '%{module_name}' will satisfy dependencies
    You specified '%{name}' (%{version})
%{dependency_list}
    Use `puppet module install --force` to install this module anyway
      EOM
{code}

We should look to update the repeated list text to be (and remove the TRANSLATOR comment)
{code}
        _(""    This depends on '%{name}' (%{version})"") % { name: m[:name], version: v(m[:version]) }
{code}


        ",Bug,PUP-8122,[],I18n strings that include repeated lists of sentence fragments can be hard to translate
"A total ""WAT"" feast occurs when trying to use {{Init}} data type with several of the core data types.
{code:puppet}
""blue"" =~ Init[Boolean]  # true - WAT
""sock"" =~ Init[Integer] # true - WAT
""salami"" =~ Init[Float] # true - WAT
{code}
...this because the {{new}} method is typed to accept {{String}} instead of an appropriately constrained string.

Review all new operator signatures for the core type to ensure that only acceptable initialization values match an Init. ",Bug,PUP-8121,[],Init[T] close to unusuable due to relaxed signatures in several core data types
,Sub-task,PUP-8120,[],Update language specification (PUP-8119 case independent Enum)
"An {{Enum}} data type should allow specification that the given strings are matched in a case independent way (they are now case dependent). This can be done by allowing a single boolean value as the last entry, where a ""true"" means ""case independent"", the default is false.
",New Feature,PUP-8119,[],"Add a boolean ""case independent"" flag to the Enum type"
,Sub-task,PUP-8118,[],Update Language Specification (PUP-8117 - Parameterized Boolean type)
"Sometimes a constraint is wanted such that a parameter may take on only a Boolean true or a Boolean false value. This is impossible since the Boolean type represents both states. The typical use case is to use a boolean to indicate something like ""off"" as in {{Variant\[Boolean\[false], String[1]]}} - i.e. a literal {{false}} or non empty string (not accepting literal {{true}}).

This means that a Boolean must (just like String) keep track of the value when it is inferred.",New Feature,PUP-8117,[],It should be possible to parameterize Boolean with either true or false
The language specification for Object should now include how to parameterize an Object type as implemented in PUP-8078.,Task,PUP-8116,[],"Update Language Specification (PUP-8078, parameterized Object Type)"
"Few weeks ago we have started to notice corrupted files which managed by puppet.
Every time content of file changed to something like json. It happens rarely and unpredictable.
For example, file resource definition:
{code}
  file { '/etc/puppet/etckeeper-commit-pre':
    mode   => '755',
    owner  => root,
    group  => root,
    source => 'puppet:///modules/amoeba/etckeeper-commit-pre',
  }
{code}
It was regular shell script, but content changed to:
{code}
{""path"":""/etc/puppetlabs/code/environments/fcc_production/modules/amoeba/files/etckeeper-commit-pre"",""relative_path"":null,""links"":""manage"",""owner"":0,""group"":752,""mode"":420,""checksum"":{""type"":""md5"",""value"":""{md5}20814627a1afc8495d264bd1403b498c""},""type"":""file"",""destination"":null}
Last modification date:
~# ls -l /etc/puppet/etckeeper-commit-pre
-rwxr-xr-x 1 root root 279 Oct 30 09:35 /etc/puppet/etckeeper-commit-pre
{code}

For that puppet run, syslog contains next:
{code}Oct 30 09:30:50 lou-webproxy puppet-agent[16977]: Local environment: ""production"" doesn't match server specified node environment ""fcc_production"", switching agent to ""fcc_production"".
Oct 30 09:33:30 lou-webproxy puppet-agent[16977]: Could not retrieve catalog from remote server: execution expired
Oct 30 09:33:30 lou-webproxy puppet-agent[16977]: Using cached catalog
Oct 30 09:33:35 lou-webproxy puppet-agent[16977]: (/Stage[main]/Security_updates/File[/etc/yum/yum-cron.conf]) Could not evaluate: Could not retrieve file metadata for puppet:///modules/security_updates/yum-cron.conf: Could not intern from text/pson: Paths must be fully qualified
Oct 30 09:34:48 lou-webproxy puppet-agent[16977]: (/Stage[main]/Bash::Logout/File[/etc/bash.bash_logout_fcc]/content) content changed '{md5}c3b5264e7fe471a18f30f8468af159ea' to '{md5}93b20bfff221414cdbaf45bedc8db6f2'
Oct 30 09:34:56 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6]) Could not evaluate: Could not retrieve file metadata for puppet:///modules/epel/RPM-GPG-KEY-EPEL-6: Could not intern from application/octet-stream: No format match the given format name or mime-type (application/octet-stream)
Oct 30 09:35:20 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/File[/etc/puppet/etckeeper-commit-pre]/content) content changed '{md5}20814627a1afc8495d264bd1403b498c' to '{md5}d865e6b948a74cb03bc3401c0b01b785'
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Epel::Rpm_gpg_key[EPEL-6]/Exec[import-EPEL-6]) Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Epel::Rpm_gpg_key[EPEL-6]/Exec[import-EPEL-6]) Skipping because of failed dependencies
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-debuginfo]) Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-debuginfo]) Skipping because of failed dependencies
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-source]) Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-source]) Skipping because of failed dependencies
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel]) Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
Oct 30 09:35:21 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel]) Skipping because of failed dependencies
Oct 30 09:35:51 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/File[/etc/puppet/etckeeper-commit-post]) Could not evaluate: Could not retrieve file metadata for puppet:///modules/amoeba/etckeeper-commit-post: Could not intern from application/octet-stream: No format match the given format name or mime-type (application/octet-stream)
Oct 30 09:35:51 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Augeas[puppet.conf.etckeeper]) Dependency File[/etc/puppet/etckeeper-commit-post] has failures: true
Oct 30 09:35:51 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Augeas[puppet.conf.etckeeper]) Skipping because of failed dependencies
Oct 30 09:35:51 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-source]) Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
Oct 30 09:35:51 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-source]) Skipping because of failed dependencies
Oct 30 09:35:58 lou-webproxy puppet-agent[16977]: blockdevice_sr0_model
Oct 30 09:35:58 lou-webproxy puppet-agent[16977]: (/Stage[main]/Lsi_raid::Zabbix/Notify[blockdevice_sr0_model]/message) defined 'message' as 'blockdevice_sr0_model'
Oct 30 09:35:58 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-debuginfo]) Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
Oct 30 09:35:58 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-debuginfo]) Skipping because of failed dependencies
Oct 30 09:35:58 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Puppettidy/Exec[empty dirs under /var/lib/puppet/clientbucket]/returns) executed successfully
Oct 30 09:35:59 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing]) Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
Oct 30 09:35:59 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing]) Skipping because of failed dependencies
Oct 30 09:36:00 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Service[puppet]) Dependency File[/etc/puppet/etckeeper-commit-post] has failures: true
Oct 30 09:36:00 lou-webproxy puppet-agent[16977]: (/Stage[main]/Amoeba::Etckeeper/Service[puppet]) Skipping because of failed dependencies
Oct 30 09:36:00 lou-webproxy puppet-agent[16977]: blockdevice_sda_model
Oct 30 09:36:00 lou-webproxy puppet-agent[16977]: (/Stage[main]/Lsi_raid::Zabbix/Notify[blockdevice_sda_model]/message) defined 'message' as 'blockdevice_sda_model'
Oct 30 09:36:00 lou-webproxy puppet-agent[16977]: Finished catalog run in 149.49 seconds
Oct 30 09:36:06 lou-webproxy puppet-agent[16977]: Could not send report: undefined method `from_data_hash' for Array:Class
{code}

puppetserver.log
{code}
2017-10-30 09:35:02,983 INFO  [qtp1978657657-1639189] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,311 INFO  [qtp1978657657-1639168] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,418 INFO  [qtp1978657657-1639554] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,433 INFO  [qtp1978657657-1647678] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,441 INFO  [qtp1978657657-1631368] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,540 INFO  [qtp1978657657-1639593] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,746 INFO  [qtp1978657657-1642277] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,752 INFO  [qtp1978657657-1644916] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:03,958 INFO  [qtp1978657657-1647662] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:04,056 INFO  [qtp1978657657-1644918] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:35:04,060 INFO  [qtp1978657657-1634004] [puppetserver] Puppet Not Found: Could not find file_metadata plugins
2017-10-30 09:36:10,278 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int/Puppet Local environment: ""production"" doesn't match server specified node environment ""fcc_production"", switching agent to ""fcc_production"".
2017-10-30 09:36:10,278 ERROR [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int/Puppet Could not retrieve catalog from remote server: execution expired
2017-10-30 09:36:10,278 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int/Puppet Using cached catalog
2017-10-30 09:36:10,278 ERROR [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Security_updates/File[/etc/yum/yum-cron.conf] Could not evaluate: Could not retrieve file metadata for puppet:///modules/security_updates/yum-cron.conf: Could not intern from text/pson: Paths must be fully qualified
2017-10-30 09:36:10,278 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Bash::Logout/File[/etc/bash.bash_logout_fcc]/content content changed '{md5}c3b5264e7fe471a18f30f8468af159ea' to '{md5}93b20bfff221414cdbaf45bedc8db6f2'
2017-10-30 09:36:10,278 ERROR [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] Could not evaluate: Could not retrieve file metadata for puppet:///modules/epel/RPM-GPG-KEY-EPEL-6: Could not intern from application/octet-stream: No format match the given format name or mime-type (application/octet-stream)
2017-10-30 09:36:10,278 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/File[/etc/puppet/etckeeper-commit-pre]/content content changed '{md5}20814627a1afc8495d264bd1403b498c' to '{md5}d865e6b948a74cb03bc3401c0b01b785'
2017-10-30 09:36:10,278 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Epel::Rpm_gpg_key[EPEL-6]/Exec[import-EPEL-6] Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
2017-10-30 09:36:10,278 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Epel::Rpm_gpg_key[EPEL-6]/Exec[import-EPEL-6] Skipping because of failed dependencies
2017-10-30 09:36:10,278 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-debuginfo] Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
2017-10-30 09:36:10,278 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-debuginfo] Skipping because of failed dependencies
2017-10-30 09:36:10,278 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-source] Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
2017-10-30 09:36:10,278 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-source] Skipping because of failed dependencies
2017-10-30 09:36:10,278 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel] Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
2017-10-30 09:36:10,278 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel] Skipping because of failed dependencies
2017-10-30 09:36:10,279 ERROR [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/File[/etc/puppet/etckeeper-commit-post] Could not evaluate: Could not retrieve file metadata for puppet:///modules/amoeba/etckeeper-commit-post: Could not intern from application/octet-stream: No format match the given format name or mime-type (application/octet-stream)
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Augeas[puppet.conf.etckeeper] Dependency File[/etc/puppet/etckeeper-commit-post] has failures: true
2017-10-30 09:36:10,279 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Augeas[puppet.conf.etckeeper] Skipping because of failed dependencies
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-source] Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
2017-10-30 09:36:10,279 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing-so
urce] Skipping because of failed dependencies
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int/Puppet blockdevice_sr0_model
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Lsi_raid::Zabbix/Notify[blockdevice_sr0_model]/message defined 'message' as 'blockdevice_sr0_model'
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-debuginfo] Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
2017-10-30 09:36:10,279 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-debuginfo] Skipping because of failed dependencies
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Puppettidy/Exec[empty dirs under /var/lib/puppet/clientbucket]/returns executed successfully
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing] Dependency File[/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6] has failures: true
2017-10-30 09:36:10,279 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Epel/Yumrepo[epel-testing] Skipping because of failed dependencies
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Service[puppet] Dependency File[/etc/puppet/etckeeper-commit-post] has failures: true
2017-10-30 09:36:10,279 WARN  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Amoeba::Etckeeper/Service[puppet] Skipping because of failed dependencies
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int/Puppet blockdevice_sda_model
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int//Stage[main]/Lsi_raid::Zabbix/Notify[blockdevice_sda_model]/message defined 'message' as 'blockdevice_sda_model'
2017-10-30 09:36:10,279 INFO  [qtp1978657657-1644994] [puppetserver] //lou-webproxy.int/Puppet Finished catalog run in 149.49 seconds
{code}

About same time when it happened first time, we tried to improve puppet server performance, so we tried to tune 'max-active-instances', but returned it back.
Why it happens?
",Bug,PUP-8115,[],Puppet randomly corrupts files (it puts json/pson instead of file content)
"Service provider 'redhat' does not correctly detect enabled state of 'boot.*' services on SLES 11.

Pull request: https://github.com/puppetlabs/puppet/pull/6333

SLES 11 has a list of Sys V services beginning with the string 'boot.' that do not behave like other services when {{chkconfig}} is run against them. To illustrate:
{code:bash}
$ cat /etc/SuSE-release
SUSE Linux Enterprise Server 11 (x86_64)
VERSION = 11
PATCHLEVEL = 3

# Service is running
$ /sbin/service boot.kdump status
kdump kernel loaded
                                                                                                                                                                                                                                 running

# chkconfig shows 'B'
$ /sbin/chkconfig boot.kdump
boot.kdump  B

# Only appears when --allservices is specified
$ /sbin/chkconfig --list | grep kdump
$ /sbin/chkconfig --list --allservices | grep kdump
boot.kdump                0:off  1:off  2:off  3:off  4:off  5:off  6:off  B:on

# Compare with ""normal"" service
$ /sbin/service ntp status
...

Checking for network time protocol daemon (NTPD):                                                                                                                                                                                running

# chkconfig shows 'on', not 'B'
$ /sbin/chkconfig ntp
ntp  on
{code}

The provider script ({{puppet/lib/puppet/provider/service/redhat.rb}}) uses the following function to test whether a service is enabled.
{code:ruby}
  def enabled?
    name = @resource[:name]

    begin
      output = chkconfig name
    rescue Puppet::ExecutionFailure
      return :false
    end

    # For Suse OS family, chkconfig returns 0 even if the service is disabled or non-existent
    # Therefore, check the output for '<name>  on' to see if it is enabled
    return :false unless Facter.value(:osfamily) != 'Suse' || output =~ /^#{name}\s+on$/

    :true
  end
{code}

It accounts for the fact that SLES, unlike RHEL, returns a zero return code in the event that a service is disabled or nonexistent:
{code:bash}
$ /sbin/chkconfig asdf
asdf: unknown service
$ echo $?
0
{code}

This doesn't trigger the {{rescue}} block with its {{false}} return value as a disabled or nonexistent service would for RHEL.

So, if the OS family is not 'Suse' and we didn't hit the {{rescue}} block, it returns {{true}}. If the OS family is 'Suse', {{output}} must contain the service name followed by {{'on'}} in order for it to return {{true}}. As we've seen above, the {{boot.*}} services print an output of {{<service_name> B}} and thus return {{false}} even when enabled.
",Bug,PUP-8114,['community'],Service provider 'redhat' does not correctly detect enabled state of 'boot.*' services on SLES 11.
"When we decided not to remove the audit metaparameter, we forgot to remove the corresponding deprecation warning stating the metaparam would be removed. We should get rid of the deprecation warning.

For details on the audit metaparameter can be found here: https://puppet.com/docs/puppet/5.3/metaparameter.html#audit (and there also appears to be a stray deprecation warning in the docs for it that should also be removed).

This should be merged first to the 4.10.x stream and then merged up.",Bug,PUP-8113,[],Remove incorrect deprecation warning for `audit` metaparam
"Jenkins used to list archived files for agent builds at the top of job pages; This went away after the advent of the unimatrix, but it should be re-enabled, since it's helpful for debugging transients.",Bug,PUP-8112,"['ci', 'triaged']",Archived file lists are missing for Jenkins unimatrix jobs
"The failed job:
https://jenkins-master-prod-1.delivery.puppetlabs.net/job/platform_puppet-agent_puppet-agent-integration-suite_daily-master/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=redhat5-64a/10/

Relevant error text:
{code}
                                                                Total size: 29 
                                                                Downloading Packages:
                                                                
                                                                
                                                                Package guid-1.0-1.noarch.rpm is not signed
                                                                Error: /Stage[main]/Main/Package[guid]/ensure: change from 'purged' to 'present' failed: Execution of '/usr/bin/yum -e 0 -y install /tmp/rpmrepo/RPMS/noarch/guid-1.0-1.noarch.rpm' returned 1: Loaded plugins: product-id, security
                                                                Setting up Install Process
                                                                Examining /tmp/rpmrepo/RPMS/noarch/guid-1.0-1.noarch.rpm: guid-1.0-1.noarch
                                                                Marking /tmp/rpmrepo/RPMS/noarch/guid-1.0-1.noarch.rpm to be installed
                                                                Resolving Dependencies
                                                                --> Running transaction check
                                                                ---> Package guid.noarch 0:1.0-1 set to be updated
                                                                --> Finished Dependency Resolution
                                                                
                                                                Dependencies Resolved
{code}
then:
{code}
                                                              Minitest::Assertion: Expected /Package\[guid\]\/ensure:\ created/ to match ""redhat5-64-1: \e[mNotice: Compiled catalog for ppmr1lulo5okinp.delivery.puppetlabs.net in environment production in 0.44 seconds\e[0m\n\e[0;32mInfo: Applying configuration version '1509553721'\e[0m\n\e[mNotice: Applied catalog in 1.73 seconds\e[0m\n"".
{code}",CI Blocker,PUP-8111,[],Unsigned Redhat 5 guid rpm causes yum provider package test to fail
"We recently added support for following FIPS approved hash algorithms: SHA384, SHA512, SHA224. See PUP-8021

Relevant spec tests were updated to exercise these new algorithms. However it was found that tests for signing certificate requests using either of sha384 or sha512 fail when run from within spec. Equivalent code when run as a ruby script works fine. 

This currently is not an issue or is blocking any functionality or flows. However should be investigated and resolved. ",Bug,PUP-8110,[],"Certificate signing request using sha384, sha512 spec test fail"
"Backport fix into 5.3.x

broken -- output of `puppet device --debug` when ran as root:
{noformat}
info: Creating a new SSL key for 10.0.1.3
err: Could not request certificate: Could not write /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem to privatekeydir: Permission denied - /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem
{noformat}

success -- output of `puppet device --debug` when ran as a normal user:
{noformat}
warning: peer certificate won't be verified in this SSL session
info: Caching certificate for ca
warning: peer certificate won't be verified in this SSL session
warning: peer certificate won't be verified in this SSL session
info: Creating a new SSL certificate request for 10.0.1.3
info: Certificate Request fingerprint (md5): 6C:1C:4C:37:A7:1D:B3:6E:F3:94:25:67:55:27:89:4C
warning: peer certificate won't be verified in this SSL session
debug: Using cached certificate for ca
warning: peer certificate won't be verified in this SSL session
info: Caching certificate for 10.0.1.3
{noformat}

Note, that you have to copy `/etc/puppetlabs/puppet/device.conf` to `~/.puppet/`",Bug,PUP-8109,['redmine'],puppet device cannot create certs when run as root (5.3.x backport)
"Back port fix from 5.4.0 to 4.10.x


broken -- output of `puppet device --debug` when ran as root:
{noformat}
info: Creating a new SSL key for 10.0.1.3
err: Could not request certificate: Could not write /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem to privatekeydir: Permission denied - /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem
{noformat}

success -- output of `puppet device --debug` when ran as a normal user:
{noformat}
warning: peer certificate won't be verified in this SSL session
info: Caching certificate for ca
warning: peer certificate won't be verified in this SSL session
warning: peer certificate won't be verified in this SSL session
info: Creating a new SSL certificate request for 10.0.1.3
info: Certificate Request fingerprint (md5): 6C:1C:4C:37:A7:1D:B3:6E:F3:94:25:67:55:27:89:4C
warning: peer certificate won't be verified in this SSL session
debug: Using cached certificate for ca
warning: peer certificate won't be verified in this SSL session
info: Caching certificate for 10.0.1.3
{noformat}

Note, that you have to copy `/etc/puppetlabs/puppet/device.conf` to `~/.puppet/`",Bug,PUP-8108,['redmine'],puppet device cannot create certs when run as root (4.10.x backport)
"On a system with multiple IP addresses, the user should be able to specify which IP address the puppet agent will use.

This feature is especially desired on a network device that may have many IP addresses where a certain one should be chosen due to routing or security considerations.  We have a large customer who has specifically requested this support for their environment.",New Feature,PUP-8107,[],Ability to specify source IP for the agent
"The {{mount}} type should autorequire a {{File}} resource for its mountpoint.

{noformat}
    mount { '/usr/local/foo':
        ensure => mounted,
        ...
    }
    file { '/usr/local/foo':
        ensure => directory,
    }
{noformat}

This will try to mount {{/usr/local/foo}} before creating it.

I've got a mountpoint being created in one component and the nfs share being mounted from another component.  So my profile has to know the details of the components to know that it has to create the ordering relationship.  This should be automatic.",New Feature,PUP-8106,['community'],"""mount"" type should autorequire its mountpoint"
This ticket is just to verify that the Create Ticket link in https://confluence.puppetlabs.com/display/ENG/Maintenance is up to date. [http://24.media.tumblr.com/tumblr_m32m03lv8J1qivhiio1_400.gif] and close this ticket as proof that it made it to the correct triage board!,Bug,PUP-8105,['cs_pr_review'],Triage Test
"While removing legacy facts from my personal modules I found that I still have to use them in metadata.json at least according to https://puppet.com/docs/puppet/5.3/modules_metadata.html It would be nice to be able to use structured facts in the {{operatingsystem_support}} section. 

For example, to be able to replace this
{code}
  ""operatingsystem_support"": [
    {
      ""operatingsystem"": ""RedHat"",
      ""operatingsystemrelease"": [
        ""5"",
        ""6"",
        ""7""
      ]
    },
    {
      ""operatingsystem"": ""CentOS"",
      ""operatingsystemrelease"": [
        ""5"",
        ""6"",
        ""7""
      ]
    }
  ],
{code}

with something like this
{code}
  ""operatingsystem_support"": [
    {
      ""facts.os.name"": ""RedHat"",
      ""facts.os.release.major"": [
        ""5"",
        ""6"",
        ""7""
      ]
    },
    {
      ""facts.os.name"": ""CentOS"",
      ""facts.os.release.major"": [
        ""5"",
        ""6"",
        ""7""
      ]
    }
  ],
{code}

or, better yet, something like this
{code}
  ""operatingsystem_support"": [
    {
      ""facts.os.family"": ""RedHat"",
      ""facts.os.release.major"": [
        ""5"",
        ""6"",
        ""7""
      ]
    }
  ],
{code}",New Feature,PUP-8103,[],Structured facts in metadata.json
"The PAL API should have a general {{call_function}}.

The motivation for this was originally to be allow Bolt CLI to call {{run_task}}, but it seems better to allow calling any function.

The API needs refactoring as the current implementation does not allow performing multiple operations without setting up the entire context for each call.
There should also be methods for:
* creating a new instance of a data type
* creating a type instance
* evaluating puppet logic",New Feature,PUP-8102,[],"Refactor PAL API, add 'call_function' and more to the PAL API"
"This is easiest to describe with a simple code example

{code}
class example (
    Optional[String] $param = 'some non undef default value',
) {
    # $param can never be undef, no matter what you pass in
    # if you pass in undef, then the default is used
    # it's effectively impossible to ""disable"", even though it's Optional
}
{code}

Proposal:

I would like the {{Optional}} type to be an enum of the passed in data type, {{Undef}}, and {{false}}. If that were the case, I could pass {{false}} to the class above and achieve the desired results. This could *almost* be done today with {{Variant\[String, Boolean]}}, but then the user could pass in {{true}}, which isn't a member of the desired set of input values.",Bug,PUP-8101,[],Optional[] data type doesn't allow a parameter to be disabled
"The first step to being able to pluginsync module locale files from the master to the agent is to add a new mount in [file_serving/mount|https://github.com/puppetlabs/puppet/tree/master/lib/puppet/file_serving/mount] to find locale files in modules on the master. This mount point should be located at {{puppet:///locales}} and serve up the {{locales/}} directory of each module, when present (not all modules have them). This is analogous to the existing {{plugins}} and {{pluginfacts}} mounts. You will likely have to add some methods to the [module class|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/module.rb] to do things like detecting if there is a locale directory, and returning the path to it if it exists (we are currently only referencing it [here|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/module.rb#L429].

Some documentation about server mountpoints and {{puppet:///}} URIs can be found here: https://puppet.com/docs/puppet/5.3/file_serving.html

Mount point tests live here https://github.com/puppetlabs/puppet/tree/master/spec/unit/file_serving/mount and should be augmented to exercise this new mountpoint.",Sub-task,PUP-8100,[],Create mountpoint for locale files on master
"When you create a zpool with disks using a full file system path, the zpool provider is not idempotent because it is not querying the status of zpools in a compatible way. Consider the following code and Puppet run:


{code:puppet}
zpool { 'zpool1':
  disk => '/dev/vg_os/lv_zfs',
}
{code}

{noformat}
[root@host ~]# puppet apply test.pp 
Notice: Compiled catalog for bunyip.yb.lmax in environment production in 0.06 seconds
Error: zpool disk can't be changed. should be /dev/vg_os/lv_zfs, currently is lv_zfs
Error: /Stage[main]/Main/Zpool[zpool1]/disk: change from lv_zfs to /dev/vg_os/lv_zfs failed: zpool disk can't be changed. should be /dev/vg_os/lv_zfs, currently is lv_zfs
Notice: Finished catalog run in 0.76 seconds
{noformat}

The problem comes from the provider using the ""zpool status POOLNAME"" command in order to find out what VDevs are in the pool.  That command will always return a relative path, so if the zpool is created with a fully qualified path the resource will always fail on a subsequent run.

The fix is to run ""zpool status -P POOLNAME"" which will return the full path, and I've got a PR for that coming.

The problem is if people have been doing this:

{code:puppet}
zpool { 'zpool1':
  disk => 'sda1',
}
{code}

Which works right now, but after the PR will cause the same problem.  I would argue that using relative paths to disk is not the best idea anyway (and the ZFS community has somewhat decided that using WWNs under /dev/disk/by-id/ is the way forward). However it's still a breaking change.",Bug,PUP-8099,"['community', 'solaris', 'triaged', 'type_and_provider', 'zfs']",Use VDev full path names for zpools
"The property 'acltype' is a valid ZFS property:


{noformat}
[root@host ~]# zfs get all zpool1/files | grep acltype
zpool1/files  acltype               posixacl               inherited from zpool1
{noformat}

",Bug,PUP-8098,['community'],Add 'acltype' to list of supported ZFS properties
"There are many different methods and set ups for using VM Pooler. This can be quite confusing for new comers trying to set up. We are also prevented from improving our processes as a group, where there is no standard documented process. 

Goals: 
# identify use cases for vm pooler
## agent only setup (VM)
## acceptance tests
## Server only with local agent -{color:#59afe1}Essential for Server development{color}
## Full PE set up (both VMs)
# identify methods for setting up vm pooler
# match use cases to methods
# document a standard process for our team
# identify and document shortcomings in the standard process (evaluate alternatives?)",Task,PUP-8097,[],Research: Evaluate VM Pooler processes in attempt to standardize
"Reproduction steps:
• Add a _new_ resource to site.pp
• Run {{puppet agent -t}} on the node
• Observe that the change is properly marked as intentional
• Modify the resource on disk
• Run {{puppet agent -t}} on the node
• Observe that the change is properly marked as corrective
• Modify the resource on disk
• Run {{puppet agent -t --tags faketag}} on the node (this can be done before or after the previous step)
• Observe that no change is made
• Run {{puppet agent -t}} on the node
• Observe that the change is _wrongly_ marked as intentional

The agent uses a transaction persistence file to store the previous desired state (or actual state? unclear) which it can compare to the current state on the next run. That file seems to only include resources that are actually managed on a given run, so any resource that is skipped due to tags is omitted. That causes the agent to think that every change is intentional the next time around.

I expect this is also broken for resources which are skipped due to failed dependencies, though I haven't tested that.",Bug,PUP-8096,['scr-candidate-irving'],Filtering resources by tag interferes with corrective vs. intentional change determination
"If you create 2 users.
ex test1 and test2 
{code}
  user { $user:
      home             => ""/home/${user}"",
      managehome       => true,
      purge_ssh_keys   => true,
      ensure           => ""present"",
    }
{code}
And then add 1 key to each
{code}
    ssh_authorized_key { $user:
      ensure => present,
      key    => $key,
      user   => $user,
    }
{code}
then you on the client machine, manual edit your authorized_keys and copy the entire line from test1 user to test2 users authorized_keys, that line will not be delete on next puppet run",Bug,PUP-8095,['the-goods'],"User {purge_ssh_keys => true, } not removing all keys"
"I have 2 environments, production and acceptance.

I have an environment group for Acceptance:

{code}
node_group { 'Acceptance Environment':
  ensure               => 'present',
  environment          => 'acceptance',
  id                   => '539f71ae-50d3-42f6-8201-289dba160ba5',
  override_environment => 'true',
  parent               => 'Production environment',
  rule                 => ['and',
  ['~',
    ['trusted', 'extensions', 'pp_role'],
    'agent']],
}
{code}

'Production Environment' node group has not been modified.

When I run puppet agent in a node with pp_role = agent, I confirm that it is using the right environment:

{code}
[root@10-32-175-131 ~]# puppet agent -t
Notice: Local environment: 'production' doesn't match server specified node environment 'acceptance', switching agent to 'acceptance'.
{code}

Yet when I try to do a lookup for that node, the data retrieved is from Production:

{code}
puppet lookup --node 10-32-175-131.rfc1918.puppetlabs.net message --explain
Searching for ""message""
  Global Data Provider (hiera configuration version 5)
    Using configuration ""/etc/puppetlabs/puppet/hiera.yaml""
    Hierarchy entry ""Classifier Configuration Data""
      No such key: ""message""
  Environment Data Provider (hiera configuration version 5)
    Using configuration ""/etc/puppetlabs/code/environments/production/hiera.yaml""
    Hierarchy entry ""Per-node data""
{code}

If I pin the node to the ""Acceptance Environment"" group, I get the right output for lookup:

{code}
node_group { 'Acceptance Environment':
  ensure               => 'present',
  environment          => 'acceptance',
  id                   => '539f71ae-50d3-42f6-8201-289dba160ba5',
  override_environment => 'true',
  parent               => 'Production environment',
  rule                 => ['or',
  ['and',
    ['~',
      ['trusted', 'extensions', 'pp_role'],
      'agent']],
  ['=', 'name', '10-32-175-131.rfc1918.puppetlabs.net']],
}
{code}

{code}
root@10-32-175-155.rfc1918.puppetlabs.net /root> puppet lookup --node 10-32-175-131.rfc1918.puppetlabs.net message --explain
Searching for ""message""
  Global Data Provider (hiera configuration version 5)
    Using configuration ""/etc/puppetlabs/puppet/hiera.yaml""
    Hierarchy entry ""Classifier Configuration Data""
      No such key: ""message""
  Environment Data Provider (hiera configuration version 5)
    Using configuration ""/etc/puppetlabs/code/environments/acceptance/hiera.yaml""
{code}

Found the issue in LTS, reproduced in 2017.3.0.

EDIT: A rule created with an out-of-the-box fact like domain honors the environment. A rule created with a trusted fact defaults to production. A mix of trusted + normal fact, like trusted.extensions.pp_role + domain defaults to production.",Bug,PUP-8094,[],Lookup ignores environment from the classifier when using rule with trusted facts
"1) Check that the version number in source for puppet is correct

  version for puppet should be 4.10.9

  * check {{lib/puppet/version.rb}} for the {{PUPPETVERSION}} variable
  * check .gemspec for {{version}} variable

",Task,PUP-8093,[],Bump puppet version to 4.10.9
"There are some concatenated strings in Puppet that are resulting in mistranslations because the translator doesn't have the full context of what the complete sentence is supposed to be, and cannot change the sentence order,

{code} [centos@ericdelaney lib]$ find . -type f -print | xargs grep '+= _'
./puppet/graph/simple_graph.rb:      message += _(""Cycle graph written to %{filename}."") % { filename: filename }
./puppet/graph/simple_graph.rb:      message += _(""Try the '--graph' option and opening the resulting '.dot' file in OmniGraffle or GraphViz"")
./puppet/parameter/value_collection.rb:      str += _(""Valid values are %{value_list}. "") % { value_list: values.join("", "") } unless values.empty?
./puppet/parameter/value_collection.rb:      str += _(""Valid values match %{pattern}."") % { pattern: regexes.join("", "") } unless regexes.empty?
./puppet/pops/lookup/lookup_adapter.rb:        msg += _("". A '%{config}' file should be used instead"") % { config: HieraConfig::CONFIG_FILE_NAME } if mp.nil?
./puppet/pops/lookup/lookup_adapter.rb:        msg += _("". A '%{config}' file should be used instead"") % { config: HieraConfig::CONFIG_FILE_NAME } if ep.nil?
[centos@ericdelaney lib]$
{code}

{code}
[centos@ericdelaney puppet]$ find lib -type f -print | xargs grep '_(' | grep '+'
lib/puppet/face/epp.rb:        raise Puppet::Error, _(""One or more file(s) specified did not exist:\n"") + missing_files.map { |f| ""   #{f}"" }.join(""\n"")
lib/puppet/face/epp.rb:          raise Puppet::Error, _(""One or more file(s) specified did not exist:\n"") + missing_files.collect { |f| ""   #{f}"" }.join(""\n"")
lib/puppet/face/help.rb:          summary = face.deprecated? ? face.summary + _("" (Deprecated)"") : face.summary
lib/puppet/face/module/build.rb:      _(""Module built: "") + return_value.expand_path.to_s
lib/puppet/face/module/list.rb:        str << '  ' + colorize(:red, _('invalid'))
lib/puppet/face/module/list.rb:          str << '  ' + colorize(:red, _('invalid'))
lib/puppet/face/parser.rb:        raise Puppet::Error, _(""One or more file(s) specified did not exist:\n%{files}"") % { files: missing_files.collect {|f| "" "" * 3 + f + ""\n""} }
lib/puppet/face/parser.rb:          dumps + _(""One or more file(s) specified did not exist:\n"") + missing_files.collect { |f| ""   #{f}"" }.join(""\n"")
lib/puppet/functions/slice.rb:      raise ArgumentError, _(""slice(): block must define one parameter, or "") +
lib/puppet/functions/slice.rb:        _(""the same number of parameters as the given size of the slice (%{slice_size}). Block has %{serving_size}; "") % { slice_size: slice_size, serving_size: serving_size }+
lib/puppet/graph/simple_graph.rb:      message += _(""Cycle graph written to %{filename}."") % { filename: filename }
lib/puppet/graph/simple_graph.rb:      message += _(""Try the '--graph' option and opening the resulting '.dot' file in OmniGraffle or GraphViz"")
lib/puppet/module_tool/errors/shared.rb:      trace += @source[1..-1].map { |m| _(""which depends on '%{name}' (%{version})"") % { name: m[:name], version: v(m[:version]) } }
lib/puppet/network/http/error.rb:      super(_(""Not Acceptable: "") + message, CODE, issue_kind)
lib/puppet/network/http/error.rb:      super(_(""Not Found: "") + message, CODE, issue_kind)
lib/puppet/network/http/error.rb:      super(_(""Not Authorized: "") + message, CODE, issue_kind)
lib/puppet/network/http/error.rb:      super(_(""Bad Request: "") + message, CODE, issue_kind)
lib/puppet/network/http/error.rb:      super(_(""Method Not Allowed: "") + message, CODE, issue_kind)
lib/puppet/network/http/error.rb:      super(_(""Unsupported Media Type: "") + message, CODE, issue_kind)
lib/puppet/network/http/error.rb:      super(_(""Server Error: "") + original_error.message, CODE, issue_kind)
lib/puppet/parameter/value_collection.rb:      str += _(""Valid values are %{value_list}. "") % { value_list: values.join("", "") } unless values.empty?
lib/puppet/parameter/value_collection.rb:      str += _(""Valid values match %{pattern}."") % { pattern: regexes.join("", "") } unless regexes.empty?
lib/puppet/pops/lookup/lookup_adapter.rb:        msg += _("". A '%{config}' file should be used instead"") % { config: HieraConfig::CONFIG_FILE_NAME } if mp.nil?
lib/puppet/pops/lookup/lookup_adapter.rb:            _(""Defining environment_data_provider='%{provider_name}' in environment.conf is deprecated"") % { provider_name: provider_name }, env_path + 'environment.conf')
lib/puppet/pops/lookup/lookup_adapter.rb:              _(""The environment_data_provider='%{provider_name}' setting is ignored since '%{config_path}' version >= 5"") % { provider_name: provider_name, config_path: config_path }, env_path + 'environment.conf')
lib/puppet/pops/lookup/lookup_adapter.rb:        msg += _("". A '%{config}' file should be used instead"") % { config: HieraConfig::CONFIG_FILE_NAME } if ep.nil?
lib/puppet/pops/model/ast_transformer.rb:    raise _(""Not a valid expression in a collection query: "")+o.class.name
lib/puppet/util/plist.rb:          Puppet.warning(_(""Cannot read file %{file_path}; Puppet is skipping it.\n"") % { file_path: file_path } + _(""Details: %{detail}"") % { detail: detail })
lib/puppet/util/reference.rb:    ""\n\n----------------\n\n*"" + _(""This page autogenerated on "") + ""#{Time.now}*\n""
lib/puppet/util/reference.rb:    text << _(""\n\n**This page is autogenerated; any changes will get overwritten** *(last generated on "") + ""#{Time.now.to_s})*\n\n""
{code}

{code}
/puppet/syntax_checkers/base64.rb
      if (cleaned_text.bytes.to_a.size * 8) % 6 != 0
        msg2 = _(""padding is not correct"")
      else
        msg2 = _(""contains letters outside strict base 64 range (or whitespace)"")
      end
      msg = _(""Base64 syntax checker: Cannot parse invalid Base64 string - %{msg2}"") % { msg2: msg2 }
{code}

{code}
[centos@ericdelaney puppet]$ find lib -type f -print | xargs grep '_(' | grep '<<'
lib/puppet/face/module/uninstall.rb:      Puppet.notice _(""Preparing to uninstall '%{name}'"") % { name: name } << (options[:version] ? "" (#{colorize(:cyan, options[:version].sub(/^(?=\d)/, 'v'))})"" : '') << "" ...""
lib/puppet/face/module/list.rb:        str << '  ' + colorize(:red, _('invalid'))
lib/puppet/face/module/list.rb:          str << '  ' + colorize(:red, _('invalid'))
lib/puppet/forge/errors.rb:      message = _(<<-EOS).chomp % { uri: @uri, response: @response }
lib/puppet/forge/errors.rb:      message << _(""\n  The message we received said '%{message}'"") % { message: @message } if @message
lib/puppet/module_tool/errors/installer.rb:      message << _(""Could not install module '%{module_name}' (%{version})"") % { module_name: @module_name, version: @requested_version }
lib/puppet/module_tool/errors/installer.rb:      message << _(""  Module '%{module_name}' (%{version}) is already installed"") % { module_name: @module_name, version: @installed_version }
lib/puppet/module_tool/errors/installer.rb:      message << _(""    Installed module has had changes made locally"") unless @local_changes.empty?
lib/puppet/module_tool/errors/installer.rb:      message << _(""    Use `puppet module upgrade` to install a different version"")
lib/puppet/module_tool/errors/installer.rb:      message << _(""    Use `puppet module install --force` to re-install only this module"")
lib/puppet/module_tool/errors/installer.rb:      message << _(""Could not install '%{requested_package}'"") % { requested_package: @requested_package }
lib/puppet/module_tool/errors/installer.rb:      message << _(""  No releases are available from %{source}"") % { source: @source }
lib/puppet/module_tool/errors/installer.rb:      message << _(""    Does '%{requested_package}' have at least one published release?"") % { requested_package: @requested_package }
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not %{action} module '%{module_name}' (%{version})"") % { action: @action, module_name: @requested_name, version: vstring }
lib/puppet/module_tool/errors/shared.rb:      message << _(""  No version of '%{module_name}' can satisfy all dependencies"") % { module_name: @requested_name }
lib/puppet/module_tool/errors/shared.rb:      message << _(""    Use `puppet module %{action} --ignore-dependencies` to %{action} only this module"") % { action: @action }
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not %{action} '%{module_name}' (%{version})"") % { action: @action, module_name: @module_name, version: vstring }
lib/puppet/module_tool/errors/shared.rb:        message << _(""  No releases are available from %{source}"") % { source: @source }
lib/puppet/module_tool/errors/shared.rb:        message << _(""    Does '%{module_name}' have at least one published release?"") % { module_name: @module_name }
lib/puppet/module_tool/errors/shared.rb:        message << _(""  No releases matching '%{version}' are available from %{source}"") % { version: @requested_version, source: @source }
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not install module '%{module_name}' (%{version})"") % { module_name: @requested_module, version: @requested_version }
lib/puppet/module_tool/errors/shared.rb:        message << _(""  Dependency '%{name}' (%{version}) would overwrite %{dir}"") % { name: @dependency[:name], version: v(@dependency[:version]), dir: @directory }
lib/puppet/module_tool/errors/shared.rb:        message << _(""  Installation would overwrite %{dir}"") % { dir: @directory }
lib/puppet/module_tool/errors/shared.rb:        message << _(""    Currently, '%{name}' (%{version}) is installed to that directory"") % { name: @metadata[""name""], version: v(@metadata[""version""]) }
lib/puppet/module_tool/errors/shared.rb:        message << _(""    Use `puppet module install --ignore-dependencies` to install only this module"")
lib/puppet/module_tool/errors/shared.rb:        message << _(""    Use `puppet module install --force` to install this module anyway"")
lib/puppet/module_tool/errors/shared.rb:      trace << _(""You specified '%{name}' (%{version})"") % { name: @source.first[:name], version: v(@requested_version) }
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not install module '%{module_name}' (%{version})"") % { module_name: @requested_module, version: v(@requested_version) }
lib/puppet/module_tool/errors/shared.rb:      message << _(""  No version of '%{module_name}' will satisfy dependencies"") % { module_name: @module_name }
lib/puppet/module_tool/errors/shared.rb:      message << _(""    Use `puppet module install --force` to install this module anyway"")
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not %{action} module '%{module_name}'"") % { action: @action, module_name: @module_name }
lib/puppet/module_tool/errors/shared.rb:      message << _(""  Module '%{module_name}' is not installed"") % { module_name: @module_name }
lib/puppet/module_tool/errors/shared.rb:      message << _(""    Use `puppet module install` to install this module"") if @action == :upgrade
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not %{action} module '%{module_name}'"") % { action: @action, module_name: @module_name }
lib/puppet/module_tool/errors/shared.rb:      message << _(""  Module '%{module_name}' appears multiple places in the module path"") % { module_name: @module_name }
lib/puppet/module_tool/errors/shared.rb:      message << _(""    Use the `--modulepath` option to limit the search to specific directories"")
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not %{action} module '%{module_name}' (%{version})"") % { action: @action, module_name: @module_name, version: vstring }
lib/puppet/module_tool/errors/shared.rb:      message << _(""  Installed module has had changes made locally"")
lib/puppet/module_tool/errors/shared.rb:      message << _(""    Use `puppet module %{action} --ignore-changes` to %{action} this module anyway"") % { action: @action }
lib/puppet/module_tool/errors/shared.rb:      message << _(""Could not %{action} module '%{module_name}'"") % { action: @action, module_name: @name }
lib/puppet/module_tool/errors/shared.rb:      message << _(""  Failure trying to parse metadata"")
lib/puppet/module_tool/errors/shared.rb:      message << _(""    Original message was: %{message}"") % { message: @error.message }
lib/puppet/module_tool/errors/uninstaller.rb:      message << _(""Could not uninstall module '%{module_name}' (%{version})"") % { module_name: @module_name, version: v(@version) }
lib/puppet/module_tool/errors/uninstaller.rb:      message << _(""  No installed version of '%{module_name}' matches (%{version})"") % { module_name: @module_name, version: v(@version) }
lib/puppet/module_tool/errors/uninstaller.rb:        message << _(""Could not uninstall module '%{module_name}' (v%{requested_version})"") % { module_name: @module_name, requested_version: @requested_version }
lib/puppet/module_tool/errors/uninstaller.rb:        message << _(""Could not uninstall module '%{module_name}'"") % { module_name: @module_name }
lib/puppet/module_tool/errors/uninstaller.rb:      message << _(""  Other installed modules have dependencies on '%{module_name}' (%{version})"") % { module_name: @module_name, version: v(@installed_version) }
lib/puppet/module_tool/errors/uninstaller.rb:      message << _(""    Use `puppet module uninstall --force` to uninstall this module anyway"")
lib/puppet/module_tool/errors/upgrader.rb:      message << _(""Could not upgrade module '%{module_name}' (%{version})"") % { module_name: @module_name, version: vstring }
lib/puppet/module_tool/errors/upgrader.rb:        message << _(""  The installed version is already the latest version matching %{version}"") % { version: vstring }
lib/puppet/module_tool/errors/upgrader.rb:        message << _(""  There are %{count} newer versions"") % { count: @newer_versions.length }
lib/puppet/module_tool/errors/upgrader.rb:        message << _(""    No combination of dependency upgrades would satisfy all dependencies"")
lib/puppet/module_tool/errors/upgrader.rb:          message << _(""    Dependencies will not be automatically upgraded across major versions"")
lib/puppet/module_tool/errors/upgrader.rb:          message << _(""    Upgrading one or more of these modules may permit the upgrade to succeed:"")
lib/puppet/module_tool/errors/upgrader.rb:      message << _(""    Use `puppet module upgrade --force` to upgrade only this module"")
lib/puppet/module_tool/errors/upgrader.rb:      message << _(""Could not %{action} module '%{module_name}' (%{version})"") % { action: @action, module_name: @module_name, version: vstring }
lib/puppet/module_tool/errors/upgrader.rb:      message << _(""  Downgrading is not allowed."")
lib/puppet/node/environment.rb:      errors << _(""The 'disable_per_environment_manifest' setting is true, and the '%{env_name}' environment has an environment.conf manifest that conflicts with the 'default_manifest' setting."") % { env_name: name }
lib/puppet/parser/resource.rb:      msg << _(' by %{source}') % { source: current.source.to_s } unless current.source.to_s == ''
lib/puppet/parser/resource.rb:      msg << _('; cannot redefine')
lib/puppet/provider/package/nim.rb:        errmsg << _(""with version '%{version}' "") % { version: version }
lib/puppet/reference/providers.rb:            details << _(""  - Missing files %{files}\n"") % { files: values.join("", "") }
lib/puppet/reference/providers.rb:                details << _(""  - Setting %{name} (currently %{value}) not in list %{facts}\n"") % { name: name, value: Puppet.settings.value(name).inspect, facts: facts.join("", "") }
lib/puppet/reference/providers.rb:                details << _(""  - Fact %{name} (currently %{value}) not in list %{facts}\n"") % { name: name, value: Facter.value(name).inspect, facts: facts.join("", "") }
lib/puppet/reference/providers.rb:            details << _(""  - Got %{values} true tests that should have been false\n"") % { values: values }
lib/puppet/reference/providers.rb:            details << _(""  - Got %{values} false tests that should have been true\n"") % { values: values }
lib/puppet/reference/providers.rb:            details << _(""  - Missing features %{values}\n"") % { values: values.collect { |f| f.to_s }.join("","") }
lib/puppet/util/log.rb:    annotated_string << _(""Backtrace:"") << ""\n"" << caller[0..10].join(""\n"")
lib/puppet/util/logging.rb:        arr << _('Wrapped exception:')
lib/puppet/util/logging.rb:      arr << _(""Wrapped exception:"")
lib/puppet/util/reference.rb:    text << _(""\n\n**This page is autogenerated; any changes will get overwritten** *(last generated on "") + ""#{Time.now.to_s})*\n\n""
{code}",Bug,PUP-8092,['i18n'],Concatenated strings causing breakages with Japanese group 2
"1) Check that the version number in source for puppet is correct

  version for puppet should be 5.3.3

  * check {{lib/puppet/version.rb}} for the {{PUPPETVERSION}} variable
  * check .gemspec for {{version}} variable

",Task,PUP-8091,[],Bump puppet version to 5.3.3
"Currently we are naively loading modules' translations whenever a Ruby instance of the Module class is created, in a way assumes that the locale files are located within the module's installed directory. This works on the master and when doing things like {{puppet apply}}, but agent runs get their data from {{$vardir}}, which is populated by pluginsync. We need to add hooks to load module translations from {{$vardir}} after pluginsyncing, and make sure we check both places (installed modules and {{$vardir}}) when invoking puppet applications, to ensure we get translations when and where we need them. This ticket mostly entails getting correct translation behavior, over optimizing, which is covered in PUP-8024.",Sub-task,PUP-8090,[],Load module translation files
"The second part of getting module translations visible on the the agent is to actually download the locale files along with the other module data. This involves the following steps:

- Add a new Downloader to the [DownloaderFactory|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/configurer/downloader_factory.rb] for downloading locale files. This downloader should put the files into a directory structure like {{$vardir/locales/<locale>/<module_name>.po}}. For the time being, we should sync all of the available locales, not just the one detected on the system. This can be optimized later if needed.
- Add the relevant settings for the new downloader (e.g. {{localedest}} and {{localesource}}) to the [settings defaults|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/defaults.rb#L1690-L1729].
- Add tests for the new Downloader to the [downloader factory specs|https://github.com/puppetlabs/puppet/blob/master/spec/unit/configurer/downloader_factory_spec.rb].
- Update the tests in the [plugin handler specs|https://github.com/puppetlabs/puppet/blob/master/spec/unit/configurer/plugin_handler_spec.rb] to exercise the locale downloader.

Other pieces may fall out of this, and other tests may need to be updated, but this is a good start. Note that this will not cause any module translations to actually be displayed; this ticket's other subtask describes the work needed to load the translation files from {{$vardir}} once they are present.",Sub-task,PUP-8089,[],Pluginsync locale files
"For an advanced hiera backends that open connections to a remote service it is not enough to simply throw away cached information as this may ""leak connections"". Just waiting for a GC to kick in and then expecting that it clears up a connection is not reliable and it may take a long time before such resources are freed. Depending on the implementation it may not even be freed until the ruby runtime is terminated.

The most natural would be to register a callback for a LookupContext cached key (or all keys). Using a lambda for this is however somewhat problematic if the backend is written in the Puppet Language as the lambda does not have access to the local scope it is defined in. It will work if the lookup context instance is given to it and if we document that this lambda only has access to the global scope + the lookup context given to it.

Preferably we would make a new implementation of Scope (that is not stupid), but that is a big thing.

Alternatives would be to register a named function that gets called with the lookup_context, or using  name convention such that {{mymodule::mybackend::on_evict(lookupcontext)}} gets called. Neither is very nice.

In addition to being able to set the on-eviction-lambda there must be a way to get the already set lambda (to avoid setting it again).

Suggest using {{on_evict(&block)}} for setting it and {{on_evict()}} for getting it, and where {{on_evict(false)}} would drop the registered lambda.

",Improvement,PUP-8088,[],add mechanism for cache eviction callback / finalizers
"The final message of this error is that {{curl -m 1 localhost:8140}} fails, but the error originates when the the puppetserver service tries to restart and fails because the {{hiera_config}} path is inaccessible (permission denied).

Matrix: https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/5.3.x/view/Suite/job/platform_puppet-agent_puppet-agent-integration-suite_daily-5.3.x/

A specific case: https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/5.3.x/view/Suite/job/platform_puppet-agent_puppet-agent-integration-suite_daily-5.3.x/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=ubuntu1604-64a/

Full output: https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/5.3.x/view/Suite/job/platform_puppet-agent_puppet-agent-integration-suite_daily-5.3.x/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=ubuntu1604-64a/1/consoleText

{code}
                             b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 0.05 seconds
                            localhost $ scp /tmp/beaker20171024-329-5yhmvd redhat7-64-1:/tmp/hieratest.8wLYGg/puppet.conf {:ignore => }
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:51:29$ cat /etc/puppetlabs/puppet/puppet.conf
                              [master]
                              vardir = /opt/puppetlabs/server/data/puppetserver
                              logdir = /var/log/puppetlabs/puppetserver
                              rundir = /var/run/puppetlabs/puppetserver
                              pidfile = /var/run/puppetlabs/puppetserver/puppetserver.pid
                              codedir = /etc/puppetlabs/code
                              
                              [main]
                              environmentpath = /tmp/hieratest.8wLYGg/environments
                              hiera_config = /tmp/hieratest.8wLYGg/hiera.yaml
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 0.05 seconds
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:51:29$ service puppetserver reload
                              Redirecting to /bin/systemctl reload  puppetserver.service
                              Job for puppetserver.service failed. See 'systemctl status puppetserver.service' and 'journalctl -xn' for details.
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 11.38 seconds
                            Exited: 1
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:51:40$ puppet resource service puppetserver ensure=stopped
                              service { 'puppetserver':
                                ensure => 'stopped',
                              }
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 1.13 seconds
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:51:42$ puppet resource service puppetserver ensure=running
                              Error: Systemd start for puppetserver failed!
                              journalctl log for puppetserver:
                              -- Logs begin at Tue 2017-10-24 06:25:56 PDT, end at Tue 2017-10-24 06:52:12 PDT. --
                              Oct 24 06:47:47 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:47:50 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:47:55 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:47:58 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:08 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:12 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:16 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:20 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:26 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:29 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:32 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:36 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:45 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:49 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:52 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:55 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:03 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:08 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:11 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:15 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:26 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:30 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:33 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:38 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:53 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:57 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:00 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:04 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:11 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:14 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:19 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:23 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:37 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:40 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:43 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:55 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:51:06 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:51:13 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:51:16 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:51:19 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:51:29 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: Errno::EACCES: Permission denied - /tmp/hieratest.8wLYGg
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: valid_directory? at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:237
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:187
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:281
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: each at org/jruby/RubyArray.java:1613
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:280
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:370
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get! at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:34
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: push_application_context at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29
                              Error: /Service[puppetserver]/ensure: change from 'stopped' to 'running' failed: Systemd start for puppetserver failed!
                              journalctl log for puppetserver:
                              -- Logs begin at Tue 2017-10-24 06:25:56 PDT, end at Tue 2017-10-24 06:52:12 PDT. --
                              Oct 24 06:47:47 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:47:50 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:47:55 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:47:58 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:08 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:12 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:16 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:20 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:26 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:29 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:32 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:36 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:45 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:49 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:48:52 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:48:55 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:03 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:08 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:11 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:15 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:26 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:30 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:33 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:38 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:49:53 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:49:57 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:00 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:04 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:11 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:14 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:19 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:23 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:37 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:40 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:50:43 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:50:55 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:51:06 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:51:13 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:51:16 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:51:19 b2e01ieijg21est systemd[1]: Reloaded puppetserver Service.
                              Oct 24 06:51:29 b2e01ieijg21est systemd[1]: Reloading puppetserver Service.
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: Errno::EACCES: Permission denied - /tmp/hieratest.8wLYGg
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: valid_directory? at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:237
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:187
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:281
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: each at org/jruby/RubyArray.java:1613
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:280
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:370
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: get! at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:34
                              Oct 24 06:51:40 b2e01ieijg21est puppetserver[3273]: push_application_context at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29
                              service { 'puppetserver':
                                ensure => 'stopped',
                              }
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 30.82 seconds
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:52:12$ curl -m 1 https://localhost:8140
                              Trying command 30 times.
                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                            .                              Command `curl -m 1 https://localhost:8140` failed.
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:52:51$ puppet master --configprint config
                              /etc/puppetlabs/puppet/puppet.conf
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 0.79 seconds
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:52:52$ if [ -f '/tmp/hieratest.8wLYGg/puppet.conf.bak' ]; then cat '/tmp/hieratest.8wLYGg/puppet.conf.bak' > '/etc/puppetlabs/puppet/puppet.conf'; rm -f '/tmp/hieratest.8wLYGg/puppet.conf.bak'; fi
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 0.16 seconds
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:52:52$ service puppetserver reload
                              Redirecting to /bin/systemctl reload  puppetserver.service
                              Job for puppetserver.service failed. See 'systemctl status puppetserver.service' and 'journalctl -xn' for details.
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 0.24 seconds
                            Exited: 1
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:52:52$ puppet resource service puppetserver ensure=stopped
                              service { 'puppetserver':
                                ensure => 'stopped',
                              }
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 1.48 seconds
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:52:54$ puppet resource service puppetserver ensure=running
                              Notice: /Service[puppetserver]/ensure: ensure changed 'stopped' to 'running'
                              service { 'puppetserver':
                                ensure => 'running',
                              }
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) executed in 25.28 seconds
                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:53:19$ curl -m 1 https://localhost:8140
                              Trying command 30 times.
                            .                            
                            b2e01ieijg21est.delivery.puppetlabs.net (redhat7-64-1) 13:53:20$ curl -m 1 https://localhost:8140 ostensibly successful.
                            RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Command `curl -m 1 https://localhost:8140` failed.
{code}

",CI Blocker,PUP-8087,[],hiera acceptance tests fail with permission denied on hiera_config directory
"Bolt needs to be able to load & run tasks and plans from the same modulepath Puppet is using (see BOLT-121). Bolt also will contain the {{run_task}}, {{run_plan}}, etc functions (see BOLT-185), and will need to pass a list of directories to augment the resulting modulepath with. I'm assuming the bolt specified modulepath should take precedence.",Improvement,PUP-8086,[],Provide PAL API to use a modulepath and environment name
"This error was spotted when doing {{win-2012r2-ja-x86_64}} imaging acceptance testing.

Build is at: https://jenkins-imaging.delivery.puppetlabs.net/view/Win-Exp/job/experimental_auto_windows-2012r2-ja_x86_64_vmware_vsphere.cygwin_acceptance_packer/3/

",Bug,PUP-8085,['Engineering-Initiative'],Win-2012r2 JA Puppet Acceptance showing 25 Failed Tests
"Hello, 

There is a regression in the handling of serialized regexps in yaml ( http://yaml.org/YAML_for_ruby.html#regexps); starting with Puppet 4.10.2 an error occured about a type mismatch.

{color:red}[ ... ] has wrong type, expects Puppet::LookupValue, got Hash[Regexp[/a.b/] [...]  at [...]
{color}

Steps to reproduce :

Using Docker, it is easy to reproduce :
In a repository, create the following files 

 * data/common.yaml
{code}
foo::bar:
  !ruby/regexp '/a.b/':
    'test': {}
{code}

 * data/hiera5.yaml
{code}
---
version: 5
hierarchy:
  - name: Common             
    path: common.yaml         
defaults:
  data_hash: yaml_data        
  datadir: /tmp/bug_puppet/data 
{code}

 * data/foo.pp

{code}
class foo (
  $bar = 'Toto',
){
  notify{""${bar}"":}
}

node /.*/{
  class{'foo':}
}
{code}

 * Dockerfile

{code}
ARG PUPPET_VERSION=latest
FROM puppet/puppet-agent:${PUPPET_VERSION}

RUN mkdir /tmp/bug_puppet/
ADD . /tmp/bug_puppet
{code}

Then run the following commands :

{code}
for i in 1.9.3 1.9.2 1.9.1 1.10.1 1.10.2 1.10.3 1.10.4 ; do docker build --build-arg PUPPET_VERSION=$i . -t puppet-test:$i ; done

for i in 1.9.3 1.9.2 1.9.1 1.10.1 1.10.2 1.10.3 1.10.4 ; do echo ""Puppet Version $i ""; docker run -it --rm puppet-test:$i apply --hiera_config /tmp/bug_puppet/data/hiera5.yaml  /tmp/bug_puppet/data/foo.pp ; done
{code}

You will see the following output : 

{code}
for i in 1.9.3 1.9.2 1.9.1 1.10.1 1.10.2 1.10.3 1.10.4 ; do echo ""Puppet Version $i ""; docker run -it --rm puppet-test:$i apply --hiera_config /tmp/bug_puppet/data/hiera5.yaml  /tmp/bug_puppet/data/foo.pp ; done
Puppet Version 1.9.3 
Notice: Compiled catalog for e8d8df813253 in environment production in 0.06 seconds
Notice: {(?-mix:a.b) => {test => {}}}
Notice: /Stage[main]/Foo/Notify[{(?-mix:a.b) => {test => {}}}]/message: defined 'message' as '{(?-mix:a.b) => {test => {}}}'
Notice: Applied catalog in 0.02 seconds
Puppet Version 1.9.2 
Notice: Compiled catalog for 763be4c8093e in environment production in 0.06 seconds
Notice: {(?-mix:a.b) => {test => {}}}
Notice: /Stage[main]/Foo/Notify[{(?-mix:a.b) => {test => {}}}]/message: defined 'message' as '{(?-mix:a.b) => {test => {}}}'
Notice: Applied catalog in 0.02 seconds
Puppet Version 1.9.1 
Notice: Compiled catalog for 51794a142499 in environment production in 0.06 seconds
Notice: {(?-mix:a.b) => {test => {}}}
Notice: /Stage[main]/Foo/Notify[{(?-mix:a.b) => {test => {}}}]/message: defined 'message' as '{(?-mix:a.b) => {test => {}}}'
Notice: Applied catalog in 0.02 seconds
Puppet Version 1.10.1 
Notice: Compiled catalog for b037e978fee2 in environment production in 0.07 seconds
Notice: {(?-mix:a.b) => {test => {}}}
Notice: /Stage[main]/Foo/Notify[{(?-mix:a.b) => {test => {}}}]/message: defined 'message' as '{(?-mix:a.b) => {test => {}}}'
Notice: Applied catalog in 0.02 seconds
Puppet Version 1.10.2 
Error: Evaluation Error: Error while evaluating a Resource Statement, Lookup of key 'foo::bar' failed: Value for key 'foo::bar', in hash returned from data_hash function 'yaml_data', when using location '/tmp/bug_puppet/data/common.yaml', has wrong type, expects Puppet::LookupValue, got Hash[Regexp[/a.b/], Hash[String, Hash[0, 0], 1, 1], 1, 1] at /tmp/bug_puppet/data/foo.pp:8:3 on node cb1a4758863b
Puppet Version 1.10.3 
Error: Evaluation Error: Error while evaluating a Resource Statement, Lookup of key 'foo::bar' failed: Value for key 'foo::bar', in hash returned from data_hash function 'yaml_data', when using location '/tmp/bug_puppet/data/common.yaml', has wrong type, expects Puppet::LookupValue, got Hash[Regexp[/a.b/], Hash[String, Hash[0, 0], 1, 1], 1, 1] at /tmp/bug_puppet/data/foo.pp:8:3 on node 6d6370c009db
Puppet Version 1.10.4 
Error: Evaluation Error: Error while evaluating a Resource Statement, Lookup of key 'foo::bar' failed: Value for key 'foo::bar', in hash returned from data_hash function 'yaml_data', when using location '/tmp/bug_puppet/data/common.yaml', has wrong type, expects Puppet::LookupValue, got Hash[Regexp[/a.b/], Hash[String, Hash[0, 0], 1, 1], 1, 1] at /tmp/bug_puppet/data/foo.pp:8:3 on node 1ff02903420e
{code}

It was working also on version 1.8.0.

Regards

Olivier ",Bug,PUP-8084,"['hiera', 'yaml']",Hiera lookup failed when using serialized regex in yaml
"While investigating MODULES-4934, it was realized that NTFS reparse points inside of DFS mounts were using an inappropriate data structure.

This would result in {{Puppet::Util::Windows::File.resolve_symlink}} returning a path string missing the first 4 bytes (and reading an extra 4 bytes of junk data off the end of the buffer).

In short, DFS shares with reparse points never work in Puppet properly.  A simple repro scenario is to use a file resource in Puppet to recursively copy from a DFS path (that contains the default hidden reparse point to the host drives {{C:\\Volume Information}}) like:

{code}
file { 'c:/Share1-test':
     ensure  => directory,
     recurse => true,
     source  => '//dfsdemo.local/Puppet/TestShare',
     source_permissions => 'ignore'
 }
{code}",Bug,PUP-8083,[],NTFS reparse points return invalid path data strings for mount points (like those in a DFS share)
When PMT is installing a deprecated module (either directly or as a dependency of another module) it should emit a warning. The warning should include a link to the Forge module detail page of the deprecated module so that the user can investigate.,Improvement,PUP-8082,[],Add warning to Puppet Module Tool when installing a deprecated module
"Need to create tests for the following I18n and modules cases:
* -Module in multiple environments-
* Run puppet agent multiple times without restarting the server (not planning on doing this)
* -Puppet Functions, custom facts, manifests, types, providers-
* -puppet agent-
* -puppet apply-
* -puppet facts-
* -puppet describe-
* -puppet resource-
* -Can still disable translations globally-
* -Verify fall back when language not available-
* -server side non-EN locale-",Task,PUP-8081,[],Create tests for expanded module I18N testing
"Add tests for the following cases:
* Need a module with a non puppet locale
* Modules with locale's not in Puppet
* Multiple requests against puppetserver

Need to understand what is required to produce the failure",Task,PUP-8080,[],Puppet i18n with Modules: Add basic modules tests
"This epic contains the work needed to get modules translations fully functional in all configurations, while maintaining good performance.

Initial design work was done in https://docs.google.com/a/puppet.com/document/d/1u9IQDh1zozOGPCmsMX99_11FA-ET9uaW0gPLgLGVlF0/edit?usp=sharing.",Epic,PUP-8079,['i18n'],Puppet i18n with Modules: Expanded use-cases and performance
"It is currently not possible to create an {{Object}} data type that is parameterized. The type itself can thus only be used to filter instances based on their type, not on contents. This is highly desirable in some cases.

A first implementation should allow parameterized types to be created with filtering logic implemented in Ruby. Later, we might add predefined filters such as using {{Pattern}}, {{String}}, or {{Enum}} to match string attributes, min/max filters for magnitudes, or {{Boolean}} filters to match if attributes have a value or not.

The parameters for an {{Object}} type can be added using a new top level property named {{type_parameters}}. The value of this property is a hash similar to {{attributes}} where a parameter declaration is a subset of an attribute declaration. The parameter can have a {{type}} and a {{value}} but is different from an attribute in that a parameter is always optional (a required parameter would break the current pattern where a fully generalized type exists for each parameterized type).

A parameterized `Object` type, when serialized, must retain the values of its parameters.

Example:
{code:puppet}
type Error = Object[
  type_parameters => {
    kind => Variant[String, Regexp, Type[Enum], Type[Pattern]],
    issue_code => Variant[String, Regexp, Type[Enum], Type[Pattern]]
  },
  attributes => {
    message => String[1],
    kind => { type => Optional[String[1]], value => undef },
    issue_code => { type => Optional[String[1]], value => 'ERROR' },
    partial_result => { type => Data, value => undef },
    details => { type => Optional[Hash[String[1],Data]], value => undef },
  }]
{code}

The above declaration makes it possible to create a parameterized {{Error}} by either providing no parameters at all, one {{Hash}} parameter with named arguments, or one or two anonymous (positional) arguments.",Bug,PUP-8078,[],Make it possible to create parameterized Object data types
"It seems that code in https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/indirection.rb#L177 is incorrect.
I suppose, 

{code}
  def allow_remote_requests?
    terminus.allow_remote_requests?
 end
{code}
should have been something like
{code}
def allow_remote_requests?
    term = terminus(cache_class)
    term.allow_remote_requests?
end
{code}

Found this while debugging more complex issue with Puppet master on OpenIndiana.",Bug,PUP-8077,[],terminus is undefined in lib/puppet/indirector/indirection.rb
"As we have made changes to the language and introduced new data types we must update the language specification to be on par with the implementation.  While there are currently some subtasks associated with tickets for features on the feature branch, those may not be complete which means that:
* a review must be made of what we added must be done, adding tickets for spec work where required
* complete the specification update tickets

(This work is basically due to ""scrambling to be finished for puppet conf"")",Task,PUP-8076,[],language specification needs to be updated with changes from feature_puppet-tasks
The tickets for commits on the feature_puppet-tasks branch should be made up to date wrt. puppet release version and release notes.,Task,PUP-8075,[],tickets merged from feature branch should be made up to date
"Before merge, a green acceptance run of the merged result is needed.

Technically, the feature branch should be up to date with master being merged into the feature branch and a merge into master should be a simple operation. It therefore seems that an acceptance run on a build of puppet from the feature branch should be enough.",Task,PUP-8074,[],Make trial merge of feature_puppet-tasks branch and run acceptance
"The functions:
* run_task
* run_plan
* run_script
* run_command
* file_upload

Should move from the puppet repo to bolt. This ticket is about removing the functions in puppet. There is a corresponding ticket for Bolt to add them there. Both these tickets must be done at the same time.",Task,PUP-8073,[],"(Re)move the execution functions from puppet (to a ""module"" in bolt)"
We need to merge the branch {{feature_puppet-tasks}} to the master branch. This requires coordinated changes across the puppet and bolt repos.,Epic,PUP-8072,[],Merge tasks/scripts feature branch to puppet master
The [class documentation|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/types/p_binary_type.rb#L5-L6] for the {{PBinaryType}} is copied verbatim from the {{PVersionType}}. It should be changed to describe the {{Binary}} data type.,Bug,PUP-8071,[],Class documentation for PBinaryType is copy/pasted and incorrect
"Given a simple task:

{code}
#!/opt/puppetlabs/puppet/bin/ruby

require 'json'

puts Time.now
exit 1
{code}

And a plan:

{code}
plan mymod () {
  $r = run_task(""mymod::sample"", [""dev1""])
  $r.error_nodes.each |$node, $error| {
    notice($node)
    notice($error)
    if $error =~ Error {
      notice($error.partial_result())
    }
  }
}
{code}

I expect to get the data out of partial result, but:

{code}
bolt plan run mymod --modules .
Warning: Support for ruby version 2.0.0 is deprecated and will be removed in a future release. See https://docs.puppet.com/puppet/latest/system_requirements.html#ruby for a list of supported ruby versions.
   (at /home/rip/.gem/ruby/gems/bolt-0.5.1/vendored/puppet/lib/puppet.rb:134:in `<module:Puppet>')
Notice: Scope(/home/rip/temp/bolts/mymod/plans/init.pp, 4): dev1
Notice: Scope(/home/rip/temp/bolts/mymod/plans/init.pp, 5): Error({'message' => 'The task failed with exit code 1', 'kind' => 'puppetlabs.tasks/task-error', 'issue_code' => 'TASK_ERROR', 'partial_result' => ""2017-10-19 12:23:59 +0200\n"", 'details' => {'exit_code' => 1}})
Error: Evaluation Error: Unknown function: 'partial_result'. at /home/rip/temp/bolts/mymod/plans/init.pp:6:34 on node dev2.devco.net
Exiting because of an error in Puppet code
{code}
",Bug,PUP-8070,[],cannot extract partial result from errors in plans
The test  acceptance/tests/environment/directory_environment_with_access_problems.rb should have the server tag to ensure it runs in the right suites.,Task,PUP-8069,[],tag env error acceptance test with 'server'
Puppet should use {{Puppet.lookup}} to resolve the bolt executor instead of relying on {{Bolt::Node.from_uri}} as the later does not preserve executor state when executed from bolt.,Improvement,PUP-8068,[],Use Puppet.lookup to resolve executor
"Hello,

In some situations, a selector expression will be ignored in favor of the statement that it's testing. This seems like an operator precedence problem.

The following manifest should notify two lines, ""I am an array"", and ""I am still an array"":
{code:puppet}
$value = 'nonsense'

$test = [
  'I am',
  $value =~ Array ? {
    default => 'not an array',
    true    => 'an array',
  },
].join(' ')

$test2 = [
  'I am still',
  ($value =~ Array) ? {
    default => 'not an array',
    true    => 'an array',
  },
].join(' ')

notify{ $test: }
notify{ $test2: }
{code}
Instead, the first notify becomes ""I am false"", because ""$value =~ Array"" resolves without consulting the selector.
The parentheses in $test2's assignment seem to workaround this behavior. 


And similarly in a function, the same occurs due to implicit returning:
{code:puppet}
$value = 'asdasd'

function test_broken ($item) {
  $value =~ /\d/ ? {
    default => 'non-numeric',
    true    => 'numeric',
  }
}

function test_works ($item) {
  ($value =~ /\d/) ? {
    default => 'non-numeric',
    true    => 'numeric',
  }
}
$x = test_broken($value)
$y = test_works($value)
notify{ ""$x"": }
notify{ ""$y"": }
{code}


The following manifest should notify 'I am less than or equal to three'::
{code:puppet}
$value = 3

$test = [
  'I am',
  $value > 3 ? {
    default => 'less than or equal to three',
    true    => 'larger than three',
  },
].join(' ')
{code}
The parser instead errors with:

{code}
Evaluation Error: Comparison of: Integer > String, is not possible. Caused by 'A Numeric is not comparable to non Numeric'. at /test.pp:5:10
{code}

If I can provide further information or help in any way with this issue, please let me know.",Bug,PUP-8067,"['parser', 'selector']",Selector expression ignored in some scenarios
"Following acceptance tests fail when running in FIPS mode using PA linked against system openssl. 

* acceptance/tests/face/loadable_from_modules.rb
* acceptance/tests/loader/func4x_loadable_from_modules.rb
* acceptance/tests/modules/build/build_agent.rb
* acceptance/tests/modules/build/build_should_not_create_changes.rb
* acceptance/tests/modules/install/basic_install.rb
* acceptance/tests/modules/install/with_version.rb
* acceptance/tests/parser_functions/calling_all_functions.rb
* acceptance/tests/puppet_apply_a_file_should_create_a_file_and_report_the_md5.rb
* acceptance/tests/resource/file/content_attribute.rb
* acceptance/tests/ticket_1334_clientbucket_corrupted.rb
* acceptance/tests/ticket_6541_invalid_filebucket_files.rb

They need to be investigated and adjusted appropriately.",Bug,PUP-8066,[],Failing acceptance tests in FIPS mode
"Link to the overall list of jobs:
https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/master/view/Non-Standard/job/platform_puppet-agent_intn-van-sys_suite-secondary-puppet-master/30/

https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/master/view/Suite/job/platform_puppet-agent_integration-vanagon-suite-daily-master/12/COMPONENT=puppet,SLAVE_LABEL=beaker,TEST_TARGET=solaris10-64a/

Relevant part of the output (using the AIX 6.1 job as reference):
{code}
Debug: Facter: resolving hypervisors facts.
            Debug: Facter: dmidecode executable not found
            Debug: Facter: /sys/class/dmi/id/ not found.
            Error: Facter: Facter.to_hash uncaught exception: boost::too_many_args: format-string referred to less arguments than were passed
            Error: Could not retrieve local facts: undefined method `[]=' for nil:NilClass
            Error: Failed to apply catalog: Could not retrieve local facts: undefined method `[]=' for nil:NilClass
            Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
            Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
            Debug: report supports formats: json pson yaml
            Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
            Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
            Debug: report supports formats: json pson yaml
            Debug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack
            Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
            Debug: report supports formats: json pson yaml
            Debug: Using cached connection for https://u7tzaige52d694t.delivery.puppetlabs.net:8140
            Debug: Caching connection for https://u7tzaige52d694t.delivery.puppetlabs.net:8140
            Debug: Closing connection for https://u7tzaige52d694t.delivery.puppetlabs.net:8140
{code}

This is also causing many failures in the Facter tests:

{code}
Beaker::Host::CommandFailure: Host 'aix-61-agent2.delivery.puppetlabs.net' exited with 1 running:
                   env TERM=""xterm-256color"" facter --debug --color
                  Last 10 lines of output were:
                        2017-11-05 17:06:16.801647 DEBUG leatherman.execution:476 - completed processing output: closing child pipes.
                        2017-11-05 17:06:16.801832 DEBUG leatherman.execution:558 - process exited with status code 0.
                        2017-11-05 17:06:16.801951 DEBUG puppetlabs.facter - fact ""augeasversion"" has resolved to ""1.8.1"".
                        2017-11-05 17:06:16.802022 DEBUG puppetlabs.facter - fact ""augeas"" has resolved to {
                          version => ""1.8.1""
                        }.
                        2017-11-05 17:06:16.802088 DEBUG puppetlabs.facter - resolving hypervisors facts.
                        2017-11-05 17:06:16.802216 DEBUG puppetlabs.whereami - dmidecode executable not found
                        2017-11-05 17:06:16.802269 DEBUG puppetlabs.whereami - /sys/class/dmi/id/ not found.
                        2017-11-05 17:06:16.832718 FATAL puppetlabs.facter - unhandled exception: boost::too_many_args: format-string referred to less arguments than were passed
{code}",CI Blocker,PUP-8065,[],puppet acceptance test server_list_setting.rb fails on AIX and Solaris
,Sub-task,PUP-8064,[],Produce pre-docs for new type Target
,Sub-task,PUP-8062,[],Update language specification with Target data type
"* The URI type needs to be specified. 
* Operator + merges two URIs
* all attributes available as methods - just like for object
* additional operations
",Sub-task,PUP-8060,[],Update language specification with URI type
"puppetlabs_spec_helper provides a task named [validate|https://github.com/puppetlabs/puppetlabs_spec_helper/blob/8758356179498c053c76d16f7f460d3313858f92/lib/puppetlabs_spec_helper/rake_tasks.rb#L483-L496] that now fails on modules containing plans. I have traced the calls this makes down and it seems that, in the end, each {{.pp}} file in a project that is not excluded manually via {{PuppetSyntax.exclude_paths}} is passed to {{puppet parser validate}} via the code below:

{code:ruby}
def validate_manifest(file)
  Puppet[:parser] = 'future' if PuppetSyntax.future_parser and Puppet.version.to_i < 4
  Puppet[:app_management] = true if PuppetSyntax.app_management && (Puppet::Util::Package.versioncmp(Puppet.version, '4.3.0') >= 0 && Puppet.version.to_i < 5)
  Puppet::Face[:parser, :current].validate(file)
end
{code}

The result of this is that existing module authors like myself who have added plans to their modules now have failing test with valid code. Natrually, I could work around this by adding the entire plans directory to my list of excluded paths but, seeing as these are proper {{.pp}} files, this feels wrong. 

Here is the full trace of how {{rake validate}} gets to these manifests:

# puppetlabs_spec_helper defines a {{validate}} task [here|https://github.com/puppetlabs/puppetlabs_spec_helper/blob/8758356179498c053c76d16f7f460d3313858f92/lib/puppetlabs_spec_helper/rake_tasks.rb#L483-L496] that calls the {{syntax}} task.
# the {{syntax}} task is part of puppet-syntax and calls {{syntax:manifests}} [here|https://github.com/voxpupuli/puppet-syntax/blob/5fb0bb43123a5a3ca0916df16cf8cef30c4d57b7/lib/puppet-syntax/tasks/puppet-syntax.rb#L29]
# the {{syntax:manifests}} task is defined [here|https://github.com/voxpupuli/puppet-syntax/blob/5fb0bb43123a5a3ca0916df16cf8cef30c4d57b7/lib/puppet-syntax/tasks/puppet-syntax.rb#L50-L70]. It calls the check method of {{PuppetSyntax::Manifests}} on all found manifests [here|https://github.com/voxpupuli/puppet-syntax/blob/5fb0bb43123a5a3ca0916df16cf8cef30c4d57b7/lib/puppet-syntax/tasks/puppet-syntax.rb#L67].
# The check method calls the {{validate_manifest}} method on each file [here|https://github.com/voxpupuli/puppet-syntax/blob/5fb0bb43123a5a3ca0916df16cf8cef30c4d57b7/lib/puppet-syntax/manifests.rb#L24].
# The {{validate_manifest}} method is defined [here|https://github.com/voxpupuli/puppet-syntax/blob/5fb0bb43123a5a3ca0916df16cf8cef30c4d57b7/lib/puppet-syntax/manifests.rb#L60-L64] and passes each file to puppet parser validate via the code block above.",Bug,PUP-8059,[],rake validate fails on modules with plans
The {{Numeric}} type returns {{true}} for a ruby {{Rational}} value when it should return {{false}}. This is probably because it blindly accepts subtypes of ruby numeric.,Bug,PUP-8057,[],Ruby Rational data type matches Numeric when it should not
"The plan error docs https://puppet.com/docs/bolt/0.5/writing_plans.html#returning-errors-in-plans suggest this would work:

{code}
plan mymodule::myplan {
  Error(
    message    => ""Sorry, this plan does not work yet."",
    kind       => 'mymodule/error',
    issue_code => 'NOT_IMPLEMENTED'
    )
  }
{code}

This gives:

{code}
Error: Evaluation Error: Error while evaluating a Function Call, 'new_error' parameter 'message' expects a String value, got Struct at /home/rip/temp/bolts/mymod/plans/discover.pp:2:3 on node dev2.devco.net
{code}

Appears the code does not support that syntax it wants params of strings https://github.com/puppetlabs/puppet/blob/7fce55c2395df4c9547220169f82c97bb92b4574/lib/puppet/pops/types/p_error_type.rb#L59

Henrik points out and I seem to recall that there's something that should allow a hash to be passed in and mapped to param names - this might be the actual thing thats broken (Henrik: yes this is an implementation bug).",Bug,PUP-8056,[],Error type docs show new from hash - does not work as intended
"When trying to use the {{mount}} provider, on FreeBSD, it will append the [update|https://github.com/puppetlabs/puppet/blob/33843ed58d92c371a4c153c4dd64beb712306467/lib/puppet/provider/mount.rb#L33] option when trying to issue the initial mount command.

However, for some file types (i.e. procfs, and fdescfs), the {{update}} flag is not a valid flag. 

I'll note that the the entry written to the fstab is correct, but the mount command issues by Puppet is what is incorrect.",Bug,PUP-8055,['freebsd'],Mount command on FreeBSD inaccurate for some fs types.
"Hi,
erwbgy-system got migrated to puppet-system. Please mark it as deprecated.",Bug,PUP-8054,[],erwbgy-system: Mark as deprecated
"Please add an option to make {{puppet agent}} wait for the lock to become available and then run. As is I often end up retrying multiple times, or setting up a {{while}} loop to check for the presence of the lock file.

For example, {{puppet agent --waitforlock --test}} or {{puppet agent -Wt}}.",New Feature,PUP-8051,[],puppet agent option to wait for lock
Please add a {{\-E}} short option for {{puppet agent}} that corresponds to {{--environment}}. We (and likely many other people) running {{puppet agent -t --environment myenv}} many times per day.,Improvement,PUP-8050,[],puppet agent -E environment
"Following tests were identified to be incompatible with FIPS mode of operation due to their use of md5. They need to be either skipped or adjusted to use one of the fips approved hash algorithms. 

* tests.puppet_apply_a_file_should_create_a_file_and_report_the_md5.rb
* tests.ticket_1334_clientbucket_corrupted.rb
* tests.ticket_6541_invalid_filebucket_files.rb
* tests/face.loadable_from_modules.rb
* tests/loader.func4x_loadable_from_modules.rb
* tests/parser_functions.calling_all_functions.rb
* tests/modules/build.build_agent.rb
* tests/modules/build.build_should_not_create_changes.rb
* tests/modules/install.basic_install.rb
* tests/modules/install.with_version.rb
* ",Task,PUP-8049,[],Adjust or skip FIPS incompatible acceptance tests when running in FIPS mode
"I accidentially created a VM with only 128MB RAM. Puppet run looks like this:

{{Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass
Error: Could not autoload puppet/provider/service/openbsd: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass
Error: Could not retrieve local facts: Could not autoload puppet/provider/service/openbsd: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass
Error: Failed to apply catalog: Could not retrieve local facts: Could not autoload puppet/provider/service/openbsd: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass}}

This is due to Facter.value(:operatingsystem) being NilClass. When running with --debug, I see a lot of the following messages:{{Debug: Facter: value for <foo> is still nil}}

It took me a while to find out the puppet run succeeds with more memory just fine. I didn't see any OOM-Killings in dmesg. Of course, it might be not supported/advised to run puppet on such low memory, but I'd still expect puppet to somehow fail in a better way… This might boil down to facter failing in weird ways, puppet not noticing that, or something in between.

puppet-4.8.2-5 on Debian Stretch with packages provided by Debian directly.",Bug,PUP-8048,[],puppet / facter fails randomly in low memory situations
"Given:
- Puppet defaults to english and has japanese translations
- A module defaults to german and has no translations
- A module defaults to japanese and has german translations

If I were a user with a german locale, I'd expect Puppet to be in english and both modules to be in german. If the japanese module is loaded last, I believe you will end up with Puppet in japanese and both modules in german.

I haven't tested this out, just intuition based on how we update default locale in gettext-setup and then use it to negotiate locale.",Bug,PUP-8047,['i18n'],Puppet may get surprising locale if modules use different default locales
"When tasks that have an ensure parameter are used in a plan, they cause a stack trace.

I am seeing this when using gcompute::instance in a plan on bolt 0.5.0",Bug,PUP-8046,[],Tasks with an ensure parameter cause plan failure
The dnf provider is only configured to be the default on Fedora 22-24.  This provider should support all Fedora releases from 22 and up.,Improvement,PUP-8045,[],Add support for Fedora 26 in the dnf provider
"Set the agent host node prior to running acceptance tests into FIPS mode on following platforms:
rhel7, rhel6, fedora24, fedora25",Task,PUP-8044,[],Enable testing PA built for FIPS on platforms in FIPS mode
"The {{Puppet::Pops::Loader::TaskInstantiator}} performs rigid type checking of the task metadata and since the specification for this metadata has changed (""puppet_task_version"" is now an {{Integer}} rather than a {{String}}), a maint release has been merged to also change the actual type used when performing the check.

Additional tests are needed that verifies that the declared type used for the check has 100% conformance to the specification.",Bug,PUP-8043,[],Add test to assert that task metadata type is validated according to spec.
"Attempting to install pip packages with the puppet resource pip.

This is displayed in the the UI:
Failed to apply catalog: [nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, [(provider=pip)]]

I read somewhere that if you use easy_install to install pip instead of installing the python-pip package it resolves the error, which i have to do with an exec (prefer not to use)... It did, however, the pip packages then will not install.  Unless I re-install python-pip.  Which brings the error back. I also have to update pip after it is installed??? Why do I have to manage the packages that are required for the puppet provider pip to work? Shouldn't this already be handled by puppet within the provider itself??? It also is frustrating that you do not support the environment variable like you do in yum and other providers.

{code:ruby}
  package { 'python-pip':
    ensure   => present,
    provider => yum
  }

  exec { 'install_pip':
    command => 'easy_install pip >> /tmp/easy_install_pip.log',
    path    => ['/usr/bin', '/usr/sbin', '/usr/local/bin/', '/bin'],
    creates => '/tmp/easy_install_pip.log',
  }

  exec { 'upgrade_pip':
    command => 'pip install --upgrade pip >> /tmp/upgrade_pip.log',
    path    => ['/usr/bin', '/usr/sbin', '/usr/local/bin/', '/bin'],
    creates => '/tmp/upgrade_pip.log',
    require => Exec['install_pip'],
  }

  $pip_packages.each | $pip_package | {
    $shortp = $pip_package.split('-')[0]
    $namep = regsubst($shortp, '([_])', '-').downcase
    package { $namep:
      ensure   => installed,
      #environment doesn't work...
      #environment => [ $proxy_string, $https_proxy_string, $no_proxy_string ],
      provider => pip,
      #install options for attempting to install from local source
      #install_options => ['--no-index', ""--find-links=${p_installdir}${pip_package}""],
      require  => Exec['install_pip'],
    }
  }
{code}
",Bug,PUP-8042,[],"Failed to apply catalog: [nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, [(provider=pip)]]"
"Since 2012, we've used {{FACTER_url}} as a workaround for {{puppet resource}}:

bq. A limitation to watch out for in the current Puppet release is that 'puppet apply' and 'puppet resource' cannot modify network resources. However, we implemented a feature to allow puppet resource to query a F5 device. (For authors of types/providers, making changes to resources aren’t supported until apply_to_device in resources type are handled differently by puppet apply/resource commands). For now we use url facts to establish connectivity to specific F5 devices.

https://puppet.com/blog/managing-f5-big-ip-network-devices-puppet

Using {{FACTER_url}} is insecure, as it places authentication credentials either in history or in the environment. It's also ugly.

If we implement {{--target}} in {{puppet resource}} as we've done in {{puppet device}} we can lookup the target device's url and internally set {{Facter(:url). This would not require changes to existing device modules.

If we implement this as a {{device(name)}} method in Puppet::Util::NetworkDevice::Config, it would allow device tasks to use {{device(name)}} to target devices.",New Feature,PUP-8041,['cs_pr_review'],Replace FACTER_url with --resource for puppet device
"From a few hours of investigation, the puppetserver appears to track translation repositories from compile to compile, but either ""forgets"" about the locale after each compile, or must have the locale initialized in EVERY thread individually.

Some technical details:
- {{Puppet::GettextConfig.initialize_i18n}} checks {{translation_repositories}} before initializing {{FastGettext.locale}}, and thus only initializes the locale once ever (see https://github.com/puppetlabs/puppet/blob/5.3.2/lib/puppet/module.rb#L427-L446).
- {{FastGettext.translation_repositories}} are a class variable. According to the FastGettext readme, {{FastGettext.locale}} must be initialized once per thread: https://github.com/grosser/fast_gettext#3-choose-text-domain-and-locale-for-translation
- The locale should be negotiated at every module load, contrary to what this says: https://github.com/puppetlabs/puppet/blob/5.3.2/lib/puppet/gettext/config.rb#L83-L84 (watch out for performance implications) but the translation repositories should only needed to be loaded once.

We are going to explore refactoring the gettext initialization code to skip the logic around {{available_locales}} and {{FastGettext.locale}} in favor of just setting {{FastGettext.default_locale}} to the system locale directly, since {{default_locale}} is not thread local, unlike {{FastGettext.locale}}. That library should already handle the fallback cases from this configuration (though we will be writing tests to verify this, see PUP-8080). In order to avoid breaking other users of GettextSetup, we will likely be implementing most of this directly in Puppet as gettext utils, and drop our runtime dependency on GettextSetup.

It looks like we might run into a similar issue when we start trying to use more text domains (see PUP-8013 and https://github.com/grosser/fast_gettext/blob/master/lib/fast_gettext/storage.rb#L54) as the current text domain also appears to be a thread-local variable. Currently we're avoiding issues here by only using one text domain which is both set as {{FastGettext.text_domain}} and {{FastGettext.default_text_domain}}, the latter of which is not thread local.

----

Reproduction steps in a basic PE 2017.3.1 install
- {{localectl set-locale LANG=ja_JP.UTF-8}}
- add {{fail('trigger failure')}} to {{node default}} section of {{/etc/puppetlabs/code/environments/production/manifests/site.pp}}
- set {{disable_i18n=false}} in {{/etc/puppetlabs/puppet/puppet.conf}}
- {{systemctl restart pe-puppetserver}}
- {{puppet agent -t --noop}} (several times)

Expect to see
{quote}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: サーバエラー: Evaluation Error: a Function Callの検証中にエラーが生じました。trigger failure at /etc/puppetlabs/code/environments/production/manifests/site.pp:31:3 on node hwcijw3gfrqxsiw.delivery.puppetlabs.net
{quote}
Will mostly see
{quote}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, trigger failure at /etc/puppetlabs/code/environments/production/manifests/site.pp:31:3 on node hwcijw3gfrqxsiw.delivery.puppetlabs.net
{quote}",Bug,PUP-8040,['i18n'],Puppet does not initialize I18N locale per thread
"Currently in Puppet >4.10.5, if the gettext-setup gem cannot be found we will issue a warning for every single module that is loaded, each time that module is loaded. This causes a huge amount of log spam in environments that load a lot of modules, all with nearly the same message:
{{2017-09-26 00:05:19,103 WARN  [qtp1394837016-64] [puppetserver] Puppet GettextSetup is not available, skipping GettextSetup initialization for <module_name>.}}

We should only issue this warning once.",Bug,PUP-8039,[],Puppet 4.10.x: Only warn once when gettext cannot be found
"in the rubocop-i18n cops' there is a cop GetText/DecorateString which appears to be incorrect.

After trying to make the cop work correctly I figured out that we really don't want a cop like this. *Every* ruby string pretty much comes up as needing to be decorated. In many cases this is not what we want for example:

* file paths
* command lines
* hash keys (hash['this is a key #{thing}'])

-I believe the intent was for it to complain when it found a string that does not have a decorator method around it.-

-Need to update the cop-
-Need to add more spec tests-
Need to add the cop to the README.md
Remove the cop
Add a CHANGELOG.md",Task,PUP-8038,[],rubocop-i18n GetText/DecorateString needs to be more selective
"When configuring an agent with ""server_urls"", failover events that exhaust the list of servers result in connection attempts to port 0:

{noformat}
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2) for nil port 0
{noformat}

I couldn't find this behavior documented anywhere.  Is it intentional?",Bug,PUP-8037,[],"Configuring ""server_urls"" causes connection attempts to port 0"
"h3. The issue:

the ""server_urls"" configuration setting can mask server-side issues by mistakingly pointing to a connectivity issue on port 0:

{noformat}
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2) for nil port 0
{noformat}

h3. Replication: 

Configure an agent to connect to a master with the server_list setting:

{noformat}
[agent]
#server = pe-201724-master.puppetdebug.vlan
server_list = pe-201724-master.puppetdebug.vlan:8140
{noformat}

Revoke the agent's certificate on the master and observe the error on the next agent run:

h3. Actual result:

{noformat}
Warning: Could not select a functional puppet master
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: Connection refused - connect(2) for nil port 0
Info: Retrieving pluginfacts
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2) for nil port 0
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: Connection refused - connect(2) for nil port 0
Info: Retrieving plugin
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2) for nil port 0
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Connection refused - connect(2) for nil port 0
Info: Loading facts
Error: Could not retrieve catalog from remote server: Connection refused - connect(2) for nil port 0
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
Error: Could not send report: Connection refused - connect(2) for nil port 0
{noformat}

h3. Expected result:

Change the agent's configuration to use the ""server"" setting and observe the difference.  The error points more clearly to an SSL issue:

{noformat}
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: SSL_connect SYSCALL returned=5 errno=0 state=unknown state
Info: Retrieving pluginfacts
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': SSL_connect SYSCALL returned=5 errno=0 state=unknown state
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: SSL_connect SYSCALL returned=5 errno=0 state=unknown state
Info: Retrieving plugin
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': SSL_connect SYSCALL returned=5 errno=0 state=unknown state
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: SSL_connect SYSCALL returned=5 errno=0 state=unknown state
Info: Loading facts
Error: Could not retrieve catalog from remote server: SSL_connect SYSCALL returned=5 errno=0 state=unknown state
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
Error: Could not send report: SSL_connect SYSCALL returned=5 errno=0 state=unknown state
{noformat}",Bug,PUP-8036,[],Use of server_urls can cause misleading agent errors
"HI 

I have a customer who is reporting the following:

Currently when they do a manual run on their agent it will fail. This will display in the console as a failed run. 

When the agent does a scheduled automatic run, it will apply a cached catalog and show in the console as a run with no failures and unchanged. However when you dig into the report details it will show that there has been an error and the cached catalog is being applied. 

The user is aware that they can change usecacheonfailure to false in their agent's puppet.conf but they would like to raise a feature request to show that the scheduled run did still have a failure even if a cached catalog is applied. 

Thanks 
",New Feature,PUP-8035,[],Failed Runs showing as Unchanged in Console due to Cached Catalog
"I have raised this as an improvement because character encoding is a right mess...

If you create a csr_attribute.yaml file to add extensions to your Puppet Certificate the puppet process will complain:
Error: Could not request certificate: ASCII incompatible encoding needs binmode
Wrapped exception:
ASCII incompatible encoding needs binmode.

This will happen if you create the file as follows:
{code}
# Creating file to ensure we include assured facts in Puppet Cert
New-Item -ItemType directory -Path ""$($osDrive)\ProgramData\PuppetLabs\puppet\etc""
$csrattributes = ""---`r`nextension_requests:`r`n  `""1.3.6.1.4.1.34380.1.1.100`"": Farnborough`r`n""
$csrattributes | out-file ""$($osDrive)\ProgramData\PuppetLabs\puppet\etc\csr_attributes.yaml""
{code}

If you create the file with encoding:
{code}
# Creating file to ensure we include assured facts in Puppet Cert
New-Item -ItemType directory -Path ""$($osDrive)\ProgramData\PuppetLabs\puppet\etc""
$csrattributes = ""---`r`nextension_requests:`r`n  `""1.3.6.1.4.1.34380.1.1.100`"": Farnborough`r`n""
$csrattributes | out-file -Encoding ascii ""$($osDrive)\ProgramData\PuppetLabs\puppet\etc\csr_attributes.yaml""
{code}

then you don't get the error.

It would be useful if the character encoding could be ignored when reading this file.",Improvement,PUP-8034,[],csr_attribute.yaml file on Windows is encoding sensitive
"I notice that a puppet class is not included when I use the same name in the node definition. Let me explain by example:

I have the following structure on puppetmaster:

manifests/nodes/zimbra.pp

{code:java}
node /zimbra/ {
 include ::zimbra
}
{code}

modules/zimbra/manifests/init.pp
{code:java}
class zimbra {
  notify {'foobar': }
}
{code}


I have node zimbra01 where I run puppet. It runs successfully but the notify from the class zimbra is not applied/executed (actually nothing inside zimbra class).

It works in two different cases when:
* I change the line ""include ::zimbra"" to ""class { '::zimbra': }""
* or when I change the line ""node /zimbra/"" to ""node /zimbra[0-9]/""

Another weird thing is that when I make a syntax error in zimbra class, puppet fails due to that.


It looks like a node definition '/zimbra/' interferences with the zimbra class and so it's included but not executed.

I may provide more output.
     ",Bug,PUP-8032,[],a node definition beats a include when the names equal
"Functions do not seem to work properly when there is ""bad"" data in metadata.json.  

*Puppet Version:* PE 2017.2.1 2017.2.4


Please take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.",Bug,PUP-8031,[],"Evaluation Error: Error while evaluating a Function Call, undefined method `include?' for nil:NilClass"
"Sometimes it might be helpful or necessary for users or our support team to see English messages instead of translated ones, for debugging and Googling. We should create a Puppet setting that disables translation.

Now that we have this capability we need to add tests to puppet to verify this behavior",Task,PUP-8030,[],Provide a setting to disable translations (create tests to verify feature)
"There are some concatenated strings in Puppet that are resulting in mistranslations because the translator doesn't have the full context of what the complete sentence is supposed to be, and cannot change the sentence order,

Example:
https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/catalog/compiler.rb#L273-L276
https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/catalog/compiler.rb#L291-L292

These might be the only two occurrences [~eric.delaney]",Bug,PUP-8029,['i18n'],Concatenated strings causing breakages with Japanese
"When puppet loads tasks from a module it does not exclude directories this means that 

Currently the following module has two tasks:
<module>
<module>::foo
It should only have a single task <module> and the directory should be ignore.
{noformat}
.
└── tasks
    ├── foo
    │   └── bar.sh
    ├── init.json
    └── init.rb
{noformat}",Bug,PUP-8028,[],Puppet considers directories as tasks
"PUP-620 added an install_options parameter to the gem provider which can be used to specify a proxy:

{code}
  package { 'puppet-lint':
    ensure          => latest,
    provider        => 'gem',
    install_options => [{'--http-proxy' => 'http://myproxy.com:80'}],
  }
{code}

This works fine on the the original run where the gem is installed.  However, on subsequent runs the puppet agent will hang since the gem list command does not pass in the install options (proxy):
{quote}Debug: Executing: '/bin/gem list --local'
Debug: Executing: '/bin/gem list --remote ^puppet-lint{quote}

At this point the puppet agent will hang until killed.

",Bug,PUP-8027,[],gem provider does not work behind proxy
"Translation support in Puppet was extended to Puppet code in modules. It also appears to be expected to support any Ruby code in modules, such as custom facts, types and providers, and Puppet functions.

This works with {{puppet apply}}. However, we don't appear to do anything to pluginsync the locales directory containing those translations to agents to make them available during a {{puppet agent}} run. We should.

In order to get pluginsync working, we need a locale mountpoint on the server with the locale files, each of which has a unique name based on the module name. These come from the {{locales}} subdirectories of modules. We only want to sync the PO files, not the config files. We either need to preserve the directory structure or only download the one locale we need (or both). We should probably start by downloading all locales to keep things simple.

Adding the downloader on the agent side should be a relatively simple addition, thanks to metaprogramming. We should have these translations be kept separate from the main plugin directory. See {{configurer/downloader_factory.rb}}.

Once we have the translation files, we should load them into the text domain for the current environment at the start of every Puppet application call. This can likely be added to the application base. The first time that this happens on the agent, there won't be any translations. We need to load translations every time we pluginsync and re-evaluate facts, to make sure that we really have loaded the ones for the correct environment, so this should probably be added to the pluginsync functionality.",Bug,PUP-8026,['i18n'],Module code translation should be supported with puppet agent runs
"When using `puppet module install` on a local module tarball that had a {{locales}} dir with a config.yaml, a {{ja/}} folder with a PO file in it, and a POT file, not all of these got installed to the modulepath. The first time I tried it, only config.yaml came, the second time, only the {{ja/}} folder. All of these are needed to correctly initialize display module translations. We should investigate what is wrong with the install command.

It's unclear if this also happens for modules installed from the forge.",Bug,PUP-8025,['i18n'],`puppet module install` does not correctly install locale files
"Currently, we attempt to initialize translations machinery for all modules as soon as they are loaded, despite the fact in many contexts we do not need to display any translations (e.g. {{module list}}). We do this even for modules that do not have any translation files or marked strings.

We should add a function to {{module.rb}} that loads a module's translations, then call it before we think we need module translations to be displayed (e.g. before compilation, or when running a puppet application). We should not load translations for things like file serving, in order to avoid doing unnecessary work. We should see if these optimizations are sufficient to reduce the performance impact before doing anything more drastic.


*Notes on decoupling module naming from locales/config.yaml project name*
From comment below:
{quote}
As part of this, we should remove the requirement that the module have metadata (relies on forge_name) and remove the coupling of metadata naming and locales/config.yaml's project_name.
{quote}

Benchmarks in puppet have shown a non-trivial performance degradation if there is a mismatch between the module's metadata name, and the locales/config.yaml's project_name:
With matching names:
{code}
mkdir -p /var/folders/0_/6qt793gx6w706cq1q9kc0w780000gq/T/many_modules20171009-2426-1l58rtz
                 user     system      total        real
Run 1        3.700000   0.460000   4.170000 (  4.171436)
Run 2        2.840000   0.130000   2.970000 (  2.974983)
Run 3        2.890000   0.120000   3.010000 (  3.016188)
Run 4        2.910000   0.130000   3.040000 (  3.036231)
Run 5        2.770000   0.150000   2.920000 (  2.932649)
Run 6        2.800000   0.120000   2.920000 (  2.910116)
Run 7        3.240000   0.110000   3.350000 (  3.359197)
Run 8        2.760000   0.150000   2.910000 (  2.909707)
Run 9        3.260000   0.150000   3.410000 (  3.414169)
Run 10       3.690000   0.140000   3.830000 (  3.835340)
> total:    30.860000   1.660000  32.530000 ( 32.560017)
> avg:       3.086000   0.166000   3.253000 (  3.256002)
{code}

with mismatched names:
{code}
mkdir -p /var/folders/0_/6qt793gx6w706cq1q9kc0w780000gq/T/many_modules20171009-2350-11p565v
                 user     system      total        real
Run 1        3.680000   0.460000   4.150000 (  4.157170)
Run 2        3.300000   0.250000   3.550000 (  3.552481)
Run 3        3.180000   0.250000   3.430000 (  3.430290)
Run 4        3.400000   0.260000   3.660000 (  3.662123)
Run 5        3.690000   0.310000   4.000000 (  4.010465)
Run 6        3.600000   0.260000   3.860000 (  3.866366)
Run 7        3.320000   0.250000   3.570000 (  3.571592)
Run 8        3.610000   0.320000   3.930000 (  3.943484)
Run 9        3.560000   0.310000   3.870000 (  3.866563)
Run 10       3.990000   0.260000   4.250000 (  4.247610)
> total:    35.330000   2.930000  38.270000 ( 38.308143)
> avg:       3.533000   0.293000   3.827000 (  3.830814)
{code}

Note ~ 6 second cumulative runtime increase 

----

Note that a further implication of how we're loading modules is that if modules don't have metadata, they [will not have a forge_name|https://github.com/puppetlabs/puppet/blob/5.3.1/lib/puppet/module.rb#L226-L229] and thus [initializing i18n will be skipped|https://github.com/puppetlabs/puppet/blob/5.3.1/lib/puppet/module.rb#L426].",Improvement,PUP-8024,['i18n'],Only load module translations when necessary
"Unfortunately we ended up with the attribute 'msg' in {{Error}} instead of the intended {{message}} (because that is how errors are delivered in JSON from bolt, and tasks). In order to facilitate a change, an {{Error}} should respond to {{message}} and return the {{msg}}.
It is expected that far more consume errors than producing new ones. 

Until fixed for good, {{msg}} must be used when creating an error.",New Feature,PUP-8023,[],Add a derived attribute 'message' to Error to prepare for change of 'msg' to 'message'
FIPS requires supporting sha384 besides sha256 (and sha512) and Puppet needs to have support for it to enable its use in FIPS enabled environments. ,New Feature,PUP-8021,[],Puppet needs to support all FIPS approved hash algs
"Currently we use a {{String}} data type as the way to specify a node in the execution API. While this works for now, there are some things are difficult with this design:

* When introspecting a plan, the data type for a parameter that accepts nodes cannot be identified when it is simply {{String}}, or {{Array\[String]}}.
* There are additional values that users must be able to specify
* There is the desire to be able to describe nodes as a comma separated list of host names - the parsing and handling of that (creating individual node references) is logic that should be available in a single implementation

To solve this, we should add a new data type {{Target}} to describe a single node. A collection of {{Target}} is described using {{Array\[Target]}}.

A {{Target}} has the following attributes:
* {{host}} - {{String\[1]}} for the host name.
* {{options}} - An optional {{Hash\[String\[1], Data]}} - additional options that vary.

The functions that take ""nodes"" should be updated to also accept instance of {{Target}}, or {{Array\[Target]}}. (if they are fed strings, they will create the corresponding {{Target}} instances).

To complete the functionality, there must be a way to give {{Target}}/{{Array\[Target]}} to bolt (currently this is a host {{String}} only).",New Feature,PUP-8020,[],Add data type Target to puppet for tasks/plans
,Task,PUP-8019,[],Update language specification with Error type (added in PUP-7998)
"Currently the ENC can provide the environment to the client.  However, when testing a new environment on a client the workflow can result in running the catalog before I'm ready.

Example workflow:
1. disable puppet on the client
2. build testing environment on the puppet master
3. configure the ENC to send the new environment
4. enable puppet in noop mode on the client

If step 1 is not complete, the client may apply the catalog.

This may also be useful in another workflow: if puppet needs to be temporarily disabled on a host.  Puppet can set noop=true via a catalog run, but once this is done, there isn't a way to undo that without manual intervention.

See also: https://www.example42.com/2017/03/06/server-side-noop-mode/",New Feature,PUP-8018,[],ENC option to run catalog in noop mode
"1) Check that the version number in source for puppet is correct

  version for puppet should be 5.3.2

  * check {{lib/puppet/version.rb}} for the {{PUPPETVERSION}} variable
  * check .gemspec for {{version}} variable

",Task,PUP-8017,[],Bump puppet version to 5.3.2
"Once a module's translations have been added to gettext's translation repositories, they will not be updated, even if the underlying translation files change. For modules, in general when source files change at run time, the changes are picked up immediately. We would like to see the same behavior with translations, so we should investigate ways of reloading translation files and adding them to the translation repositories when updates are made to a module's PO files.",Bug,PUP-8016,[],Updated module translations will not be loaded without restarting puppet
"The bootstrap module needs some refactoring and augmented tests before it can be integrated into puppet core. This work breaks down into the following:

- Change the bootstrap application to something like csr or ssl
- Figure out the right transformations for the bootstrap and verify subcommands (i.e. {{puppet ssl generate-csr}} or {{puppet csr generate}} or {{puppet ssl verify}})
- Add tests to validate the new puppet application
- PR the thing
- Profit",Task,PUP-8015,[],Refactor puppet-agent-bootstrap module into something palatable by puppet core
"h1.  The Problem 

When running puppet server you have two levers to adjust how short-lived Puppet environments are cleared from memory.  

1.  {{max-requests-per-instance}} in {{puppetserver.conf}}
2.  {{environment_timeout}} in {{puppet.conf}}/{{environment.conf}}

Each option has it's own cons, because neither addresses the core problem we want to tackle.  We want to clear Puppet environments from memory when they haven't been used for a while and there's no direct way to do that.  

With {{max-requests-per-instance}} we're destroying a whole JRuby which takes out all of the Puppet environments that were ever loaded into it.  

With {{environment_timeout}} we have to clear environments after a certain amount of time even if that environment is getting lots of catalogs compiled against it right now.  

h1.  The solution

Create a setting that allows for expiring a Puppet environment after it has not been compiled against for a set period of time.  If we were to call this setting {{environment_ttl}} and we set it to {{30m}} then that would mean that if you ran an agent against your test environment and then then no other agents checked into that environment for 30m then the test environment would be marked expired.  

This gets to the bottom of the problem customers see when deploying short-lived Puppet environments.  

This setting would be a global setting not a per-environment setting.  

h1.  Caveats 

The setting would presumably interact with the environment_timeout setting.  This setting could only be applied when the environment_timeout is not 0.  If environment_timeout is 0 then this setting would emit a warning and do nothing.  

When the environment_timeout < environment_ttl then environment_timeout would take precedence because it would mark the environment expired before the environment_ttl code had a chance to run.  

When environment_timeout > environment_ttl then this is the primary use case for the setting and environment_ttl finally has a chance to help expire environments more quickly/efficiently than our current settings allow.  ",Improvement,PUP-8014,[],Create an environment_ttl setting to clear short-lived puppet environments from memory
"Users can have different sets and different versions of modules per Puppet environment. In the current system we only load module translations once, so if a user changes their environment to one with a new version of the module in it, the translations will not be updated.

----

We should make translations environment-aware by creating a new text domain for each environment. (note that it appears the current text domain setting is thread local, like locales https://github.com/grosser/fast_gettext/blob/master/lib/fast_gettext/storage.rb#L54) When we load a module's translations, they should be added to the appropriate text domain, and that domain should be loaded when we select an environment (such as on each compilation request, start an application with a configured environment, or switch environment during an agent run).

Modules should be responsible for loading their own translation files, by adding the translations to a gettext repository and adding that repository to the correct text domain. This should be idempotent.

We need to decide where to initialize the text domains themselves. On the server side, this probably happens as part of the HTTP handler for compilation. On the agent side, this is part of application startup. On the agent side, we don't need to tie text domains to environments because we only ever have one active at once.

Text domains should be tied to the environment lifecycle; i.e. when an environment is refreshed, the text domains should be too, to pick up any updates to module translations that occurred. The {{EnvironmentLoader}} might be a good place to put the logic to blow away outdated text domains.

[~henrik.lindberg] probably has the most expertise on the environment lifecycle and how things are loaded within an environment.",Bug,PUP-8013,['i18n'],Translations should be stored in different text domains based on environment
The access operator {{\[]}} when applied to an {{ExecutionResult}} (PUP-8010) should use the index as a node-uri and return the same as the {{value(node-uri)}} method.,New Feature,PUP-8012,[],Make access operator [] work on ExecutionResult
"The functions in puppet that operates on multiple nodes in the bolt execution should all return an instance of {{ExecutionResult}} (PUP-8010).

BOLT-106 describes how Bolt returns a result. The respective puppet function should translate that into {{Variant\[Error, Any]}} per node and return an {{ExecutionResult}} for the set of nodes.
",New Feature,PUP-8011,[],"Make run_task, run_command, run_script and upload_file return ExecutionResult"
"A new datatype {{ExecutionResult}} is needed to encode the execution result on a set of nodes. An instance of this data type is to be returned from run_task() (and other execution functions that operate on a set of nodes).

The data type should have the following methods:
* {{names()}} - the {{String}} names (node-uris) of all nodes in the set as an Array
* {{empty()}} - returns {{Boolean}} if the execution result set is empty
* {{count()}} returns an {{Integer}} count of nodes
* {{value(node-uri)}} the {{Variant\[Error, Any]}} for the given node-uri
* {{values()}} - Array of {{Variant\[Error, Any]}} for the nodes in the result set
* {{ok_nodes()}} - returns an ExecutionResult containing all nodes that have a non {{Error}} result
* {{error_nodes()}} - returns an ExecutionResult containing all nodes that have an {{Error}} result
* {{all_nodes()}} - is not initially needed since this is ""self""
* {{ok()}} - a {{Boolean}} that is the same as {{error_nodes.empty}}

An instance of {{ExecutionResult}} should be {{Iterable}} as if it is a hash of {{String}} node-uri, to {{Variant\[Error, Any]}} - such that iterative functions like {{each}}, {{map}}, {{reduce}}, {{filter}} etc. work.

A separate ticket will add support for the {{\[]}} access operator to {{ExecutionResult}}.",New Feature,PUP-8010,[],Implement ExecutionResult data type
"We've seen a ~30% reduction in compilation capacity with Puppet 5.3 (over Puppet 4.10). It appears to be related to gettext setup at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/gettext/config.rb#L37-L69.

We haven't fully isolated why, but the best guess is that code related to accessing modules during compilation is being called too frequently, and resulting in lots of disk-related activity.",Bug,PUP-8009,[],Performance regression with lots of modules and gettext
"https://jenkins-master-prod-1.delivery.puppetlabs.net/view/modules/view/linux/view/postgresql/view/master/job/forge-module_puppetlabs-postgresql_intn-sys_full-pe-current-master/PLATFORM=centos7-64default.a-redhat7-64mdca,WORKER_LABEL=beaker/99/consoleFull


{code:java}
03:12:34 Failure/Error: install_module_dependencies_on(hosts)
03:12:34 Beaker::Host::CommandFailure:
03:12:34   Host 'uacd2e1mnxhnx0t.delivery.puppetlabs.net' exited with 1 running:
03:12:34    puppet module install puppetlabs-apt -v 4.2.0
03:12:34   Last 10 lines of output were:
03:12:34   	Notice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...
03:12:34   	Notice: Downloading from https://forgeapi.puppet.com ...
03:12:34   	Error: Could not install 'puppetlabs-apt' (v4.2.0)
03:12:34   	  No releases matching '4.2.0' are available from https://forgeapi.puppet.com{code}

If we run with verbose and debug, we can see that it is using pagination, but not checking the next page. 

{code}
[root@n8vja2lvd96dr50 ~]# puppet module install puppetlabs-apt -v 4.2.0 --force --verbose --debug
Debug: Runtime environment: puppet_version=5.3.1, ruby_version=2.4.1, run_mode=user, default_encoding=UTF-8
Notice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...
Debug: puppetlabs-lvm initialized for i18n:
Debug: puppetlabs-facter_task initialized for i18n:
Debug: puppetlabs-package initialized for i18n:
Debug: puppetlabs-pe_accounts initialized for i18n:
Debug: puppetlabs-pe_concat initialized for i18n:
Debug: puppetlabs-pe_hocon initialized for i18n:
Debug: puppetlabs-pe_infrastructure initialized for i18n:
Debug: puppetlabs-pe_inifile initialized for i18n:
Debug: puppetlabs-pe_install initialized for i18n:
Debug: puppetlabs-pe_java_ks initialized for i18n:
Debug: puppetlabs-pe_nginx initialized for i18n:
Debug: puppetlabs-pe_postgresql initialized for i18n:
Debug: puppetlabs-pe_puppet_authorization initialized for i18n:
Debug: puppetlabs-pe_r10k initialized for i18n:
Debug: puppetlabs-pe_razor initialized for i18n:
Debug: puppetlabs-pe_repo initialized for i18n:
Debug: puppetlabs-pe_staging initialized for i18n:
Debug: puppetlabs-pe_support_script initialized for i18n:
Debug: puppetlabs-puppet_conf initialized for i18n:
Debug: puppetlabs-puppet_enterprise initialized for i18n:
Debug: puppetlabs-service initialized for i18n:
Notice: Downloading from https://forgeapi.puppet.com ...
Debug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-apt&module_groups=base pe_only
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Debug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-apt&module_groups=base+pe_only&limit=20&offset=20
{code}

This is prevents users from installing the latest version of postrgesql. It may also affect other modules",CI Blocker,PUP-8008,[],puppet module install fails to install apt 4.2.0
"I was hacking on some bolt plans today, specifically how I could re-use existing Puppet functions to augment plans.  I've ran into an issue where bolt isn't loading some code shipped in modules.

When Google built the recent release of the GCP modules they added a lot of in ruby module code: {{https://github.com/GoogleCloudPlatform/puppet-google-auth/blob/master/lib/google/authorization.rb}}.  If I use a function that requires {{google/authorization}} then I get a failure in bolt but not when running a {{puppet apply}}.
",Bug,PUP-8007,[],In module ruby loading does not work in Pal API
"Hello all,

the init script for Puppet agent (V 5.2.0) seems to be broken. It sets
piddir=/var/run/puppetlabs for agent.pid, but the PID is not in this folder.
I find this file in the old PID folder, i. e., /var/run/puppet . As a workaround,
I hacked the init script.

In order to run ""service puppet status/stop"" correctly, the PID folder
should point to correct one.

Cheers and thanks for your assistance,
Beat",Bug,PUP-8006,[],Wrong PID dir
"Using the below EPP file
{code:puppet}
<%- | Optional[Struct] $acls = undef,
       Optional[Struct] $options = undef
| -%>
##
### Managed by Puppet - DO NOT EDIT 
##
##
<% unless $acls =~ Undef { -%>
### Pre-defined Friendly ACL lists ###
##
<% $acls.keys.sort.each |$name| { -%>
acl <%= $name %> {
 <% $acls[$name].each |$address| { -%>
 <%= $address %>;
 <% } -%>
};
<% } -%>
<% } -%>
{code}

Called by
{code:puppet}
    content => epp('named/named.conf.epp', {
                'acls'    => $::named::acls,
                'options' => $::named::options,
    } ),
{code}
Results in the following error on the agent
{code}
Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, undefined method `set_optional' for #<Puppet::Pops::Types::ExtraneousKey:0x3454240c> at /etc/puppetlabs/code/environments/kilnnp/modules/named/manifests/config.pp:14:16
{code}

Where line 14 :16 is the epp() call in question",Bug,PUP-8005,[],undefined method `set_optional' when using Option[Struct] in an EPP
"See PUP-7650 for the root cause of the issue. This behaviour is also sometimes (indeterminately) cause by using a *resource collector*, and that does not seem to be corrected by the patch linked in PUP-7650.

The error thrown is:

{code}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Virtual Query, Could not autoload puppet/type/pe_ini_setting: Attempt to redefine entity 'http://puppet.com/2016.1/runtime/type/pe_ini_setting'. Set at unknown location at /etc/puppetlabs/code/modules/classroom/manifests/master/student_environment.pp:51:3 on node superdog.puppetlabs.vm
{code}",Bug,PUP-8002,[],"""Attempt to redefine entity"" caused by using a resource collector "
"Currently puppet lookup will do a lookup based on hiera backends and report back what the value for a given key is. In PE, this falls short because there may be class parameters applied at the node classifier level. Puppet lookup should take the node classifier into account when returning the lookup, as it will trump any other value.

For example, in the attached screenshot I have set java_args on the orchestrator profile in the classifier to include Xms of 128m.

When running {{puppet lookup puppet_enterprise::profile::orchestrator::java_args}} I would expect to see a return of a hash with a key of ""Xms"" and a value of ""128m"", but lookup returns the empty string.

{code}
[root@uf4axdb8s4q9fqn production]# puppet lookup puppet_enterprise::profile::orchestrator::java_args
[root@uf4axdb8s4q9fqn production]# 
{code}",New Feature,PUP-8000,[],lookup CLI should be able to lookup (already set) class parameters
"Currently in PE, the pe_infrastructure and pe_manager modules end up recreated a large amount of the puppet lookup application logic to do lookups without shelling out to puppet (which would be expensive). It would be far better if puppet itself exposed the lookup as an easy to use method for other applications. Ideally, if I knew the node name, environment name, and a list of keys to lookup, I should be able to invoke the method to retrieve those lookups.",Improvement,PUP-7999,[],Puppet Lookup should be easily used as a library in other applications
"It is of value to describe a value as being an {{Error\[kind, issue_code]}} - a kind of exceptional result that can be returned from functions and passed around.

An error type is parameterised with a ""kind"" discriminator - a missing parameter means ""all kinds"". A ""kind"" is a string that should follow certain conventions, but is not required to. It is typically a string on the form {{authority/name}} where authority is something like ""puppetlabs"" or ""puppet"", or the loose notion of ""author"" (the authority that controls what is valid as a kind-name). The type parameter can be given as {{Variant\[String, Regexp, Type\[Enum], Type\[Pattern], Type\[Any] ]}}, where a given {{String}} is the same as an Enum with that single value, and {{Regexp }}is the same as {{Pattern}} with that single regexp). An {{Error\[Any]}} is the same as {{Error}}.

The issue code type parameter is of the same type as kind, but here it is expected that than an issue code (without structure) is used.

As an example, the type {{Error\[Any, ""SYNTAX_ERROR""]}} would match all error objects from any authority using an issue code of ""SYNTAX_ERROR"". An {{Error\[/^puppet/]}} would match all errors with ""puppet..."" as the authority.

An error instance is described by:
{code:puppet}
type Error = Object[
  attributes => {
    message => String,
    kind => { type => Optional[String], default_value => undef},
    issue_code => { type => String, default_value => ""ERROR"" },
    partial_result => { type => Optional[Any], default_value => undef }
    details => { type => Optional[DataHash], default_value = undef }
  }
}
{code}

Type algebra: An Error {{Error\[K, I] op Error\[K2, I2]}} is true if {{K op K2}} and {{I op I2}} are both true. Error < Object.

The ""detail"" hash is an encoding of additional information such as ""exitcode"", ""stacktrace"", ""exception"", etc. These are included for the purpose of being able to give a user more debugging information. The exact content and details of ""details"" is left open ended to be flexible for different kinds of error information.",Improvement,PUP-7998,[],Add an Error data type to puppet
"In order to enable introducing tasks and plans named the same as the module they are contained in, the standard ""puppet way"" is to use the special name ""init"" (as in ""tasks/init.sh"" for a task, and ""plans/init.pp"" for a plan) to define a task/plan with the name of the module it is contained in.

For a plan, the contained plan must be named after the module - for example, in a module ""foo"", its ""plans/init.pp"" file must contain the definition {{plan foo()}}.",Improvement,PUP-7997,[],"add loading tasks and plans from an ""init"" named element to name it after containing module"
"Automatic loading of manifests under the _'manifests'_ folder and loading of puppet types under _'lib/puppet/type'_ must be avoided when running with {{--tasks}} enabled.

This means that the {{Runtime3TypeLoader}} should be disabled completely and that the predefined puppet types should be removed from the {{StaticLoader}}",Improvement,PUP-7996,[],"Avoid loading manifests, puppet types and providers when running tasks."
"I'm trying to stop rpc-svcgssd.service on some servers.

This service is marked as static:
systemctl status  rpc-svcgssd.service
rpc-svcgssd.service - RPC security service for NFS server
  Loaded: loaded (/usr/lib/systemd/system/rpc-svcgssd.service; static; vendor preset: disabled)
  Active: inactive (dead)

And that prevent it to be masked;
puppet resource service rpc-svcgssd.service enable=mask 
service { 'rpc-svcgssd.service':
 enable => 'true',
}

And I I launch with --debug:
Debug: Executing: '/usr/bin/systemctl is-enabled rpc-svcgssd.service'
Debug: Unable to enable or disable static service rpc-svcgssd.service

Indeed, that's why I want to mask it instead of simply disable it.

systemctl says:
/usr/bin/systemctl is-enabled rpc-svcgssd.service
static

But worst;
If I put that in my modules:
   service{'rpc-svcgssd':
       enable => mask,
   }
It don't fails, so I'm even not aware that masking fails.

The easy work around is to add a symlink to /dev/null, that's how mask works.
",Bug,PUP-7995,"['linux', 'service', 'systemd', 'triaged', 'type_and_provider']",Puppet can't mask systemd's static unit
"When the first argument to run_task is a string that doesn't resolve to a {{Task}}, an attempt is till made to call to #new using the {{nil}} value returned from the loader and errors with ""'new' parameter 'type' expects a Type value, got Undef"".",Bug,PUP-7994,[],run_task crashes with bad message when passed a string that doesn't represent a task
"Hi 

I have a customer who is facing a bug when using AIX. 

They have the following resource:

On AIX: it requires type => ""mtime"", # and only mtime works 
tidy { '/opt/log': 
age => '2w', 
recurse => 9, 
matches => ['*.txt', '*.gz', 'error_log.20170*', 'access_log.20170*', '*.Z', '*.zip' ], 
type => ""mtime"", 
}

and only 'mtime' appears to work. 

I have asked them to run the following commands:

find /opt/log/ -ctime -14 -print
find /opt/log/ -atime -14 -print
find /opt/log/ -mtime -14 -print

and they all produce results which match the resource criteria specified. If they use any type except mtime it doesn't pick up any files to tidy. 

The affected OS is AIX 7.1. 

https://docs.puppet.com/puppet/latest/types/tidy.html#tidy-attribute-type 

Thanks

",Bug,PUP-7993,[],Tidy Resource 'Type' Bug
"{code}
$ puppet agent -t
Info: 設定された環境'production'を使用しています。
Info: pluginfactsを取得しています。
Info: pluginを取得しています。
Info: Loading facts
Error: リモートサーバからカタログを取得できませんでした: SERVERのエラー500 : サーバエラー: Evaluation Error: a Resource Statementの検証中にエラーが生じました。Evaluation Error: a Resource Statementの検証中にエラーが生じました。/etc/puppetlabs/code/environments/production/.resource_types/pe_anchor.ppからロードしたコードでは、リソースタイプ'pe_anchor'は作成されません - Puppet::Resource::ResourceType3.newに対するコールが見つかりませんでした。 at /opt/puppetlabs/puppet/modules/puppet_enterprise/manifests/init.pp:228:3 on node mom.puppet.vm
Warning: 失敗したカタログではキャッシュを使用できません。
Error: カタログを取得できませんでした; 実行をスキップしています。
{code}",Bug,PUP-7992,[],Puppetserver errors reading pcore objects with non-english locale
"win32-service has some ANSI API calls that may cause problems in a non-US language environment.

*In Scope*
* Identify existing uses of the Win32::Service API, located primarily (if not entirely) in provider/service/windows
* Create a new API implementation inside of puppet that meets these same requirements, using FFI or fiddle
* For an example of a similar effort which defined an API replacing our need for Win32::EventLog, see https://github.com/puppetlabs/puppet/commit/a158879977570227c857ddf232bc00edac69e9fe
* New API _must_ make use of the Unicode-compatible versions of functions in the Windows API 
",Task,PUP-7990,"['i18n', 'utf-8']",Create internal puppet API implementation satisfying requirements for win32-service
"Link to the job: https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/master/view/Suite/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/194/SLAVE_LABEL=beaker,TEST_TARGET=fedora26-64a/

The test resources/group/should_create fails with the following output:
 Errored Tests Cases:
03:55:12   Test Case tests/resource/group/should_create.rb reported: #<Beaker::Host::CommandFailure: Host 'co8z7zqqxslhr7e.delivery.puppetlabs.net' exited with 8 running:
03:55:12  if getent group pl372022; then groupdel pl372022; fi
03:55:12 Last 10 lines of output were:
03:55:12 	pl372022:x:1001:
03:55:12 	groupdel: cannot remove the primary group of user 'symuser'>
03:55:12     Test line: tests/resource/group/should_create.rb:22:in `block (2 levels) in run_test'

",CI Blocker,PUP-7988,['transient'],resources/group/should_create test fails on fedora-26-64a
"The Puppet::Pal API when creating a tmp or regular environment should accept a hash of variable names to values that it will use to define those top scope variables.
",Improvement,PUP-7987,[],Add support to defined top scope variables to the Pal API 
"https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/1.10.x/view/Suite/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-1.10.x/62/SLAVE_LABEL=beaker,TEST_TARGET=windows2012r2-64a/

The relevant part of the output is:
p72wdcdl1rtxf54.delivery.puppetlabs.net (windows2012r2-64-1) executed in 0.07 seconds
Exited: 1
Beaker::Host::CommandFailure: Host 'p72wdcdl1rtxf54.delivery.puppetlabs.net' exited with 1 running:
 cmd.exe /c puppet --version
Last 10 lines of output were:
	'puppet' is not recognized as an internal or external command,
	operable program or batch file.

^This type of failure means that the install has not completed yet. ",CI Blocker,PUP-7986,[],Puppet tests do not wait for the puppet-agent install on Windows to finish
"When `puppet cert generate` is invoked, it configures itself as a [""local"" CA|https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/application/cert.rb#L288-L292]. This [configures the indirector|https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/ssl/host.rb#L93-L95] for SSL files to use the CA locations, but cache files in the agent location. The intent of this is unclear but it looks like this is done in order to [cache generated files|https://projects.puppetlabs.com/issues/3961] in a location that the Puppet agent will read.

This becomes a problem if the contents of `cacert` does not match the contents of `localcacert`. In an environment where intermediate CA certificates are in use, `cacert` needs to contain the intermediate CA certificate (since it contains information used during signing certificates) while `localcacert` needs to contain the root certificate (because the Puppet agent needs the root certificate in order to validate the server SSL certificate chain).

If this case occurs, when Puppet configures itself to use the CA file terminii but uses the normal SSL file terminii as a cache. Because the cached files are consulted first Puppet will ignore the `cacert` location and read the `localcacert` file. Because Puppet is reading the `cakey` file for signing certificates but the `localcacert` for certificate information, [validating the key against the certificate will fail|https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/ssl/host.rb#L209].

To add to the fun, when this circumstance appears Puppet is hardcoded to indicate that the [agent private key and certificate don't match|https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/ssl/host.rb#L213], and debugging this is effectively impossible without injecting pry invocations through the source code.",Bug,PUP-7985,[],`puppet cert generate` uses the wrong CA certificate
"When Puppet loads the CRL in order to revoke a certificate, it does so without verifying that the loaded CRL was issued by the CA that will be revoking the certificate. If a user mistakenly copied a CRL from a different CA to where Puppet will load it, and then revokes a certificate, Puppet will merrily add the serial number of the revoked certificate, sign the CRL using the wrong CA key, and will leave the Issuer field alone. If this CRL is used it will contain revocation information for two unrelated PKIs and the Issuer field of the original CA.

This is problematic because identifying and resolving the issue is extremely difficult to do without a deep understanding of X.509. In environments where people are using intermediate CAs it's not unreasonable for them to accidentally copy a CRL from the root CA into the intermediate CA environment, which will create and distribute unusable CRLs.",Bug,PUP-7984,[],`puppet cert revoke` doesn't verify the loaded CRL
"Testing PA built against system openssl thru CI has turned into quite a non-trivial exercise. First attempt resulted in some tests failing on the master host that CI sets up. Ironically, such agents have been able to get their certificate signed by the master fine when setup manually. 
That led to reproducing the failure using beaker locally. Testing using beaker led to a different failure during the pre-suite/setup step of PA acceptance tests.
Managed to overcome that by customizing pre-suite scripts in puppet. Now need to use this custom version of puppet when launching CI. Lets see how long this goes on... 
All to get a PA CI test passing certificate to be able to submit PR in puppet to enable building against system openssl. ",Bug,PUP-7983,[],Enable testing puppet-agent built against system openssl on RHEL in PA CI pipes
"Copied ticket from customer ASK jira

Currently, I have 4 pip packages on infinite install, due to the hyphen character being in the package name instead of an underscore in the package name.
During install of the package, the name uses an underscore.
After the package is installed, the package name returns with a hyphen instead of an underscore.

Examples I have come across include:
smart_open
int_date
cx_Oracle
pandas_oracle

I am sure there are more out there...

The python documentation states that ""All comparisons of distribution names MUST be case insensitive, and MUST consider hyphens and underscores to be equivalent."" source: https://www.python.org/dev/peps/pep-0426/#name

My update attempts to resolve this problem by gsubing all hyphens for underscores in the @resource:name and provider_pip.name to make hyphens and underscores equivalent.",Bug,PUP-7982,[],pip provider package install loop
"The {{run_script}} function takes a reference to a file - (use the ""find_file"" semantics to enable the file to reside in a module), and a ""NodeOrNodes"" nodes parameter (like the other 'bolt' functions).",New Feature,PUP-7980,[],Add a run_script() function to enable this bolt feature from the language
"Add a {{run_command()}} function that executes a command line on a given set of hosts and returns the result.
Make this function take arguments to suite the bolt executor that is behind the command line for running a command.

ORIGINAL
-----
Some design is needed:
* different shells interpret arguments differently and we must decide how a user specifies the command arguments:
** as a single string to be given to a given kind of shell on the target system
*** and thus support whatever expansion and features offered by that shell
** as a single string to be parsed by the control language and turned into discreet arguments (to make the handling more universe) - if so, with what features?
** to be given by user as individual arguments (for example [""-a foo"", ""-b bar""]) etc.

An alternative is to have {{run_task}} do this, and make a {{Command}} be a special {{Task}} that does not refer to a file, and instead have the ""payload"" to execute inside of the Command. This enables having parameterized named commands (via subtyping), making it easy to pass them around etc.
",New Feature,PUP-7979,[],Add a run_command() function
"h1. The Problem 

As described in PE-14492, if you install your first module via PMT before deploying code with code manager then the modules directory will be created with root ownership by PMT and when you do enable file-sync it will fail to sync and crash puppetserver.  

h1.  The Suggested Solution 

Make sure that when PMT installs modules it makes them with pe-puppet:pe-puppet owner and group.  

This could be achieve by downgrading to the pe-puppet user before running commands or by chmod/chown ing files after the fact.  ",Bug,PUP-7978,['tcse'],PMT Should Install Modules as pe-puppet / create the modules directory as pe-puppet
"h2. Overview

Currently, by using the `user` resource that come with puppet, it's not possible to prevent passwords from being visible on the puppet infrastructure and restricts management to the puppet team. 
- e-yaml will hide it in the source control but it will be send decrypted via the catalog to the puppet agent and thus also can be found back in the reports. 
- management of the password is a task for the people managing the puppet manifests and/or yaml files. However, in our company, password management is done by a separate team using their own tools for managing the content of the password vault.

h2. Use Case

Similar to what is, e.g., done with the cluster configuration file on RHEL6. Here, there is a passwd attribute to hard-code the password, but also a passwd_script attribute (see e.g. https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Cluster_Administration/ap-fence-device-param-CA.html). 
The latter takes a command and assumes the stdout is the password to fill in.

This would only be executed on the puppet agent. The catalog would only contain the command. This command can then be used to retrieve the password from the password vault used by the security team.
",New Feature,PUP-7977,[],Add a password_script attribute to user resource
"For Red Hat Enterprise Linux systems, the puppet-agent RPM packages the following directories as user root, group root:

{noformat}
$ rpm --verify puppet-agent
S.5....T.  c /etc/puppetlabs/puppet/puppet.conf

$ ls -lsad /opt/puppetlabs/puppet/cache /var/log/puppetlabs/puppet /var/run/puppetlabs
4 drwxr-x---. 9 root root 4096 May 27 17:37 /opt/puppetlabs/puppet/cache/
4 drwxr-x---. 2 root root 4096 May 19 19:32 /var/log/puppetlabs/puppet/
4 drwxr-xr-x. 2 root root 4096 May 27 18:17 /var/run/puppetlabs/
{noformat}

However, when the puppet agent is invoked, it immediately changes the owner/group of these directories to puppet:

{noformat}
$ env - /sbin/service puppet start
Starting puppet agent:                                     [  OK  ]
$ ls -lsad /opt/puppetlabs/puppet/cache /var/log/puppetlabs/puppet /var/run/puppetlabs
4 drwxr-x---. 9 puppet puppet 4096 May 27 17:37 /opt/puppetlabs/puppet/cache/
4 drwxr-x---. 2 puppet puppet 4096 May 19 19:32 /var/log/puppetlabs/puppet/
4 drwxr-xr-x. 2 puppet puppet 4096 May 27 18:21 /var/run/puppetlabs/
{noformat}

Changing the owner/group of these directories causes rpm verification of the package integrity to emit errors:

{noformat}
$ rpm --verify puppet-agent
S.5....T.  c /etc/puppetlabs/puppet/puppet.conf
.....UG..    /opt/puppetlabs/puppet/cache
.....UG..    /var/log/puppetlabs/puppet
.....UG..    /var/run/puppetlabs
{noformat}

So, there are two possibilities:

# The above directories should be user puppet, group puppet, and the puppet RPM spec file is incorrect.
# The above directories should be user root, group root, and the behavior of the puppet agent is incorrect.

Which is it?

If it's the RPM spec file that's incorrect, then that should be trivial to fix, but correcting the behavior of the puppet agent might be a little harder.",Task,PUP-7976,[],Puppet agent fights with RPM package over owner/group of certain directories
"When calling the gemlist and gemsplit commands (https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/provider/package/gem.rb#L22-L71) the provider attempts an exact match with {{^}} and {{$}} however on windows only the {{$}} is honored:
{noformat}
C:\Program Files\Puppet Labs\Puppet\sys\ruby\bin>gem.bat list --remote ^pry$

*** REMOTE GEMS ***

awesome-pry (0.0.4)
awesome_pry (0.0.1)
better_errors-pry (1.0.2)
debugger-pry (0.1.1)
dontkillmypry (0.0.1)
fog-pry (0.0.1)
lemme-pry (0.5.0)
middleman-pry (1.0.1)
pry (0.11.0 ruby java, 0.10.2 i386-mingw32 i386-mswin32 x64-mingw32)
rack-webconsole-pry (0.1.9)
rails-console-pry (0.0.5)
rails-pry (0.0.1)
ruby-debug-pry (0.0.3)
spry (0.0.2)
super-pry (0.1.1)
web-console-pry (0.2.1)
{noformat}

If instead we use {{\A}} and {{\z}} then it functions as expected:

{noformat}
C:\Program Files\Puppet Labs\Puppet\sys\ruby\bin>gem.bat list --remote \Apry\z

*** REMOTE GEMS ***

pry (0.11.0 ruby java, 0.10.2 i386-mingw32 i386-mswin32 x64-mingw32)
{noformat}",Bug,PUP-7973,[],gem package provider doesn't match exact on windows
"Updating the 'groups' property of a User{} resource doesn't behave as expected. Take the following resource for example:

user { 'User1':
  ensure => 'present',
  groups => ['Users'],
}

This correctly creates the local user 'User1', belonging to the 'Users' group on Windows. However if we now change the definition to:

user { 'User1':
  ensure => 'present',
  groups => ['Administrators'],
}

Puppet will add User1 to the Administrators group but NOT remove the user from the Users group. Expected behavior would be to remove the user from the Users group.

If User1 is manually deleted from the system, followed by another Puppet run, the user is correctly re-created as being only a member of the 'Administrators' group.",Bug,PUP-7972,[],Change in groups attribute of User resource only adds group membership but does not remove any
"Automate testing of locale detection on Tier 1 OS platforms. How we will go about this depends on the decision made in PA-1179 about whether we want to be switching the locales on the machines during the test run, or use dedicated cells. We should test locale detection both at the command line.",Task,PUP-7970,[],Acceptance: Automate testing of i18n locale detection
"When a resource subscribes to another resource, the debug output is as you might expect. Given:

{code}
class foo {
  exec { 'notify test':
    command => '/usr/bin/true',
    refreshonly => true,
  }
}

class test {
  include foo
  exec { 'test':
    command => '/usr/bin/true',
    subscribe => Class['foo'],
  }
}

include test
{code}

This debug line is logged:
{code}
Debug: /Stage[main]/Test/Exec[test]/subscribe: subscribes to Class[Foo]
{code}

All good so far. But if I have a notify, I get the _same_ line. I.e., given:
{code}
    notify => Class['foo'],
{code}

I get:
{code}
Debug: /Stage[main]/Test/Exec[test]/notify: subscribes to Class[Foo]
{code}

This line should read ""*notifies* Class\[Foo\]"", not ""*subscribes* to Class\[Foo]"".

This is important because this aspect of puppet is already hard enough to understand without inaccurate relationship reporting between resources. In puppet it is a very different thing to say something subscribes to another thing vs notifies it.",Bug,PUP-7969,"['beginner', 'the-goods']",debug message for notify relationship is inaccurate - should be 'notifies' not 'subscribes'
"{code:puppet}
group { 'what':
#ensure => present,
#gid => 1234,
}
{code}
If I do a ""puppet apply --debug /tmp/x.pp"" the group will not be created with the manifest as above. The relevant line in the debug output appears to be:
{code}
Debug: /Stage[main]/Main/Group[what]: Nothing to manage: no ensure and the resource doesn't exist
{code}
It will be created if I uncomment either of the ensure or gid parameters.

With only the gid uncommented the debug output includes:
{code}
Debug: Executing: '/sbin/groupadd -g 1234 what'
Notice: /Stage[main]/Main/Group[what]/ensure: created
{code}
With only the ensure uncommented the debug output includes:
{code}
Debug: Executing: '/sbin/groupadd what'
Notice: /Stage[main]/Main/Group[what]/ensure: created
{code}
With both uncommented the debug output includes:
{code}
Debug: Executing: '/sbin/groupadd -g 1234 what'
Notice: /Stage[main]/Main/Group[what]/ensure: created
{code}",Bug,PUP-7968,['beginner'],group resource doesn't default to ensure=>present
"A {{file_upload()}} function is wanted that transfers a file to one or more hosts. In contrast to {{run_task}} which also transfers a file, the {{file_upload}} does not execute the transferred file.

More input is needed here regarding the requirements/features of this function:
* single file or directory/structure?
* how to deal with a target path that does not exist (create parents)
* control over user and file mode?
* how to deal with an existing target? (simply overwrite, fail, etc)

Should this be modeled as a File resource that is given to the upload_file function as an argument? (This because we already have the file resource type with a large set of parameters to control behavior.)",New Feature,PUP-7967,[],Add a file_upload() function 
"Coverity will happily run in a Travis job, though they don't support a lot of scans per week. It looks like we're in the 7-14/week bucket. Their suggestion is to have a separate branch for scanning that we push changes to periodically.

This ticket is mostly so I can link to it from my branch, tbh.",Improvement,PUP-7966,[],Enable Coverity scanning on puppetlabs/puppet
,Sub-task,PUP-7965,[],"Update language specification for ""hash without braces"""
"When the agent applies the catalog, tags seem to be ignored for defined types, which means there is no way to include them in tagged runs.
However, the correct tags seem to appear in the puppet reports.

*Example 1:*

In /var/tmp/a.pp:

{code:puppet}
class a (){
  file { '/tmp/a':
    ensure  => file,
    content => 'test',
  }
  ~> b { '-': }
}

define b () {
  exec { 'cat /tmp/a':
    path        => '/usr/bin:/bin',
    refreshonly => true,
    logoutput   => true,
  }
}

include a
{code}

Then:
{code:shell}
$ puppet apply -d --tags a,b /var/tmp/a.pp
...
Notice: /Stage[main]/A/File[/tmp/a]/ensure: defined content as '{md5}098f6bcd4621d373cade4e832627b4f6'
Debug: /Stage[main]/A/File[/tmp/a]: The container Class[A] will propagate my refresh event
Info: /Stage[main]/A/File[/tmp/a]: Scheduling refresh of B[-]
Debug: B[-]: Not tagged with a, b
Debug: B[-]: Resource is being skipped, unscheduling all events
Info: B[-]: Unscheduling all events on B[-]
Debug: B[-]: Not tagged with a, b
Debug: B[-]: Resource is being skipped, unscheduling all events
Debug: Class[A]: The container Stage[main] will propagate my refresh event
...
{code}

Whereas, according to https://docs.puppet.com/puppet/5.2/lang_tags.html#automatic-tagging, B[-] should be tagged with b.

*Example 2:*

Trying to explicitly add a tag does not help:

{code:puppet}
class a (){
  tag c
  file { '/tmp/a':
    ensure  => file,
    content => 'test',
  }
  ~> b { '-': tag => ['c'] }
}

define b () {
  exec { 'cat /tmp/a':
    path        => '/usr/bin:/bin',
    refreshonly => true,
    logoutput   => true,
  }
}

include a
{code}

{code:shell}
$ puppet apply -d --tags c /var/tmp/a.pp
...
Debug: Class[A]: Not tagged with c
Debug: Class[A]: Resource is being skipped, unscheduling all events
Notice: /Stage[main]/A/File[/tmp/a]/ensure: defined content as '{md5}098f6bcd4621d373cade4e832627b4f6'
Debug: /Stage[main]/A/File[/tmp/a]: The container Class[A] will propagate my refresh event
Info: /Stage[main]/A/File[/tmp/a]: Scheduling refresh of B[-]
Debug: B[-]: Not tagged with c
Debug: B[-]: Resource is being skipped, unscheduling all events
Info: B[-]: Unscheduling all events on B[-]
Debug: B[-]: Not tagged with c
Debug: B[-]: Resource is being skipped, unscheduling all events
Debug: Class[A]: Not tagged with c
Debug: Class[A]: Resource is being skipped, unscheduling all events
Info: Class[A]: Unscheduling all events on Class[A]
...
{code}

Whereas even just the tag c line should have sufficed.",Bug,PUP-7963,[],Tagged runs ignore defined resources' tags
"For bolt, we need to ship a {{puppet-bolt}} gem, which should be essentially the same as the normal {{puppet}} gem, except that it has a different name, and does not conflict with a possibly already installed {{puppet}} gem (or puppet-agent)",New Feature,PUP-7961,[],Create puppet-bolt gem
"1) Check that the version number in source for puppet is correct

  version for puppet should be 5.3.1

  * check {{lib/puppet/version.rb}} for the {{PUPPETVERSION}} variable.
  * check .gemspec for {{version}} variable

",Task,PUP-7960,[],Bump puppet version to 5.3.1
"The puppet acceptance test resource/service/ticket_5024_systemd_enabling_masked_service.rb fails on the SLES 12 Power8 host with the following:

{noformat}

power8-sles12-3.ops.puppetlabs.net (sles12-POWER-1) 16:52:26$ zypper remove -y apache2 apache2-prefork apache2-worker libapr1 libapr-util1
  Loading repository data...
  Reading installed packages...
  Package 'apache2-worker' not found.
  Resolving package dependencies...
  
  The following 5 packages are going to be REMOVED:
    apache2 apache2-prefork apache2-utils libapr-util1 libapr1
  5 packages to remove.
  After the operation, 11.3 MiB will be freed.
  Continue? [y/n/...? shows all options] (y): y
  (1/5) Removing apache2-prefork-2.4.23-29.3.2.ppc64le [.  .  .  .  .  done]
  (2/5) Removing apache2-2.4.23-29.3.2.ppc64le [.  .  .  .  .  done]
  (3/5) Removing apache2-utils-2.4.23-29.3.2.ppc64le [.  .  .  .  .done]
  (4/5) Removing libapr-util1-1.5.3-1.77.ppc64le [.  .  .  .  .done]
  (5/5) Removing libapr1-1.5.1-2.7.ppc64le [.  .  .  .  .  done]
  Installation has completed with error.

power8-sles12-3.ops.puppetlabs.net (sles12-POWER-1) executed in 1.46 seconds
Exited: 104
Beaker::Host::CommandFailure: Host 'power8-sles12-3.ops.puppetlabs.net' exited with 104 running:
 zypper remove -y apache2 apache2-prefork apache2-worker libapr1 libapr-util1
Last 10 lines of output were:
	
	5 packages to remove.
	After the operation, 11.3 MiB will be freed.
	Continue? [y/n/...? shows all options] (y): y
	(1/5) Removing apache2-prefork-2.4.23-29.3.2.ppc64le [.....done]
	(2/5) Removing apache2-2.4.23-29.3.2.ppc64le [.....done]
	(3/5) Removing apache2-utils-2.4.23-29.3.2.ppc64le [.....done]
	(4/5) Removing libapr-util1-1.5.3-1.77.ppc64le [.....done]
	(5/5) Removing libapr1-1.5.1-2.7.ppc64le [.....done]
	Installation has completed with error.
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/host.rb:375
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/helpers/host_helpers.rb:83
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/shared/host_manager.rb:127
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/patterns.rb:37
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/helpers/host_helpers.rb:63
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/tests/resource/service/ticket_5024_systemd_enabling_masked_service.rb:63
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_case.rb:146
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_case.rb:144
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_case.rb:144
/home/sgarman/.rbenv/versions/2.3.3/lib/ruby/2.3.0/benchmark.rb:308
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_case.rb:130
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:66
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:63
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:63
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:112
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/cli.rb:205
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/cli.rb:131
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/bin/beaker:9
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/bin/beaker:22
/home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/bin/beaker:22
End teardown
Warning: tests/resource/service/ticket_5024_systemd_enabling_masked_service.rb errored in 24.28 seconds
      Test Suite: tests @ 2017-09-18 16:52:03 +0000

      - Host Configuration Summary -


              - Test Case Summary for suite 'tests' -
       Total Suite Time: 24.28 seconds
      Average Test Time: 24.28 seconds
              Attempted: 1
                 Passed: 0
                 Failed: 0
                Errored: 1
                Skipped: 0
                Pending: 0
                  Total: 1

      - Specific Test Case Status -
        
Failed Tests Cases:
Errored Tests Cases:
  Test Case tests/resource/service/ticket_5024_systemd_enabling_masked_service.rb reported: #<Beaker::Host::CommandFailure: Host 'power8-sles12-3.ops.puppetlabs.net' exited with 104 running:
 zypper remove -y apache2 apache2-prefork apache2-worker libapr1 libapr-util1
{noformat}

It seems that I can reproduce the failure with:


{noformat}
zypper in apache2-worker
zypper rm apache2 apache2-prefork apache2-utils libapr-util1 libapr1
{noformat}
",Bug,PUP-7959,[],acceptance: zypper reports errors when uninstalling apache2-worker on SLES 12 Power8
"When running the aio test suite against the SLES 12 Power8 agent, the following test fails:


{noformat}
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) 16:39:19$ puppet generate types --environment 'autoload_from_resource_type_decl_svizw65x'
      Notice: Generating Puppet resource types.
      Notice: found_type_tst
      Notice: Generating '/etc/puppetlabs/code/environments/autoload_from_resource_type_decl_svizw65x/.resource_types/type_tst.pp' using 'pcore' format.
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) executed in 0.91 seconds
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) 16:39:20$ cat '/tmp/agent_autoload_resource.8ivnm7'
      
      found_type_tst: 2017-09-18 09:39:20 -0700
      found_type_tst: 2017-09-18 09:39:20 -0700
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) executed in 0.05 seconds
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) 16:39:20$ cat '/tmp/agent_autoload_resource.8ivnm7'
      
      found_type_tst: 2017-09-18 09:39:20 -0700
      found_type_tst: 2017-09-18 09:39:20 -0700
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) executed in 0.05 seconds
    Minitest::Assertion: Expected execution log file to be empty on agent node lsicgt5r55bppgw.delivery.puppetlabs.net.
    Expected ""\nfound_type_tst: 2017-09-18 09:39:20 -0700\nfound_type_tst: 2017-09-18 09:39:20 -0700"" to be empty.
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/minitest-5.10.3/lib/minitest/assertions.rb:139
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/minitest-5.10.3/lib/minitest/assertions.rb:154
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/tests/loader/autoload_from_resource_type_decl.rb:118
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/helpers/host_helpers.rb:93
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/shared/host_manager.rb:127
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/patterns.rb:37
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/helpers/host_helpers.rb:63
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/tests/loader/autoload_from_resource_type_decl.rb:117
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/tests/loader/autoload_from_resource_type_decl.rb:116
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/tests/loader/autoload_from_resource_type_decl.rb:116
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/structure.rb:44
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/tests/loader/autoload_from_resource_type_decl.rb:96
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/dsl/structure.rb:67
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/tests/loader/autoload_from_resource_type_decl.rb:1
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_case.rb:133
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_case.rb:133
    /home/sgarman/.rbenv/versions/2.3.3/lib/ruby/2.3.0/benchmark.rb:308
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_case.rb:130
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:66
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:63
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:63
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/test_suite.rb:112
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/cli.rb:205
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/lib/beaker/cli.rb:131
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/gems/beaker-3.24.0/bin/beaker:9
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/bin/beaker:22
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/bin/beaker:22
    Begin teardown
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) 16:39:20$ rm -rf /etc/puppetlabs/code/environments/autoload_from_resource_type_decl_svizw65x
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) executed in 0.04 seconds
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) 16:39:21$ rm -f '/tmp/agent_autoload_resource.8ivnm7'
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) executed in 0.05 seconds
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) 16:39:21$ rm -f '/tmp/agent_autoload_resource.8ivnm7'
    
    lsicgt5r55bppgw.delivery.puppetlabs.net (centos6-64-1) executed in 0.05 seconds
    
    power8-sles12-2.ops.puppetlabs.net (sles12-POWER-1) 16:39:21$ rm -f '/tmp/agent_autoload_resource.NsDa4p'
    
    power8-sles12-2.ops.puppetlabs.net (sles12-POWER-1) executed in 0.04 seconds
    End teardown
    tests/loader/autoload_from_resource_type_decl.rb failed in 41.43 seconds
      Test Suite: tests @ 2017-09-18 16:38:39 +0000

      - Host Configuration Summary -


              - Test Case Summary for suite 'tests' -
       Total Suite Time: 41.43 seconds
      Average Test Time: 41.43 seconds
              Attempted: 1
                 Passed: 0
                 Failed: 1
                Errored: 0
                Skipped: 0
                Pending: 0
                  Total: 1

      - Specific Test Case Status -
        
Failed Tests Cases:
  Test Case tests/loader/autoload_from_resource_type_decl.rb reported: #<Minitest::Assertion: Expected execution log file to be empty on agent node lsicgt5r55bppgw.delivery.puppetlabs.net.
Expected ""\nfound_type_tst: 2017-09-18 09:39:20 -0700\nfound_type_tst: 2017-09-18 09:39:20 -0700"" to be empty.>
    Test line: tests/loader/autoload_from_resource_type_decl.rb:118:in `block (5 levels) in run_test'
Errored Tests Cases:
Skipped Tests Cases:
Pending Tests Cases:

    Failed: errored in TestSuite: report_and_raise_on_failure
    #<RuntimeError: Failed while running the tests suite>
    No tests to run for suite 'post_suite'
    No tests to run for suite 'pre_cleanup'
    
    You can reproduce this run with:
    /home/sgarman/pl/wip/sles12p8-beaker/puppet/acceptance/vendor/bundle/ruby/2.3.0/bin/beaker --options-file merged_options.rb --hosts sles-power8-cfg.yaml --tests=tests/loader/autoload_from_resource_type_decl.rb --debug --preserve-hosts always
{noformat}

",Bug,PUP-7958,[],Puppet loader/autoload_from_resource_type_decl.rb fails for 1.10.x SLES 12 Power8 agent
"When Puppet revokes a certificate and updates the corresponding CRL, it uses SHA1 for generating the [CRL signature|https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/ssl/certificate_revocation_list.rb#L108]. SHA1 is being deprecated and should be replaced by SHA256 or better.",Bug,PUP-7957,[],Puppet uses SHA1 when revoking certificates
"Allow syntax similar to Ruby when passing declaring a hash. E.g. in addition of writing:
{code:puppet}
call_me('hello', { a => 'value of a', b => 'value of b' })
{code}
it should also be possible (and the exact same thing) to write:
{code:puppet}
call_me('hello', a => 'value of a', b => 'value of b')
{code}
",New Feature,PUP-7956,[],Allow declaration of hashes without surrounding curly braces
To support using rubocop-i18n with puppet we need to update puppet to use at least version 0.49 of rubocopy,Task,PUP-7955,[],Update puppet to use the rubocop 0.49 or greater
"We should update rubocop-i18n to support complaining about then a translated string contains the interpolation string {code} #{} {code}.
We should correct issues found in the puppet source
We should update puppet to use this verison

This way when someone checks something in then Travis CI would run the rubocop tests and fail.",Task,PUP-7954,[],I18N update rubocop-i18n to support complaining about translation strings with #{}
"Add the posibility of using a git:// source as a content to a File class.
Will be very usefull to manage your configure files in a life environment.

Example:

file { ""/etc/ntp.conf"":
      content => ""git://github.com/project/master/ntp/ntp.conf"",
      }
",New Feature,PUP-7953,[],Add git:// as a source in the File class
"Type Aliases are broken if they include a trailing comma during testing on 5.2.0.

I created a demo repository with a Travis hook right here: https://github.com/pegasd/puppet-broken_type

As you can see from the latest build, both types work fine under 5.1.0, but one of them (with a trailing comma) fails:
https://travis-ci.org/pegasd/puppet-broken_type",Bug,PUP-7952,[],Types with a trailing comma fail on 5.2.0
"Scenario: Puppet Agent is bucketing file to Puppetserver

Following scenario (but in agent-server) configuration should show the error:
puppet apply -e 'file { ""/tmp/d1/file1"": source => ""/usr/bin/at"" }'

puppet apply -e 'file { ""/tmp/d1/file1"": source => ""/usr/bin/bash"" }'
# file1 already exists, so it is bucketed before rewritten by contents of 'bash'

puppet apply -e 'file { ""/tmp/d2/file2"": source => ""/usr/bin/at"" }'

puppet apply -e 'file { ""/tmp/d2/file2"": source => ""/usr/bin/bash"" }'
# file2 already exists, so it is bucketed before rewritten by contents of 'bash'. It is bucketed to same directory on server because md5 hash of file2 is same as md5 hash of bucketed file1. And bucketing fails.


In theory this should work. And for local bucketing it works. 
There are 2 artefacts on server for each bucketed file - contents and paths. Paths contains all paths where contents was stored on origin system.

When file is bucketed there are multiple checks - size, md5 hash and file to be bucketed is byte-to-byte compared with already bucketed file.

In case that given file is bucketed (file with md5sum hash exists on server) and path on origin system is different to path stored in 'paths' than there are 2 checks - size of bucketed file and checksum. Size is compared between data of file received over network from agent and existing 'contents' on server.

The problem is, that this comparison usually fails because encoding of data received over network are 'UTF-8' encoded and contents is ""like"" plain bytes. So size doesn't match and it is considered error and processing of file resource fails.

For puppet-agent-1.10.4-1.el7.x86_64 rpm:
Comparison is in: method Puppet::FileBucketFile::File.verify_identical_file()
bucket_file is: Puppet::FileBucket::File::StringContents

Solution should be to ensure size of data received over network to be converted to something like ""ASCII-8BIT"" encoding even for 'size' operation.",Bug,PUP-7951,[],agent - server setup - file bucketing for binary files fails in case same file is bucketed for 2 different paths
"Because a simple ""touch"" command can change the ctime/mtime on files, and thus leading to false changes (which could then trigger service or exec refreshes). there should be a way to specify a URI that contains an MD5sum or other checksum value for files that use http or https based sources.

Example:

{code}
file {
  '/some/path/to/some_file.ext':
     source => 'http:://example.com/files/some_file.ext',
     checksum_source => 'http://example.com/files/some_file.ext.md5',
}
{code}

",New Feature,PUP-7950,[],Allow specifying an MD5 URI for files with HTTP(s) sources
"We should add something to check the contents of the POT file to ensure that people aren't adding string values which make it hard to translate our strings.

* %s
* %\d.\df
* #{value + 1}
* etc

Possible options are to:
* add a Rubocop entry to check for these to the puppetlabs/rubocop-i18n
* add a test to puppet or puppet-agent that would check the contents of the po file.",Task,PUP-7949,[],"I18N Add support feedback when badly formed I18N strings are added ""%s"" ""%\d.\df"""
"I was playing with rubocop when it complained about:

{code}
== lib/puppet/provider/selmodule/semodule.rb ==
W:121: 13: Lint/EmptyExpression: Avoid empty expressions.
{code}

Looking at the code its complaining about the ""lines = ()"" assignment:

{code}
  def selmodversion_loaded
    lines = ()
    begin
      execpipe(""#{command(:semodule)} --list"") do |output|
        output.each_line do |line|
          line.chomp!
          bits = line.split
          if bits[0] == @resource[:name]
            self.debug ""load version #{bits[1]}""
            return bits[1]
          end
        end
      end
    rescue Puppet::ExecutionFailure
      raise Puppet::ExecutionFailure, ""Could not list policy modules: #{lines.join(' ').chomp!}"", $!.backtrace
    end
    nil
  end
{code}

Looking at the code, lines will be assigned ""nil"" which doesn't have a .join method. So the exception will fail. We also fail to do anything with the lines variable in the method so if it was intended to be an array, it never gets changed from an empty array which is kind of pointless.

We should enable ""Lint/EmptyExpression"" in the .robocop.yml if when this is fixed and we're on 0.49 or greater.

Branch off of 5.3.x",Bug,PUP-7948,[],selmodversion_loaded lines variable broken
"Currently, when turning on --tasks, the puppet parser validate (and puppet apply, and possibly others) do not also set the --strict=error / strict_variables=true and will therefore behave differently from {{puppet script}}. 

It was difficult to add a hook for --tasks as when it is set to false, tests that flip back and forth between true/false does not get the derived settings in the desired state without explicitly changing them.

Not sure if the settings system can actually do this in a sane way.

Work around: use --strict=error on the command line when using apply or parser commands with --tasks
",Task,PUP-7947,[],Make puppet parser validate --tasks (and others) work with all implied strictness
,New Feature,PUP-7946,[],Implement Puppet API for running scripts
If the environment does not refer to an actual environment directory the {{Scope.to_s}} method will fail when running {{puppet script}} since the {{Environment}} instance has a {{nil}} path.,Bug,PUP-7945,[],Scope.to_s fails if there is no source and no path to env in Environment obj
"1) Check that the version number in source for puppet is correct

  version for puppet should be 4.10.8

  * check {{lib/puppet/version.rb}} for the {{PUPPETVERSION}} variable.
  * check .gemspec for {{version}} variable

",Task,PUP-7944,[],Bump puppet version to 4.10.8
"We should update rubocop-i18n to support complaining about then a translated string contains the formatting strings like %s and %f
We should correct issues found in the puppet source
We should update puppet to use this version of rubocop-i18n

This way when someone checks something in then Travis CI would run the rubocop tests and fail.


Details:
I was reviewing the puppet.po file when I noticed that we a bunch of %s and a few %f entries in the strings. This is mostly caused when the puppet code builds up the text string to be output. This makes it hard on translators as they only have a small piece of the whole sentence to work with. This will make for a poor reading experience in some languages.

Here is a list of what I found while looking:

{code}
#: ../lib/puppet/face/module/list.rb:120
msgid ""Module '%s' (v%s) fails to meet some dependencies:""
msgstr ""モジュール'%s' (v%s)は一部の依存関係を満たしていません:""

----------------
#: ../lib/puppet/network/auth_config_parser.rb:54
msgid ""allowing %s access""
msgstr "" %sアクセスを許可しています。""

----------------
#: ../lib/puppet/network/auth_config_parser.rb:56
msgid ""denying %s access""
msgstr ""%s アクセスを拒否しています。""

----------------
#: ../lib/puppet/network/auth_config_parser.rb:58
msgid ""allowing IP %s access""
msgstr ""IP %s アクセスを許可しています。""

----------------
#: ../lib/puppet/network/auth_config_parser.rb:60
msgid ""denying IP %s access""
msgstr ""IP %s アクセスを拒否しています。""

----------------
#: ../lib/puppet/network/auth_config_parser.rb:62
msgid ""allowing 'method' %s""
msgstr ""'method' %sを許可しています。""

----------------
#: ../lib/puppet/network/auth_config_parser.rb:64
msgid ""adding environment %s""
msgstr ""環境 %sを追加しています。""

----------------
#: ../lib/puppet/network/auth_config_parser.rb:66
msgid ""adding authentication %s""
msgstr ""認証%sを追加しています。""

----------------
#: ../lib/puppet/network/http/rack.rb:26
msgid ""Internal Server Error: \""%s\""""
msgstr ""内部サーバエラー: \""%s\""""

----------------
#: ../lib/puppet/network/http/rack.rb:28
msgid ""Puppet Server (Rack): Internal Server Error: Unhandled Exception: \""%s\""""
msgstr ""Puppetサーバ(ラック): 内部サーバエラー: 未処理の例外: \""%s\""""

----------------
#: ../lib/puppet/network/http/webrick.rb:30
msgid ""Client did not send data within %.1f seconds of connecting""
msgstr ""クライアントが接続から%.1f秒以内にデータを送信しませんでした。""

----------------
#: ../lib/puppet/provider/package/opkg.rb:25
msgid ""Failed to match line %s""
msgstr ""行 %sのマッチに失敗しました。""

----------------
#: ../lib/puppet/provider/package/pkg.rb:46
#: ../lib/puppet/provider/package/pkg.rb:55
msgid ""Unknown format %s: %s[%s]""
msgstr ""不明なフォーマット %s: %s[%s]""

----------------
#: ../lib/puppet/provider/package/pkg.rb:85
msgid ""Unknown format %s: %s""
msgstr ""不明なフォーマット %s: %s""

----------------
#: ../lib/puppet/provider/package/pkg.rb:104
msgid ""Unknown line format %s: %s""
msgstr ""不明な行フォーマット %s: %s""

----------------
#: ../lib/puppet/provider/package/pkgutil.rb:73
#: ../lib/puppet/provider/package/pkgutil.rb:145
msgid ""Cannot match %s""
msgstr "" %sが一致しません。""

----------------
#: ../lib/puppet/provider/package/pkgutil.rb:91
msgid ""Package not in pkgutil catalog: %s""
msgstr ""パッケージはpkgutilカタログにありません: %s""

----------------
#: ../lib/puppet/transaction.rb:180
msgid ""Evaluated in %0.2f seconds""
msgstr ""%0.2f 秒で検証されました。""

----------------
#: ../lib/puppet/transaction/resource_harness.rb:147
#: ../lib/puppet/transaction/resource_harness.rb:155
msgid ""change from %s to %s failed: ""
msgstr ""%s から %s への変更に失敗しました: ""

----------------
#: ../lib/puppet/transaction/resource_harness.rb:212
msgid ""audit change: previously recorded value %s has been changed to %s""
msgstr ""オーディット変更: 以前に記録された値 %s が %sに変更されました。""

----------------
#: ../lib/puppet/transaction/resource_harness.rb:222
msgid "" (previously recorded value was %s)""
msgstr "" (以前に記録された値は%s)""

----------------
#: ../lib/puppet/transaction/resource_harness.rb:229
msgid ""current_value %s, should be %s (noop)""
msgstr ""current_value %s、%s にする必要があります(noop)。""

----------------
#: ../lib/puppet/transaction/resource_harness.rb:238
msgid ""changed %s to %s""
msgstr ""%s から%sへ変更しました。""

----------------
#: ../lib/puppet/transaction/resource_harness.rb:261
msgid ""audit change: newly-recorded value %s""
msgstr ""オーディット変更: 新たに記録された値%s""

----------------
#: ../lib/puppet/type/schedule.rb:374
msgid ""%s is not a valid day of the week""
msgstr ""%s は有効な曜日ではありません。""

----------------
#. TRANSLATORS forms the end of a string indicating how long a
#. given operation took
#: ../lib/puppet/util.rb:228
msgid "" in %0.2f seconds""
msgstr "" %0.2f 秒""
{code}",Improvement,PUP-7943,[],I18N update rubocop-i18n to complain about translation strings that contain formatting string like %s and %f 
"We build puppet agent's for these Cisco platforms:
cisco-wrlinux-5-x86_64  (Test Target = cisconx-64)
cisco-wrlinux-7-x86_64  (Test Target = ciscoxr-64)

We presently only ciscoxr-64 in the Non Standard pipeline.  We should also test cisco*nx*-64",Task,PUP-7942,[],Add Cisco_Nexus-7-x86_64 as a test target in Puppet Agent Non Standard Pipeline
"Don't know if I missed something, but as far as I can tell via prefetch autogenerated resources of custom types never get all properties set.

Here is a simple example:

{code:title=test/lib/puppet/type/touchfile.rb|ruby}
Puppet::Type.newtype(:touchfile) do

  ensurable do
    defaultvalues
    defaultto :present
  end

  newparam(:name) do
    isnamevar
  end

  newproperty(:data) do
  end

  validate do
    Puppet.warning(""validate name: #{self[:name]} ensure: #{self[:ensure]} data: #{self[:data]}"")
    if self[:ensure] == :present and self[:data].nil?
      warning('data must be set if ensure is present')
    end
  end
end
{code}

{code:title=test/lib/puppet/provider/touchfile/default.rb|ruby}
Puppet::Type.type(:touchfile).provide(:default) do

  commands :touch => 'touch', :rm => 'rm'
  def self.instances
    Dir[""/tmp/*.txt""].collect do |filename|
      n = filename.gsub(/^\/tmp\/(.*)\.txt$/, '\1')
      new(
        :name => n,
        :ensure => :present,
        :data => 'default',
      )
    end
  end

  def self.prefetch(resources)
    instances.each do |prov|
      if tf = resources[prov.name]
        tf.provider = prov
      end
    end
  end

  def create
    touch([""/tmp/#{@resource[:name]}.txt""])
  end

  def destroy
    Puppet.warning(""destroy name: #{@resource[:name]} ensure: #{@resource[:ensure]} data: #{@resource[:data]}"")
    rm([""/tmp/#{@resource[:name]}.txt""])
  end

  def exists?
    File.exist?(""/tmp/#{@resource[:name]}.txt"")
  end

  mk_resource_methods
end
{code}

As is shown in the execution below the property ""data"" is never set to the value 'default':

{noformat}
touch /tmp/a.txt; puppet apply --modulepath=/data/modules -e 'resources { ""touchfile"": purge => true }'
Notice: Compiled catalog for test.example.com in environment production in 0.13 seconds
Warning: validate name: a ensure: present data: 
Warning: /Touchfile[a]: data must be set if ensure is present
Warning: destroy name: a ensure: absent data: 
Notice: /Stage[main]/Main/Touchfile[a]/ensure: removed
Notice: Applied catalog in 0.32 seconds
{noformat}",Bug,PUP-7941,[],Autogenerated custom types never get all properties set
"When running a plan it keeps track of the status of all executed tasks such that it is possible via a function {{plan_diagnostics}} to get access to the current state of the plan's task execution. The returned object has methods that return information about executed tasks and their status per host. 

The state is available per plan and is local to the plan's scope. Calling another plan gives it a new plan-diagnostics scope. 

The state of a called plan is also included in the plan_diagnostics.

The plan_diagnostics goes out of scope when the plan returns. If the resulting object from {{plan_diagnostics}} is returned, it cannot be used to reference the diagnostics scope from which it was obtained, its methods always returns snapshot information pertaining to the plan scope from which it is called.

For normal execution the collected information should be kept to a minimum - essentially just host and a status. This can be expanded on when running in trace or debug modes (yet to be designed).",New Feature,PUP-7940,[],Support task diagnostics in a plan
"While reviewing the puppet.po file I noticed that in the english version the string contains some spaces (probably for specific readability in the output), while in the japanese translation the spaces are missing or are not the same number of spaces:

{code}
#: ../lib/puppet/module_tool/errors/installer.rb:17
msgid ""  Module '%{module_name}' (%{version}) is already installed""
msgstr ""モジュール'%{module_name}' (%{version})はすでにインストールされています。""

-------------------

#: ../lib/puppet/module_tool/errors/installer.rb:37
#: ../lib/puppet/module_tool/errors/shared.rb:44
msgid ""  No releases are available from %{source}""
msgstr ""%{source}に利用できるリリースがありません。""

-------------------

#: ../lib/puppet/module_tool/errors/installer.rb:38
msgid ""    Does '%{requested_package}' have at least one published release?""
msgstr "" '%{requested_package}'には少なくとも1つの公開済みリリースがありますか?""

-------------------

#: ../lib/puppet/module_tool/errors/shared.rb:17
msgid ""  No version of '%{module_name}' can satisfy all dependencies""
msgstr ""'%{module_name}'にはすべての依存関係を満たすバージョンがありません。""

-------------------

#: ../lib/puppet/module_tool/errors/shared.rb:69
msgid ""  Dependency '%{name}' (%{version}) would overwrite %{dir}""
msgstr ""依存関係'%{name}' (%{version})により%{dir}が上書きされます。""

-------------------

#: ../lib/puppet/module_tool/errors/shared.rb:126
msgid ""  Module '%{module_name}' is not installed""
msgstr ""モジュール'%{module_name}'はインストールされていません。""

------------------- (different number of leading spaces)

#: ../lib/puppet/module_tool/errors/shared.rb:128
msgid ""    You may have meant `puppet module %{action} %{suggestion}`""
msgstr ""   あなたが意図していたのは`puppet module %{action} %{suggestion}`だった可能性があります。""

-------------------

#: ../lib/puppet/module_tool/errors/shared.rb:130
msgid ""    Use `puppet module install` to install this module""
msgstr ""`puppet module install`を使ってこのモジュールをインストール。""

------------------- (different number of leading spaces)

#: ../lib/puppet/module_tool/errors/shared.rb:147
msgid ""  Module '%{module_name}' appears multiple places in the module path""
msgstr "" モジュール'%{module_name}'がモジュールパスの複数の場所に現れます。""

-------------------

#: ../lib/puppet/module_tool/errors/shared.rb:168
msgid ""  Installed module has had changes made locally""
msgstr ""インストールされたモジュールはローカルで変更されています。""

-------------------

#: ../lib/puppet/module_tool/errors/upgrader.rb:58
msgid ""  Downgrading is not allowed.""
msgstr ""ダウングレードは許可されていません。""
{code}",Bug,PUP-7939,[],I18N japanese translation does not contain leading spaces
"While reviewing the puppet.po file I found be below translation. The english version attempt to indent and line wrap the output while the japanese version only indents the 1 line.

We need to determine how this should be handled in a localized way and do it that way

{code}
#: ../lib/puppet/face/plugin.rb:27
msgid """"
""      A list of the files downloaded, or a confirmation that no files were\n""
""      downloaded. When used from the Ruby API, this action returns an array of\n""
""      the files downloaded, which will be empty if none were retrieved.\n""
msgstr """"
""      ダウンロードしたファイルのリスト、またはダウンロードされたファイルがないことの確認。Ruby ""
""APIから使用する場合、このアクションにより、ダウンロードされたファイルの配列が返されます。何も取得されなかった場合は空になります。 \n""
{code}",Bug,PUP-7938,[],I18N Indented and line wrapped face plugin output
"I was reviewing the puppet.po file for Japanese when I noticed these 2 messages which are very similar. We appear to end a sentence of the message on line 2, but in the 2nd case there is no ""."" before we start the next sentence: ""  To continue""...

{code}
#: ../lib/puppet/ssl/certificate_authority.rb:397
msgid """"
""CSR '%{csr}' contains a subjectAltName outside the DNS label space: ""
""%{alt_names}.  To continue, this CSR needs to be cleaned.""
msgstr """"
""CSR '%{csr}'にDNSラベルスペース外のsubjectAltNameが含まれています: ""
""%{alt_names}。続行するには、このCSRを削除する必要があります。""

#: ../lib/puppet/ssl/certificate_authority.rb:402
msgid """"
""CSR '%{csr}' subjectAltName contains a wildcard, which is not allowed: ""
""%{alt_names}  To continue, this CSR needs to be cleaned.""
msgstr """"
""CSR '%{csr}' subjectAltNameに、許可されていないワイルドカードが含まれています: ""
""%{alt_names}。続行するには、このCSRを削除する必要があります。 ""
{code}",Bug,PUP-7937,[],"extra ""."" or missing ""."" in csr message"
"When looking through the puppet.po file I found a few cases where there are double spaces in the output and I was trying to figure out why. In all of these cases it appears to be that the person chose 2 spaces instead of 1.

It would be good if were consistent.

{code}
#: ../lib/puppet/agent.rb:48
msgid """"
""Run of %{client_class} already in progress; skipping  (%{lockfile_path} ""
""exists)""
msgstr ""%{client_class}の実行はすでに進行中です; スキップ(%{lockfile_path}が存在)""

--------------

#: ../lib/puppet/application/apply.rb:198
msgid ""Only one file can be applied per run.  Skipping %{files}""
msgstr ""1回の実行で適用できるのは1ファイルのみです。%{files}をスキップしています。""

--------------

#: ../lib/puppet/application/face_base.rb:128
msgid ""'%{face}' has no %{action} action.  See `puppet help %{face}`.""
msgstr ""'%{face}'には%{action}アクションはありません。`puppet help %{face}`を参照してください。""

--------------

#: ../lib/puppet/face/module/generate.rb:147
msgid """"
""We need to create a metadata.json file for this module.  Please answer the\n""
""    following questions; if the question is not applicable to this module, feel free\n""
""    to leave it blank.""
msgstr """"
""このモジュールのmetadata.jsonファイルを作成する必要があります。次の質問に答えてください; 質問がこのモジュールに適用されない場合は\n""
""    空欄のままでかまいません。""

--------------

#: ../lib/puppet/face/module/generate.rb:154
msgid ""What version is this module?  [%{version}]""
msgstr ""このモジュールのバージョンは?  [%{version}]""

--------------

#: ../lib/puppet/face/module/generate.rb:162
msgid ""Who wrote this module?  [%{author}]""
msgstr ""このモジュールの作成者は?  [%{author}]""
--------------

#: ../lib/puppet/face/module/generate.rb:166
msgid ""What license does this module code fall under?  [%{license}]""
msgstr ""このモジュールコードはどのライセンス下にありますか?  [%{license}]""

--------------

#: ../lib/puppet/provider/mcx/mcxcontent.rb:137
#: ../lib/puppet/provider/mcx/mcxcontent.rb:143
msgid """"
""Could not parse ds_type from resource name '%{name}'.  Specify with ds_type ""
""parameter.""
msgstr ""リソース名'%{name}'からds_typeを解析できませんでした。ds_typeパラメータで指定してください。""

--------------

#: ../lib/puppet/provider/mcx/mcxcontent.rb:153
msgid """"
""Could not parse ds_name from resource name '%{name}'.  Specify with ds_name ""
""parameter.""
msgstr ""リソース名'%{name}'からds_nameを解析できませんでした。ds_nameパラメータで指定してください。""

--------------

#: ../lib/puppet/provider/nameservice/directoryservice.rb:160
msgid ""Could not get report.  command execution failed.""
msgstr ""レポートを取得できませんでした。コマンド実行に失敗しました。""

--------------

#: ../lib/puppet/provider/package/apt.rb:39
msgid """"
""/etc/apt/sources.list contains a cdrom source; not installing.  Use ""
""'allowcdrom' to override this failure.""
msgstr """"
""/etc/apt/sources.listにcdromソースが含まれています; ""
""インストールされていません。'allowcdrom'を使ってこの不具合をオーバーライドしてください。""

--------------

#: ../lib/puppet/ssl/certificate_authority.rb:397
msgid """"
""CSR '%{csr}' contains a subjectAltName outside the DNS label space: ""
""%{alt_names}.  To continue, this CSR needs to be cleaned.""
msgstr """"
""CSR '%{csr}'にDNSラベルスペース外のsubjectAltNameが含まれています: ""
""%{alt_names}。続行するには、このCSRを削除する必要があります。""

--------------

#: ../lib/puppet/ssl/certificate_authority.rb:402
msgid """"
""CSR '%{csr}' subjectAltName contains a wildcard, which is not allowed: ""
""%{alt_names}  To continue, this CSR needs to be cleaned.""
msgstr """"
""CSR '%{csr}' subjectAltNameに、許可されていないワイルドカードが含まれています: ""
""%{alt_names}。続行するには、このCSRを削除する必要があります。 ""

--------------

#: ../lib/puppet/util/log.rb:401
msgid ""%{msg}  at %{file}:%{line}""
msgstr ""%{file}:%{line}に%{msg} ""

--------------

#: ../lib/puppet/util/log.rb:403
msgid ""%{msg}  at line %{line}:%{pos}""
msgstr ""行%{line}:%{pos}に%{msg}""

--------------

#: ../lib/puppet/util/log.rb:405
msgid ""%{msg}  at line %{line}""
msgstr ""行%{line}に%{msg}""

--------------

#: ../lib/puppet/util/log.rb:407
msgid ""%{msg}  in %{file}""
msgstr ""%{file}に%{msg}""
{code}


I think in most of the cases it was accidental, like the below example code where some of the messages contain a double space before the ""at"" or ""in"" and some don't. It would be good to be consistent

{code}
  def to_s
    msg = message

    # Issue based messages do not have details in the message. It
    # must be appended here
    unless issue_code.nil?
      msg = _(""Could not parse for environment %{env}: %{msg}"") % { env: environment, msg: msg } unless environment.nil?
      if file && line && pos
        msg = _(""%{msg} at %{file}:%{line}:%{pos}"") % { msg: msg, file: file, line: line, pos: pos }
      elsif file and line
        msg = _(""%{msg}  at %{file}:%{line}"") % { msg: msg, file: file, line: line }
      elsif line && pos
        msg = _(""%{msg}  at line %{line}:%{pos}"") % { msg: msg, line: line, pos: pos }
      elsif line
        msg = _(""%{msg}  at line %{line}"") % { msg: msg, line: line }
      elsif file
        msg = _(""%{msg}  in %{file}"") % { msg: msg, file: file }
      end
      msg = _(""%{msg} on node %{node}"") % { msg: msg, node: node } unless node.nil?
      if @backtrace.is_a?(Array)
        msg += ""\n""
        msg += @backtrace.join(""\n"")
      end
    end
    msg
  end
{code}

",Story,PUP-7936,[],double space versus single space in output messages
"Is it a bug or a feature that it is not possible to prefetch custom types if the _namevar_ parameter is not named ""name"", because in _puppet/provider.rb_: *@property_hash\[:name\]* is hardcoded.

Here an simple example for clarification of the issue:

{code:title=test/lib/puppet/type/touchfile.rb|ruby}
Puppet::Type.newtype(:touchfile) do

  ensurable

  newparam(:filename) do
    isnamevar
  end
end
{code}

{code:title=test/lib/puppet/provider/touchfile/default.rb|ruby}
Puppet::Type.type(:touchfile).provide(:default) do

  commands :touch => 'touch', :rm => 'rm'

  def self.instances
    Dir[""/tmp/*.txt""].collect do |filename|
      new(
        :filename => filename,
      )
    end
  end

  def self.prefetch(resources)
    instances.each do |prov|
      if tf = resources[prov.name]
        tf.provider = prov
      end
    end
  end

  def create
    touch([""/tmp/#{@resource[:filename]}.txt""])
  end

  def destroy
    rm([""/tmp/#{@resource[:filename]}.txt""])
  end

  def exists?
    File.exist?(""/tmp/#{@resource[:filename]}.txt"")
  end
end
{code}

The above creates the following error if a txt file is inside of /tmp/:

{noformat}
puppet apply --modulepath=/data/modules -e 'touchfile { ""dummy"": }' --trace
Notice: Compiled catalog for test.example.com in environment production in 0.13 seconds
Error: Failed to apply catalog: No resource and no name in property hash in default instance
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:531:in `name'
[...]
{noformat}

If the _namevar_ parameter is renamed from ""filename"" to ""name"" it works without problems.",Bug,PUP-7935,[],"Prefetching custom types not possible if namevar is not ""name"""
"When trying to set a scheduled_task trigger I get the following error:

{code}
C:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:8:in `<main>'
Error: /Stage[main]/Adoberum::Service/Scheduled_task[Adobe Remote Update Manager
]/ensure: change from absent to present failed: Failed to call #<Win32::TaskSche
duler::COM::TaskTrigger:0x0000000872bd18>::SetTrigger with HRESULT: -2147024809.
:  The parameter is incorrect.
{code}

This happens for both month-by-date and month-by-weekday.

My scheduled_task resource is as follows:
{code}
scheduled_task { 'Adobe Remote Update Manager':
      ensure    => present,
      command   => $adoberum::command_source,
      enabled   => true,
      trigger   => {schedule => monthly, on => [1,3,last,17], start_time => '08:00', months => [1, 3, 5]},
    }
{code}

I've tried quoting and unquoting the parameter in the triggers hash. Works completely fine for daily and weekly triggers.

This has been tested on two different windows 7 machines with two different puppet version and the error is the same.

Full Trace(from 3.7.4 Puppet):
{code}
Error: Failed to call #<Win32::TaskScheduler::COM::TaskTrigger:0x0000000872bd18>
::SetTrigger with HRESULT: -2147024809.:  The parameter is incorrect.
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:142:in
 `block (3 levels) in []'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:966:in `block (2 levels) in populate_trigger'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:918:in `initialize'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:918:in `new'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:918:in `block in populate_trigger'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:917:in `initialize'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:917:in `new'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:917:in `populate_trigger'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:621:in `block (2 levels) in trigger='
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:117:in
 `block in UseInstance'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in
 `initialize'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in
 `new'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in
 `UseInstance'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:620:in `block in trigger='
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:615:in `initialize'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:615:in `new'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler
.rb:615:in `trigger='
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi
n32_taskscheduler.rb:193:in `block in trigger='
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi
n32_taskscheduler.rb:188:in `each'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi
n32_taskscheduler.rb:188:in `trigger='
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi
n32_taskscheduler.rb:216:in `block in create'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi
n32_taskscheduler.rb:215:in `each'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi
n32_taskscheduler.rb:215:in `create'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property/ensure.rb:16:in `
block in defaultvalues'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:197:in `call_v
aluemethod'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:498:in `set'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:581:in `sync'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne
ss.rb:204:in `sync'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne
ss.rb:128:in `sync_if_needed'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne
ss.rb:81:in `perform_changes'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne
ss.rb:20:in `evaluate'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:204:in `app
ly'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:217:in `eva
l_resource'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `cal
l'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `blo
ck (2 levels) in evaluate'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:327:in `block in t
hinmark'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.0.0/benchmark.rb:296:in
`realtime'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:326:in `thinmark'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `blo
ck in evaluate'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/graph/relationship_graph.r
b:118:in `traverse'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:138:in `eva
luate'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:169:in
 `block in apply'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/log.rb:149:in `with_d
estination'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/report.rb:112:
in `as_logging_destination'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:168:in
 `apply'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:120:in `bloc
k in apply_catalog'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:161:in `block in b
enchmark'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.0.0/benchmark.rb:296:in
`realtime'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:160:in `benchmark'

C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:119:in `appl
y_catalog'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:227:in `run_
internal'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:134:in `bloc
k in run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override
'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:133:in `run'

C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:47:in `block (4 l
evels) in run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent/locker.rb:20:in `loc
k'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:47:in `block (3 l
evels) in run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:117:in `with_clie
nt'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:44:in `block (2 l
evels) in run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:82:in `run_in_for
k'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:43:in `block in r
un'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:179:in `cal
l'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:179:in `con
trolled_run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:41:in `run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/agent.rb:356:i
n `onetime'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/agent.rb:322:i
n `run_command'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `blo
ck (2 levels) in run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:507:in `plu
gin_hook'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `blo
ck in run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:488:in `exit_on_fa
il'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `run
'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:146:i
n `run'
C:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:92:in
 `execute'
C:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:8:in `<main>'
Error: /Stage[main]/Adoberum::Service/Scheduled_task[Adobe Remote Update Manager
]/ensure: change from absent to present failed: Failed to call #<Win32::TaskSche
duler::COM::TaskTrigger:0x0000000872bd18>::SetTrigger with HRESULT: -2147024809.
:  The parameter is incorrect.
{code}",Bug,PUP-7933,"['hresult', 'monthly', 'scheduled_task', 'settrigger', 'windows']",Remove documentation about 'last' in scheduledtasks type
In order to not allow old and quirky behavior when scripting we should hardcode that --strict = error when running --tasks.,Improvement,PUP-7932,[],Make --strict=error when using --tasks feature
"On very low bandwidth connections (cellular and such) the reports can be very costly.

I have developed a patch which I will be submitting shortly to enable optional HTTPS compression for the report uploads.

While this is not supported directly by puppet-server, having a proxy in front allows for the compression and gives more options for low bandwidth connections",New Feature,PUP-7931,[],Support HTTPS Compression on report upload
"The following sample can be found in the the Puppet Specifications chapter on Expression, section on [""- operator"" / Delete|https://github.com/puppetlabs/puppet-specifications/blob/master/language/expressions.md#delete]:
{code:puppet}
[1,2,b] - {a => 1, b => 20}     # => [2]
{code}
but when evaluating the expression in puppet, the result is {{\[1, 2, b\]}}. Internally, puppet does roughly this:
{code:ruby}
array - hash.to_a
{code}
and since {{hash.to_a}} returns an array of 2-element arrays (key pairs) one of two things should change. Either the example should be changed into:
{code:puppet}
[[1,2],[b,20]] - {a => 1, b => 20} # => [[1,2]]
{code}
or the code should change to:
{code:ruby}
array - hash.to_a.flatten
{code}
",Bug,PUP-7930,[],Array delete does not work according to spec when right hand side is hash
"Don't know if this behavior is a bug or not, but as it took me a long time to figure it out I thought I report it so that at least the documentation can be improved. On custom types the default value of the ensure property is only set to present if the type has any other property set.

Simple example:

{code:title=test/lib/puppet/type/touchfile.rb|ruby}
Puppet::Type.newtype(:touchfile) do
  @doc = ""Manage file""

  ensurable

  newparam(:name) do
    desc ""file name""
    isnamevar
  end

  newproperty(:dummy) do
  end
end
{code}

{code:title=test/lib/puppet/provider/touchfile/default.rb|ruby}
Puppet::Type.type(:touchfile).provide(:default) do

  commands :touch => 'touch', :rm => 'rm'

  def create
    touch([@resource[:name]])
  end

  def destroy
    rm([@resource[:name]])
  end

  def exists?
    File.exist?(@resource[:name])
  end
end
{code}

I would expect that the following command creates the file _/tmp/dummy.txt_:

{noformat}
rm -f /tmp/dummy.txt; puppet apply --modulepath=/data/modules -e 'touchfile { ""/tmp/dummy.txt"": }'
Notice: Compiled catalog for test.example.com in environment production in 0.11 seconds
Notice: Applied catalog in 0.29 seconds
{noformat}

But that is not the case. Instead the following command creates the file _/tmp/dummy.txt_:

{noformat}
rm -f /tmp/dummy.txt; puppet apply --modulepath=/data/modules -e 'touchfile { ""/tmp/dummy.txt"": dummy => 'dummy' }'
Notice: Compiled catalog for test.example.com in environment production in 0.12 seconds
Notice: /Stage[main]/Main/Touchfile[/tmp/dummy.txt]/ensure: created
Notice: Applied catalog in 0.33 seconds
{noformat}

I think that the presence of a property should not change the default value of the ensure property.

The problem is, that the function _expandable_ only adds the _defaultto :present_ modifier if the resource is managed. But that the resource is managed it needs a property with a value assigned, which it would have if the defaultto modifier was assigned to the ensure property. I'm not sure if there is a reason that the _defaultto :present_ modifier is only applied if the resource is managed. If there isn't a reason then the simple solution would be to always apply the _defaultto :present_ modifier.

The following workaround solve the problem so it is only a inconsistent behavior and a minor inconvenience.

{code:java}
  ensurable do
    defaultvalues
    defaultto :present
  end
{code}

 ",Bug,PUP-7929,[],No ensure property default value for types without any other property set
while running puppet agent this error has been shown but puppet works fine except this error,Bug,PUP-7928,[],"Error: Facter: error while resolving custom fact ""environment"": undefined method `application_name' for Puppet:Module"
"I was checking the help messages for depricated puppet subcommands and I noticed that the
Warning message for the deprication doesn't appear to get translated. Although it appears to
be translated.

{code}
[root@jrtoktjo21jq94d locale]# LANG=ja_JP puppet help key

Warning: 'puppet key' is deprecated and will be removed in a future release.

USAGE: puppet key <action> [--terminus _ターミナス] [--extra ハッシュ]

This subcommand manages certificate private keys. Keys are created
automatically by puppet agent and when certificate requests are generated
with 'puppet certificate generate'; it should not be necessary to use this
subcommand directly.

OPTIONS:
  --render-as FORMAT             - The rendering format to use.
  --verbose                      - Whether to log verbosely.
  --debug                        - Whether to log debug information.
  --extra ハッシュ                   - 間接リクエストに渡す追加の引数
  --terminus _ターミナス              - 使用する間接ターミナス

ACTIONS:
  destroy    オブジェクトを削除。
  find       オブジェクトを名前で検索。
  info       このフェイスのデフォルトのターミナスクラスを印刷。
  save       API のみ: オブジェクトを作成または上書き。
  search     単一のオブジェクトまたは複数のオブジェクトを検索。

TERMINI: ca, disabled_ca, file, memory

See 'puppet man key' or 'man puppet-key' for full help.
[root@jrtoktjo21jq94d locale]#
{code}

We have a couple translations for this like this one:

{code}
#: ../lib/puppet/application/face_base.rb:244
msgid ""'puppet %{face}' is deprecated and will be removed in a future release""
msgstr ""'puppet %{face}'は廃止予定であり、今後のリリースで廃止されます。""
{code}

Ah the issue is that the text is coming from the .erb file ""./puppet/face/help/face.erb""

{code}
%# encoding: UTF-8%>
<% if face.deprecated? -%>
<%= ""Warning: 'puppet #{face.name}' is deprecated and will be removed in a future release."" %>
<% end %>
<% if face.synopsis -%>
{code}",Bug,PUP-7927,[],I18N: deprecated help Warning messages are print in english only
"pathspec has a regular expression to match for Windows drive letters.
It is contains [a-zA-z] - which unintentionally also matches _, ^ and other non-letter characters between Z and a.
See https://github.com/highb/pathspec-ruby/pull/16 for the pull request for upstream pathspec-ruby.",Bug,PUP-7926,[],vendored pathspec library has an over-reaching regexp
"This is a minimal test case reproducing a customer report from slack.

Let's start out with this reduction of https://github.com/puppetlabs/puppetlabs-mysql/blob/d066549a0d79cda2b74e81254d3618538f4ba7eb/lib/puppet/type/mysql_datadir.rb :
{code}
david@davids:~/git/tmp/test/testmod$ cat lib/puppet/type/mysql_datadir.rb 
Puppet::Type.newtype(:mysql_datadir) do
  newparam(:works) do
    newvalues(%r{^/})
  end

  newparam(:fails) do
    newvalues(%r{^\/$})
  end
end
david@davids:~/git/tmp/test/testmod$ pry
[1] pry(main)> %r{^\/$}
=> /^\/$/
[2] pry(main)> 
{code}

As you can see, the {{fails}} property has a valid regular expression in {{newvalues}}.

Let's see what {{puppet generate types}} does:
{code}
david@davids:~/git/tmp/test/testmod$ bundle exec puppet generate types --modulepath ..Notice: Generating Puppet resource types.
Notice: No files were generated because all inputs were up-to-date.
david@davids:~/git/tmp/test/testmod$ cat /home/david/.puppetlabs/etc/code/environments/production/.resource_types/mysql_datadir.pp# This file was automatically generated on 2017-09-08 13:58:29 +0100.
# Use the 'puppet generate types' command to regenerate this file.

Puppet::Resource::ResourceType3.new(
  'mysql_datadir',
  [

  ],
  [
    # Values can match `/^\//`.
    Puppet::Resource::Param(Pattern[/^\//], 'works'),

    # Values can match `/^\/$/`.
    Puppet::Resource::Param(Pattern[/^\\/$/], 'fails')
  ],
  {
  },
  true,
  false)
david@davids:~/git/tmp/test/testmod$ bundle exec puppet parser validate /home/david/.puppetlabs/etc/code/environments/production/.resource_types/mysql_datadir.pp
Error: Could not parse for environment production: Syntax error at '' at /home/david/.puppetlabs/etc/code/environments/production/.resource_types/mysql_datadir.pp:14:42
david@davids:~/git/tmp/test/testmod$ 
{code}

The {{fails}} regular expression gets rendered with a double backslash, causing the rendered PCore code to be invalid puppet syntax.

The customer reporting this on slack was running puppet 4.10.5, while I could reproduce this locally using puppet 5.1.0.
",Bug,PUP-7925,[],puppet generate types incorrectly quotes backslashes in regular expressions when rendering Patterns
"If there is an older version of Puppet on Windows, which needs to be retained and a newer Puppet version is installed, the older version is implicitly deleted. 
This is very inconvenient because I have a need to support two Puppet versions on the same Windows machine. Is there a solution for this? If not, can it be fixed?
",Bug,PUP-7924,[],Co-existence of Puppet versions on Windows
"Make it illegal to perform an assignment like the below example when --tasks / scripting is on:
{code:puppet}
[$a] = Class[some_class]
{code}
",Improvement,PUP-7923,[],Make multi assign from resource illegal when --task feature is on
The use of referencing individual facts as top scope variables is unwanted (exists in puppet manifests for backwards compatibility reasons). This is not something we want to support with tasks and plans.,Improvement,PUP-7922,[],Do not add individual facts as top scope variables when --tasks is in effect
"Since tasks and plans are function oriented, and that there are no classes, it is not meaningful to reference arbitrary fully qualified variables that may or may not be initialized. Also, the old style of facts as top scope variables is no longer of values, and the same for settings as they are now available in hashes. For all those reason, --strict_variables should be on and not configurable.",Improvement,PUP-7921,[],Make --strict_variables standard when using --tasks
"Travis is currently failing for all puppet PRs, regardless of branch, against ruby 1.9.3.

{code}
NoMethodError: undefined method `spec' for nil:NilClass
An error occurred while installing puppet (5.1.0), and Bundler cannot continue.
Make sure that `gem install puppet -v '5.1.0'` succeeds before bundling.
{code}

The failure looks like the following:
{code}
44.67s$ rvm use 1.9.3 --install --binary --fuzzy
ruby-1.9.3-p551 is not installed - installing.
Searching for binary rubies, this might take some time.
Found remote file https://rvm_io.global.ssl.fastly.net/binaries/ubuntu/14.04/x86_64/ruby-1.9.3-p551.tar.bz2
Checking requirements for ubuntu.
Requirements installation successful.
ruby-1.9.3-p551 - #configure
ruby-1.9.3-p551 - #download
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 13.3M  100 13.3M    0     0  45.9M      0 --:--:-- --:--:-- --:--:-- 46.1M
ruby-1.9.3-p551 - #validate archive
ruby-1.9.3-p551 - #extract
ruby-1.9.3-p551 - #validate binary
ruby-1.9.3-p551 - #setup
ruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551@global
Updating rubygems-update
Fetching: rubygems-update-2.6.13.gem (100%)
Successfully installed rubygems-update-2.6.13
Installing RubyGems 2.6.13
RubyGems 2.6.13 installed
=== 2.6.13 / 2017-08-27
Security fixes:
* Fix a DNS request hijacking vulnerability.
  Fix by Samuel Giddins.
* Fix an ANSI escape sequence vulnerability.
  Fix by Evan Phoenix.
* Fix a DOS vulernerability in the `query` command.
  Fix by Samuel Giddins.
* Fix a vulnerability in the gem installer that allowed
  a malicious gem to overwrite arbitrary files.
  Fix by Samuel Giddins.
=== 2.6.12 / 2017-04-30
Bug fixes:
* Fix test_self_find_files_with_gemfile to sort expected files. Pull
  request #1880 by Kazuaki Matsuo.
* Fix issue for MinGW / MSYS2 builds and testing. Pull request #1879 by
  MSP-Greg.
* Fix gem open to open highest version number rather than lowest. Pull
  request #1877 by Tim Pope.
* Add a test for requiring a default spec as installed by the ruby
  installer. Pull request #1899 by Samuel Giddins.
* Fix broken --exact parameter to gem command. Pull request #1873 by Jason
  Frey.
* [Installer] Generate backwards-compatible binstubs. Pull request #1904
  by Samuel Giddins.
* Fix pre-existing source recognition on add action. Pull request #1883 by
  Jonathan Claudius.
* Prevent negative IDs in output of #inspect. Pull request #1908 by Vít
  Ondruch.
* Allow Gem.finish_resolve to respect already-activated specs. Pull
  request #1910 by Samuel Giddins.
=== 2.6.11 / 2017-03-16
Bug fixes:
* Fixed broken tests on ruby-head. Pull request #1841 by
  SHIBATA Hiroshi.
* Update vendored Molinillo to 0.5.7. Pull request #1859 by Samuel
  Giddins.
* Avoid activating Ruby 2.5 default gems when possible. Pull request #1843
  by Samuel Giddins.
* Use improved resolver sorting algorithm. Pull request #1856 by
  Samuel Giddins.
=== 2.6.10 / 2017-01-23
Bug fixes:
* Fix `require` calling the wrong `gem` method when it is overridden.
  Pull request #1822 by Samuel Giddins.
=== 2.6.9 / 2017-01-20
Bug fixes:
* Allow initializing versions with empty strings. Pull request #1767 by
  Luis Sagastume.
* Fix TypeError on 2.4. Pull request #1788 by Nobuyoshi Nakada.
* Don't output mkmf.log message if compilation didn't fail. Pull request
  #1808 by Jeremy Evans.
* Fixed broken links and overzealous URL encoding in gem server. Pull
  request #1809 by Nicole Orchard.
* Update vendored Molinillo to 0.5.5. Pull request #1812 by Samuel
  Giddins.
* RakeBuilder: avoid frozen string issue. Pull request #1819 by Olle
  Jonsson.
=== 2.6.8 / 2016-10-29
Bug fixes:
* Improve SSL verification failure message. Pull request #1751
  by Eric Hodel.
* Ensure `to_spec` falls back on prerelease specs. Pull request
  #1755 by André Arko.
* Update vendored Molinillo to 0.5.3. Pull request #1763 by
  Samuel Giddins.
=== 2.6.7 / 2016-09-26
Bug fixes:
* Install native extensions in the correct location when using the
  `--user-install` flag. Pull request #1683 by Noah Kantrowitz.
* When calling `Gem.sources`, load sources from `configuration`
  if present, else use the default sources. Pull request #1699
  by Luis Sagastume.
* Fail gracefully when attempting to redirect without a Location.
  Pull request #1711 by Samuel Giddins.
* Update vendored Molinillo to 0.5.1. Pull request #1714 by
  Samuel Giddins.
=== 2.6.6 / 2016-06-22
Bug fixes:
* Sort installed versions to make sure we install the latest version when
  running `gem update --system`. As a one-time fix, run
  `gem update --system=2.6.6`. Pull request #1601 by David Radcliffe.
=== 2.6.5 / 2016-06-21
Minor enhancements:
* Support for unified Integer in Ruby 2.4. Pull request #1618
  by SHIBATA Hiroshi.
* Update vendored Molinillo to 0.5.0 for performance improvements.
  Pull request #1638 by Samuel Giddins.
Bug fixes:
* Raise an explicit error if Signer#sign is called with no certs. Pull
  request #1605 by Daniel Berger.
* Update `update_bundled_ca_certificates` utility script for directory
  nesting. Pull request #1583 by James Wen.
* Fix broken symlink support in tar writer (+ fix broken test). Pull
  request #1578 by Cezary Baginski.
* Remove extension directory before (re-)installing. Pull request #1576
  by Jeremy Hinegardner.
* Regenerate test CA certificates with appropriate extensions. Pull
  request #1611 by rhenium.
* Rubygems does not terminate on failed file lock when not superuser. Pull
  request #1582 by Ellen Marie Dash.
* Fix tar headers with a 101 character name. Pull request #1612 by Paweł
  Tomulik.
* Add Gem.platform_defaults to allow implementations to override defaults.
  Pull request #1644 by Charles Oliver Nutter.
* Run Bundler tests on TravisCI. Pull request #1650 by Samuel Giddins.
=== 2.6.4 / 2016-04-26
Minor enhancements:
* Use Gem::Util::NULL_DEVICE instead of hard coded strings. Pull request #1588
  by Chris Charabaruk.
* Use File.symlink on MS Windows if supported. Pull request #1418
  by Nobuyoshi Nakada.
Bug fixes:
* Redact uri password from error output when gem fetch fails. Pull request
  #1565 by Brian Fletcher.
* Suppress warnings. Pull request #1594 by Nobuyoshi Nakada.
* Escape user-supplied content served on web pages by `gem server` to avoid
  potential XSS vulnerabilities. Samuel Giddins.
=== 2.6.3 / 2016-04-05
Minor enhancements:
* Lazily calculate Gem::LoadError exception messages. Pull request #1550
  by Aaron Patterson.
* New fastly cert. Pull request #1548 by David Radcliffe.
* Organize and cleanup SSL certs. Pull request #1555 by James Wen.
* [RubyGems] Make deprecation message for paths= more helpful. Pull
  request #1562 by Samuel Giddins.
* Show default gems when using ""gem list"". Pull request #1570 by Luis
  Sagastume.
Bug fixes:
* Stub ordering should be consistent regardless of how cache is populated.
  Pull request #1552 by Aaron Patterson.
* Handle cases when the @@stubs variable contains non-stubs. Pull request
  #1558 by Per Lundberg.
* Fix test on Windows for inconsistent temp path. Pull request #1554 by
  Hiroshi Shirosaki.
* Fix `Gem.find_spec_for_exe` picks oldest gem. Pull request #1566 by
  Shinichi Maeshima.
* [Owner] Fallback to email and userid when owner email is missing. Pull
  request #1569 by Samuel Giddins.
* [Installer] Handle nil existing executable. Pull request #1561 by Samuel
  Giddins.
* Allow two digit version numbers in the tests. Pull request #1575 by unak.
=== 2.6.2 / 2016-03-12
Bug fixes:
* Fix wrong version of gem activation for bin stub. Pull request #1527 by
  Aaron Patterson.
* Speed up gem activation failures. Pull request #1539 by Aaron Patterson.
* Fix platform sorting in the resolver. Pull request #1542 by Samuel E.
  Giddins.
* Ensure we unlock the monitor even if try_activate throws. Pull request
  #1538 by Charles Oliver Nutter.
=== 2.6.1 / 2016-02-28
Bug fixes:
* Ensure `default_path` and `home` are set for paths. Pull request #1513
  by Aaron Patterson.
* Restore but deprecate support for Array values on `Gem.paths=`. Pull
  request #1514 by Aaron Patterson.
* Fix invalid gem file preventing gem install from working. Pull request
  #1499 by Luis Sagastume.
=== 2.6.0 / 2016-02-26
Minor enhancements:
* RubyGems now defaults the `gem push` to the gem's ""allowed_push_host""
  metadata setting.  Pull request #1486 by Josh Lane.
* Update bundled Molinillo to 0.4.3. Pull request #1493 by Samuel E. Giddins.
* Add version option to gem open command. Pull request #1483 by Hrvoje
  Šimić.
* Feature/add silent flag. Pull request #1455 by Luis Sagastume.
* Allow specifying gem requirements via env variables. Pull request #1472
  by Samuel E. Giddins.
Bug fixes:
* RubyGems now stores `gem push` credentials under the host you signed-in for.
  Pull request #1485 by Josh Lane.
* Move `coding` location to first line. Pull request #1471 by SHIBATA
  Hiroshi.
* [PathSupport] Handle a regexp path separator. Pull request #1469 by
  Samuel E. Giddins.
* Clean up the PathSupport object. Pull request #1094 by Aaron Patterson.
* Join with File::PATH_SEPARATOR in Gem.use_paths. Pull request #1476 by
  Samuel E. Giddins.
* Handle when the gem home and gem path arent set in the config file. Pull
  request #1478 by Samuel E. Giddins.
* Terminate TimeoutHandler. Pull request #1479 by Nobuyoshi Nakada.
* Remove redundant cache. Pull request #1482 by Eileen M. Uchitelle.
* Freeze `Gem::Version@segments` instance variable. Pull request #1487 by
  Ben Dean.
* Gem cleanup is trying to uninstall gems outside GEM_HOME and reporting
  an error after it tries. Pull request #1353 by Luis Sagastume.
* Avoid duplicated sources. Pull request #1489 by Luis Sagastume.
* Better description for quiet flag. Pull request #1491 by Luis Sagastume.
* Raise error if find_by_name returns with nil. Pull request #1494 by
  Zoltán Hegedüs.
* Find_files only from loaded_gems when using gemdeps. Pull request #1277
  by Michal Papis.
=== 2.5.2 / 2016-01-31
Bug fixes:
* Fix memoization of Gem::Version#prerelease? Pull request #1125 by Matijs van
  Zuijlen.
* Handle trailing colons in GEM_PATH, by Damien Robert.
* Improve the Gemfile `gemspec` method, fixing #1204 and #1033. Pull request
  #1276 by Michael Papis.
* Warn only once when a gemspec license is invalid. Pull request #1414 by Samuel
  E. Giddins.
* Check for exact constants before using them, fixing Ruby bug #11940. Pull
  request #1438 by Nobuyoshi Nakada.
* Fix building C extensions on Ruby 1.9.x on Windows. Pull request #1453 by Marie
  Markwell.
* Handle symlinks containing "".."" correctly. Pull request #1457 by Samuel E.
  Giddins.
Minor enhancements:
* Add `--no-rc` flag, which skips loading `.gemrc`. Pull request #1329 by Luis
  Sagastume.
* Allow basic auth to be excluded from `allowed_push_host`. By Josh Lane.
* Add `gem list --exact`, which finds gems by string match instead of regex. Pull
  request #1344 by Luis Sagastume.
* Suggest alternatives when gem license is unknown. Pull request #1443 by Samuel
  E. Giddins.
* Print a useful error if a binstub expects a newer version of a gem than is
  installed. Pull request #1407 by Samuel E. Giddins.
* Allow the (supported) s3:// scheme to be used with `--source`. Pull request
  #1416 by Dave Adams.
* Add `--[no-]post-install-message` to `install` and `update`. Pull request #1162
  by Josef Šimánek.
* Add `--host` option to `yank`, providing symmetry with `pull`. Pull request
  #1361 by Mike Virata-Stone.
* Update bundled Molinillo to 0.4.1. Pull request #1452 by Samuel E. Giddins.
* Allow calling `build` without '.gemspec'. Pull request #1454 by Stephen
  Blackstone.
* Add support for `source` option on gems in Gemfile. Pull request #1355 by
  Michael Papis.
* Function correctly when string literals are frozen on Ruby 2.3. Pull request
  #1408 by Samuel E. Giddins.
=== 2.5.1 / 2015-12-10
Bug fixes:
* Ensure platform sorting only uses strings. Affected binary installs on Windows.
  Issue #1369 reported by Ryan Atball (among others).
  Pull request #1375 by Samuel E. Giddins.
* Revert PR #1332. Unable to reproduce, and nil should be impossible.
* Gem::Specification#to_fullpath now returns .rb extensions when such a file
  exists.  Pull request #1114 by y-yagi.
* RubyGems now handles Net::HTTPFatalError instead of crashing.  Pull
  request #1314 by Samuel E. Giddins.
* Updated bundled Molinillo to 0.4.0.  Pull request #1322, #1396 by Samuel E.
  Giddins.
* Improved performance of spec loading by reducing likelihood of loading the
  complete specification.  Pull request #1373 by Aaron Patterson.
* Improved caching of requirable files  Pull request #1377 by Aaron Patterson.
* Fixed activation of gems with development dependencies.  Pull request #1388
  by Samuel E. Giddins.
* RubyGems now uses the same Molinillo vendoring strategy as Bundler.  Pull
  request #1397 by Samuel E. Giddins.
* Fixed documentation of Gem::Requirement.parse.  Pull request #1398 by
  Juanito Fatas.
* RubyGems no longer warns when a prerelease gem has prerelease dependencies.
  Pull request #1399 by Samuel E. Giddins.
* Fixed Gem::Version documentation example.  Pull request #1401 by Guilherme
  Goettems Schneider.
* Updated documentation links to https://.  Pull request #1404 by Suriyaa
  Kudo.
* Fixed double word typo.  Pull request #1411 by Jake Worth.
=== 2.5.0 / 2015-11-03
Major enhancements:
* Added the Gem::Licenses class which provides a set of standard license
  identifiers as set by spdx.org. This is now used by the
  Gem::Specification#license attribute to try to standardize (though not
  enforce) licenses set by gem authors.
  Pull request #1249 by Kyle Mitchell.
Minor enhancements:
* Use Molinillo as the resolver library.  This is the same resolver as used by
  Bundler.  Pull request #1189 by Samuel E. Giddins.
* Add `--skip=gem_name` to Pristine command.  Pull request #1018 by windwiny.
* The parsed gem dependencies file is now available via Gem.gemdeps following
  Gem.use_gemdeps.  Pull request #1224 by Hsing-Hui Hsu, issue #1213 by
  Michal Papis.
* Moved description attribute to recommended for Gem::Specification.
  Pull request #1046 by Michal Papis
* Moved `Gem::Indexer#abbreviate` and `#sanitize` to `Gem::Specification`.
  Pull request #1145 by Arthur Nogueira Neves
* Cache Gem::Version segments for `#bump` and `#release`.
  Pull request #1131 by Matijs van Zuijlen
* Fix edge case in `levenshtein_distance` for comparing longer strings.
  Pull request #1173 by Richard Schneeman
* Remove duplication from List#to_a, improving from O(n^2) to O(n) time.
  Pull request #1200 by Marc Siegel.
* Gem::Specification.add_specs is deprecated and will be removed from version
  3.0 with no replacement.  To add specs, install the gem, then reset the
  cache.
* Gem::Specification.add_spec is deprecated and will be removed from version
  3.0 with no replacement.  To add specs, install the gem, then reset the
  cache.
* Gem::Specification.remove_spec is deprecated and will be removed from version
  3.0 with no replacement.  To remove specs, uninstall the gem, then reset the
  cache by calling Gem::Specification.reset.
* Call Array#compact before calling Array#uniq for minor speed improvement in
  the Gem::Specification#files method.
  Pull request #1253 by Marat Amerov.
* Use stringio instead of custom String classes.
  Pull request #1250 by Petr Skocik.
* Use URI#host instead of URI#hostname to retain backwards compatibility with
  Ruby 1.9.2 and earlier in util library.
  Pull request #1288 by Joe Rafaniello.
* Documentation update for gem sources.
  Pull request #1324 by Ilya Vassilevsky.
* Documentation update for required_ruby_version.
  Pull request #1321 by Matt Patterson.
* Documentation update for gem update.
  Pull request #1306 by Tim Blair.
* Emit a warning on SRV resolve failure.
  Pull request #1023 by Ivan Kuchin.
* Allow duplicate dependencies between runtime and development.
  Pull request #1032 by Murray Steele.
* The gem env command now shows the user installation directory.
  Pull request #1343 by Luis Sagastume.
* The Gem::Platform#=== method now treats a nil cpu arch the same as 'universal'.
  Pull request #1356 by Daniel Berger.
* Improved memory performance in Gem::Specification.traverse.  Pull request
  #1188 by Aaron Patterson.
* RubyGems packages now support symlinks.  Pull request #1209 by Samuel E.
  Giddins.
* RubyGems no longer outputs mkmf.log if it does not exist.  Pull request
  #1222 by Andrew Hooker.
* Added Bitrig platform.  Pull request #1233 by John C. Vernaleo.
* Improved error message for first-time RubyGems developers.  Pull request
  #1241 by André Arko
* Improved performance of Gem::Specification#load with cached specs.  Pull
  request #1297 by Samuel E. Giddins.
* Gem::RemoteFetcher allows users to set HTTP headers.  Pull request #1363 by
  Agis Anastasopoulos.
Bug fixes:
* Fixed Rake homepage url in example for Gem::Specification#homepage.
  Pull request #1171 by Arthur Nogueira Neves
* Don't crash if partially uninstalled gem can't be found.
  Pull request #1283 by Cezary Baginski.
* Test warning cleanup.
  Pull request #1298 by Samuel E. Giddins.
* Documentation fix for GemDependencyAPI.
  Pull request #1308 by Michael Papis.
* Fetcher now ignores ENOLCK errors in single threaded environments. This
  handles an issue with gem installation on NFS as best we can. Addresses
  issue #1176 by Ryan Moore.
  Pull request #1327 by Daniel Berger.
* Fix some path quoting issues in the test suite.
  Pull request #1328 by Gavin Miller.
* Fix NoMethodError in running ruby processes when gems are uninstalled.
  Pull request #1332 by Peter Drake.
* Fixed a potential NoMethodError for gem cleanup.
  Pull request #1333 by Peter Drake.
* Fixed gem help bug.
  Issue #1352 reported by bogem, pull request #1357 by Luis Sagastume.
* Remove temporary directories after tests finish.  Pull request #1181 by
  Nobuyoshi Nokada.
* Update links in RubyGems documentation.  Pull request #1185 by Darío Hereñú.
* Prerelease gem executables can now be run.  Pull request #1186 by Samuel E.
  Giddins.
* Updated RubyGems travis-ci ruby versions.  Pull request #1187 by Samuel E.
  Giddins.
* Fixed release date of RubyGems 2.4.6.  Pull request #1190 by Frieder
  Bluemle.
* Fixed bugs in gem activation.  Pull request #1202 by Miklós Fazekas.
* Fixed documentation for `gem list`.  Pull request #1228 by Godfrey Chan.
* Fixed #1200 history entry.  Pull request #1234 by Marc Siegel.
* Fixed synchronization issue when resetting the Gem::Specification gem list.
  Pull request #1239 by Samuel E. Giddins.
* Fixed running tests in parallel.  Pull request #1257 by SHIBATA Hiroshi.
* Fixed running tests with `--program-prefix` or `--program-suffix` for ruby.
  Pull request #1258 by Shane Gibbs.
* Fixed Gem::Specification#to_yaml.  Pull request #1262 by Hiroaki Izu.
* Fixed taintedness of Gem::Specification#raw_require_paths.  Pull request
  #1268 by Sam Ruby.
* Fixed sorting of platforms when installing gems.  Pull request #1271 by
  nonsequitur.
* Use `--no-document` over deprecated documentation options when installing
  dependencies on travis.  Pull request #1272 by takiy33.
* Improved support for IPv6 addresses in URIs.  Pull request #1275 by Joe
  Rafaniello.
* Spec validation no longer crashes if a file does not exist.  Pull request
  #1278 by Samuel E. Giddins.
* Gems can now be installed within `rescue`.  Pull request #1282 by Samuel E.
  Giddins.
* Increased Diffie-Hellman key size for tests for modern OpenSSL.  Pull
  request #1290 by Vít Ondruch.
* RubyGems handles invalid config files better.  Pull request #1367 by Agis
  Anastasopoulos.
=== 2.4.8 / 2015-06-08
Bug fixes:
* Tightened API endpoint checks for CVE-2015-3900
=== 2.4.7 / 2015-05-14
Bug fixes:
* Limit API endpoint to original security domain for CVE-2015-3900.
  Fix by claudijd
=== 2.4.6 / 2015-02-05
Bug fixes:
* Fixed resolving gems with both upper and lower requirement boundaries.
  Issue #1141 by Jakub Jirutka.
* Moved extension directory after require_paths to fix missing constant bugs
  in some gems with C extensions.  Issue #784 by André Arko, pull request
  #1137 by Barry Allard.
* Use Gem::Dependency#requirement when adding a dependency to an existing
  dependency instance.  Pull request #1101 by Josh Cheek.
* Fixed warning of shadowed local variable in Gem::Specification.  Pull request
  #1109 by Rohit Arondekar
* Gem::Requirement should always sort requirements before coercion to Hash.
  Pull request #1139 by Eito Katagiri.
* The `gem open` command should change the current working directory before
  opening the editor.  Pull request #1142 by Alex Wood.
* Ensure quotes are stripped from the Windows launcher script used to install
  gems.  Pull request #1115 by Youngjun Song.
* Fixed errors when writing to NFS to to 0444 files.  Issue #1161 by Emmanuel
  Hadoux.
* Removed dead code in Gem::StreamUI.  Pull request #1117 by mediaslave24.
* Fixed typos.  Pull request #1096 by hakeda.
* Relaxed CMake dependency for RHEL 6 and CentOS 6.  Pull request #1124 by Vít
  Ondruch.
* Relaxed Psych dependency.  Pull request #1128 by Vít Ondruch.
=== 2.4.5 / 2014-12-03
Bug fixes:
* Improved speed of requiring gems.  (Around 25% for a 60 gem test).  Pull
  request #1060 by unak.
* RubyGems no longer attempts to look up gems remotely with the --local flag.
  Pull request #1084 by Jeremy Evans.
* Executable stubs use the correct gem version when RUBYGEMS_GEMDEPS is
  active.  Issue #1072 by Michael Kaiser-Nyman.
* Fixed handling of pinned gems in lockfiles with versions.  Issue #1078 by
  Ian Ker-Seymer.
* Fixed handling of git@example:gem.git URIs.  Issue #1054 by Mogutan Mogu.
* Fixed handling of platforms retrieved from the dependencies API.  Issue
  #1058 and patch suggestion by tux-mind.
* RubyGems now suggests a copy-pasteable `gem pristine` command when
  extensions are missing.  Pull request #1057 by Shannon Skipper.
* Improved errors for long file names when packaging.  Pull request #1016 by
  Piotrek Bator.
* `gem pristine` now skips gems cannot be found remotely.  Pull request #1064
  by Tuomas Kareinen.
* `gem pristine` now caches gems to the proper directory.  Pull request #1064
  by Tuomas Kareinen.
* `gem pristine` now skips bundled gems properly.  Pull request #1064 by
  Tuomas Kareinen.
* Improved interoperability of Vagrant with RubyGems.  Pull request #1057 by
  Vít Ondruch.
* Renamed CONTRIBUTING to CONTRIBUTING.rdoc to allow markup.  Pull request
  #1090 by Roberto Miranda.
* Switched from #partition to #reject as only one collection is used.  Pull
  request #1074 by Tuomas Kareinen.
* Fixed installation of gems on systems using memory-mapped files.  Pull
  request #1038 by Justin Li.
* Fixed bug in Gem::Text#min3 where `a == b < c`.  Pull request #1026 by
  fortissimo1997.
* Fixed uninitialized variable warning in BasicSpecification.  Pull request
  #1019 by Piotr Szotkowski.
* Removed unneeded exception handling for cyclic dependencies.  Pull request
  #1043 by Jens Wille.
* Fixed grouped expression warning.  Pull request #1081 by André Arko.
* Fixed handling of platforms when writing lockfiles.
=== 2.4.4 / 2014-11-12
Bug fixes:
* Add alternate Root CA for upcoming certificate change. Fixes #1050 by
  Protosac
=== 2.4.3 / 2014-11-10
Bug fixes:
* Fix redefine MirrorCommand issue. Pull request #1044 by @akr.
* Fix typo in platform= docs.  Pull request #1048 by @jasonrclark
* Add root SSL certificates for upcoming certificate change.  Fixes #1050 by
  Protosac
------------------------------------------------------------------------------
RubyGems installed the following executables:
	/home/travis/.rvm/rubies/ruby-1.9.3-p551/bin/gem
RubyGems system software updated
ruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/global.gems.....................................
ruby-1.9.3-p551 - #generating global wrappers........
Latest version currently installed. Aborting.
ruby-1.9.3-p551 - #uninstalling gem rubygems-bundler-1.4.4.
ruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551
Latest version currently installed. Aborting.
ruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/default.gems...............
ruby-1.9.3-p551 - #generating default wrappers........
Using /home/travis/.rvm/gems/ruby-1.9.3-p551
Latest version currently installed. Aborting.
$ export BUNDLE_GEMFILE=$PWD/Gemfile
$ ruby --version
ruby 1.9.3p551 (2014-11-13 revision 48407) [x86_64-linux]
$ rvm --version
rvm 1.29.2 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io/]
$ bundle --version
Bundler version 1.7.6
$ gem --version
2.6.13
28.27s$ bundle install --without development extra
Fetching gem metadata from https://rubygems.org/............
Resolving dependencies...
Installing rake 10.1.1
Installing CFPropertyList 2.3.5
Installing addressable 2.4.0
Installing ast 2.3.0
Installing builder 3.2.3
Installing safe_yaml 1.0.4
Installing crack 0.4.3
Installing diff-lcs 1.3
Installing facter 2.5.1
Installing fast_gettext 1.1.0
Installing locale 2.1.2
Installing text 1.3.1
Installing gettext 3.2.4
Installing gettext-setup 0.28
Installing hashdiff 0.3.6
Installing hiera 3.4.0
Installing highline 1.6.21
Installing trollop 2.1.2
Installing hiera-eyaml 2.1.0
Installing hocon 1.2.5
Installing json-schema 2.1.1
Installing metaclass 0.0.4
Installing mocha 0.10.5
Installing multi_json 1.7.7
Installing parser 2.4.0.0
Installing powerpack 0.1.1
NoMethodError: undefined method `spec' for nil:NilClass
An error occurred while installing puppet (5.1.0), and Bundler cannot continue.
Make sure that `gem install puppet -v '5.1.0'` succeeds before bundling.
{code}

A previous successful run looked like this:
{code}
$ rvm use 1.9.3 --install --binary --fuzzy
ruby-1.9.3-p551 is not installed - installing.
Searching for binary rubies, this might take some time.
Found remote file https://rvm_io.global.ssl.fastly.net/binaries/ubuntu/14.04/x86_64/ruby-1.9.3-p551.tar.bz2
Checking requirements for ubuntu.
Requirements installation successful.
ruby-1.9.3-p551 - #configure
ruby-1.9.3-p551 - #download
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 13.3M  100 13.3M    0     0  74.1M      0 --:--:-- --:--:-- --:--:-- 74.5M
ruby-1.9.3-p551 - #validate archive
ruby-1.9.3-p551 - #extract
ruby-1.9.3-p551 - #validate binary
ruby-1.9.3-p551 - #setup
ruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551@global
ruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/global.gems.....................................
ruby-1.9.3-p551 - #generating global wrappers........
ruby-1.9.3-p551 - #uninstalling gem rubygems-bundler-1.4.4.
ruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551
ruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/default.gems...............
ruby-1.9.3-p551 - #generating default wrappers........
Using /home/travis/.rvm/gems/ruby-1.9.3-p551
$ export BUNDLE_GEMFILE=$PWD/Gemfile
$ ruby --version
ruby 1.9.3p551 (2014-11-13 revision 48407) [x86_64-linux]
$ rvm --version
rvm 1.29.2 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io/]
$ bundle --version
Bundler version 1.7.6
$ gem --version
2.4.3
install.bundler
18.57s$ bundle install --without development extra
Fetching gem metadata from https://rubygems.org/............
Resolving dependencies...
Installing rake 10.1.1
Installing CFPropertyList 2.3.5
Installing addressable 2.4.0
Installing ast 2.3.0
Installing builder 3.2.3
Installing safe_yaml 1.0.4
Installing crack 0.4.3
Installing diff-lcs 1.3
Installing facter 2.5.0
Installing fast_gettext 1.1.0
Installing locale 2.1.2
Installing text 1.3.1
Installing gettext 3.2.4
Installing gettext-setup 0.26
Installing hashdiff 0.3.5
Installing hiera 3.4.0
Installing highline 1.6.21
Installing trollop 2.1.2
Installing hiera-eyaml 2.1.0
Installing hocon 1.2.5
Installing json-schema 2.1.1
Installing metaclass 0.0.4
Installing mocha 0.10.5
Installing multi_json 1.7.7
Installing parser 2.4.0.0
Installing powerpack 0.1.1
Using puppet 5.0.1 from source at /home/travis/build/puppetlabs/puppet
Installing rainbow 2.1.0
Installing rdoc 4.3.0
Installing rspec-support 3.6.0
Installing rspec-core 3.6.0
Installing rspec-expectations 3.6.0
Installing rspec-mocks 3.6.0
Installing rspec 3.6.0
Installing rspec-collection_matchers 1.1.3
Installing rspec-its 1.2.0
Installing rspec-legacy_formatters 1.0.1
Installing ruby-progressbar 1.8.1
Installing unicode-display_width 1.3.0
Installing rubocop 0.39.0
Installing vcr 2.9.3
Installing webmock 1.24.6
Installing yard 0.9.9
Installing yarjuf 2.0.0
Using bundler 1.7.6
Your bundle is complete!
{code}",Bug,PUP-7920,[],Puppet PRs failing travis against ruby 1.9.3 with `undefined method spec for nil:NilClass`
"When doing a puppet run to create a local group {{dba}} but is also in Active Directory, Puppet is unable to handle AD groups with embedded blank spaces. 

{code}
class linux_base::base_groups { 
  group { 'dba': 
    gid => 123, 
    forcelocal => true, 
  } 
}
{code}

{code}
root # puppet agent -t 
Info: Using configured environment 'lab' 
Info: Retrieving pluginfacts 
Info: Retrieving plugin 
Info: Loading facts 
Info: Caching catalog for server.example.com 
Info: Applying configuration version '1234567890' 
Error: Invalid value Foo,Bar Baz,dba: Groups must be comma-separated 
Error: /Stage[main]/Linux_base::Base_users/User[oracle]/groups: change from dba,Foo,Bar Baz,dba failed: Invalid value Foo,Bar Baz,dba: Groups must be comma-separated
{code}

Defined in AD is a group named ""Bar Baz"", with an embedded blank space.

Groups defined to user ""oracle"" as seen by running the operating systems ""groups"" command: 

{code}
root # su - oracle 
oracle> groups 
dba Foo Bar Baz
{code}

An issue on Oracle Linux 5.11.
Not an issue with Oracle Linux 6.x, 7.x.",Bug,PUP-7918,"['group', 'ldap', 'table', 'triaged', 'type_and_provider', 'user']",puppet fails to change user group membership if directory group names have spaces
"If an Object type is created with an unresolved parent type, this causes an unnamed anonymous class to be created which in turn results in the error an undefined error.

This error should normally never happen since the fact that the parent type is unresolved will be trapped by the evaluator. In order to this to happen, the unresolved parent must first be cloaked by having a string resolved into a {{TypeReference}}. Example:
{code}$ bundle exec puppet apply -e 'notice(Object[{name => ""Bar"", parent => Type(""Foo"")}].new)'
Error: Evaluation Error: Error while evaluating a Method call, undefined method `sub' for nil:NilClass  at line 1:54 on node localhost
{code}
This however (which would be the common case) correctly reports the unresolved parent:
{code}
$ bundle exec puppet apply -e 'notice(Object[{name => ""Bar"", parent => Foo}].new)'
Error: Evaluation Error: Resource type not found: Foo  at line 1:41 on node localhost
{code}

",Bug,PUP-7916,[],An Object Data Type with an unresolved parent causes an undefined method error
"1) Check that the version number in source for puppet is correct

  version for puppet should be 5.2.0

  * check {{lib/puppet/version.rb}} for the {{PUPPETVERSION}} variable.
  * check .gemspec for {{version}} variable

",Task,PUP-7915,[],Bump puppet version to 5.2.0
"As part of PUP-5756, some functionality trickled in allowing Puppet to optionally use the {{Puppet}} event log, should one exist.  See more detailed notes at https://github.com/puppetlabs/puppet/pull/5509/files#r135102712

This ticket exists solely to document this for end users.",Task,PUP-7914,[],Document enabling `Puppet` event log destination on Windows
"In IMAGES-550, Stan did some work to reset the Cisco 9x switch at the start of every test run.  This needs to be integrated, because it presently isn't happening today.",Task,PUP-7913,[],Integrate Cisco reset code
The run_task and run_plan functons should give an error if called when --tasks is not in effect. to give a clear indication that they are not available when compiling a catalog.,Improvement,PUP-7912,[],the run_task and run_plans functions should be --tasks feature swtiched
"In order to merge script feature into puppet regular, the use of the 'plan' keyword must only be available when {{\--tasks}} is on. (See how this was done for application management features in the language prior to version 5.0.0 when they became standard).",Improvement,PUP-7911,[],--tasks feature flag 'plan' keyword in lexer
"The functions:

* include
* require
* ensure_resources
* defined (part of)
* contain
* hiera_include (may call include and get the error that way)

...should all be {{\--tasks}} feature flagged to get a nicer error than just crashing when they try to get to the catalog.",Improvement,PUP-7910,[],--tasks feature flag all functions in puppet that are catalog operations
We do not want to support ERB when scripting as they are impossible to support on a runtime that is not Ruby based. (Use EPP instead).,Improvement,PUP-7909,[],--tasks feature flag ERB templates (not supported when scripting)
"The problem:

The regular compiler keeps the ""main logic"" (roughly ""top scope"") in a class named with an empty string. When compiling this scope is mutated (eeeeek! run for cover) as more code is loaded (actually, a special thing is created where code is appended so not as terribly horribly bad as it once was).

The use of Class\[''] when running scripts is the only use of resources, and it requires that the construct known as ""known_resource_types"" is used (to define the class, and to find it with the name '').

wanted:
That we can get rid of the ""known_resource_types"" and the ties to the old autoloader when scripting and instead of creating the Class\[''] that we can just relay the instance of Program that the parser creates (without wrapping it in a Class).

This will require exploration into the feasability to do this with minimal code change on regular puppet.",Improvement,PUP-7908,[],explore possibility to get rid of Class[''] when using 'script'
,Improvement,PUP-7907,[],Make loading of Task conditional on --tasks feature flag
,Improvement,PUP-7906,[],set --tasks feature to on in 'script' application
"A new validator should be added that kicks in if the {{\--tasks}} feature flag is on. This new validator should flag all catalog related operations as only being allowed when compiling a catalog.  These expressions are:

* resource, resource default, resource override
* relationships
* collectors
* class definition
* user defined resource definition
* application expression
* site expression
",Improvement,PUP-7905,[],Add a --tasks feature flagged validator
"So the documentation for {{return()}} says plainly that it will return from a lambda, ending evaluation of the function.

https://docs.puppet.com/puppet/4.10/function.html#return:
{quote}
If called from within a lambda the return will return from the function evaluating the lambda.
{quote}

So let's build a short manifest and use a function that evaluates a lambda:
{code}
with(1) |$num| {
  return()
}
{code}

This creates an error:
{code}
$ puppet apply return_bug.pp
Error: return() from context where this is illegal at /tmp/return_bug.pp:2 on node 
{code}

Reading the spec test confirms that this is expected behavior?
https://github.com/puppetlabs/puppet/blob/ebd96213cab43bb2a8071b7ac0206c3ed0be8e58/spec/unit/functions/return_spec.rb#L85-L94

I thought of perhaps creating this as a documentation bug, but this is failing on documented (and desirable) functionality.",Bug,PUP-7904,['generated-docs'],return() documentation incorrect regarding lambdas
"Considering a running environment, if a machine gets replaced with the same hostname and the node certificate is not removed from the master prior to the agent running for the first time on the new node, it will generate a new SSL key and pull the old certificate from the puppet master, notice the key and certificate mismatch and provide the following error:

{quote}Info: Creating a new SSL key for agenthostname-domain.com
Info: Caching certificate for ca
Info: Caching certificate for agenthostname-domain.com
Error: Could not request certificate: The certificate retrieved from the master does not match the agent's private key.
Certificate fingerprint: XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX
To fix this, remove the certificate from both the master and the agent and then start a puppet run, which will automatically regenerate a certificate.
On the master:
  puppet cert clean agenthostname-domain.com
On the agent:
  1a. On most platforms: find C:/ProgramData/PuppetLabs/puppet/etc/ssl -name agenthostname-domain.com.pem -delete
  1b. On Windows: del ""C:\ProgramData\PuppetLabs\puppet\etc\ssl\certs\agenthostname-domain.com.pem"" /f
  2. puppet agent -t

Exiting; failed to retrieve certificate and waitforcert is disabled{quote}

The problem with the above is that if the mismatched certificate is cached on the host, which it is, it will print that error each time puppet agent runs and not attempt to contact the puppet master again, resulting in a ""stalemate"" whereby an admin needs to remove the above file,  before the agent can contact the master again.

I don't believe that this is intended behaviour. It results in admin intervention which can be avoided if the node certificate is not kept on local disk if it it mismatches the SSL key, thereby allowing the scenario of an admin removing the certificate from the master and allowing the agent to perform the enrollment process. This is necessary in situations where access to the agent is limited/restricted for various reasons.

In summary: if an agent retrieves a certificate from a puppet master and it mismatches the local private key it should be discarded and not kept on local disk to avoid having to remove the cert manually.",Bug,PUP-7903,[],Do not cache invalid node certificate from puppet master
"A heredoc set to [suppress the final line break|https://docs.puppet.com/puppet/5.1/lang_data_string.html#suppressing-the-final-line-break] also converts double line breaks into single line breaks.

{code:title=Without suppression (END)}
❯ cat test.pp 
notice(@(END))
line1
line2

line4
END
❯ puppet apply test.pp 
Notice: Scope(Class[main]): line1
line2

line4

Notice: Compiled catalog for marla.local in environment production in 0.03 seconds
Notice: Applied catalog in 0.01 seconds
{code}

{code:title=With suppression (-END)}
❯ cat test.pp 
notice(@(END))
line1
line2

line4
-END
❯ puppet apply test.pp
Notice: Scope(Class[main]): line1
line2
line4
Notice: Compiled catalog for marla.local in environment production in 0.03 seconds
Notice: Applied catalog in 0.01 seconds
{code}

{{-END}} should only supress the final line break.",Bug,PUP-7902,[],Heredoc with hyphen strips extra newlines
"We are running an environment of RHEL 6 and 7 and recently started puppetizing our Mac computers as well. When puppetizing the macs, we wanted to use the Homebrew module found in the [forge|https://forge.puppet.com/thekevjames/homebrew]. After doing no more than adding this module to our Puppetfile, RHEL 6 systems could no longer run Puppet. These systems throw the following error:


{code:bash}
Info: Loading facts
Error: Could not autoload puppet/provider/package/brew: /var/lib/puppet/lib/puppet/provider/package/brew.rb:99: syntax error, unexpected ':', expecting ')'
...o, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:100: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:106: syntax error, unexpected ':', expecting ')'
...*install_options], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:123: syntax error, unexpected ':', expecting ')'
...l, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:124: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:134: syntax error, unexpected ':', expecting ')'
...e, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:135: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
Error: Could not autoload puppet/type/package: Could not autoload puppet/provider/package/brew: /var/lib/puppet/lib/puppet/provider/package/brew.rb:99: syntax error, unexpected ':', expecting ')'
...o, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:100: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:106: syntax error, unexpected ':', expecting ')'
...*install_options], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:123: syntax error, unexpected ':', expecting ')'
...l, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:124: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:134: syntax error, unexpected ':', expecting ')'
...e, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:135: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
Error: Could not retrieve catalog from remote server: Could not intern from text/pson: Could not autoload puppet/type/package: Could not autoload puppet/provider/package/brew: /var/lib/puppet/lib/puppet/provider/package/brew.rb:99: syntax error, unexpected ':', expecting ')'
...o, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:100: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:106: syntax error, unexpected ':', expecting ')'
...*install_options], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:123: syntax error, unexpected ':', expecting ')'
...l, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:124: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:134: syntax error, unexpected ':', expecting ')'
...e, resource_name], failonfail: true)
                              ^
/var/lib/puppet/lib/puppet/provider/package/brew.rb:135: syntax error, unexpected tASSOC
    rescue Puppet::ExecutionFailure => detail
                                      ^
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{code}

It appears that these systems, which are limited to Ruby 1.8.7, are attempting to compile the providers included Homebrew module despite having no references to it and the providers being constrained to Darwin systems.

A work around is to have the Macs on a separate environment with just the Homebrew module added to the Puppetfile. But, that's not a good solution.",Bug,PUP-7901,"['compile', 'provider', 'ruby']",Puppetized systems compile providers constrained to other systems
"I have a PE master/agent setup.  I can log onto the agent and set the environment to anything I want (doesn't have to exist on the master, but in my case did).  But after I do the CLI will not let me change it back to production.  And it won't even let me ask it what the environment is.  I can recover from this by editing the puppet.conf manually on the agent.  

logged onto an agent and ran this...
[root@mq0vlyukbz5upn8 ~]# puppet config print environment
production
[root@mq0vlyukbz5upn8 ~]# puppet config set environment nc_orch_agent_environment_settings --section main
[root@mq0vlyukbz5upn8 ~]# puppet config print environment
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!': Could not find a directory environment named 'nc_orch_agent_environment_settings' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29:in `push_application_context'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:346:in `run'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'
	from /opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
[root@mq0vlyukbz5upn8 ~]# puppet config set environment production --section main
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!': Could not find a directory environment named 'nc_orch_agent_environment_settings' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29:in `push_application_context'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:346:in `run'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'
	from /opt/puppetlabs/puppet/bin/puppet:5:in `<main>'
[root@mq0vlyukbz5upn8 ~]#

",Bug,PUP-7900,[],Can't set agent env back to production with CLI
PUP-6364 addressed a flaw in the AIX package provider where using 'ensure => latest' failed to upgrade a package if it was already installed. The existing acceptance test for the AIX package provider needs to be updated to ensure that the desired behavior for this meta-parameter does not regress.,Task,PUP-7899,[],acceptance: Update aix package test to validate 'ensure => latest'
"Add a ""tasks"" feature to enable feature flagging logic supporting tasks in the puppet code base.",New Feature,PUP-7898,[],Add a --tasks feature flag / setting
"Aix 5.3 mount tests are failing.

We found the root cause: New 5.3 images are up and they use jfs2, not jfs. Updating the test suite should fix the issue",Bug,PUP-7893,[],AIX 5.3 tests/resource/mount/mounted.rb failure
"It should be possible to ask the Puppet Loader system for a list of all loadable values (functions, tasks, plans, types).",New Feature,PUP-7892,[],Add discovery to the Puppet Loader system
"In https://github.com/puppetlabs/r10k/issues/760, users noticed warnings indicating stack too deep when using r10k with puppet-agent and having more than one version of a dependency of r10k installed. As noted in https://github.com/puppetlabs/r10k/issues/760#issuecomment-325825267, it is because of how rubygems behaves when doing version selection, and also because of how the version of the hiera and puppet gems are declared in their gemspecs.",Task,PUP-7889,['maintenance'],Begin hardcoding puppet version into gemspec
"After updating the Windows DSC module with the latest resources, the acceptance tests were failing setup due to plugin cache failing to synchronise files with deep directories

{code}
$ puppet agent -t --trace
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Error: Could not set 'file' on ensure: No such file or directory @ dir_s_mkdir - C:/ProgramData/PuppetLabs/puppet/cache/lib/puppet_x/dsc_resources/xSQLServer/DSCResources/MSFT_xSQLServerAlwaysOnAvailabilityGroupDatabaseMembership/en-US/MSFT_xSQLServerAlwaysOnAvailabilityGroupDatabaseMembership.strings.psd120170829-2800-rxsfcz.lock
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:182:in `mkdir'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:182:in `mkdir'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:175:in `locking'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:38:in `block in initialize'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:134:in `create_tmpname'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:28:in `initialize'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util.rb:453:in `new'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util.rb:453:in `replace_file'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/file.rb:854:in `write'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:87:in `contents_sync'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/file/content.rb:121:in `sync'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/file/ensure.rb:66:in `block (2 levels) in <module:Puppet>'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/property.rb:487:in `set'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/property.rb:561:in `sync'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/file/ensure.rb:186:in `sync'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:236:in `sync'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:134:in `sync_if_needed'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:80:in `perform_changes'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:21:in `evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:224:in `apply'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:240:in `eval_resource'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `call'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block (2 levels) in evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util.rb:386:in `block in thinmark'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util.rb:385:in `thinmark'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block in evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:118:in `traverse'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:154:in `evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:159:in `with_destination'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/report.rb:137:in `as_logging_destination'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer/downloader.rb:13:in `evaluate'
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer/plugin_handler.rb:20:in `download_plugins'
{code}

It appears that the ruby mkdir function is hitting the MAX_PATH limit (https://msdn.microsoft.com/en-us/library/aa365247.aspx#maxpath)

Due to this failure we cannot update the DSC module with the SQL Server resources and it's only a matter of time until another module hits this issue.

Instead perhaps puppet should use the UNC style naming which support 32,000 path lengths instead.",Bug,PUP-7888,[],Pluginsync modules with deep directories fail on Windows
"The current Cisco testing pipeline requires frequent manual reconfiguration because :
- There's no passed parameter that controls what branch and SHA in [cisco-network-puppet-module] we want to run from.
- We frequently jump back and forth between puppet agent version 5.0.x and 1.10.x.

I want to add the following ENV variables/parameters to the Cisco pipeline :
- cisco-network-puppet-module branch
- cisco-network-puppet-module SHA (default HEAD)
- cisco-network-node-utils branch (defaults to the branch name of cisco-network-puppet-module)
- cisco-network-node-utils SHA (default HEAD)

Scope of this ticket includes the JJB work needed to add these parameters, and some presuite work needed to take the cisco-network-node-utils branch and SHA, build the gem and load it to puppet master and switch under test.
",Task,PUP-7887,[],Cisco Pipeline Reorg
"""Enum[foo, 1]"" parses in ruby but not in java
com.puppet.pcore.TypeResolverException: Invalid parameter type specified: 'Enum' requires parameter 1 to be a 'String', Long provided

I don't how important this is.",Bug,PUP-7885,[],Enum accepts arguments that are not strings
Conduct a test audit since we're doing a rewrite to determine if any of the tests can be removed or scoped to a lower test tier.,Task,PUP-7884,['scheduled_task'],Scheduled task test audit
"* jruby-ldap does not provide a to_hash method - add a ldap_entry_to_hash() method based on jruby-ldap PR#5
* the environment parameter from ldap was accessed with a string instead of a symbol (or the PR#5 in jruby-ldap did not replicate ruby-ldap's behaviour correctly)
* remove environment from parameters hash to prevent duplicate declaration error
* downcase key in ldap_entry_to_hash for consistent key names and to ensure acceptable puppet variable names (first char needs to be lowercase in any case)

See also: SERVER-711, https://github.com/jruby/jruby-ldap/pull/5, https://groups.google.com/forum/#!topic/puppet-users/DKu4e7dzhvE",Bug,PUP-7883,[],Make node_terminus=ldap working with jruby/puppetserver
"Hi,

In brief, it will be convenient to be able to set a kind of default value in the {{lookup()}} function where this default value is merged with the ""normal"" value of the lookup. Now I try to give an example below to explain more precisely my idea.

Suppose that I have a module {{mymod}} which has a parameter {{var}} which is a hash. Suppose that the default merge policy of this parameter {{mymod::var}} is {{deep}}. Now, I have a ""role"" class called {{myrole}} which inlcudes the class {{mymod}}. In this role, I need to set the {{var}} parameter to a specific value. So, for instance, in my hierarchy, I can set this in the file {{fqdn/$fqdn.yaml}}:

{code:yaml}
---
mymod::var: { ... a specific value... }
{code}

With the 'deep' merge policy, I have *easily* and *exactly* the value I want for my role.

But the problem is: this specific and final value of {{mymod::var}} is *intrinsic to my role*. I don't want the ""hiera user"" to be able to change this value in my role class because, if it is set to another value, my role has no meaning.

So I would like to set this value directly in the body of my role class with something like that (the code is not currently valid of course because the feature doesn't exist yet):

{code:puppet}
class myrole {

  $options = {
    'default_merged_value' =>  { ... a specific value... },
  }
  $specific_value_for_this_role = lookup('mymod::var', $options)

  class {'mymod':
    var => $specific_value_for_this_role,
  }
}
{code}

Of course, this lookup option {{default_merged_value}} currently doesn't exist. The idea is:

1. the {{lookup()}} makes its normal job of lookup...
2. ... except that the {{default_merged_value}} is merged too in the lookup according to the current merge policy.

I hope I'm clear...

Maybe my request is not relevant (I don't think so but maybe I'm wrong), maybe it's not desirable, or maybe it is not easy to implement etc. Anyway, feel free to close this ticket if needed.

Thanks for reading me. :)

PS: edit typo",New Feature,PUP-7882,[],lookup() function: set a kind of default value which is merged
"I was testing a development built version of the puppet gem. The system in questions has Ruby 2.0.0 which causes a warning to be printed. However its always printed in Japanese

{code}
[root@vok2pfwd7v6dx6t ~]# puppet --help
Warning: rubyバージョン2.0.0のサポートは廃止予定であり、今後のリリースで廃止されます。サポートされているrubyのバージョンについては、https://docs.puppet.com/puppet/latest/system_requirements.html#rubyを参照してください。
   (/usr/local/share/gems/gems/puppet-5.1.0.118/lib/puppet.rb:134:in `<module:Puppet>'において)

Usage: puppet <subcommand> [options] <action> [options]

Available subcommands:

  agent             The puppet agent daemon
  apply             Apply Puppet manifests locally
  ca                Local Puppet Certificate Authority management. (Deprecated)
  catalog           Compile, save, view, and convert catalogs.
  cert              Manage certificates and requests
  certificate       Provide access to the CA for certificate management.
  certificate_request  Manage certificate requests. (Deprecated)
  certificate_revocation_list  Manage the list of revoked certificates. (Deprecated)
  config            Interact with Puppet's settings.
  describe          Display help about resource types
  device            Manage remote network devices
  doc               Generate Puppet references
  epp               Interact directly with the EPP template parser/renderer.
  facts             Retrieve and store facts.
  filebucket        Store and retrieve files in a filebucket
  generate          Generates Puppet code from Ruby definitions.
  help              Display Puppet help.
  key               Create, save, and remove certificate keys. (Deprecated)
  lookup            Interactive Hiera lookup
  man               Display Puppet manual pages.
  master            The puppet master daemon
  module            Creates, installs and searches for modules on the Puppet Forge.
  node              View and manage node definitions.
  parser            Interact directly with the parser.
  plugin            Interact with the Puppet plugin system.
  report            Create, display, and submit reports.
  resource          The resource abstraction layer shell
  status            View puppet server status. (Deprecated)

See 'puppet help <subcommand> <action>' for help on a specific subcommand action.
See 'puppet help <subcommand>' for help on a specific subcommand.
Puppet v5.1.0
[root@vok2pfwd7v6dx6t ~]#
{code}

I only have the LANG environment variable set to its default

LANG=en_US.UTF-8

So something weird is happening while things are initializing.",Bug,PUP-7881,[],puppet gem prints ruby version warning in Japanese
"The console logger (amongst others) makes assumptions that strings can be concatenated as passed - https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/log/destinations.rb#L167

{code}
str = msg.source == ""Puppet"" ? str : ""#{msg.source}: #{str}""
{code}

This assumes that the logger has made all attributes of the log message match encodings (as UTF-8) prior to handing off a message with {{handle}}, so that each individual logger is not responsible for doing so - the call to {{dest.handle(msg)}} is at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/log.rb#L187

It is possible (reproducible through Cygwin on Windows) to get a source that represents a Puppet file resource path, with an encoding of IBM437... and a message of UTF-8 containing characters above the 7-bit ASCII range (that were converted form IBM437 as part of PUP-5756 / https://github.com/puppetlabs/puppet/commit/c47be2d3b3d002f02cbed6edee8dfee119152b46).  When this happens, Ruby will fail to concatenate the incompatible strings and crash (without actually mentioning the logger that caused the crash). 

For instance when {{source}} is in {{IBM437}} as
{code}
/Stage[main]/Main/File[c:/temp/unicode_dir_ㅀㅅㅶㅅㅲㅂㅄㅉㅑㅧㅩㅙㅘ]/require
{code}

and message in UTF-8 is 

{code}
subscribes to File[c:/temp]
{code}

as reproducible (only through Cygwin / Beaker) with the manifest:

{code}
file { ""c:/temp"":
  ensure => directory
}

file { ""c:/temp/unicode_dir_ㅀㅅㅶㅅㅲㅂㅄㅉㅑㅧㅩㅙㅘ"":
  ensure  => directory,
  require => File['c:/temp']
}

user { ""bob"":
  ensure     => present,
  groups     => 'Users',
  managehome => true,
  password   => ""L0v3Pupp3t!""
}

acl { ""c:/temp/unicode_dir_ㅀㅅㅶㅅㅲㅂㅄㅉㅑㅧㅩㅙㅘ"":
  permissions => [
    { identity => 'bob', rights => ['full'] },
  ],
}
{code}


{code}
Error: Failed to apply catalog: incompatible character encodings: IBM437 and UTF-8
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log/destinations.rb:167:in `handle'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:187:in `block in newmessage'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:186:in `each'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:186:in `newmessage'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:304:in `initialize'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:87:in `new'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:87:in `create'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/logging.rb:12:in `send_log'
  C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/logging.rb:40:in `debug'
{code}


This was discovered while executing tests against the ACL module and Puppet 5 https://github.com/puppetlabs/puppetlabs-acl/pull/111  and is a net new problem as a result of PUP-5756. This is not a problem in the Puppet 4.10 series.

",CI Blocker,PUP-7880,"['i18n', 'utf-8', 'windows']","When logging mixed encoding strings, Puppet may fail"
"We need to have a configuration of the Language runtime behind an API for the bolt CLI tool (to allow changes to be made behind this API). Behind the API we need to configure parsing and validation.

Depending on how packaging is done we may need a feature flag to turn on the behavior to support plans.

Depending on how settings are initialized, we need a ticket for that.

We need a ticket for the API itself.

We need a different validator (to flag catalog constructs as errors) - it is not essential to have, without it catalog related things are simply silently ignored.",New Feature,PUP-7879,[],Configure Language runtime
"After upgrading the puppet version on a puppet server from 5.0.1 to 5.1.0 puppet runs on all nodes referencing that master now fail with the same type of error. Downgrading the server's puppet version back to 5.0.1 results in no errors again. 

The bug appear to be related to PUP-7670. 

{code}
[root@puppet ~]# puppet agent -t
Info: Using configured environment 'infrastructure'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, uninitialized constant Puppet::Pops::Types::PClassType at /etc/puppetlabs/code/environments/infrastructure/modules/puppetdb/manifests/master/config.pp:4:34 on node puppet.mydomain}}

When looking at the code referenced, it appears that it is choking on a very common template
{{class puppetdb::master::config (
  $puppetdb_server             = $::fqdn,
  $puppetdb_port               = defined(Class['puppetdb']) ? {
{code}

ie - the {{defined(Class\['foo'])}} is what causes the problem. On playing on other nodes, not the puppet master, I see the same error in various different modules, depending on what the node requires.  For example, on a webserver node using Apache the line that trips this up is:

{code}
[root@mezabaan1 ~]# puppet agent -t
Info: Using configured environment 'application'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, uninitialized constant Puppet::Pops::Types::PClassType at /etc/puppetlabs/code/environments/application/modules/apache/manifests/service.pp:27:8 at /etc/puppetlabs/code/environments/application/modules/webserver/manifests/static.pp:77 on node mezabaan1.mydomain
{code}
{code:puppet}
if ! defined(Class\['apache::params'])
{code}

I can replicate the exact same error in my own modules using the same code pattern. 
{code}
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, uninitialized constant Puppet::Pops::Types::PClassType at /etc/puppetlabs/code/environments/application/modules/ntpd/manifests/config.pp:5:8 on node mezabaan1.mydomain
{code}

{code:puppet}
define ntpd::config (
  Array[String] $local_servers = [],
) {
 
if ! defined( Class['ntpd::master'])
{code}

etc etc.
",Bug,PUP-7878,['puppet-agent'],Change in Puppet type management breaks defined class checks
Epic for Intermediate CA improvements that did not make the cut for initial iteration.,Epic,PUP-7877,[],Future Work for Intermediate CA Improvements
"This was noticed when running the {{imaging}} acceptance test suites for latest Puppet-Agent () against the Packer Built Windows Images.

The {{win-2012r2-ja-x86_64}} fails with test: {{tests/reports/cached_catalog_status_in_report.rb}} failing.

There is also a log of ""strange"" output in the build log - see the log after elapsed time {{01:33:17.686}}

The build log is available at: https://jenkins-imaging.delivery.puppetlabs.net/view/Win-Acpt/job/imaging_windows-2012r2-ja_x86_64_vmware_vsphere.cygwin_acceptance_packer/17/consoleFull

Unsure where this issue should be logged, so starting with {{PUP}} and will check with [~larissa]
",Bug,PUP-7876,['windows'],Puppet Acceptance Suite Fails for Win-2012r2 Japanese
"Add a function {{run_task(Task $t, Array[String] $hosts = [])}} that runs the referenced instance of {{Task}} on the given set of hosts. Such that
* if $hosts is not given, then it will run on the local host

As an intermediate step, a mocking version of this function will instead accept any Object as a simulation of a real Task. The function will initially do a notice of the type for feedback, and return a 'result' attribute if an 'exit' attribute is non existing or '0', and the exit code otherwise. This allows mocking up  examples with fake tasks (before they can be loaded).",New Feature,PUP-7875,[],Add a run_task function
"Everywhere in the Puppet documentation where the default file serving mount points are listed, the list should be updated to include the new 'tasks' mount point. The extant default mount points are 'modules', 'plugins', and 'pluginfacts'.

The pre-docs for this are [in a PR, waiting to be merged into the Puppet repo|https://github.com/puppetlabs/puppet/pull/6147/files].",Sub-task,PUP-7874,[],Docs for tasks file serving end point
"There may be some custom event log dependencies on the puppetres.dll (sp).

This is a research ticket to determine those dependencies, if any, and to create tickets to mitigate the dependencies.",Task,PUP-7873,[],Windows Custom event log - Research puppetres.dll dependencies 
"Detail the steps to uninstall the custom event log on uninstall.

Do we allow the user to optionally leave the event log?",Task,PUP-7872,[],Windows - Custom event log remove on uninstall
Detail the steps required to allow the user to name the custom event log destination (name).,Story,PUP-7871,[],Custom event logging - integration with the puppet installer
,Epic,PUP-7870,[],Windows - Custom event logging v.next
"puppet.conf configuration setting will list the name of the new event log.  
If the event log does not exist, one with the corresponding name should be created.  
If creation fails, log the failure and redirect event logs to the system default.",Task,PUP-7869,[],Create new event log if one does not exist
"At a minimum the custom event log name will be stored in the puppet.conf file.
Any other related settings should be documented.",Task,PUP-7868,[],Document the settings required to set custom eventlog 
"puppet.conf will store the name of the custom eventlog name.  Puppet will need to be able to read this value in order to log to custom eventlog.

In absence of this value, or if there is an error attempting to log to the custom setting the the logging should go to the system default eventlog.",Task,PUP-7867,[],Read the name of the custom eventlog from puppet.conf
"When installing a module using the system tar, the PMT will filter filesystem permissions to a sane value. This may just be based on the user's umask.

When using minitar, files are unpacked with whatever permissions are in the tarball. This is potentially unsafe, as tarballs can be easily created with weird permissions.",Bug,PUP-7866,['Security'],PMT unpacks modules with tarball permissions when using minitar
"Tasks as defined by the Puppet orchestrator task scripts and metadata should be loadable as data types derived from a base type of {{Puppet::Task}}.
A task is represented under the directory {{<root>/tasks}}, (or possibly (need confirmation)) in a nested directory where the nested directory names form a nested namespace under the module or environment where it resides.

The {{Puppet::Task}} data type holds the definition of the attributes common to all tasks (for example if it supports noop mode (attribute names to be taken from the relevant specification of task metadata)).

A task is represented by:
* a file under {{<root>/tasks}} that is not a metadata file
* a (non metadatafile) and a metadatafile with the same name but different suffix
* (possibly  in later version) only a metadata file

When there is no metadata file, the resulting type should be instantiable with an arbitrary Data compliant Hash. As an example:
{code:puppet}
Mymodule::Echo({x => 10, free_fantasy => 'hello', whatever => [1,2,3]})
{code}

Since we cannot define a datatype that accepts arbitrary parameters our definition of the type is perhaps that it has {{Array\[Parameter]}} as an attribute. (This needs to be designed). It is perfectly fine to have an additional abstract data type for the ""anything goes"" case if that helps. 
",New Feature,PUP-7864,[],Add a data type loader for tasks
"The {{Default}} type, which maps to the {{default}} keyword in the puppet language is not part of the {{RichData}} variant. This is wrong. It must be possible to pass the {{default}} as {{RichData}}.",Bug,PUP-7863,[],The Default type is not considered RichData
"The implementation assumes that all values assignable to {{ScalarData}} also inherits from {{ScalarData}}. This means that an {{Optional}}, {{NotUndef}}, or {{Variant}} type that is limited to contain {{ScalarData}} types still isn't assignable to {{ScalarData}}.

The same problem applies to {{Scalar}}.
",Bug,PUP-7862,[],Optional types are not assignable to Data and RichData
"Instructions for running beaker locally in the file {{acceptance/README.md}} seem to be broken in master.

I've been running using:
{noformat}
CONFIG=config/nodes/centos6-local.yaml SHA=#{test-commit-sha} GIT_SERVER='192.168.80.1' FORK='puppet' bundle exec rake --trace ci:test:git
{noformat}

As suggested by the instructions, I encountered 2x failures:

*Errored build: Unable to yum install rubygem-json*
Fix was to use a centos7 vagrant box which already has ""Development Tools"" metapackage installed

*Errored build:  Unable to checkout puppet from git*
{noformat}
...SNIP
    Don't run Bundler as root. Bundler can ask for sudo if it is needed, and
    installing your bundle as root will break this application for all non-root
    users on this machine.
    Fetching https://github.com/puppet/puppet.git
    fatal: Needed a single revision
    Revision 15ffe6b31 does not exist in the repository
    https://github.com/puppet/puppet.git. Maybe you misspelled it?
  
  all-in-one executed in 226.35 seconds
  Exited: 11
  Beaker::Host::CommandFailure: Host 'all-in-one' exited with 11 running:
...SNIP
{noformat}

This turns out to be the build system not using the GIT_SERVER environment variable.  I had a quick scan through the code and couldn't see it being used anywhere.  I came up with a hacky workaround by editing {{acceptance/setup/git/pre-suite/010_TestSetup.rb}} around line 35 to just hardcode to the git server I setup (git daemon, as per instructions):

{noformat}
        gemfile_contents = <<END
source '#{ENV[""GEM_SOURCE""] || ""https://rubygems.org""}'
gem '#{repository[:name]}', :git => 'git://192.168.0.1/puppetlabs-puppet.git', :ref => '#{ENV['SHA']}'
# gem '#{repository[:name]}', :git => '#{repository[:path]}', :ref => '#{ENV['SHA']}'
END
{noformat}

After making these two changes, it looks like the beaker tests are mostly working, but it would be great to get the instructions updated/helpers fixed to make life easier for those contributing patches",Bug,PUP-7861,[],beaker instructions at ./acceptance/readme seem to be wrong
"Test:

The functions all and any are very useful to have as the alternative is to write a somewhat awkward reduce where lots of values are potentially skipped.
The all and any should follow the puppet iterative function convention of one or two keys being the index/key and value.",Task,PUP-7859,[],Test Add functions 'all' and 'any'
"Currently only some of the subcommands listed when running `puppet help` are translated. This is because only Puppet Faces pulled these summaries into standalone strings. Applications extract the summary from a large heredoc that provides the full help text for the subcommand. The full subcommand text should not be translated, but the summary messages should be, since `puppet help` is such a visible entry point for the software. We need to isolate the summary strings from the full subcommand help text.",Bug,PUP-7858,[],`puppet help` output contains untranslated subcommand summaries
"In the recent refactor of the GettextSetup initialization code, a reference to the GettextSetup gem in the module initialization code was left unguarded, which means that sometimes (e.g. in Puppet Server unit tests), the method is called before GettextSetup has been required. This would also fail if GettextSetup had failed to load. We need to refactor this to behave correctly if GettextSetup is not present.",Bug,PUP-7857,[],Module initialization code attempts to use GettextSetup before it has been required
"When serializing the {{default}} value using the {{ToDataConverter}}/{{FromDataConverter}} pair, the value is serialized as:
{code:json}
{""key"":{""__pcore_type__"":""Default""}}
{code}
even when {{rich_data}} is not enabled.",Bug,PUP-7855,[],Rich data is used for serializing symbols even when rich_data is not enabled.
"Customer is reporting warnings when using the Default data type as the parameter to a class.

For example, this code:

{code}
# cat manifests/site.pp
node default {
  class { 'test':
    var => default,
  }
}

# cat modules/test/manifests/init.pp
class test (
  Variant[String, Default] $var,
) {
  if $var =~ String {
    $content = ""foo='${var}'""
  } else {
    $content = ""# Using the default value for foo""
  }
  file { '/tmp/foo':
    ensure  => 'file',
    content => $content,
  }
}

# puppet agent -t
{code}

Succeeds, with this warning:

{code}
WARN [puppetserver] Puppet Resource 'Class[Test]' contains a Symbol value. It will be converted to the String 'default'
{code}

This seems to be an indirector/serialization issue. No warning is generated if you replace if you replace the Default data type with the Undef data type in the above code, but ...

This customer is using the pattern similar to Variant [ Default, String ] because often when specifying configuration to a program or service specifying a value will override its default. When any string is a valid value to the parameter then matching strings like '' or 'DEFAULT' to force not specifying a string is less than ideal as those are potentially valid values.

Using undef is a possibility, however, it is then impossible to specify that a default value should be used in preference to any Hiera lookup.

That is:

{code}
class { test: 
  var => undef 
}
{code}

will always defer to a Hiera lookup.

If you want to explicitly say ""ignore Hiera, use the default"" then: 

{code}
class { test: 
  var => default 
}
{code}

is an effective way of doing that, allowing the writer of that Puppet module to intentionally override any values which may get specified in Hiera (e.g. a policy which implements a single particular behavior).",Improvement,PUP-7854,[],Handle Default type in Puppet Serialization
"Before this, a type alias of an {{Object}} type would have to be
declared like this:
{code:puppet}
type MyType = Object[{ ... }]
{code}

This new feature makes the brackets optional for the {{Object}} type so that
the above expression can be written:
{code:puppet}
type MyType = Object { ... }
{code}

This feature also makes the type reference {{Object}} optional and allows this to have the same meaning:
{code:puppet}
type MyType = { ... }
{code}

The {{Object}} can also be replaced by some other data type reference, in which case it
becomes the parent type. Thus, this description:
{code:puppet}
type MyType = Object[{ parent => ParentType, ... }]
{code}

can now be written like this:
{code:puppet}
type MyType = ParentType { ... }
{code}
",New Feature,PUP-7853,[],Add short form type definition
"Before this, a {{constant}} in an {{Object}} required a full specification of an {{attribute}} setting {{kind}} to {{constant}}, and then specifying both {{value}} and {{type}}. This is in almost all cases excessive and makes simple definition of objects long.

To make constants easier to define - it should be possible to specify constants with just name and value and let the data type of the value determine the constant's data type.

This example:
{code:puppet}
constants => { size => 10}
{code}
is equivalent to the long form:
{code:puppet}
attributes => { size => { kind => constant, type => Integer, value => 10} }
{code}
The two forms are interchangeable.

The inferred data type for the constant is made generic to the base data type. If a more restricted data type is wanted, the long form must be used. When overriding a constant with the same name in a parent type, the constant must be of a compliant type. When using the short form to override, the resulting data type is inherited from the base type. If a narrowing of the type is wanted when overriding the long form must be used.",New Feature,PUP-7852,[],Simplify definition and override of constants in Object
"The puppet language should support the notion of a ""plan"" such that:

* a plan created in the language with the syntax (example)
{code}
plan mymodule::my_plan(String $msg) {
  # doing lots of things with tasks
}
{code}
* a plan is either defined in the ""main manifest"" or is autoloaded:
** from a module with the name of the first part of a plan's fully qualified name
** from the environment
** with autoloading taking place from <root>/plans
* can be invoked by calling the function {{run_plan(String $plan_name, Hash\[String, Any] $args = \{})}}",New Feature,PUP-7850,[],Add plan to puppet language
"When puppetmaster starts first time (with a reboot) , it's not working web, a lot of errors:
 09:59:27 puppet-pre puppet-master[1599]:    (at /usr/lib/ruby/vendor_ruby/pu                                                                                         ppet/settings.rb:1141:in `issue_deprecation_warning')
Aug 18 09:59:28 puppet-pre puppet-master[1620]: Reopening log files
Aug 18 09:59:28 puppet-pre puppet-master[1620]: Starting Puppet master version 3.8.                                                                                         7
Aug 18 09:59:43 puppet-pre puppet-master[1620]: Removing mount ""war_files"": /WAR do                                                                                         es not exist or is not a directory
Aug 18 09:59:43 puppet-pre puppet-master[1620]: Removing mount ""filecopy_data"": /FI                                                                                         LES does not exist or is not a directory
Aug 18 09:59:43 puppet-pre puppet-master[1620]: ""\xC3"" on US-ASCII
Aug 18 09:59:43 puppet-pre puppet-master[1620]: ""\xC3"" on US-ASCII
Aug 18 09:59:44 puppet-pre puppet-master[1620]: ""\xC3"" on US-ASCII
Aug 18 09:59:44 puppet-pre puppet-master[1620]: ""\xC3"" on US-ASCII

but if you stop it manualy and restarts, it works correctly.
",Bug,PUP-7849,[],"Error  ""\xC3"" on US-ASCII when puppetmasters stars first time"
"Hi,

The following EPP snippet compiles with no issues and in a timely manner

{noformat}
USER='<%= $hg_oais::archivematica::requirements::automation_tools::user %>'
{noformat}

however this one (note the capitals) ends up in a catalog request that never finishes, indefinitely consuming 100% CPU in the thread where the jRuby instance assigned to compile is running.

{noformat}
USER='<%= $hg_oais::archivematica::requirements::automation_tools::USER %>'
{noformat}

No timeouts/errors master-side, nothing, just huge CPU usage forever.

The variable name ought have no capitals indeed but the master should either fail or resolve to empty, but never hang.

We're using Puppet agent 1.9.3 (Puppet 4.9.4) and Puppetserver 2.7.2. No attempts to hit the bug using Puppetserver5 were made so far.

!2.png|thumbnail! shows how two threads that had to compile that code have been consuming a large amount of CPU hours. That time roughly matches the time lapsed between the moment when the compilation request was issued and the time when the screenshot was taken. We don't see that pattern on masters that never saw that snippet.

Could you please try to reproduce the issue?

Thanks.

(CERN internal reference: AI-4900)",Bug,PUP-7848,[],Capitals in variable names in EPP templates hang threads forever
"With the current change in https://github.com/voxpupuli/puppet-rabbitmq/pull/504 (which still needs some work), I get:
Error: Failed to apply catalog: undefined method `source' for (provider=rabbitmqadmin):Puppet::Type::Rabbitmq_binding::ProviderRabbitmqadmin

when the parameter source does exist (if I take the parameter out of the type, I get a different error).

It seems like this was discussed in: https://projects.puppetlabs.com/issues/15046
but unclear if that was ever migrated to the new ticket system, and seems like it may never have been actually fixed?",Bug,PUP-7847,[],undefined method error when title_patterns isn't matched
"When running puppet using a different language setting, it fails to use the configured LANG
language on redhat 7.3 on Power8 systems:

{code}
[root@power8-rhel73-3 locale]# LANG=ja_JP.utf8 puppet crazy
Error: Unknown Puppet subcommand 'crazy'
See 'puppet help' for help on available puppet subcommands
[root@power8-rhel73-3 locale]#
{code}

On Intel based redhat systems puppet(1) would print out the above messages in Japanese, which is the expected behavior.

The locale is listed as supported by the system:

{code}
[root@power8-rhel73-3 locale]# locale -a | grep ja_JP
ja_JP
ja_JP.eucjp
ja_JP.ujis
ja_JP.utf8
[root@power8-rhel73-3 locale]#
{code}

And all the .po files exist on the system:

{code}
root@power8-rhel73-3 locale]# pwd
/opt/puppetlabs/puppet/share/locale
[root@power8-rhel73-3 locale]# find . -type f -print
./config.yaml
./es/LC_MESSAGES/puppet.mo
./es/puppet.po
./fr/LC_MESSAGES/leatherman_locale.mo
./fr/LC_MESSAGES/leatherman_logging.mo
./fr/LC_MESSAGES/puppet.mo
./fr/puppet.po
./ja/LC_MESSAGES/puppet.mo
./ja/puppet.po
./puppet.pot
./out
./en_US/LC_MESSAGES/FACTER.mo
./ja_JP/LC_MESSAGES/FACTER.mo
[root@power8-rhel73-3 locale]#
{code}

If you set LANG wrong, we detect that and facter complains:

{code}
[root@power8-rhel73-3 locale]# LANG=ja puppet crazy
2017-08-15 17:37:21.973108 WARN  puppetlabs.facter - locale environment variables were bad; continuing with LANG=C LC_ALL=C
Error: Unknown Puppet subcommand 'crazy'
See 'puppet help' for help on available puppet subcommands
[root@power8-rhel73-3 locale]# 
{code}

As you can see this works correctly with date:

{code}
[root@power8-rhel73-3 puppet]# LANG=ja_JP date
2017ǯ  8�� 15�� ������ 17:42:18 EDT
[root@power8-rhel73-3 puppet]#
{code}

These same methods work on Intel based systems on Redhat versions.",Bug,PUP-7846,[],I18N LANG setting not honored when running puppet on redhat 7.3 on power8
"Apache 2.4 added the {{SSLCARevocationCheck}} setting, which controls the depth of revocation checking done for client certificates. Supporting leaf certificate revocation checking provides the same level of security as full chain checking when intermediate CAs are not used, and still provides a good level of security when intermediate CAs are in use.

The work required for full chaining (discussed in PUP-3788) is fairly involved, so while we're working on the larger picture we should support leaf revocation checking so that CRLs can be used in some form when intermediate CAs are in use.",New Feature,PUP-7845,[],Support leaf certificate CRL checking
"Recently when playing around with reports in irb, I discovered that the exit_status method raises an exception when called against a report from an interrupted (ctrl + c or other) puppet run.

{code}
irb(main):007:0> a.exit_status
NoMethodError: undefined method `[]' for nil:NilClass
        from /Users/matthaus/src/puppet/lib/puppet/transaction/report.rb:380:in `exit_status'
        from (irb):7
        from /usr/local/opt/ruby/bin/irb:11:in `<main>'
{code}

The metrics instance variable is not fully populated for that report and the lookups performed in the exit_status method are not safe with respect to metrics being an empty hash.",Bug,PUP-7844,[],A Puppet report from an interrupted run can cause exit_status to throw an exception
"The {{Checker4_0}} class, used for validating the AST produced by the puppet parser, keeps a list named [RESERVED_TYPE_NAMES|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/validation/checker4_0.rb#L360-L380]. This list is incomplete. It lacks the following entries:
{code:ruby}
    'init' => true,
    'object' => true,
    'sensitive' => true,
    'semver' => true,
    'semverrange' => true,
    'string' => true,
    'timestamp' => true,
    'timespan' => true,
    'typeset' => true,
{code}",Bug,PUP-7843,[],The list of reserved type names known to the parser validator is incomplete
"
SLES 11.3 32bit and 64bit

After rebooting the a system set up such that it should be logging in Japanese, it does not:

dtc5551owjlupna:~ # cat /etc/sysconfig/puppet
LANG=ja_JP.utf8
LC_CTYPE=ja_JP.utf8
LC_NUMERIC=""ja_JP.utf8""
LC_TIME=""ja_JP.utf8""
LC_COLLATE=""ja_JP.utf8""
LC_MONETARY=""ja_JP.utf8""
LC_MESSAGES=""ja_JP.utf8""
LC_PAPER=""ja_JP.utf8""
LC_NAME=""ja_JP.utf8""
LC_ADDRESS=""ja_JP.utf8""
LC_TELEPHONE=""ja_JP.utf8""
LC_MEASUREMENT=""ja_JP.utf8""
LC_IDENTIFICATION=""ja_JP.utf8""
LC_ALL=
dtc5551owjlupna:~ #

/var/log/messages:
Aug 14 14:37:34 dtc5551owjlupna puppet-agent[3290]: found_type_tst
Aug 14 14:37:34 dtc5551owjlupna puppet-agent[3290]: Applied catalog in 0.04 seconds


If I source the same file and run puppet I get the right locale. Although it
appears that we're seeing more messages (which is interesting):

dtc5551owjlupna:~ # date ; puppet agent -t ; tail -f /var/log/messages
2017年  8月 14日 月曜日 14:45:13 PDT
Info: JA:Ŭşīƞɠ ƈǿƞƒīɠŭřḗḓ ḗƞṽīřǿƞḿḗƞŧ 'production'
Info: JA:Řḗŧřīḗṽīƞɠ pluginfacts
Info: JA:Řḗŧřīḗṽīƞɠ plugin
Info: JA:Ƈȧƈħīƞɠ catalog ƒǿř dtc5551owjlupna.delivery.puppetlabs.net
Notice: found_type_tst
Info: JA:Ȧƥƥŀẏīƞɠ ƈǿƞƒīɠŭřȧŧīǿƞ ṽḗřşīǿƞ '1502747116'
Notice: JA:Ȧƥƥŀīḗḓ ƈȧŧȧŀǿɠJA: īƞ 0.08 şḗƈǿƞḓş
Aug 14 14:45:14 dtc5551owjlupna dhcpcd[4138]: exiting
Aug 14 14:45:15 dtc5551owjlupna puppet-agent[4132]: JA:Ŭşīƞɠ ƈǿƞƒīɠŭřḗḓ ḗƞṽīřǿƞḿḗƞŧ 'production'
Aug 14 14:45:15 dtc5551owjlupna puppet-agent[4132]: JA:Řḗŧřīḗṽīƞɠ pluginfacts
Aug 14 14:45:15 dtc5551owjlupna puppet-agent[4132]: JA:Řḗŧřīḗṽīƞɠ plugin
Aug 14 14:45:15 dtc5551owjlupna dhcpcd[4168]: exiting
Aug 14 14:45:15 dtc5551owjlupna dhcpcd[4169]: exiting
Aug 14 14:45:15 dtc5551owjlupna puppet-agent[4132]: JA:Ƈȧƈħīƞɠ catalog ƒǿř dtc5551owjlupna.delivery.puppetlabs.net
Aug 14 14:45:15 dtc5551owjlupna puppet-agent[4132]: found_type_tst
Aug 14 14:45:15 dtc5551owjlupna puppet-agent[4132]: JA:Ȧƥƥŀẏīƞɠ ƈǿƞƒīɠŭřȧŧīǿƞ ṽḗřşīǿƞ '1502747116'
Aug 14 14:45:15 dtc5551owjlupna puppet-agent[4132]: JA:Ȧƥƥŀīḗḓ ƈȧŧȧŀǿɠJA: īƞ 0.08 şḗƈǿƞḓş

Yet when I set everything in my environment to english and restart the service, I get japanese (as its configured and expected to do).

dtc5551owjlupna:~ # LANG=en_US.utf8
dtc5551owjlupna:~ # LC_CTYPE=en_US.utf8
dtc5551owjlupna:~ # LC_NUMERIC=""en_US.utf8""
dtc5551owjlupna:~ # LC_TIME=""en_US.utf8""
dtc5551owjlupna:~ # LC_COLLATE=""en_US.utf8""
dtc5551owjlupna:~ # LC_MONETARY=""en_US.utf8""
dtc5551owjlupna:~ # LC_MESSAGES=""en_US.utf8""
dtc5551owjlupna:~ # LC_PAPER=""en_US.utf8""
dtc5551owjlupna:~ # LC_NAME=""en_US.utf8""
dtc5551owjlupna:~ # LC_ADDRESS=""en_US.utf8""
dtc5551owjlupna:~ # LC_TELEPHONE=""en_US.utf8""
dtc5551owjlupna:~ # LC_MEASUREMENT=""en_US.utf8""
dtc5551owjlupna:~ # LC_IDENTIFICATION=""en_US.utf8""
dtc5551owjlupna:~ # LC_ALL=
dtc5551owjlupna:~ # date
Mon Aug 14 14:49:22 PDT 2017
dtc5551owjlupna:~ # puppet apply -e 'service { ""puppet"": enable => true, ensure => stopped }'
Notice: Compiled catalog for dtc5551owjlupna.delivery.puppetlabs.net in environment production in 0.22 seconds
Notice: /Stage[main]/Main/Service[puppet]/ensure: ensure changed 'running' to 'stopped'
Notice: Applied catalog in 0.16 seconds
dtc5551owjlupna:~ # puppet apply -e 'service { ""puppet"": enable => true, ensure => running }'
Notice: Compiled catalog for dtc5551owjlupna.delivery.puppetlabs.net in environment production in 0.22 seconds
Notice: /Stage[main]/Main/Service[puppet]/ensure: ensure changed 'stopped' to 'running'
Notice: Applied catalog in 1.71 seconds
dtc5551owjlupna:~ # tail /var/log/messages
Aug 14 14:49:24 dtc5551owjlupna dhcpcd[4569]: exiting
Aug 14 14:49:24 dtc5551owjlupna puppet-agent[4482]: JA:Ƈǿŭŀḓ ƞǿŧ JA:řŭƞ: SIGQUIT
Aug 14 14:49:26 dtc5551owjlupna dhcpcd[4601]: exiting
Aug 14 14:49:26 dtc5551owjlupna dhcpcd[4602]: exiting
Aug 14 14:49:26 dtc5551owjlupna dhcpcd[4631]: exiting
Aug 14 14:49:26 dtc5551owjlupna dhcpcd[4632]: exiting
Aug 14 14:49:28 dtc5551owjlupna dhcpcd[4658]: exiting
Aug 14 14:49:28 dtc5551owjlupna dhcpcd[4659]: exiting
Aug 14 14:49:28 dtc5551owjlupna puppet-agent[4662]: JA:Řḗǿƥḗƞīƞɠ ŀǿɠ ƒīŀḗş
Aug 14 14:49:28 dtc5551owjlupna puppet-agent[4662]: JA:Şŧȧřŧīƞɠ Ƥŭƥƥḗŧ ƈŀīḗƞŧ ṽḗřşīǿƞ 5.0.1
dtc5551owjlupna:~ #

There is something different about how the system starts the service during boot up that its not getting the configured language.
",Bug,PUP-7842,"['i18n', 'packaging', 'sles', 'triaged']",language for SLES 11.3 service not being set correctly during boot
"I was testing I18N when I noticed this error message, which is of limited help since the more important error message isn't converted:

Aug 14 10:57:04 mujnurmcsuht939 puppet-agent[1438]: FR:Ƈǿŭŀḓ ƞǿŧ ȧŭŧǿŀǿȧḓ puppet/type/type_tst: undefined local variable or method `asdf' for main:Object
",Bug,PUP-7841,[],autoload error message should convert more of the message
"Allow task file content to be fetched.

Requirements:
- Will allow access to the raw content of any file within the /tasks subdirectory of a module.
- Does not allow access to any other files.

There's prior art for this in the file_content mount point for /files and /plugins.

Confirmed with the Direct Change team that we need not worry about the existing issues with these endpoints -- namely, that they load entire files into memory. This will be fixed later.

Open questions:
- Are we going to be required to implement behavior for any other endpoints we don't care about, but are related, like file_metadata?",Story,PUP-7840,[],Mount point: file contents under /tasks in modules
"using http://nightlies.puppetlabs.com/puppet-agent-latest/repos/apt/trusty/pool/PC1/p/puppet-agent/

*scenario*:

agent is installed, There is no japanese translation for the agent. available locales is only english
We have a module that has both english and japanese locales available.

Despite the system/OS being set to the japanese locale, it will never display the japanese translation for the module errors/output.  

We can manually work around the issue by inserting FastGettext.locale='ja'
@
https://github.com/puppetlabs/puppet/blob/master/lib/puppet.rb#L96

*Expected behaviour:*
The agent should be able use available translations/locales for a module. Even if the agent does not have that locale translated yet.",Bug,PUP-7839,[],Setting locales fails for a module. if the agent does not have an equivalent locale available 
,Bug,PUP-7838,[],puppet service failed to start  
"
Problem:
We need to consider how exactly the configured language of puppet is determined
* when started as a service
* when started as a user


Short version:
Puppet agent uses the LANG/LANGUAGE settings of the process that starts it.
* If that's the system its during startup, its Posix/C
* If its restarting the puppet agent service
** on Rhel5/6 its the settings of the user
** on Rhel7 its the systemctl's daemons (Posix/C)
** Other systems are TBD (but likely similar)
* If that's a user its the users environment settings",Bug,PUP-7837,[],Need to consider how the language used by puppet is decided
"The problem occurs when including a class that might look like the following:

{code:puppet}
class test (
  String $var,
  Test::Options $opts
) {
}
{code}

Let's assume that Test::Options is defined as:

{code:puppet}
type Test::Options = Struct[{
  var => String
}]
{code}

If the 'var' parameter doesn't get passed to the test class, an evaluation error would be generated as expected. This works indeed.

However, one would expected to see the same evaluation error popping up if var is not specified in the 'opts' hash, since it is required. Instead, the following error occurs:

{noformat}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Method call, undefined method `from' for #<Puppet::Pops::Types::PStructType:0x6d4ca435>
{noformat}

This problem does not occur when using puppet apply (masterless).",Bug,PUP-7835,[],undefined method `from' for #<Puppet::Pops::Types::PStructType:0x6d4ca435>
"Now, when all serialization of YAML data is ensured to be {{Data}}, we must also ensure that no unsafe data can be loaded using YAML. Psych provides the method {{YAML.safe_load}} to accomplish this.

We do have some places were we still load objects that are not {{Data}} for backward compatibility causes. We allow {{Symbol}} keys in hiera in some places and we provide a YAML-specificit tag for {{Puppet::Node::Facts}} to make it directly deserializable into instances of that class. Such exceptions can (and should) be declared specifically as arguments to {{YAML.safe_load}}.

Also need to review JSON.load
",Improvement,PUP-7834,[],Change all calls to YAML.load into YAML.safe_load
"Apologize if this is the desired behavior, but I've noticed while I'm working on my custom report handler that I have to restart Puppet Server for the changes to be seen. Would like to have a way to subscribe to the report in my module under 'lib/puppet/reports' so that the server can be restarted when the file changes. 

Thanks!",Bug,PUP-7833,[],Puppet server needs to be restarted to see report updates
"{code}
# functions/test.pp 
function apt::test() >> Any { 
  ''
}
{code}

{{puppet parser validate}} (and {{puppet apply}}) both complain about syntax error:

{code}
Error: Syntax error at '>>' at /home/david/git/puppetlabs-apt/spec/fixtures/modules/apt/functions/test.pp:2:22 on node davids.corp.puppetlabs.net
{code}

The same function works on at least 4.8.0 and 5.0.1 (the only other versions I tested).

The docs at https://docs.puppet.com/puppet/4.7/lang_write_functions_in_puppet.html#return-types (and other versions) claim that the return value declaration is valid from puppet 4.7 onwards.

At this point in time, fixing the documentation to say '4.8' instead is probably the only recourse we have.


h/t to [~kevin.reeuwijk] for discovering && bringing the issue to my attention.",Bug,PUP-7831,[],Specifying a return type causes syntax error on puppet 4.7 in conflict with docs
"_Basic Info_

On the User resource, specifying a group with a group name as a number fails

CentOS is a POSIX compliant, so can accept numbers for a group name fine



*Puppet Version:*

Tested in 4.10, Customer reporting in 4.5 
*OS Name/Version:*
CentOS Linux release 7.2.1511
_Describe your issue in as much detail as possible..._

Creating a user with a group name as a number 


{code:java}
user {'nicky':
groups => '12345678',
ensure => 'present',
}
{code}


Applying this gets the following behaviour 

Error: Parameter groups failed on User[nicky]: Group names must be provided, not GID numbers. at /home/centos/user.pp:3

The code checks if the group is a number and throws the above error, which is valid for GIDs

But not for group names

Documentation also doesn't explicitly explain that group names should start with a letter, just explains it as best practice (which of course it is)

https://docs.puppet.com/puppet/4.5/types/group.html#group-attribute-name


*Desired Behavior:*

Accept a numeric group name

*Actual Behavior:*

Fails on parsing the code


Please take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.

Error: Parameter groups failed on User[nicky]: Group names must be provided, not GID numbers. at /home/centos/user.pp:3

",Bug,PUP-7830,[],Adding a user with a numeric group name fails
"The {{TypeParser}} class, used for parsing parameter types in Ruby dispatchers, allows parameters that are not types. The Puppet evaluator does however check that all parameters
are types.

The behavior should be the same for both. It does not make sense for a Variant to accept parameters that are not types.",Bug,PUP-7829,[],TypeParser accepts Variant parameters that are not types.
"The path to the metadata file of a task should be retreivable from outside the task class; if no metadata file was provided when the task was created, it should be nil.",New Feature,PUP-7826,[],Tasks can return the path to their metadata file
"The puppet {{StringFormatter}} relies on the ruby {{#inspect}} method when a regexp has flags. This is bad because a) the output is not consistent between different ruby versions, and b) the '/' character is incorrectly escaped. This leads to problems in other implementations where '/' isn't used as a regexp delimiter at all.

The problem is minor because such regexps cannot be created from Puppet code (puppet doesn't support flags).",Bug,PUP-7825,[],regexp's with flags and slashes is incorrectly presented using %s and %p
"When formatting strings in puppet and providing a format specifier such as ""%s"" or ""%p"", the regexp for validating that specifier is not anchored. Consequently, passing a specifier like ""%strange"" will succeed since the ""%s"" at the beginning fulfills the match.",Bug,PUP-7824,[],Regexp for String format specifier is not anchored at the end
"Im start to porting next code from erb template to epp:


{code:java}
<%- if @mime_types -%>

# Custom additional mime types
<%- @mime_types.sort_by {|key,value| key}.each do |key,value| -%>
<%= key %> <%= value %>;
<%- end -%>
<%- end -%>
{code}

Next code return error ""*Invalid EPP: Syntax error at '|'*"":

{code:java}
# mime.types.epp
<%- | Hash[String, String] $nginx::config::mime_types | -%>
<% include stdlib -%>
<% $nginx::config::mime_types.keys.sort.each |$key| { -%>
    <%= $key %> <%= $nginx::config::mime_types[$key] %>
<% } -%>
{code}

manifests:

{code:java}
# manifests/config.pp
class nginx::config {
  $mimetypes=lookup('nginx::mimetypes')
  file { ""${nginx::params::conf_dir}/mime.types"":
    ensure  => file,
    content => epp(""${module_name}/mime.types.epp""),
  }
{code}

hiera:

{code:java}
nginx::mimetypes:
  video/ogg: 'ogv'

{code}

puppet version:

{noformat}
#puppet --version
5.0.1
{noformat}

",Bug,PUP-7823,[],Invalid EPP: Syntax error at '|' when use hash in epp templates
"Supporting the dot-notation for digging into structured values (arrays and hashes) is of value. The current available function {{dig()}} does not parse the dot notation (it takes an array of segments) and it cannot be changed as that would break compatibility, and it also does not support a default value.

A new function {{get(<dotted_key>)}} that also takes an optional lambda that gets called if the result would be undef. If the lambda takes no arguments it is simply called. If it accepts one argument, that is a {{Struct\[segments => Array\[String], values => Array]}}, thus making it possible to figure out how far the ""dig"" got before giving up, and to use that in a custom warning or error message (or simply logging it when debugging). (The value array ends with the undef value that caused the dig to give up). The lambda is not called if the final segment results in a nil value being found in a hash, but is called if the last segment did not exist.

Examples:
{code:puppet}
$facts.get('some.fact')
$facts.get('some.fact') || { 'go fish' } # 'go fish' is the default
$fact.get('some.facts.detail.0.x') |$resolution| { 
  $size = $resolution['values'].size() # std lib function for now since size is not in core
  notice(@(""MESSAGE""))
    Could not lookup all given segments: ${resolution['segments']}
    Got an undef value for the key: ${resolution['segments'][$size-1]}
    Values per segment are: ${resolution['values']}
    |- MESSAGE
}
{code}

When implementing this, it is of value to write a helper function {{parse_dig(String)}} that returns an array of segments from the dot-notation string. The {{get}} function uses that if it gets a string, if it gets an array it is taken as already parsed segments. The {{dig}} function should be given the lambda support to process the walked path. Thus:
* Add a {{parse_dig(String)}} function
* Add a lambda for processing default to {{dig}}
* Add {{get(Variant\[Array, String])}}, calling {{parse_dig}} for a String arg, and then calling {{dig}} to do the digging.
* Add a default value parameter to {{get}} which is mutually exclusive with giving a lambda - the default value is returned if value is undef (irrespective of reason) - if there is the need to differentiate between actual undef value, and not found, a lambda must be used. 

ORIGINAL
-----
The fact() function provides a way to use the dot syntax for indexing into structured in the DSL. This was recently merged into stdlib(PR: https://github.com/puppetlabs/puppetlabs-stdlib/pull/787 Docs: https://github.com/puppetlabs/puppetlabs-stdlib#fact). 

Ideally this would be part of core puppet instead of the stdlib module given it's the syntax used in facter and heira for structured facts.",Improvement,PUP-7822,[],"Add a get() function that supports dot syntax to ""dig"" into hash/array"
"On Windows, a corrupt environment variable will crash Puppet when initializing settings with a stack like the following when running any command (like {{puppet agent}} or {{puppet facts}}):

{noformat}
C:\>puppet facts --debug --verbose
C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:59:in `encode': ""t\xDD"" on UTF-16LE (Encoding::InvalidByteSequenceError)
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:59:in `read_wide_string'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:76:in `block in read_arbitrary_wide_string_up_to'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:75:in `each'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:75:in `read_arbitrary_wide_string_up_to'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/windows/process.rb:239:in `get_environment_strings'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util.rb:43:in `get_env'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/defaults.rb:273:in `block in <module:Puppet>'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/settings.rb:923:in `block in define_settings'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/settings.rb:922:in `each'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/settings.rb:922:in `define_settings'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet.rb:140:in `define_settings'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/defaults.rb:152:in `<module:Puppet>'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/defaults.rb:1:in `<top (required)>'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:54:in `require'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:54:in `require'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet.rb:175:in `<module:Puppet>'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet.rb:81:in `<top (required)>'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:54:in `require'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:54:in `require'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/command_line.rb:12:in `<top (required)>'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:54:in `require'
        from C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:54:in `require'
        from C:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:3:in `<main>'
{noformat}",Improvement,PUP-7821,[],Corrupt Windows environment variables crash Puppet
"While doing I18N testing I noticed this error message in the puppet.po file which should be updated for I18N

#: ../lib/puppet/pops/issues.rb:755
msgid ""\""#{label.a_an_uc(semantic)} resulted in a value outside of Puppet Integer #{range_end} range, got '#{\""%#+x\"" % value}'\""""
msgstr """"
""\""#{ŀȧƀḗŀ.ȧ_ȧƞ_ŭƈ(şḗḿȧƞŧīƈ)} řḗşŭŀŧḗḓ īƞ ȧ ṽȧŀŭḗ ǿŭŧşīḓḗ ǿƒ Ƥŭƥƥḗŧ Īƞŧḗɠḗř ""
""#{řȧƞɠḗ_ḗƞḓ} řȧƞɠḗ, ɠǿŧ '#{\""%#+ẋ\"" % ṽȧŀŭḗ}'\""""

And another

#: ../lib/puppet/pops/issues.rb:444
msgid ""\""#{label.article(actual_type)} #{actual_type}\""""
msgstr """"

And another

""The string '#{before}' was automatically coerced to the numerical value #{after}""",Bug,PUP-7820,[],error string needs update for I18N support
"Prefetching in AIX assumes that all packages have a valid {{source}} attribute. This is not always the case, as {{ensure => absent}} does not require such a source. Thus the following manifest will cause prefetch to fail:

{noformat}
package { 'sudo.rte':
    ensure => latest,
    source => ""/mnt/my-packages""
}

package { 'curl.rte':
    ensure => absent,
}
{noformat}

",Bug,PUP-7818,[],AIX provider prefetch will fail if any package does not have a source
"I wanted to ensure that puppet-agent 1.9.0 was not allowed on my boxes and realized there was no way for me to do so without resorting to RPM version string. I don't want to pin it to 1.8.4 or 1.9.2, nor do I want to play roulette and specify 'latest' since broken builds show up from time to time. I should be able to specify the well-known nomenclature that Module metatdata.json uses.
{code}
ensure =>  "">= 4.8.2 < 5.0.0""
{code}
References
* https://docs.puppet.com/puppet/5.0/modules_metadata.html#version-specifiers-in-module-metadata
* http://semver.org/
",New Feature,PUP-7816,"['package', 'resources', 'triaged', 'type_and_provider']",Package resource' ensure attribute to use Semantic Versioning
"This ticket covers giving modules the ability to list all the tasks that they contain. This involves:

* finding all files in the tasks folders that do not end in '.conf' or '.md';
* checking if every executable file *not* ending in '.json' (the 'executable file') has a matching metadata file with the same basename that *does* end in '.json' (the 'metadata file'):
    ** if so, then each of those matching file pairs constitutes one task;
    ** if not, each metadata file needs to be parsed to find the matching executable file, and any executable files left over that are not named by any metadata files are tasks that have no metadata;
* returning an array of hashes with the files for each task: the executable file and (if it exists) the metadata file.
Similar to https://github.com/puppetlabs/puppet/blob/ebd96213cab43bb2a8071b7ac0206c3ed0be8e58/lib/puppet/info_service.rb

Can be used to call from Clojure (Puppet server) so that the Puppet team can change the underlying implementation if we wish.

The new API:
- Is defined in Puppet::InfoService that has class level methods that defines services

*tasks_per_environment*
A class level method `tasks_per_environment` that returns the names and modules of available tasks in the environment. Arguments: ""environment_name"" as a string (or a list of ""environment_name"")
Output:

{code}
 [{:module => {:name => ""apache""}, :name => ""apache::install""}, …]
{code}

If there are no tasks in the named environment, returns the empty array.
If the named environment does not exist, raises {{EnvironmentNotFound}}.

Note that no information about the task itself is returned (e.g. metadata or file information), so no files are read or statted; the only filesystem IO performed is directory scans of each modules' tasks directory.

*task_data*
A class level method that returns files associated with a given task. Returns absolute file path of task metadata if found (else nil) and returns list of absolute paths to any non-metadata files with the provided name (empty list if none). Files list excludes any files with .json, .md, .conf extensions.

Arguments: ""environment_name"", ""module"", ""task_name""
Output:

{code}
{:metadata_file => ""path/to/file/<task_name>.json"",
 :files => [""path/to/file/<task_name>.exe"", ""path/to/file/<task_name>"", ...]}
{code}

If the named module does not exist, raises {{Puppet::Module::MissingModule}}.

If the named environment does not exist, raises {{Puppet::Environments::EnvironmentNotFound}}.

If the named task does not exist, raises {{Puppet::Module::Task::TaskNotFound}}.

The path to the metadata file of a task should be retreivable from outside the task class; if no metadata file was provided when the task was created, it should be nil.
",Story,PUP-7815,[],Modules can find and list all their tasks
"In [PUP-1072] we added support for http and https URL schemes for {{file}} resources' {{source}} attributes:

{code}
file { '/tmp/myfile':
  source => 'https://myserver/myfile'
}
{code}

Somehow we failed to realize that the implementation of this feature requires that the remote webserver present a certificate that is trusted by the puppet agent's SSL configuration. In practice this is extremely unlikely and difficult to configure, and therefore the utility of this feature is pretty limited.

In the code, this is because the request ultimately uses the same routines (in {{Puppet::Util::HttpProxy.get_http_object}}) that the agent itself uses, where the SSL verification mode is hardcoded but the certificate store is not.

There should be some way to permit retrieval of these files. A couple of options that occured to me as I was tracing this down:

1.  make the ssl verification mode configurable or disabled by default for file-source retrieval (equivalent to {{curl -k}})
2. use the system-wide trust store instead of puppet's store
3. expose the certificate trust and verification mode as parameters on the file type (this is truly awful)

... surely someone else has better ideas ...",Bug,PUP-7814,[],HTTPS file sources with non-puppet-trusted certs can't be used
"If one package is listed in the output of 'yum check-update', any package update fails.

{noformat}
# puppet resource package kernel ensure=latest
Error: Could not get latest version: undefined method `[]' for nil:NilClass
Error: /Package[kernel]/ensure: change from 3.10.0-514.26.2.el7 to latest failed: Could not get latest version: undefined method `[]' for nil:NilClass
package { 'kernel':
  ensure => '3.10.0-514.26.2.el7',
}
{noformat}

{noformat}

# /bin/yum check-update
Loaded plugins: enabled_repos_upload, fastestmirror, package_upload, product-id, search-disabled-repos, subscription-
              : manager, tracer_upload
KS_Centos_Centos_7_Base                                                                       | 2.1 kB  00:00:00     
KS_Centos_Centos_7_Updates                                                                    | 2.5 kB  00:00:00     
KS_Katello_Server_3_4                                                                         | 2.1 kB  00:00:00     
Loading mirror speeds from cached hostfile

foreman-installer-katello.noarch                          3.4.4-1.el7                           KS_Katello_Server_3_4
katello-debug.noarch                                      3.4.4-2.el7                           KS_Katello_Server_3_4
katello-installer-base.noarch                             3.4.4-1.el7                           KS_Katello_Server_3_4
katello-service.noarch                                    3.4.4-2.el7                           KS_Katello_Server_3_4
Uploading Enabled Reposistories Report
Loaded plugins: fastestmirror, product-id

{noformat}


{noformat}
# yum-config-manager --disable KS_Katello_Server_3_4
{noformat}


{noformat}
# puppet resource  package kernel ensure=latest
package { 'kernel':
  ensure => '3.10.0-514.26.2.el7',
}
{noformat}


",Bug,PUP-7813,['puppet-agent'],Yum package provider: ensure => latest fails when packages update available
,CI Blocker,PUP-7812,[],puppet agent (1.10.x) suite build failed for solaris-11-i386
"https://jenkins-master-prod-1.delivery.puppetlabs.net/job/platform_puppet-agent_pkg-van-ship_daily-5.0.x/32/BUILD_TARGET=aix-6.1-ppc,SLAVE_LABEL=beaker/",CI Blocker,PUP-7811,[],puppet-agent 5.0.x build failed for aix-6.1-ppc
"I'm specifically experiencing this with

{code}
puppet resource ec2_instance --to_yaml
{code}

using the puppetlabs-aws module from the forge. The module itself doesn't seem to be touching any yaml related stuff. Without the yaml flag I get this data: https://gist.github.com/wkalt/a97a42b84b1afc3cd23236ea32eed3fa and using the yaml flag I get https://gist.github.com/wkalt/a97a42b84b1afc3cd23236ea32eed3fa . Note that the former has ruby maps embedded, which is the bug.",Bug,PUP-7808,[],puppet resource <...> --to_yaml mishandles structured resource values
"When using NFS mounts on an AIX agent with the mount resource, the remount does not ensure the options persist. The `mount -o remount filesystem` does not read from `/etc/filesystems` on AIX so the options are not present in the remount.

Below is an example of a remount that strips the options from the mount on a remount. 

{code}
0] [AIX] root@pe-aix-71-support:~ # mount
  node       mounted        mounted over    vfs       date        options
-------- ---------------  ---------------  ------ ------------ ---------------
10.32.171.166 /tmp/test        /mnt/test        nfs3   Aug 01 08:47 rw,bg,hard,nointr,rsize=32768,wsize=32768,timeo=600
[0] [AIX] root@pe-aix-71-support:~ # puppet apply mount.pp
Notice: Compiled catalog for pe-aix-71-support.delivery.puppetlabs.net in environment production in 0.18 seconds
Notice: /Stage[main]/Main/Mount[/mnt/test]/options: options changed 'rw,bg,hard,nointr,rsize=32768,wsize=32768,timeo=600,account=true,mount=true' to 'rw,bg,hard,nointr,rsize=32768,wsize=32768,timeo=600,mount=true,account=true,'
Notice: /Stage[main]/Main/Mount[/mnt/test]: Triggered 'refresh' from 1 events
Notice: Applied catalog in 0.22 seconds
[0] [AIX] root@pe-aix-71-support:~ # mount
  node       mounted        mounted over    vfs       date        options
-------- ---------------  ---------------  ------ ------------ ---------------
10.32.171.166 /tmp/test        /mnt/test        nfs3   Aug 01 08:47
{code}",Bug,PUP-7807,[],AIX mount resource remounts without options
"With this epp syntax:
{code:puppet}
<% $ntp::servers.each |$server| {-%>
server <%= $server %>
<% } -%>

<%= $ntp::value %>
{code}

And this yaml syntax:
{code:puppet}
---
ntp::servers:
  - '0.pool.ntp.org'
  - '1.pool.ntp.org'
  - '2.pool.ntp.org'
  - '3.pool.ntp.org'
ntp::value: something
{code}

And then run this command:
{code:bash}
puppet epp render ntp.epp --values_file ntp.yaml
{code}

This results in epp not finding any of the variables.  If the ntp:: is removed in both files, epp renders correctly.  One would assume that if you specified the yaml file it would match up the variables correctly.  Wrapping it in a puppet class as per below and doing it via puppet apply works fine with the above epp:
{code:puppet}
class ntp {
  $servers=['one','two']
  $value='value'
  file { '/tmp/ntp' :
    ensure   => file,
    content => epp('ntp/ntp.epp'),
  }
}
{code}

I'm assuming this is a limitation of epp render and dealing with variables containing ::, but there may be more at play.  Tested with puppet 4.8.2, 4.9.4, and puppet 4.10.1.",New Feature,PUP-7806,[],puppet epp render fails to find variables with ::
"In general the server setting should be ignored when server_list is present.

In the case of PE HA, both 'server' and 'server_list' are present on a promoted replica, however the 'server' is incorrectly the old master certname rather than the current master (the promoted replica) certname.

This is causing an issue on rebooted masters where the automatic puppet agent run on reboot fails, and each file resource request times out individually - currently causing the reboot test in CI to take 30+ minutes for the puppet agent run to complete and fail.",Bug,PUP-7804,[],Should not fall back to 'server' for requesting file resources when 'server_list' is specified
Epic focused on improvements to systemd handling in Puppet,Epic,PUP-7803,[],Systemd service provider improvements
"Disabling automatic class parameter lookup in Hiera 5 also disables the global hierarchy layer

Prior to Puppet 4.9.0 and the integration of Hiera 5, setting the {{data_binding_terminus}} to {{none}} would disable automatic lookup of class parameters while keeping explicit lookups via the {{hiera()}} functions enabled. Starting with Puppet 4.9.0, setting {{data_binding_terminus}} to {{none}} disables {{hiera()}} entirely.

h2. Reproduction Case

*  Install PE 2016.4.6.
*  Replace ` /etc/puppetlabs/code/environments/production/manifests/site.pp` with the following content:

{code:puppet}
class testclass (
  $param1 = 'default',
  $param2 = 'default',
) {

  notify {""param1: ${param1}"": }
  notify {""param2: ${param2}"": }

}

node default {
  class {'testclass':
    param1 => hiera('param1'),
  }
}
{code}

*  Add the following data to {{/etc/puppetlabs/code/environments/production/hieradata/common.yaml}}:

{code}
param1: hiera_override
testclass::param2: hiera_override
{code}

*  Disable the data_binding_terminus:

{code}
puppet config set --section master data_binding_terminus none
{code}

*  Re-start {{pe-puppetserver}}
*  Run {{puppet agent -t}}

h3. Outcome

The puppet run fails with a {{lookup()}} error:

{noformat}
[root@pe-201646-master production]# puppet agent -t
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Function lookup() did not find a value for the name 'param1' on node pe-201646-master.puppetdebug.vlan
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{noformat}

h3. Expected Outcome

The run succeeds, and only param1 of testclass is overridden via Hiera data:

{noformat}
[root@pe-201643-master manifests]# puppet agent -t
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for pe-201643-master.puppetdebug.vlan
Info: Applying configuration version '1500938483'
Notice: param1: hiera_override
Notice: /Stage[main]/Testclass/Notify[param1: hiera_override]/message: defined 'message' as 'param1: hiera_override'
Notice: param2: default
Notice: /Stage[main]/Testclass/Notify[param2: default]/message: defined 'message' as 'param2: default'
Notice: Applied catalog in 11.76 seconds
{noformat}

This was the behavior prior to Puppet 4.9.",Bug,PUP-7802,[],Disabling automatic class parameter lookup in Hiera 5 also disables the global hierarchy layer
You guys don't know what you're doing!,Bug,PUP-7801,[],Moses and Karen test out the workflow
"{code:java}
package { 'a':
  ensure => 'absent',
  alias => 'b',
}

notify { 'c':
  require => Package['b'],
}
{code}

The code above works with puppet 4 but with puppet 5 it only works with puppet apply, trying to include it in a catalog results in the following error:

{noformat}
Error: Could not retrieve catalog from remote server: 
  Error 500 on SERVER: Server Error: 
    Invalid relationship: Notify[c] { require => Package[b] }, 
    because Package[b] doesn't seem to be in the catalog
{noformat}

If you change the package resource to another resource (tested with notify and file resources) then the alias parameter works as expected under puppet v5.",Bug,PUP-7800,[],relationship to aliased Package resources fails
"The [Puppet::Resource::Ral indirection|https://github.com/puppetlabs/puppet/blob/5.0.1/lib/puppet/indirector/resource/ral.rb#L24-L27] appears to attempt to convert ral to_resource() twice when you provide search criteria (shown here with package).  I'm guessing the specs are mocked such as to be validating the broken behavior.

{code}
require 'puppet'
require 'pp'

packages = Puppet::Resource.indirection.search(""package"")
pp packages.find { |r| r.name == 'Package/bash' }

begin
  Puppet::Resource.indirection.search(""package/bash"")
rescue Exception => e
  pp e.backtrace
  puts e
end

begin
  Puppet::Resource.indirection.search(""package"", {:ensure => ""installed""})
rescue Exception => e
  pp e.backtrace
  puts e
end
{code}

{code}
jpartlow@percival:~/work/src/pl/puppet$ be ruby test.rb 
Package[bash]{:name=>""bash"", :ensure=>""4.3-7ubuntu1.7"", :provider=>:apt, :configfiles=>:keep, :reinstall_on_refresh=>:false, :loglevel=>:notice}
[""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block (2 levels) in search'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `each'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `all?'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block in search'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `each'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `find_all'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `search'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/indirection.rb:270:in `search'"",
 ""test.rb:8:in `<main>'""]
undefined method `to_resource' for #<Puppet::Resource:0x007f1c8e0d57f8>
[""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block (2 levels) in search'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `each'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `all?'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block in search'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `each'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `find_all'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `search'"",
 ""/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/indirection.rb:270:in `search'"",
 ""test.rb:15:in `<main>'""]
undefined method `to_resource' for #<Puppet::Resource:0x007f1c8dacac00>
{code}",Bug,PUP-7799,[],Puppet::Resources.search fails if conditions provided
"To reproduce, I start out on a CentOS system and run ""yum -y update"". This installs the following (using bash as a baseline comparison here since it's ubiquitous):

{code}
[root@puppetmaster7 ~]# rpm -qa | egrep '^(bash|java)'
bash-4.1.2-48.el6.x86_64
java-1.8.0-openjdk-1.8.0.141-2.b16.el6_9.x86_64
java-1.8.0-openjdk-headless-1.8.0.141-2.b16.el6_9.x86_64
{code}

Then I downgrade them:

{{yum -y downgrade bash java-1.8.0-openjdk java-1.8.0-openjdk-headless}}

{code}
[root@puppetmaster7 ~]# rpm -qa | egrep '^(bash|java)'                                                                                              
bash-4.1.2-15.el6_5.2.x86_64
java-1.8.0-openjdk-1.8.0.131-0.b11.el6_9.x86_64
java-1.8.0-openjdk-headless-1.8.0.131-0.b11.el6_9.x86_64
{code}

Now when I have a bash-updating package resource, I see bash-upgrading lines in the debug output.

{{puppet apply --debug /tmp/b.pp | tee /tmp/bb}}

{code}
[root@puppetmaster7 ~]# cat /tmp/b.pp 
package { 'bash':
  ensure => latest,
}
[root@puppetmaster7 ~]# grep bash /tmp/bb
Debug: Facter: root:x:0:0:root:/root:/bin/bash
  ""bash;4.1.2;15.el6_5.2"",
Debug: /Stage[main]/Main/Package[bash]/ensure: bash ""4.1.2-15.el6_5.2"" is installed, latest is ""0:4.1.2-48.el6""
Debug: Package[bash](provider=yum): Ensuring => latest
Debug: Executing: '/bin/rpm -q bash --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n''
Debug: Package[bash](provider=yum): Ensuring latest, so using update
Debug: Executing: '/usr/bin/yum -d 0 -e 0 -y update bash'
Debug: /Stage[main]/Main/Package[bash]/ensure: bash ""4.1.2-15.el6_5.2"" is installed, latest is ""0:4.1.2-48.el6""
Notice: /Stage[main]/Main/Package[bash]/ensure: ensure changed '4.1.2-15.el6_5.2' to '0:4.1.2-48.el6'
Debug: /Stage[main]/Main/Package[bash]: The container Class[Main] will propagate my refresh event
{code}

However when I try the same thing with the java rpm, I do not see the same output.

{{puppet apply --debug /tmp/h.pp  | tee /tmp/yy}}

{code}
[root@puppetmaster7 ~]# cat /tmp/h.pp 
package { 'java-1.8.0-openjdk':
  ensure => latest,
}
[root@puppetmaster7 ~]# grep java /tmp/yy
Debug: Loading facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_patch_level.rb
Debug: Loading facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_libjvm_path.rb
Debug: Loading facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_version.rb
Debug: Loading facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_default_home.rb
Debug: Loading facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_major_version.rb
Debug: Loading facts from /opt/puppetlabs/puppet/cache/lib/facter/java_patch_level.rb
Debug: Loading facts from /opt/puppetlabs/puppet/cache/lib/facter/java_libjvm_path.rb
Debug: Loading facts from /opt/puppetlabs/puppet/cache/lib/facter/java_version.rb
Debug: Loading facts from /opt/puppetlabs/puppet/cache/lib/facter/java_default_home.rb
Debug: Loading facts from /opt/puppetlabs/puppet/cache/lib/facter/java_major_version.rb
Debug: Facter: searching for operatingsystem.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for operatingsystem.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for osfamily.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for osfamily.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for operatingsystemrelease.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for operatingsystemrelease.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for kernelrelease.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for kernelrelease.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for fqdn.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for fqdn.rb in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: searching for custom facts in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Info: Facter: loading custom facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_patch_level.rb.
Info: Facter: loading custom facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_libjvm_path.rb.
Info: Facter: loading custom facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_version.rb.
Info: Facter: loading custom facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_default_home.rb.
Info: Facter: loading custom facts from /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter/java_major_version.rb.
Info: Facter: loading custom facts from /opt/puppetlabs/puppet/cache/lib/facter/java_patch_level.rb.
Info: Facter: loading custom facts from /opt/puppetlabs/puppet/cache/lib/facter/java_libjvm_path.rb.
Info: Facter: loading custom facts from /opt/puppetlabs/puppet/cache/lib/facter/java_version.rb.
Info: Facter: loading custom facts from /opt/puppetlabs/puppet/cache/lib/facter/java_default_home.rb.
Info: Facter: loading custom facts from /opt/puppetlabs/puppet/cache/lib/facter/java_major_version.rb.
Debug: Facter: searching for custom facts in /etc/puppetlabs/code/environments/common_common/modules/java/lib/facter.
Debug: Facter: executing command: /bin/sh -c /bin/readlink -e /usr/bin/java
Debug: Facter: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.131-0.b11.el6_9.x86_64/jre/bin/java
Debug: Facter: fact ""java_default_home"" has resolved to ""/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.131-0.b11.el6_9.x86_64"".
Debug: Facter: fact ""java_libjvm_path"" has resolved to ""/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.131-0.b11.el6_9.x86_64/jre/lib/amd64/server"".
Debug: Facter: executing command: /bin/sh -c /usr/bin/java -Xmx12m -version 2>&1
Debug: Facter: fact ""java_version"" has resolved to ""1.8.0_131"".
Debug: Facter: fact ""java_major_version"" has resolved to ""8"".
Debug: Facter: fact ""java_patch_level"" has resolved to ""131"".
{code}

Both have the same query line in the log, which shows this sort of thing for these rpms (bash is post-upgrade here).


{code}
[root@puppetmaster7 ~]# /bin/rpm -qa --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n' | egrep '^(java|bash)' | sort | column -t
bash                         0  4.1.2      48.el6       x86_64
java-1.8.0-openjdk           1  1.8.0.131  0.b11.el6_9  x86_64
java-1.8.0-openjdk-headless  1  1.8.0.131  0.b11.el6_9  x86_64
{code}


I see the same behaviour on a CentOS 7 host, fully patched up and then with the java and bash rpms downgraded.",Bug,PUP-7798,[],trouble upgrading java-1.8.0-openjdk rpm
"I need to report-process all {{Puppet::Util::Log}} objects in a format 6 report (https://docs.puppet.com/puppet/4.9/format_report.html) and see no programmatic way to do so. 

Please add a corrective_change boolean to the log object.",New Feature,PUP-7797,[],Report format 6 logs do not indicate corrective changes
"h3. The issue

If a provider fails for some reason, even non-dependent catalog resources fail to be applied.  

h3. To reproduce

This test case involves the pip provider.  

Install pip:

{noformat}
curl ""https://bootstrap.pypa.io/get-pip.py"" -o ""get-pip.py""
python get-pip.py
{noformat}

Now break python so that pip can't properly be invoked:

{noformat}
mv /usr/bin/python /usr/bin/python.bak
ln -s foo /usr/bin/python
{noformat}

Create the following manifest and run it with puppet apply:

{code:puppet}
package{'foo':
  ensure => installed,
  provider => pip,
}
notify{'helloworld':}
{code}

h3. Result

We get an error:

{noformat}
Notice: Compiled catalog for pe-201720-master.example.com in environment production in 0.11 seconds
Error: Failed to apply catalog: [nil]
{noformat}

h3. Expected Result

Puppet should still apply the notify resource, which isn't dependent on the package in any way.  A more helpful error message would also be nice.",Bug,PUP-7796,"['maintenance', 'triage']",An agent should be able to recover from a provider failure
"After creating a new module using ""puppet module generate tristan-test"" (for example) and installing the gems with bundler (""cd test && bundle install""), lots of puppet functionality seems to break.

For example, I cannot run unit tests with ""rake spec"", every single test fails with the same error message:

    NoMethodError:
       undefined method `_' for #<Puppet::Resource::Catalog::Compiler:0x0055c17a1290d0>
     # /var/lib/gems/2.3.0/gems/puppet-5.0.1/lib/puppet/indirector/catalog/compiler.rb:68:in `initialize'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/adapters.rb:83:in `catalog'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/adapters.rb:161:in `catalog'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/support.rb:366:in `build_catalog_without_cache'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/support.rb:381:in `block in build_catalog'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/cache.rb:17:in `get'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/support.rb:380:in `build_catalog'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/support.rb:87:in `block in load_catalogue'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/support.rb:331:in `with_vardir'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/support.rb:81:in `load_catalogue'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/example/class_example_group.rb:7:in `catalogue'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/support.rb:11:in `block in subject'
     # /var/lib/gems/2.3.0/gems/rspec-puppet-2.6.4/lib/rspec-puppet/matchers/create_generic.rb:84:in `matches?'
     # ./spec/classes/init_spec.rb:4:in `block (3 levels) in <top (required)>'

Additionally, some of puppet's own commands seem to also break. For example, if I try to create a new puppet module after installing the gems (using ""puppet module generate tristan-test2""), I get the following error:

Error: Could not autoload puppet/face/module/list: undefined method `_' for #<Puppet::Interface::ActionBuilder:0x0055d341742b78>
Error: Could not parse application options: Could not autoload puppet/face/module/list: undefined method `_' for #<Puppet::Interface::ActionBuilder:0x0055d341742b78>
",Bug,PUP-7795,"['bundler', 'gem', 'puppet', 'ruby']","Running ""bundle install"" on a new puppet module breaks puppet"
"On the first puppet run after booting the host, a catalog apply error is thrown:

{code:bash}
Puppet	Transaction store file C:/ProgramData/PuppetLabs/puppet/cache/state/transactionstore.yaml is corrupt (Permission denied @ rb_sysopen - C:/ProgramData/PuppetLabs/puppet/cache/state/transactionstore.yaml); replacing
Wrapped exception:
Permission denied @ rb_sysopen - C:/ProgramData/PuppetLabs/puppet/cache/state/transactionstore.yaml
{code}

The catalog is applied however and successive runs do not have this error. All of our Windows hosts are doing the same thing.",Bug,PUP-7793,[],Puppet agent replacing transactionstore.yaml on first run after boot
"Change the message of a function call type mismatch to read:
{code}
The function 'xxx' was called with arguments it does not accept. It expects one of:
{code}
 as that provides the missing pieces to a user enabling them to understand where to look for the problem and what the possibly long output of type mismatches mean.

ORIGINAL
----
_Basic Info_

*Puppet Version:*
2016.5
*OS Name/Version:*
RHEL 06
_Describe your issue in as much detail as possible..._
when lookup function is given a none capitalized type the error message is large, confusing and misleading, which makes discovering the issue difficult for new users. 
  $var                 = lookup('var',boolean,'first',true) #incorrect
  #$var                 = lookup('var',Boolean,'first',true) #correct
the simple lower case 'B' in boolean triggered 4 error messages for one subject, and all of them are misleading!
{code:shell}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, 'lookup' expects one of:
  (NameType = Variant[String, Array[String]] name, ValueType = Type value_type?, MergeType = Variant[String[1, default], Hash[String, Scalar]] merge?)
    rejected: expects between 1 and 3 arguments, got 4
  (NameType = Variant[String, Array[String]] name, Optional[ValueType] value_type, Optional[MergeType] merge, DefaultValueType = Any default_value)
    rejected: parameter 'value_type' expects a ValueType = Type value, got String
  (NameType = Variant[String, Array[String]] name, ValueType = Type value_type?, MergeType = Variant[String[1, default], Hash[String, Scalar]] merge?)
    rejected: expects between 1 and 3 arguments, got 4
  (OptionsWithName = Struct[{'name' => NameType = Variant[String, Array[String]], 'value_type' => Optional[ValueType = Type], 'default_value' => DefaultValueType = Any, 'override' => Optional[Hash[String, Any]], 'default_values_hash' => Optional[Hash[String, Any]], 'merge' => Optional[MergeType = Variant[String[1, default], Hash[String, Scalar]]]}] options_hash, BlockType = Callable[NameType = Variant[String, Array[String]]] block?)
    rejected: expects 1 argument, got 4
  (Variant[String, Array[String]] name, OptionsWithoutName = Struct[{'value_type' => Optional[ValueType = Type], 'default_value' => DefaultValueType = Any, 'override' => Optional[Hash[String, Any]], 'default_values_hash' => Optional[Hash[String, Any]], 'merge' => Optional[MergeType = Variant[String[1, default], Hash[String, Scalar]]]}] options_hash, BlockType = Callable[NameType = Variant[String, Array[String]]] block?)
    rejected: expects 2 arguments, got 4 at /path/to/manifest.pp:21:37 on node 
{code}


*Desired Behavior:*
Output: 
Error: Optional[ValueType = Type] provided must be one of [X,Y,Z] 
or as at the command line 
 puppet lookup message --type=string 
Error: Could not run: The expression <string> is not a valid type specification.

*Actual Behavior:*
see above.
",Improvement,PUP-7792,[],argument type mismatch message could be clearer
"When running puppet agent with the debug flag, there's no indication as to whether a package was successfully upgraded, or what version it was upgraded to, requiring customers and support to fish for this information on the command line.

Example debug output from a failed package upgrade:
{code}
[[0;36mDebug: Facter: resolving Xen facts.^[[0m
1531 ^[[0;36mDebug: Evicting cache entry for environment 'production'^[[0m
1532 ^[[0;36mDebug: Caching environment 'production' (ttl = 0 sec)^[[0m
1533 ^[[mNotice: Compiled catalog for cmh1vlatgps003d.dev2a.dswd1.com in environment production in 0.05 seconds^[[0m
1534 ^[[0;36mDebug: Creating default schedules^[[0m
1535 ^[[0;36mDebug: Loaded state in 0.11 seconds^[[0m
1536 ^[[0;36mDebug: Loaded state in 0.08 seconds^[[0m
1537 ^[[0;32mInfo: Applying configuration version '1500483207'^[[0m
1538 ^[[0;36mDebug: Prefetching yum resources for package^[[0m
1539 ^[[0;36mDebug: Executing: '/bin/rpm --version'^[[0m
1540 ^[[0;36mDebug: Executing '/bin/rpm -qa --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\n''^[[0m
1541 ^[[0;36mDebug: Executing: '/usr/bin/yum check-update'^[[0m
1542 ^[[0;36mDebug: Finishing transaction 22088640^[[0m
1543 ^[[0;36mDebug: Storing state^[[0m
1544 ^[[0;36mDebug: Stored state in 0.12 seconds^[[0m
1545 ^[[mNotice: Applied catalog in 2.38 seconds^[[0m
1546 ^
{code}

Since we see this situation quite frequently in support, and lengthens time to resolution, and  seems trivial to add this the debug logging, I wanted to get this issue submitted and tracked, along with a recent Zendesk example.",Bug,PUP-7791,[],No useful debug output for yum/rpm provider success/failure/version information
"Due to a bug in pkgsrc (https://github.com/NetBSDfr/pkgin/issues/73), the pkgin provider fails silently when trying to ensure a particular version of a package is installed when a newer one is already installed.",Bug,PUP-7790,[],Downgrading a package with pkgin fails silents
"h3. Manifest ordering not always respected

When relying on manifest ordering to order things as they appear in the manifest, resources sometimes will not in fact be manifest-ordered if some of the resources are defined types.

h3. To reproduce

{code:puppet}
class foo () {
  foo::bar { 'bar': }
}
define foo::bar {
  foo::baz { 'a': }
  foo::baz { 'b': }
  foo::baz { 'c': }
  File {
    ensure => file,
  }
  file { '/d': }
  file { '/e': }
  file { '/f': }
}
define foo::baz {
  file { ""/$name"": ensure => file }
}
include foo
{code}

Then:

{code}
$ puppet apply foo.pp --ordering=manifest --noop
{code}

h3. Expected result

I expect to see resources ordered as they appear in the manifest, namely:
* Foo::Baz[a]
* Foo::Baz[b]
* Foo::Baz[c]
* File[/d]
* File[/e]
* File[/f]

h3. Actual result

* File[/d]
* File[/e]
* File[/f]
* Foo::Baz[a]
* Foo::Baz[b]
* Foo::Baz[c]

{code}
Notice: Compiled catalog for alexs-macbook-pro-2.local in environment production in 0.02 seconds
Notice: /Stage[main]/Foo/Foo::Bar[bar]/File[/d]/ensure: current_value 'absent', should be 'file' (noop)
Notice: /Stage[main]/Foo/Foo::Bar[bar]/File[/e]/ensure: current_value 'absent', should be 'file' (noop)
Notice: /Stage[main]/Foo/Foo::Bar[bar]/File[/f]/ensure: current_value 'absent', should be 'file' (noop)
Notice: /Stage[main]/Foo/Foo::Bar[bar]/Foo::Baz[a]/File[/a]/ensure: current_value 'absent', should be 'file' (noop)
Notice: Foo::Baz[a]: Would have triggered 'refresh' from 1 event
Notice: /Stage[main]/Foo/Foo::Bar[bar]/Foo::Baz[b]/File[/b]/ensure: current_value 'absent', should be 'file' (noop)
Notice: Foo::Baz[b]: Would have triggered 'refresh' from 1 event
Notice: /Stage[main]/Foo/Foo::Bar[bar]/Foo::Baz[c]/File[/c]/ensure: current_value 'absent', should be 'file' (noop)
Notice: Foo::Baz[c]: Would have triggered 'refresh' from 1 event
Notice: Foo::Bar[bar]: Would have triggered 'refresh' from 6 events
Notice: Class[Foo]: Would have triggered 'refresh' from 1 event
Notice: Stage[main]: Would have triggered 'refresh' from 1 event
Notice: Applied catalog in 0.07 seconds
{code}

Affects all versions of Puppet, including 3.8.7.

Presumably it has always been like this. However, this is a very confusing ordering that seems to defeat the purpose of having manifest ordering at all.",Bug,PUP-7789,[],Manifest ordering not respected if resources are nested in defined types
"While creating a custom report processor, whatever is inside of the method ""process"" does not seem to run.
If I define configuration parameters outside of the process method, that is completed, but anything inside of the method is not called. I am creating an http post call with JSON data to another server within my network.

Code below is based off of the ""myreport"" example in the custom reports documentation:


{code:ruby}
require 'puppet'
require 'net/http'
require 'json'
require 'uri'

Puppet::Reports.register_report(:myreport) do
  desc <<-DESC
     Process reports via API call  
  DESC

  def process
    uri = URI.parse('http://10.100.16.192:5000/backend/puppet/reports')
    header = {'Content-Type'=> 'application/json'}
    req = Net::HTTP::Post.new(uri.path, header)

    if self.status != nil then
      status = self.status
    else
      status = 'undefined'
    end
    req.body = {report: {status: status, node: 'unknown'}}.to_json
    res = Net::HTTP.start(uri.hostname, uri.port) do |http|
      http.request(req)
    end
  end
end
{code}
",Bug,PUP-7788,[],Report Processor not working correctly
"On a system without a license file in /etc/puppetlabs/license.key I tried to download the PE only sqlserver module. Here's what happened next:

{code}
puppet module install puppetlabs-sqlserver
Notice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...
Notice: Downloading from https://forgeapi.puppet.com ...
Error: bad URI(is not URI?): /v3/releases?module=puppetlabs-sqlserver&module_groups=base pe_only
Error: Try 'puppet help module install' for usage
{code}

It seems like the error message good be improved here. This gives me no clues that the module exists or is PE only or that I need a valid license to install it.",Bug,PUP-7787,[],Module tool on ruby 2.1.9 gives cryptic error when downloading a PE only module with no license file
"Many of our tests rely on matching against English strings to determine passing behavior. When we translate these strings, we will no longer be able to rely on this.

https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/ad-hoc/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-ad-hoc/21/ is a test run on Windows with fake translations. The failures need to be triaged to determine if mismatched strings are the only cause, and then updated so they can pass in an environment with translations. Additional tickets may need to be filed for any more complex fixes.",Task,PUP-7786,[],Triage failures from tests with translations
"/etc/puppetlabs/puppet/puppet.conf
certname = 000000000180
------------------------------------------------------------------------------------------------------
 Error: Could not parse /etc/puppetlabs/puppet/puppet.conf: invalid value for Integer(): ""000000000180""                                                                             
Error: Could not request certificate: Failed to open TCP connection to puppet:8140 (getaddrinfo: Name
 or service not known)                                   
Exiting; failed to retrieve certificate and waitforcert is disabled
------------------------------------------------------------------------------------------------------
certname in quotations makes puppet agent run but then an error on the server side is thrown:
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: invalid value for Integer(): ""000000000180""
",Bug,PUP-7785,[],certname containing only numbers throws error message
"When I start my puppet server/master in the old (deprecated) way with

{code}/opt/puppetlabs/bin/puppet master --no-daemonize --verbose{code}

my puppet client applies its catalog successfully with

{code}root@puppet-client:~# puppet agent --test
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for puppet-client
Info: Applying configuration version '1477221504'
Notice: Applied catalog in 6.85 seconds{code}

When I start my puppet server/master in the new (recommended) way with

{code}/opt/puppetlabs/bin/puppetserver foreground --debug{code}

my puppet client fails with

(1st run)
{code}root@puppet-client:~# puppet agent --test
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, """"\xC3"""" on US-ASCII at /etc/puppetlabs/code/environments/production/modules/ruby/manifests/init.pp:8:15 on node puppet-client
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run{code}

(2nd run)
{code}root@puppet-client:~# puppet agent --test
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, undefined method `empty?' for nil:NilClass at /etc/puppetlabs/code/environments/production/modules/ruby/manifests/init.pp:8:15 on node puppet-client
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run{code}

My puppet server logs this:

{code}2016-10-23 11:40:13,811 ERROR [qtp498843368-26] [puppetserver] Puppet Evaluation Error: Error while evaluating a Function Call, undefined method `empty?' for nil:NilClass at /etc/puppetlabs/code/environments/production/modules/ruby/manifests/init.pp:8:15 on node puppet-client
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend/yaml_backend.rb:22:in `lookup'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend.rb:120:in `datasourcefiles'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend.rb:92:in `datasources'
org/jruby/RubyArray.java:2414:in `map'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend.rb:90:in `datasources'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend.rb:115:in `datasourcefiles'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend/yaml_backend.rb:17:in `lookup'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend.rb:270:in `lookup'
org/jruby/RubyKernel.java:1242:in `catch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend.rb:268:in `lookup'
org/jruby/RubyArray.java:1613:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/backend.rb:263:in `lookup'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera.rb:116:in `lookup'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera_puppet.rb:11:in `lookup'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/puppet_function.rb:72:in `lookup'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/puppet_function.rb:51:in `hiera_with_default'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:45:in `invoke'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:35:in `dispatch'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:44:in `call'
/etc/puppetlabs/code/environments/production/modules/ruby/manifests/init.pp:8:in `call_function'
org/jruby/RubyKernel.java:1079:in `eval'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:276:in `call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:274:in `call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:917:in `call_function_with_block'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:886:in `eval_CallNamedFunctionExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:355:in `eval_AssignmentExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'
org/jruby/RubyArray.java:1613:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:182:in `evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'
org/jruby/RubyArray.java:1613:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:395:in `evaluate_classes'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions/include.rb:35:in `real_function_include'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions.rb:174:in `function_include'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions.rb:167:in `function_include'
/etc/puppetlabs/code/environments/production/modules/base/manifests/init.pp:8:in `stack'
org/jruby/RubyKernel.java:1079:in `eval'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:30:in `stack'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:285:in `call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:917:in `call_function_with_block'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:886:in `eval_CallNamedFunctionExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'
org/jruby/RubyArray.java:1613:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:182:in `evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'
org/jruby/RubyArray.java:1613:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:395:in `evaluate_classes'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions/include.rb:35:in `real_function_include'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions.rb:174:in `function_include'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions.rb:167:in `function_include'
/etc/puppetlabs/code/environments/production/manifests/site.pp:52:in `stack'
org/jruby/RubyKernel.java:1079:in `eval'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:30:in `stack'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:285:in `call_function'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:917:in `call_function_with_block'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:886:in `eval_CallNamedFunctionExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'
org/jruby/RubyArray.java:1613:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:179:in `evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:944:in `with_guarded_scope'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:177:in `evaluate_code'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:555:in `evaluate_ast_node'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:178:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:178:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:241:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:162:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:266:in `compile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:264:in `compile'
2016-10-23 11:40:13,812 ERROR [qtp498843368-26] [puppetserver] Puppet Evaluation Error: Error while evaluating a Function Call, undefined method `empty?' for nil:NilClass at /etc/puppetlabs/code/environments/production/modules/ruby/manifests/init.pp:8:15 on node puppet-client
2016-10-23 11:40:13,813 ERROR [qtp498843368-26] [puppetserver] Puppet Server Error: Evaluation Error: Error while evaluating a Function Call, undefined method `empty?' for nil:NilClass at /etc/puppetlabs/code/environments/production/modules/ruby/manifests/init.pp:8:15 on node puppet-client{code}

It seems that there is a problem with some hiera lookups. It doesn't find the source files.",Bug,PUP-7784,['maintenance'],Applying catalog with puppetserver fails but succeeds with puppet master
"I made the following error, using break() instead of return()
{code:java}
class foobar {                                                                                                                                                           
  if $facts['hostname'] == 'blah' {
    break()
  }
     # some code                                                                                                                                                                                 
}  
{code}

And I got this error on host blah:

{code:java}
# puppet agent -t
Info: Using configured environment 'common'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Puppet::Pops::Evaluator::PuppetStopIteration on node blah.example.com
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{code}

A more readable error would be highly appreciated. Thanks for taking this into consideration.",Bug,PUP-7783,[],error message when using break() instead of return() is hard to understand
"I'm trying to install a package as followed:

{code}
  package { 'unifi':
    ensure => latest
  }
{code}

The error I get with --debug:

{code}
Debug: Prefetching pacman resources for package
Debug: Executing '/usr/bin/pacman -Q'
Debug: Executing '/usr/bin/pacman -Sgg'
Debug: Executing '/usr/bin/pacman -Q'
Debug: Executing '/usr/bin/pacman -Sgg unifi'
Error: /Stage[main]/Unifi/Package[unifi]: Could not evaluate: undefined method `encoding' for #<IO:(closed)>
Did you mean?  set_encoding
Notice: /Stage[main]/Unifi/Service[unifi]: Dependency Package[unifi] has failures: true
{code}

Did some digging, and the command it's failing on is where it checks for package groups: https://github.com/puppetlabs/puppet/blob/5.0.0/lib/puppet/provider/package/pacman.rb#L102

So it calls execpipe with the command, and the command returns 1 because the group doesn't exist, but otherwise returns no output. This lands us here: https://github.com/puppetlabs/puppet/blob/5.0.0/lib/puppet/util/execution.rb#L86

The act of returning ""output"" as part of the exception attempts to stringify it. It's a closed IO pipe, so that fails when trying to call "".encoding"". I confirmed this by replacing ""output"" on the raise line with an empty string, which fixed the error.",Bug,PUP-7782,[],execpipe raises method error if the command fails with no output
"Since RHEL 7.4 an new yum repo option is available to verify the payload of an rpm package.
See [here|https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7-Beta/html/7.4_Release_Notes/new_features_system_and_subscription_management.html] for the description of it. ",Bug,PUP-7781,[],yumrepo don't support payload_gpgcheck option
"Currently the Redhat provider only calls ""service"" when interacting with services even with ""systemd"". Sysv init scripts require ""systemctl"" to be used. It would save customer effort if the Redhat provider checked for a SysV-style init script to determine whether the ""service"" or ""systemctl"" should be used for an service.
",Improvement,PUP-7780,"['provider-selection', 'redhat', 'service', 'systemd', 'triaged', 'type_and_provider']","Enhance the Redhat provider to check for SysV-style init script to determine whether the ""service"" or ""systemctl"" should be used for an service. "
"In [PUP-1874] and [PUP-2560] we unwisely removed a useful bit of functionality: the ability to upload facts to the master independent of catalog request. The implementation talked to a deprecated API, and what we should have done was to improve the server API, not remove the functionality completely. Users find this extremely useful (see PUP-5934) and it's an important stepping stone on the road to asynchronous catalog compilation in Direct Puppet.

This ticket should track the re-implementation of this functionality. There are two parts:
1. a command line executable which, when run, gathers facts and uploads them to the puppet master
2. an endpoint on the puppet-server which receives the facts and submits them to PuppetDB. This endpoint should be subject to tk-auth rules that permit a node to replace its own facts.  (The documented workaround of having endpoints upload their facts directly to puppetdb is unsuitable because most sites do not expose the puppetdb API to endpoints at all.)

",Epic,PUP-7779,['usability'],Re-implement `puppet facts upload` and associated server endpoint
"on a normal monolithic install of PE it returns this
root@gfdxbk6b87s3nyd ~]# puppet master --configprint logdir
/var/log/puppetlabs/puppet

But there is absolutely nothing in that dir.
Either it should be fixed to give something of use (probably puppetserver log dir) Or it should be removed so as not to cause confusion for our customers.
",Task,PUP-7778,[],puppet master --configprint logdir give s directory of no use
"This is a clone of SERVER-684, I'm hitting the very same issue with a Debian Stretch server (4.8.2) and a Debian Jessie agent (3.7.2). After upgrading the agent to 4.8.2 as well source_permissions => use starts to work.

---

The file_metadata endpoint has a query parameter called {{source_permissions}} with possible values {{ignore}}, {{use}}, or {{use_when_creating}}.

The 3.x agent and master defaulted to {{use}}, but this changed in 4.x to {{ignore}}.  In addition, 3.x agents ""rely"" on this default value matching on both sides and therefore don't bother specifying a value when making requests.

This is problematic for 3.x agents talking to a 4.x master, as the default value has changed and the agent doesn't explicitly specify it. For comparison, the 4.x agents explicitly specify the value when making the request.

This behavior will break external executable facts (they won't be executable on the agent) for 3.x agents talking to 4.x master. 

We should modify the {{legacy_routes_service}} to reconcile this difference and append {{source_permissions=use}} to file_metadata requests made to the old URLs (unless of course it's already specified, which agent 3.x agents won't).

We already have failing acceptance tests in CI for this: https://jenkins.puppetlabs.com/job/platform_puppet-server_integration-system_no-conditional_puppet3-compat_master/18/",Bug,PUP-7777,[],"Append ""source_permissions=use"" to 3.x file_metadata requests"
"If the test is running at just the right time, it can fail because the first check of the puppetserver log is in one days log file, and then if we cross into the next day, a check of the log file fails because the log has rotated into the next day.",Bug,PUP-7776,[],tests/loader.autoload_from_resource_type_decl.rb fails when the test crosses into a new day
Add test ensuring that a new file resource can receive owner and group permission for a new user when purging unmanaged users in the same catalog.,Task,PUP-7775,[],Acceptance: add test ensuring new file can receive owner of new user when purge unmanaged users
"The test installs a {{guid}} gem and package, but the package cannot be installed in the Amazon Linux environment:

{noformat}
14:43:31       ec2-35-166-77-127.us-west-2.compute.amazonaws.com (redhat6-64-2) 14:43:31$ puppet apply --verbose /tmp/apply_manifest.pp.xrEZ1D
14:43:31         Notice: Compiled catalog for ec2-35-166-77-127.us-west-2.compute.amazonaws.com in environment production in 0.62 seconds
14:43:33         Info: Applying configuration version '1499895812'
14:43:33         Error: Execution of '/usr/bin/yum -d 0 -e 0 -y install guid' returned 1: Error: Nothing to do
14:43:34         Error: /Stage[main]/Main/Package[guid]/ensure: change from purged to present failed: Execution of '/usr/bin/yum -d 0 -e 0 -y install guid' returned 1: Error: Nothing to do
14:43:34         Notice: /Stage[main]/Main/Package[gem-guid]/ensure: created
14:43:36         Info: Class[Main]: Unscheduling all events on Class[Main]
14:43:36         Notice: Applied catalog in 2.66 seconds
{noformat}",Bug,PUP-7774,[],Acceptance tests/resource/package/common_package_name_in_different_providers.rb fails in Amazon Linux
"Windows hosts files are encoded as ANSI, however some devices and software write entries to the hosts file in other encodings such as UTF-16. Puppet consumes the hosts file as Encoding.default_external instead of recognizing the UTF-16LE BOM and then writes the file back out as Encoding.default_external, leading to issues such as inserting whitespace between every character in the previous entries, which breaks Windows networking.

Puppet should check for a BOM in the hosts file first, then if one is detected load the file accordingly / preserve the content of the file.",Bug,PUP-7773,['windows'],Puppet should recognize BOM in a hosts file
"The chocolatey module was failing spec tests on Ruby 2.4.0 and Puppet 5.  example output
https://ci.appveyor.com/project/puppetlabs/puppetlabs-chocolatey/build/1.1.x.379/job/8k8kvkt9moka317t
{code}
...
Failures:
  1) Puppet::Type::Package::ProviderChocolatey when fetching a package list should invoke provider listcmd
     Failure/Error:
       execpipe(listcmd) do |process|
         process.each_line do |line|
           line.chomp!
           if line.empty? or line.match(/Reading environment variables.*/); next; end
           raise Puppet::Error, ""At least one source must be enabled."" if line.match(/Unable to search for packages.*/)
           if choco_exe
             values = line.split('|')
           else
             values = line.split(' ')
           end
     NoMethodError:
       undefined method `encoding' for #<IO:(closed)>
       Did you mean?  set_encoding
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/character_encoding.rb:93:in `scrub'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/error.rb:6:in `initialize'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/execution.rb:86:in `exception'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/execution.rb:86:in `raise'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/execution.rb:86:in `execpipe'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/provider.rb:117:in `execpipe'
     # ./lib/puppet/provider/package/chocolatey.rb:198:in `instances'
     # ./spec/unit/puppet/provider/package/chocolatey_spec.rb:432:in `block (3 levels) in <top (required)>'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:254:in `instance_exec'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:254:in `block in run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:500:in `block in with_around_and_singleton_context_hooks'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:457:in `block in with_around_example_hooks'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/hooks.rb:464:in `block in run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/hooks.rb:602:in `run_around_example_hooks_for'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/hooks.rb:464:in `run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:457:in `with_around_example_hooks'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:500:in `with_around_and_singleton_context_hooks'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:251:in `run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:627:in `block in run_examples'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:623:in `map'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:623:in `run_examples'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:589:in `run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:590:in `block in run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:590:in `map'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:590:in `run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:118:in `block (3 levels) in run_specs'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:118:in `map'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:118:in `block (2 levels) in run_specs'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/configuration.rb:1894:in `with_suite_hooks'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:113:in `block in run_specs'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/reporter.rb:79:in `report'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:112:in `run_specs'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:87:in `run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:71:in `run'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:45:in `invoke'
     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/exe/rspec:4:in `<top (required)>'
     # C:/Ruby24/bin/rspec:23:in `load'
     # C:/Ruby24/bin/rspec:23:in `<main>'
Finished in 2.06 seconds (files took 2.91 seconds to load)
194 examples, 1 failure
Failed examples:
{code}

Further digging found:
1.  The spec test is ending up with a nil value for the command_str which causes the open command to error
https://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/execution.rb#L80

2. This error is then caught however instead of {{output}} having the output of the command, it has the output of the failed open state, i.e. an IO<closed> object

3. This is then raised as an error at
https://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/execution.rb#L86

4. The error class  is then initialized and the new scrub function called at;
https://github.com/puppetlabs/puppet/blame/master/lib/puppet/error.rb#L6

5. The scrub function at;
https://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/character_encoding.rb#L89-L96

Then tries to scrub the object, however it assumes that it's a string, but what's passed in is an IO object.  This then fails on (https://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/character_encoding.rb#L89-L96) because it does not have an encoding method.

This only appears to have started in Puppet 5.

Possible resolutions:
1. Scrub function should not assume it's a string coming in.  If it's not a string, just spit the original value out.

2. The execpipe should not assume the output is a string and should cast output to a string prior to raising the error message",Bug,PUP-7772,[],Puppet fails to create error message when an exec fails
"Executed the test suite on SLES distributions. The SLES distributions specific failure is

{noformat}
Failures:

  1) Puppet::SSL::Key with a custom user-specified passfile should export the private key to PEM using the password
     Failure/Error: @content = OpenSSL::PKey::RSA.new(Puppet[:keylength].to_i)

     OpenSSL::PKey::RSAError:
       BN lib
     # ./lib/puppet/ssl/key.rb:25:in `initialize'
     # ./lib/puppet/ssl/key.rb:25:in `new'
     # ./lib/puppet/ssl/key.rb:25:in `generate'
     # ./spec/integration/ssl/key_spec.rb:78:in `block (3 levels) in <top (required)>'

Failed examples:

rspec ./spec/integration/ssl/key_spec.rb:71 # Puppet::SSL::Key with a custom user-specified passfile should export the private key to PEM using the password
{noformat}

Same test is passing on Ubuntu distribution.

Thanks & Regards,
Snehal",Bug,PUP-7771,[],Puppet::SSL::Key test failure on SLES distributions
"The pip package provider cannot manage the installation of setuptools, distribute, or wheel as they are excluded from the output of ""pip freeze"".  What happens is that puppet tries to install them on every run because it does not know they are installed.  In versions of pip newer than 8.0.3 there is an ""--all"" flag that can be passed to pip to list them.  PR is incoming to fix this, just wanted to have a jira ticket to reference :).",Bug,PUP-7770,[],Pip provider cannot manage any system python packages
"Sometimes it might be helpful or necessary for users or our support team to see English messages instead of translated ones, for debugging and Googling. We should create a Puppet setting that disables translation.",Task,PUP-7769,[],Provide a setting to disable translations
"The following type definition results in an exception when parsed.
{code:puppet}
notice(Type(@(TYPESPEC)))
Object[{
  attributes => {
    text => {
      type => String,
      value => @(TEXT)
        Some text
        |TEXT
    }
  }
}]
TYPESPEC
{code}
The following works OK though, since it is parsed by the evaluating parser.
{code:puppet}
notice(Object[{
  attributes => {
    text => {
      type => String,
      value => @(TEXT)
        Some text
        |TEXT
    }
  }
}])
{code}",Bug,PUP-7768,[],Heredoc is not accepted by the Puppet TypeParser
Puppet acceptance suite has been audited and tests tagged that should run within the server pipeline with 'server'. The puppet jobs within puppet and puppet-agent pipelines should be updated to exclude running those tests (either in ci-job-configs or in rake task).,Task,PUP-7767,[],Update puppet acceptance to exclude tests tagged 'server'
"Previously, when calling {{puppet resource}}, a {{--modulepath}} could be specified to load additional type / provider code.

For instance, with Puppet 4.10.4 / Ruby 2.3 running against a Windows node:

{code}
bundle exec puppet resource acl c:\windows --modulepath C:\source\puppetlabs-acl-master\spec\fixtures\modules
acl { 'c:\windows':
  group                      => 'S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464',
  inherit_parent_permissions => 'false',
  owner                      => 'S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464',
  permissions                => [{'affects' => 'self_only', 'identity' => 'NT SERVICE\TrustedInstaller', 'rights' => ['full']}, {'affects' => 'children_only', 'child_types' => 'containers', 'identity' => 'NT SERVICE\TrustedInstaller', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'NT AUTHORITY\SYSTEM', 'rights' => ['modify']}, {'affects' => 'children_only', 'identity' => 'NT AUTHORITY\SYSTEM', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'BUILTIN\Administrators', 'rights' => ['modify']}, {'affects' => 'children_only', 'identity' => 'BUILTIN\Administrators', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'BUILTIN\Users', 'rights' => ['read', 'execute']}, {'affects' => 'children_only', 'identity' => 'BUILTIN\Users', 'rights' => ['read', 'execute']}, {'affects' => 'children_only', 'identity' => 'CREATOR OWNER', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES', 'rights' => ['read', 'execute']}, {'affects' => 'children_only', 'identity' => 'APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES', 'rights' => ['read', 'execute']}],
}
{code}

However, on Puppet 5:

{code}
 bundle exec puppet resource acl c:\windows --modulepath C:\source\puppetlabs-acl-master\spec\fixtures\modules --trace --debug --verbose
Debug: Runtime environment: puppet_version=5.0.0, ruby_version=2.4.1, run_mode=user, default_encoding=IBM437
Debug: Evicting cache entry for environment 'production'
Debug: Caching environment 'production' (ttl = 0 sec)
Error: Could not run: Could not find type acl
C:/source/puppet/lib/puppet/application/resource.rb:193:in `parse_args'
C:/source/puppet/lib/puppet/application/resource.rb:134:in `block in main'
C:/source/puppet/lib/puppet/context.rb:65:in `override'
C:/source/puppet/lib/puppet.rb:308:in `override'
C:/source/puppet/lib/puppet/application/resource.rb:133:in `main'
C:/source/puppet/lib/puppet/application.rb:366:in `run_command'
C:/source/puppet/lib/puppet/application.rb:358:in `block in run'
C:/source/puppet/lib/puppet/util.rb:666:in `exit_on_fail'
C:/source/puppet/lib/puppet/application.rb:358:in `run'
C:/source/puppet/lib/puppet/util/command_line.rb:132:in `run'
C:/source/puppet/lib/puppet/util/command_line.rb:72:in `execute'
C:/source/puppet/bin/puppet:5:in `<top (required)>'
C:/source/puppet/.bundle/gems/ruby/2.4.0/bin/puppet:22:in `load'
C:/source/puppet/.bundle/gems/ruby/2.4.0/bin/puppet:22:in `<main>'
{code}

I was able to git bisect to determine the source of the problem in https://github.com/puppetlabs/puppet/commit/72ecbe429ce5136ffe4ab628672d6dc9faabfcdc

It seems that only code in the extended environment directory will now be loaded, which is a regression from previous behavior.  I believe that {{--modulepath}} is commonly in use for module development workflows.  For instance, I have been using the below for several years:

{code}
bundle exec rake spec_prep

# work on code

# run unit tests
bundle exec rake spec_standalone

# run interactive tests with apply or resource
bundle exec puppet apply foo.pp --modulepath ./spec/fixtures/modules
{code}",Bug,PUP-7766,['regression'],Puppet 5.0 Regression: puppet resource with --modulepath no longer loads expected code
Validate that the default providers for the package and service resources work as expected on Amazon Linux.,Task,PUP-7764,[],Manually test package/service default providers on Amazon Linux
"Upon playing around with Puppet 5 tonight I found that a default install gives the error message below on each run:
{code}
Warning: Setting trusted_server_facts is deprecated.
    (at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:1159:in `issue_deprecation_warning')
{code}

The default {{/etc/puppetlabs/puppet/puppet.conf}} is below:

{code}
# This file can be used to override the default puppet settings.
# See the following links for more details on what settings are available:
# - https://docs.puppetlabs.com/puppet/latest/reference/config_important_settings.html
# - https://docs.puppetlabs.com/puppet/latest/reference/config_about_settings.html
# - https://docs.puppetlabs.com/puppet/latest/reference/config_file_main.html
# - https://docs.puppetlabs.com/references/latest/configuration.html
[main]
    ca_server            = localhost
    server               = localhost
    strict_variables     = true
    trusted_server_facts = true
[agent]
{code}

It seems to me that we'd want to remove {{trusted_server_facts = true}} from the default config file.",Bug,PUP-7763,[],Update documentation for recommended trusted_server_facts setting
"The lambda iterator function each() was broken in Puppet 5 for array as an input parameter.

Note the following trivial example:

{code:puppet}
['foo', 'bar'].each |String $string| {
  notify { $string: }
}
{code}

works as expected in Puppet 4.10.4 but throws the error:

{noformat}
Error: Expression is not valid as a resource, resource-default, or resource-override
{noformat}

in Puppet 5.0.0.

I have verified that a hash as an input parameter to each() and array as an input parameter to slice() both work correctly in Puppet 5, so this bug is isolated.

Note SO question I opened over this: https://stackoverflow.com/questions/44958689/lambda-iterator-over-array-parameter-input-broken-in-puppet-5",Bug,PUP-7762,[],Lambda iterator function each() does not accept array as input parameter
"When using Puppet in a Beaker acceptance test to configure a user with a null password (in order to later test to ensure that null passwords would not be permitted to authenticate) I discovered a bug in Puppet when creating users with null passwords.

Given a manifest like:
{code}
user { 'testuser': password => '' }
{code}

It requires two Puppet runs to obtain the desired state.

This is due to https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/useradd.rb#L164 where properties with empty strings are not included.",Bug,PUP-7761,[],New users with null passwords not created correctly
"In Puppet 5.0.0 when converting an Array of strings to a comma separated String I use the following format specification to convert and Array of path strings to a path String:

{code}
$path_string_format = {
    Array => {
      format         => '% a',
      separator      => ':',
      string_formats => {
        String => '%s'
      }
    }
  }
{code}

Given an array of paths:
{code}
$paths=['/path/to/dir','/another/path/to/dir']
$path_string=String($paths,$path_string_format)
{code}

The expected output is {{'/path/to/dir:/another/path/to/dir'}}

However the output is {{'/path/to/dir: /another/path/to/dir'}}

The String formatting has appended a trailing space to the separator.

A workaround exists if the string is used in an {{.erb}} template by expressing the string like this:

{code}
<%= @path_string.gsub(/\s+/, """") %>
{code}

Reading the documentation there does not seem to be a flag or format option to remove this automatic addition of a space.

Being able to eliminate this space would completely remove the need for the {{join}} function from {{puppetlabs/stdlib}}
",Improvement,PUP-7760,[],Array to String formatter adds a trailing space to a separator
"Hi,

Here is the simple code:

{code:puppet}
file { ""/tmp/foo"":
  ensure  => file,
  content => ""foo\n"",
}

{'a' => '1', 'b' => '2'}.each |$k, $v| {
  notice($k)
}
{code}

Here is the error:

{code:bash}
~# puppet --version
4.10.4

~# puppet apply /tmp/test.pp 
Error: Could not parse for environment production: Syntax error at '=>' at /tmp/test.pp:6:6 on node test.athome.priv
{code}

But the code works well with a {{;}} like that:

{code:puppet}
file { ""/tmp/foo"":
  ensure  => file,
  content => ""foo\n"",
}; # <=== Here!

{'a' => '1', 'b' => '2'}.each |$k, $v| {
  notice($k)  
}
{code}

or via a temporary variable:

{code:puppet}
file { ""/tmp/foo"":
  ensure  => file,
  content => ""foo\n"",
}

$var = {'a' => '1', 'b' => '2'}

$var.each |$k, $v| {
  notice($k)  
}
{code}

Sorry in advance if it's not a bug.",Bug,PUP-7759,[],Is it a parser bug?
"pkg list [-n|-a] are currently used in the pkg provider to find latest/available packages. 

This method is imprecise; current logic later uses `pkg update -nv name` to determine if a package can be installed.

This logic can be reduced to `pkg update -nv name[@should]` 
Additionally,  --parsable=0 can be added to return json formatted results. 

pkg update also triggers a metadata refresh which also solves the workaround of adding a manual refresh PUP-7745.",Improvement,PUP-7758,"['package', 'solaris', 'triaged', 'type_and_provider']",package should use update instead of list on Solaris
"The following puppet expression is valid:
{code:puppet}
notice(Timestamp('1969-08-20T20:18:00 UTC, one giant leap for mankind'))
{code}
will run without errors and notice:
{code}
1969-08-20T20:18:00.000000000 UTC
{code}
This is because one of the default formats successfully parsed the string and managed to satisfy all of its format specifiers.

It would be desirable if Puppet could detect that the string contains trailing garbage and raise an error. Doing so is not trivial however. The {{Timestamp}} class currently relies on the {{DateTime#strptime}} function which provides no means to detect the garbage so solving this means writing a new parser.",Improvement,PUP-7757,[],Successful parsing of timestamp should raise error unless complete string is parsed
"This ticket is to explore how we could cease supporting plugin facts on a per-environment basis.

Currently per-environment plugin facts can be used as an input to node classification, which means a node may end up issuing multiple plugin downloads and catalog requests during a single run as it attempts to reconcile its environment with the one specified in its catalog.

This goes something like this:
1) agent with 'production' environment requests catalog
2) catalog specifies 'dev' environment
3) agent plugin-syncs from 'dev' environment
4) 'dev' environment plugins include new facts
5) agent submits catalog request with new facts, resulting in different classification
6) new catalog specifies 'test' environment
7) agent plugin-syncs from 'tests' environment
...
and so on up to 4 times.

The net effect on performance is non-trivial, as a worst-case agent run can generate 4x the load and nearly as many network calls. The logic in Puppet::Configurer is overly complex to accommodate.

Eliminating per-environment facts could dramatically simplify the agent run lifecycle by reducing the number of requests and environment switching logic in the configurer. This is a backwards-incompatible change that would require some sort of workflow replacement for users relying on per-environment facts. Many modules deliver facts (this is a standard mechanism for distribution of custom facts) - making them per-environment by default.

From a workflow perspective, we should investigate
- what are the use-cases for plugin-facts that are dependent on their environment?
- are there other ways we could achieve these without using facts?
- how would we support distributing facts without placing them in modules, or is there another way?
- is this even worth it?",Improvement,PUP-7755,[],[research] workflow replacement for per-environment (plugin-sync) facts
"The agent issues a node request via the indirector among the first things it does. The agent sets its environment of the environment of the returned node. However, the agent does not send its facts with this node request. This means the classifier queries the facts indirection, which loads them from a facts yaml cache for the node if available, or (as would be the case if this the first node check-in) queries puppetdb for the facts (possibly returning none).

This server-side facts search is possibly slow, especially if querying PDB under load.

The agent doesn't do anything with the facts (parameters) returned with the node request. Next the agent downloads plugins/plugin-facts, runs facter to resolve facts, and then issues the catalog request with the facts.

The agent could instead query local facts before the node request, and send the agent's facts with the node request so that the classifier does not query them. The agent would still have to subsequently download plugins/plugin-facts and evaluate these, but we could explicitly only search the plugin paths when evaluating facts the second time, and then merge these with the recently queried facts used in the node request. This would be a backwards-compatible change likely unseen by users.

Note that with this change, we would effectively eliminate the need for a yaml facts cache, as neither the node nor catalog request would rely on a facts lookup. Per [~josh]'s comment in PUP-7662, we could add a new setting value to disable the facts cache terminus by default (though users could still enable it).

The upside to this change is we eliminate the last of the potentially costly facts lookups by the classifier during an agent run. A potential downside is that we would also need to (be able to) deserialize the submitted facts in the node terminus. While not necessarily complicated from a code perspective, I'm not sure what the performance hit of doing so would be, if any. I assume the PDB terminus already does something similar so it seems reasonable that this would equal out/offset.

*In Scope*
* Modify Puppet::Configurer so that local facts are queried and then submitted with the node request
* These facts should be merged with those subsequently downloaded via plugin-sync. To evaluate plugin-synced facts, facter should explicitly only evaluate the plugin sync paths, not the default facts so that we avoid evaluating the core facts twice
* The node classifier terminus should be modified to accept a serialized facts body if submitted with the request, and deserialize them for use during the node lookup. This should be done in a backwards-compatible way so that newer agents can still talk to older masters and older agents can talk to newer masters
* Disable caching yaml facts in puppet server by default
* This is accomplished by setting {{Puppet\[:facts_cache_terminus\]}} setting to {{none}} by default and then setting {{Puppet::Node::Facts.indirection.cache_class}} to the setting value, here https://github.com/puppetlabs/puppetserver/blob/master/src/ruby/puppetserver-lib/puppet/server/puppet_config.rb.",Improvement,PUP-7754,[],[performance] Send facts with node request during agent run
"When you have Timestamp process a time stamp, it can choose to only process some of the string without providing any feedback on it. For example:

notice(Timestamp('1970-01-01 01:02:03 UTC'))

Will result in a timestamp of ""1970-01-01T00:00:00.000000000 UTC""",Bug,PUP-7753,[],Timestamp doesn't provide a default format for date and time separated by space
"{{tests/resource/service/service_enable_linux.rb}} fails because the test interprets the {{majrelease}} version of {{2017}} to be greater than {{6}} and assumes that it is using {{systemd}} to manage services. Since Amazon Linux verison {{2017.03}} is built upon Redhat 6, it uses SysV and cannot find the systemd files referenced in the test.",Bug,PUP-7752,[],Acceptance test tests/resource/service/service_enable_linux.rb fails on Amazon Linux
"When specifying sort_merged_arrays in hiera data as shown here:

{noformat}
lookup_options:
  classifier::extra_classes:
    merge:
      strategy: deep
      knockout_prefix: --
      sort_merged_arrays: true
  classifier::rules:
    merge:
      strategy: deep
      knockout_prefix: --
{noformat}

the compiler fails:

{noformat}
Error: Evaluation Error: Error while evaluating a Function Call, The merge options has wrong type, unrecognized key 'sort_merged_arrays' at /home/user/.puppetlabs/etc/code/environments/production/manifests/site.pp:4:3 on node notebook.local
{noformat}

spelling it {{sort_merge_arrays}}  fixes the problem.

also this snippet fails: 

{noformat}
  lookup({
    'name' => 'classifier::rules',
    'merge' => {
      'strategy' => 'deep',
      'sort_merged_arrays' => true,
     },
  })
{noformat}

output:

{noformat}
Error: Evaluation Error: Error while evaluating a Function Call, The merge options has wrong type, unrecognized key 'sort_merged_arrays' at /home/user/.puppetlabs/etc/code/environments/production/manifests/site.pp:4:3 on node notebook.local
{noformat}

Grepping the puppet git repo there are different places where sort_merge_arrays and sort_merged_arrays is used.

sort_merged_arrays is documented here: https://docs.puppet.com/puppet/5.0/hiera_use_function.html",Bug,PUP-7751,[],Lookup sort_merged_arrays vs. sort_merge_arrays
"I was playing around with FreeBSD 11 today and found that running {{puppet resource service}} failed with the error {{Error: Could not run: undefined method `gsub' for nil:NilClass}}. After doing some testing I believe it is due to Puppet not handling the results of running {{/etc/rc.d/bluetooth rcvar}}. Details and related examples below:

{code}
# note that there is not a line that says anything about enable in this service
➜  ~ service bluetooth rcvar
# bluetooth : Bluetooth setup script
#

➜  ~ service sshd rcvar
# sshd : Secure Shell Daemon
#
sshd_enable=""YES""
#   (default: """")

➜  ~ service ntpd rcvar
# ntpd : Network Time Protocol daemon
#
ntpd_enable=""NO""
#   (default: """")

➜  ~ puppet resource service bluetooth
Error: Could not run: undefined method `gsub' for nil:NilClass
{code}

Initially I was using the version of Puppet installed by running {{pkg install puppet4}} which brought in Puppet 4.10.0. I uninstalled that and installed the Puppet 5.0.0 gem and got the same results.

When looking in {{/etc/rc.d/bluetooth}} I noticed that {{rcvar=}} isn't set to anything whereas {{/etc/rc.d/sshd}} is set to {{rcvar=""sshd_enable""}}. Attached are copies of both files.",Bug,PUP-7750,"['cli', 'freebsd', 'help_wanted', 'service', 'triaged', 'type_and_provider']",puppet resource service fails on FreeBSD 11
"h2. Request
Request for the ability of puppet server to read custom fact extensions from the X509v3 Extended Key Usage section of the certificate.

h2. Explanation

When using an external CA, it is sometimes not possible to place trusted fact objects in the top-level extension section: 

X509v3 extensions 


h2. Example 

For example, the standard offering from Microsoft facilitates adding data into the ""X509v3 Extended Key Usage"", which puppet server does not read from.


",New Feature,PUP-7749,[],"Puppet to read ""X509v3 Extended Key Usage"" for trusted facts"
"If a large number of puppets are requested by the puppet server, when the puppet server's CPU load is too high and returns 502,503, the puppet client (3.8.7) has a chance to change the configuration file content and directory


PUPPET CONFIG
class redis( $redis_config ) {

  realize(
  Package[""redis-server""]
  )

  file {
    ""sys-redis"":
      name    => ""/etc/redis.conf"",
      mode    => 0644, owner => root, group => root,
      ensure  => present,
      force => true,
      source  => [ ""puppet://${puppet_server}/redis/$redis_config/redis.conf"",
                          ""puppet://${puppet_server}/redis/default/redis.conf"", ],
      require => Package[""redis-server""],
      notify  => Exec[""restart-redis""],
  }

  exec { ""restart-redis"":
    command => ""service redis restart"",
    require => Service[""redis""],
    refreshonly => true,
  }

  service { ""redis"":
    ensure => running,
    enable => true,
    hasrestart => true,
    require => [ Package[""redis-server""],File[""/etc/redis.conf""] ],
  }
}

---
  file { ""zbjsync_exclude.list"":
    ensure  => present,
    force => true,
    replace => true,
    mode    => 0644, owner => root, group => root,
    name    => ""/etc/zbjsync_exclude.list"",
    source  => [ ""puppet://${puppet_server}/zbj-sync/${zbj_sync_config}/zbjsync_exclude.list"",
                 ""puppet://${puppet_server}/zbj-sync/default/zbjsync_exclude.list"", ],
    require => Package[""zbj-sync""],
  }",Bug,PUP-7748,['puppet-agent'],[Fatal] puppet(3.8.7)The puppet changes the contents of the configuration file or becomes a directory
The bug detected in MODULES-5159 was fixed in [PR-26 for semantic_puppet|https://github.com/puppetlabs/semantic_puppet/pull/26] and subsequently released in version 1.0.1 of the gem. This fix must be propagated to the gem that is vendored in the puppet code-base.,Bug,PUP-7747,[],Update vendored version of the semantic_puppet gem to version 1.0.1
"Using the {{4.10.x}} branch and {{puppet-agent}} build {{4.99.0.363.g96b104a}}, the following acceptance tests fail on Amazon Linux.

{code}
tests/resource/package/common_package_name_in_different_providers.rb
tests/resource/service/service_enable_linux.rb
tests/modules/uninstall/with_multiple_modules_installed.rb
{code}

See attached Beaker log for details",Task,PUP-7746,[],Triage acceptance failures on Amazon Linux
"The current behavior from `latest` does not refresh package metadata. 

Simply adding `pkg(:refresh)` to `latest` addresses the minor issue. 

A refactor to use `pkg update -n res` will be undertaken at a later date.",Bug,PUP-7745,[],package latest method does not refresh metadata on Solaris
"Using the 'puppet node purge' command it is possible to put duplicate revoked certificates in Puppet's CRL.  For example:

{noformat}
# puppet cert generate testcert
Notice: testcert has a waiting certificate request
Notice: Signed certificate request for testcert
{noformat}

Now purge the node / certificate:

{noformat}
puppet node purge testcert
Notice: Revoked certificate with serial 650
Notice: Removing file Puppet::SSL::Certificate testcert at '/etc/puppetlabs/puppet/ssl/ca/signed/testcert.pem'
Notice: Removing file Puppet::SSL::Certificate testcert at '/etc/puppetlabs/puppet/ssl/certs/testcert.pem'
Notice: Removing file Puppet::SSL::Key testcert at '/etc/puppetlabs/puppet/ssl/private_keys/testcert.pem'
Node ""testcert"" was purged.
{noformat}

But if we purge it again...

{noformat}
puppet node purge testcert
Notice: Revoked certificate with serial 650
{noformat}

You can see that additional lines are added by looking at the output before / after the purge:

{noformat}
openssl crl -in ca_crl.pem -noout -text | grep Serial | wc -l
{noformat}

I suspect that PUP-2189 might contribute to this.  I also suspect that the larger a CRL file gets the more likely it is to become corrupted, as it takes longer to hold open the file and add a long list of redundant serial numbers.",Bug,PUP-7744,['ca'],Puppet CA's CRL is prone to duplicate entries
"Puppet currently uses [CreateSymbolicLinkW|https://msdn.microsoft.com/en-us/library/windows/desktop/aa363866%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396] to handle symlink support on Windows at https://github.com/puppetlabs/puppet/blob/f2aa573b887a93fb309c8db039b0914db85187fe/lib/puppet/util/windows/file.rb#L86-L94

However, DeviceIoControl can also be used to create junctions (aka reparse points) that behave similarly, but do not require Administrative tokens.

See:

https://www.codeproject.com/Articles/15633/Manipulating-NTFS-Junction-Points-in-NET
http://www.flexhex.com/docs/articles/hard-links.phtml#junctions

There are some slight differences in behavior that should be carefully weighed. Especially look at https://superuser.com/questions/343074/directory-junction-vs-directory-symbolic-link
",Bug,PUP-7743,[],SPIKE Consider replacing Windows CreateSymbolicLink with directory junctions
"When using ""resources { 'user': purge => true }"", a file owned by a puppet-managed user cannot be created when that user is being created in the same run.

Simple test case:

{code:title=test.pp}
group { 'test':
  ensure => 'present',
  system => true,
}

user { 'test':
  ensure => 'present',
  system => true,
  groups => [],
}

file { '/tmp/test':
  ensure => 'file',
  owner  => 'test',
  group  => 'test',
  mode   => '0644',
}

resources { 'user':
  purge => true,
}
{code}

Under CentOS 7.3, this successfully creates the user and group, and creates the /tmp/test file with ownership root:root (should be test:test), and errors:

{code}
[vagrant@hashiserver-1 vagrant]$ sudo puppet apply test.pp 
Notice: Compiled catalog for hashiserver-1.node.vagrant.consul in environment production in 0.12 seconds
Notice: /Stage[main]/Main/Group[test]/ensure: created
Notice: /Stage[main]/Main/User[test]/ensure: created
Error: Could not set 'file' on ensure: Could not find user test at /vagrant/test.pp:12
Error: Could not set 'file' on ensure: Could not find user test at /vagrant/test.pp:12
Wrapped exception:
Could not find user test
Error: /Stage[main]/Main/File[/tmp/test]/ensure: change from absent to file failed: Could not set 'file' on ensure: Could not find user test at /vagrant/test.pp:12
Notice: Applied catalog in 0.29 seconds
{code}

A subsequent ""sudo puppet apply test.pp"" completes successfully.

This problem was introduced in puppet-agent 4.10.2.",Bug,PUP-7742,[],Regression: cannot set file owner to new user when purging unmanaged users
"Currently, the pre-suites for puppet acceptance testing install puppetserver from a repo that is not available from EC2. This pre-suite should be amended to facilitate the installation of puppetserver 'latest' or a given {{SERVER_VERSION}} value on EC2.",Task,PUP-7740,[],Enable acceptance pre-suite to install puppetserver on EC2
"Need to regen the man pages, especially puppet.conf docs due to settings changes, removed {{puppet inspect}}. There's a separate ticket to add automation to handle this.",Task,PUP-7739,[],Need to regen man pages for 5.0.x
"We have a Puppet 4.10.x pipeline running librarian puppet to install modules from Puppetfile. 

This now failes on Puppet 5.0 with: 

{noformat}
10:51:05 10:51:05 Error executing puppet module install. Check that this command succeeds:
10:51:05 10:51:05 puppet module install --version 4.17.1 --target-dir /xxxx/.tmp/librarian/cache/source/puppet/forge/forgeapi_puppetlabs_com/puppetlabs-stdlib/4.17.1 --module_repository https://forgeapi.puppetlabs.com --modulepath /xxxx/.tmp/librarian/cache/source/puppet/forge/forgeapi_puppetlabs_com/puppetlabs-stdlib/4.17.1 --module_working_dir /xxxx/.tmp/librarian/cache/source/puppet/forge/forgeapi_puppetlabs_com/puppetlabs-stdlib/4.17.1 --ignore-dependencies puppetlabs-stdlib
10:51:05 10:51:05 Error:
10:51:05 10:51:05 Warning: Support for ruby version 2.0.0 is deprecated and will be removed in a future release. See https://docs.puppet.com/puppet/latest/system_requirements.html#ruby for a list of supported ruby versions.
10:51:05 10:51:05    (at /yyyyy/gems/ruby/gems/puppet-5.0.0/lib/puppet.rb:181:in `<module:Puppet>')
10:51:05 10:51:05 Error: wrong number of arguments (2 for 1)
10:51:05 10:51:05 Error: Try 'puppet help module install' for usage
{noformat}",Bug,PUP-7738,[],"""bundle exec puppet module install"" fails on Puppet 5.0.0"
"This ticket is dependent upon the work being discussed in SERVER-1543 and PUP-5069 to enhance {{Puppet::Network::HttpPool}} with configurable support for setting whether or not the ""system"" truststore should be included for HTTP client requests.  For this ticket, we would introduce a new Puppet setting that the HTTP report processor would use to control how the corresponding {{HttpPool}} setting is configured.

We'll need to decide what the default for the setting would be.  As [~chuck] argued in [this comment in SERVER-1543|https://tickets.puppetlabs.com/browse/SERVER-1543?focusedCommentId=457612&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-457612], it may make set to set this to ""true"" by default to make it easier for users to use the HTTP report processor with an externally hosted receiver which is using a cert issued outside of Puppet's PKI, e.g., on a public AWS instance.  Defaulting to ""true"" may constitute a security risk for users accustomed to only having the Puppet PKI cert bundle used.",Task,PUP-7737,['the-goods'],Add HTTP report processor setting for including system truststore
"Most of the machines we use at build-time do not have puppet/facter installed as gems. The generate_ast_model rake task requires puppet (which in turn requires facter), which causes gem and tarball generation to fail since the build environment can't load facter and the Rakefile loads all rake files under tasks.

The generate_ast_model tasks are not required at build time and as such should be conditionally enabled, if we are able to successfully load puppet.

",Bug,PUP-7736,[],Puppet 5 adds generate_ast_model rake task which breaks gem/tarball creatio
"When we pass a Regexp to a class, the class understands it as a String. To wit:
{code:puppet}
{{class what (
  Regexp[/^.$/] $param,
) {
  notice('yes')
}
 
class { 'what':
  param => /^.$/,
}
{code}
{code}
$ puppet apply /tmp/z.pp 
Error: Evaluation Error: Error while evaluating a Resource Statement, Class[Classname]: parameter 'param' expects a Regexp value, got String at /tmp/z.pp:7:1 on node cwl.hostopia.com}}

{code}

https://pastebin.com/bHJ1vqub
{code}

{{$regexp = /^.$/
notice(type($regexp))

class foo($bar) {
  notice(type($bar))
}

class { 'foo': bar => $regexp }

Notice: Scope(Class[main]): Regexp[/^.$/]
Notice: Scope(Class[Foo]): String}}
{code}

https://gist.github.com/richardc/1380cda39d7bebca19ddc9dc06fb1a16

Functions seem better though.

{code:puppet}
# From <Volcane> 
function x(Regexp $thing) { notice(type($thing)) }
{code}
happily works.",Bug,PUP-7735,[],Regexp class parameter being understood as a String
"This happens whenever the existing environment doesn't match what the ENC sets, which is fine (names in this post have been changed):
{code}
Notice: Local environment: 'production' doesn't match server specified node environment 'realenv', switching agent to 'realenv'.
{code}
If I use ""environment = otherrealenv"" (something which exists) in the [agent] section of puppet.conf then I get the same error message, which is fine. 
{code}
Notice: Local environment: 'otherrealenv' doesn't match server specified node environment 'realenv', switching agent to 'realenv'.
{code}
However, when I use an environment that has never existed or previously existed but was removed, things break.
{code}
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: Find /puppet/v3/node/myhost.me.com?environment=fakeenv&configured_environment=fakeenv&t... resulted in 404 with the message: {""message"":""Not Found: Could not find environment 'fakeenv'"",""issue_kind"":""RUNTIME_ERROR""}
Info: Retrieving pluginfacts
Error: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve information from environment fakeenv source(s) puppet:///pluginfacts
Info: Retrieving plugin
Error: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve information from environment fakeenv source(s) puppet:///plugins

(Many failing resources here.)

Error: Could not retrieve catalog from remote server: Find /puppet/v3/catalog/myhost.me.com?environment=fakeenv&facts_format=pson&facts=%257B... resulted in 404 with the message: {""message"":""Not Found: Could not find environment 'fakeenv'"",""issue_kind"":""RUNTIME_ERROR""}
{code}
The documentation seems to indicate that the ENC environment overrides the agent-requested environment. Not sure if that makes this a documentation bug or a puppet bug, but it's behaviour I did not expect.

https://docs.puppet.com/puppet/4.10/configuration.html#environment

https://docs.puppet.com/puppet/4.10/nodes_external.html#considerations-and-differences-from-node-definitions

""In Puppet 3 and later, ENCs can set an environment for a node, overriding whatever environment the node requested.""

For use case background:

The informational message about how the current environment ""doesn't match server specified node environment"" was causing some consternation so I used the environment setting to make it go away. (Apparently it sounded like an error message.)

This breaks a bit when we have ephemeral environments; somebody may remove an environment (via r10k) but forget to change the ENC classification and do an agent run first. When they remove the environment before those steps the fix is to manually update puppet.conf to remove the environment line, which works against the lesson that people should only use puppet to update server configs.",Bug,PUP-7734,[],puppet.conf bad environment setting breaks ENC correct environment setting
"I'm using:


{code:java}
    $packages = [
      '2klic-gateway=2.10.5',
    ]

    package { $packages: ensure => latest }
{code}


In a situation where `2klic-gateway` is already installed but with a later version. I get back:

{quote}Error: Could not update: Execution of '/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install 2klic-gateway=2.10.5' returned 100: Reading package lists...
Building dependency tree...
Reading state information...
The following package was automatically installed and is no longer required:
  2klic-updates
Use 'apt-get autoremove' to remove it.
The following packages will be DOWNGRADED:
  2klic-gateway
0 upgraded, 0 newly installed, 1 downgraded, 0 to remove and 5 not upgraded.
Need to get 22.0 MB of archives.
After this operation, 312 kB disk space will be freed.
E: There are problems and -y was used without --force-yes
Error: /Stage[main]/Main/Node[default]/Package[2klic-gateway=2.10.5]/ensure: change from purged to latest failed: Could not update: Execution of '/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install 2klic-gateway=2.10.5' returned 100: Reading package lists...
Building dependency tree...
Reading state information...
The following package was automatically installed and is no longer required:
  2klic-updates
Use 'apt-get autoremove' to remove it.
The following packages will be DOWNGRADED:
  2klic-gateway
0 upgraded, 0 newly installed, 1 downgraded, 0 to remove and 5 not upgraded.
Need to get 22.0 MB of archives.
After this operation, 312 kB disk space will be freed.
E: There are problems and -y was used without --force-yes
{quote}",Bug,PUP-7733,[],Unable to downgrade a package
,Task,PUP-7732,[],Audit puppet acceptance tests to remove duplicate pipeline duplication
"Either skip the module tests if on amazon linux, or adapt to use public forge",Task,PUP-7731,[],Puppet acceptance depends on internal forge
,Sub-task,PUP-7730,[],acceptance: add test ensuring v5 sends report as json when catalog cached
Add acceptance test to validate {{--preferred-serialization-format=pson}} forces server to supply catalog as pson.,Sub-task,PUP-7729,[],acceptance: add preferred serialization format test
"Hi,

Puppet it's deleting not managed lines in some cases. Best explained in this example:

This is an example manifest:
{noformat}
cron { 'logrotate':
  command => '/usr/sbin/test1',
  user    => 'zabbix',
  hour    => ['2-4'],
  minute  => '*/10',
}

cron { 'prueba2':
  command => '/usr/sbin/test2',
  user    => 'zabbix',
  hour    => ['2-4'],
  minute  => '*/10',
}
{noformat}

If I apply it the result is the one:
{noformat}
# Puppet Name: logrotate
*/10 2-4 * * * /usr/sbin/test1
# Puppet Name: prueba2
*/10 2-4 * * * /usr/sbin/test2
{noformat}

If you edit the cron manually and you add two entries, and comment some entry managed by puppet, like this:

{noformat}
*/10 2-4 * * * /usr/sbin/example1
# Puppet Name: logrotate
#*/10 2-4 * * * /usr/sbin/test1
# Puppet Name: prueba2
#*/10 2-4 * * * /usr/sbin/test2
*/10 2-4 * * * /usr/sbin/example2
{noformat}

And you execute the manifest:
{noformat}
/opt/puppetlabs/puppet/bin/puppet apply cron.pp 
Notice: Compiled catalog for euclides.es.clara.net in environment production in 0.12 seconds
Notice: /Stage[main]/Main/Cron[logrotate]/ensure: created
Notice: /Stage[main]/Main/Cron[prueba2]/command: command changed '/usr/sbin/example2' to '/usr/sbin/test2'
Notice: Applied catalog in 0.26 seconds
{noformat}

You this this result: (example2 has been removed), this only happens when the not managed entry is present after the managed entries:
{noformat}
*/10 2-4 * * * /usr/sbin/example1
#*/10 2-4 * * * /usr/sbin/test1
#*/10 2-4 * * * /usr/sbin/test2
# Puppet Name: prueba2
*/10 2-4 * * * /usr/sbin/test2
# Puppet Name: logrotate
*/10 2-4 * * * /usr/sbin/test1
 {noformat}
",Bug,PUP-7728,[],cron deleting not managed lines
"Currently the {{ci:spec}} rake task is used to run Puppet's spec tests in CI. It passes several arguments to RSpec around formatting and output destinations. We want to start running the specs in parallel, like in the {{parallel:spec}} rake task, but that task does not allow any additional arguments to be passed to RSpec. We need to update that task to allow arguments to be passed through to RSpec, and probably create a wrapper task to be called from CI that specifies the necessary args.",Task,PUP-7695,[],Create rake task to run specs in parallel in CI
"Generating a module with the {{--skip-interview}} option produces a {{metadata.json}} file that produces the following {{WARN}} and {{ERROR}} results when the {{validation}} rake task is performed.

{code}
# /opt/puppetlabs/puppet/bin/rake validate
---> syntax:manifests
---> syntax:templates
---> syntax:hiera:yaml
(WARN) dependencies: Dependency puppetlabs-stdlib has an open ended dependency version requirement >= 1.0.0
(ERROR) required_fields: Required field 'summary' not found in metadata.json.
Errors found in metadata.json
{code}

h2. Steps to reproduce
h3. Install puppet-agent
This requires puppet-agent {{de8df49}} or newer, which has not yet been published to nightlies
h3. Install bundler
{code}
/opt/puppetlabs/puppet/bin/gem install bundler
{code}
h3. Generate module
{code}
/opt/puppetlabs/bin/puppet module generate --skip-interview foo-bar
{code}
h3. Validate metadata
{code}
cd bar/
/opt/puppetlabs/puppet/bin/bundle install
/opt/puppetlabs/puppet/bin/rake validate
{code}",Bug,PUP-7694,[],metadata.json created with `puppet module generate --skip-interview` fails validation
"When this template:
{code}
Bug parade
<% $data = [""routers"", ""servers"", ""workstations""] -%>
<% $data.each |$value| { %>
  <%= $value %>
<% } -%>
{code}
is in a separate file, and attempt to render it will result in an error:
{code}
Error: Evaluation Error: Error while evaluating a Method call, each(): Wrong number of arguments given (1 for minimum 2) at /Users/henrik/git/puppet/test.epp:3:9
{code}

When stepping through this, it became apparent that this is due to the evaluator not finding the real 4.x function for {{each}} and that it is instead finding the 3.x stub used for documentation purposes. The signature of the 3.x function is wrong - if it had been correct it would have raised an error stating that the 3.x stub was called.

The same template when used from regular manifests works as it should.

It seems like there is something wrong with the {{epp}} face setup.

This is bad as it makes it impossible to debug templates with the CLI {{epp render}}.",Bug,PUP-7692,[],epp render CLI fails to render when template uses 4.x functions
"puppet apply is able to parse/render template data where puppet epp render fails.

{noformat}
puppet apply /tmp/foo.pp -v
Info: Applying configuration version '1498149368'
Notice: /Stage[main]/Main/File[/tmp/epp_file.txt]/ensure: defined content as '{md5}b5648129ac61afe0f9ffdaac69db3b75'
Notice: /Stage[main]/Main/File[/tmp/epp_inline.txt]/ensure: defined content as '{md5}b5648129ac61afe0f9ffdaac69db3b75'
Notice: Applied catalog in 0.01 seconds
{noformat}

{noformat}
puppet epp render /tmp/foo.epp --trace
Error: Evaluation Error: Error while evaluating a Method call, each(): Wrong number of arguments given (1 for minimum 2) at /tmp/foo.epp:2:9
Error: error while rendering epp
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/face/epp.rb:345:in `block (3 levels) in <top (required)>'
/usr/local/opt/rbenv/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/interface/action.rb+eval[wrapper]:242:in `render'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application/face_base.rb:252:in `main'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application.rb:366:in `run_command'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application.rb:358:in `block in run'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/util.rb:542:in `exit_on_fail'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application.rb:358:in `run'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/util/command_line.rb:132:in `run'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/util/command_line.rb:72:in `execute'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/bin/puppet:5:in `<top (required)>'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/bin/puppet:23:in `load'
/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/bin/puppet:23:in `<main>'
Error: Try 'puppet help epp render' for usage
{noformat}




The following manifest will create the test condition.
After application puppet epp render /tmp/foo.epp fails

{code:java}
$foo_epp=@(END)
<% $data = [""routers"", ""servers"", ""workstations""] -%>
<% $data.each |$value| { %>
  <%= $value %>
<% } -%>
END

# Can't actually create the template here the catalog compilation fails
# file { ""/tmp/foo.epp"":
#   ensure   => file,
#   content  => $foo_epp,
# }

file { ""/tmp/epp_file.txt"":
 ensure    => file,
 content   => epp('/tmp/foo.epp')
}

file { ""/tmp/epp_inline.txt"":
  ensure   => file,
  content  => inline_epp($foo_epp)
}

{code}
",Bug,PUP-7691,[],puppet epp render fails on valid templates 
"We are accessing hash in alias function such as:

{code:puppet}
rewrites:                                            
  rewrite-http-to-https:                             
    ""Rewrite everything from http to https"":         
      rewrite_cond:                                  
        - foo                                             
      rewrite_rule:                                  
        - bar
vhosts:
  www.bla.be:
    rewrites: ""%{alias('rewrites.rewrite-http-to-https')}""
{code}

puppet 4.9.4 everything is ok
puppet 4.10.x it doesn't work anymore. `vhosts` is empty/nil

usecase is described here: https://docs.puppet.com/puppet/4.10/hiera_subkey.html#where-can-you-access-hash-and-array-elements",Bug,PUP-7690,[],Accessing hash in interpolating function 'alias' does not work anymore
"At the moment it is not possible to make a new call at the end of a transformation. You need to do something like:
{code:puppet}
Hash($data.reduce |$memo, $entry| { ... })
{code}
because it is not possible to do this:
{code:puppet}
$data.reduce |$memo, $entry| { ... }).new(Hash)
{code}
What you want is the more natural left-to-right reading:
{code:puppet}
$data.reduce |$memo, $entry| { ... }.Hash
{code}
",New Feature,PUP-7689,[],make it possible to invoke 'Type.new(e)' as e.Type()
There are several spelling errrors in the documentation of the annotate() function.,Bug,PUP-7688,"['Functions', 'Language']",annotate() function has spelling errors in its documentation
"Hi, 

I have configured the puppet using environments.  Once I push the code in git, and when I execute r10k deploy, the environment is getting created and modules are installing inside the environment. But when I do puppet agent --test --environment <environment name>. The catalog is completing without any error. 

[root@puppetpopagent ~]# puppet agent -t --environment feature
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Info: Caching catalog for puppetpopagent
Info: Applying configuration version '1498118282'
Notice: Finished catalog run in 0.04 seconds
[root@puppetpopagent ~]# 

I am not sure, what is the issue. When I do debug, I got this message 

++++
[root@puppetpopagent ~]# puppet agent -t --environment feature --debug
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Using settings: adding file resource 'confdir': 'File[/etc/puppet]{:path=>""/etc/puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Puppet::Type::User::ProviderDirectoryservice: file /usr/bin/dsimport does not exist
Debug: Failed to load library 'ldap' for feature 'ldap'
Debug: Puppet::Type::User::ProviderLdap: feature ldap is missing
Debug: Puppet::Type::User::ProviderPw: file pw does not exist
Debug: Puppet::Type::User::ProviderUser_role_add: file roleadd does not exist
Debug: Puppet::Type::Group::ProviderDirectoryservice: file /usr/bin/dscl does not exist
Debug: Failed to load library 'ldap' for feature 'ldap'
Debug: Puppet::Type::Group::ProviderLdap: feature ldap is missing
Debug: Puppet::Type::Group::ProviderPw: file pw does not exist
Debug: Using settings: adding file resource 'vardir': 'File[/var/lib/puppet]{:path=>""/var/lib/puppet"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'logdir': 'File[/var/log/puppet]{:path=>""/var/log/puppet"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'statedir': 'File[/var/lib/puppet/state]{:path=>""/var/lib/puppet/state"", :mode=>""1755"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'rundir': 'File[/var/run/puppet]{:path=>""/var/run/puppet"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'libdir': 'File[/var/lib/puppet/lib]{:path=>""/var/lib/puppet/lib"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'preview_outputdir': 'File[/var/lib/puppet/preview]{:path=>""/var/lib/puppet/preview"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'certdir': 'File[/var/lib/puppet/ssl/certs]{:path=>""/var/lib/puppet/ssl/certs"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'ssldir': 'File[/var/lib/puppet/ssl]{:path=>""/var/lib/puppet/ssl"", :mode=>""771"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'publickeydir': 'File[/var/lib/puppet/ssl/public_keys]{:path=>""/var/lib/puppet/ssl/public_keys"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'requestdir': 'File[/var/lib/puppet/ssl/certificate_requests]{:path=>""/var/lib/puppet/ssl/certificate_requests"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'privatekeydir': 'File[/var/lib/puppet/ssl/private_keys]{:path=>""/var/lib/puppet/ssl/private_keys"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'privatedir': 'File[/var/lib/puppet/ssl/private]{:path=>""/var/lib/puppet/ssl/private"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostcert': 'File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]{:path=>""/var/lib/puppet/ssl/certs/puppetpopagent.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostprivkey': 'File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]{:path=>""/var/lib/puppet/ssl/private_keys/puppetpopagent.pem"", :mode=>""640"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostpubkey': 'File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]{:path=>""/var/lib/puppet/ssl/public_keys/puppetpopagent.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'localcacert': 'File[/var/lib/puppet/ssl/certs/ca.pem]{:path=>""/var/lib/puppet/ssl/certs/ca.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostcrl': 'File[/var/lib/puppet/ssl/crl.pem]{:path=>""/var/lib/puppet/ssl/crl.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'statefile': 'File[/var/lib/puppet/state/state.yaml]{:path=>""/var/lib/puppet/state/state.yaml"", :mode=>""660"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'clientyamldir': 'File[/var/lib/puppet/client_yaml]{:path=>""/var/lib/puppet/client_yaml"", :mode=>""750"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'client_datadir': 'File[/var/lib/puppet/client_data]{:path=>""/var/lib/puppet/client_data"", :mode=>""750"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'classfile': 'File[/var/lib/puppet/classes.txt]{:path=>""/var/lib/puppet/classes.txt"", :mode=>""640"", :owner=>""root"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'resourcefile': 'File[/var/lib/puppet/state/resources.txt]{:path=>""/var/lib/puppet/state/resources.txt"", :mode=>""640"", :owner=>""root"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'clientbucketdir': 'File[/var/lib/puppet/clientbucket]{:path=>""/var/lib/puppet/clientbucket"", :mode=>""750"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'lastrunfile': 'File[/var/lib/puppet/state/last_run_summary.yaml]{:path=>""/var/lib/puppet/state/last_run_summary.yaml"", :mode=>""644"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'lastrunreport': 'File[/var/lib/puppet/state/last_run_report.yaml]{:path=>""/var/lib/puppet/state/last_run_report.yaml"", :mode=>""640"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'graphdir': 'File[/var/lib/puppet/state/graphs]{:path=>""/var/lib/puppet/state/graphs"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'pluginfactdest': 'File[/var/lib/puppet/facts.d]{:path=>""/var/lib/puppet/facts.d"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: /File[/etc/puppet]/seluser: Found seluser default 'system_u' for /etc/puppet
Debug: /File[/etc/puppet]/selrole: Found selrole default 'object_r' for /etc/puppet
Debug: /File[/etc/puppet]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppet
Debug: /File[/etc/puppet]/selrange: Found selrange default 's0' for /etc/puppet
Debug: /File[/var/lib/puppet]/seluser: Found seluser default 'system_u' for /var/lib/puppet
Debug: /File[/var/lib/puppet]/selrole: Found selrole default 'object_r' for /var/lib/puppet
Debug: /File[/var/lib/puppet]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet
Debug: /File[/var/lib/puppet]/selrange: Found selrange default 's0' for /var/lib/puppet
Debug: /File[/var/log/puppet]/seluser: Found seluser default 'system_u' for /var/log/puppet
Debug: /File[/var/log/puppet]/selrole: Found selrole default 'object_r' for /var/log/puppet
Debug: /File[/var/log/puppet]/seltype: Found seltype default 'puppet_log_t' for /var/log/puppet
Debug: /File[/var/log/puppet]/selrange: Found selrange default 's0' for /var/log/puppet
Debug: /File[/var/lib/puppet/state]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state
Debug: /File[/var/lib/puppet/state]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state
Debug: /File[/var/lib/puppet/state]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state
Debug: /File[/var/lib/puppet/state]/selrange: Found selrange default 's0' for /var/lib/puppet/state
Debug: /File[/var/run/puppet]/seluser: Found seluser default 'system_u' for /var/run/puppet
Debug: /File[/var/run/puppet]/selrole: Found selrole default 'object_r' for /var/run/puppet
Debug: /File[/var/run/puppet]/seltype: Found seltype default 'puppet_var_run_t' for /var/run/puppet
Debug: /File[/var/run/puppet]/selrange: Found selrange default 's0' for /var/run/puppet
Debug: /File[/var/lib/puppet/lib]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/selrange: Found selrange default 's0' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/preview]/seluser: Found seluser default 'system_u' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/preview]/selrole: Found selrole default 'object_r' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/preview]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/preview]/selrange: Found selrange default 's0' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/ssl/certs]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl/certs]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl/certs]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl/certs]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl/public_keys]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/public_keys]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/public_keys]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/public_keys]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/private_keys]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private_keys]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private_keys]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private_keys]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/private]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/private]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/private]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/state/state.yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/state/state.yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/state/state.yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/state/state.yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/client_yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_data]/seluser: Found seluser default 'system_u' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/client_data]/selrole: Found selrole default 'object_r' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/client_data]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/client_data]/selrange: Found selrange default 's0' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/classes.txt]/seluser: Found seluser default 'system_u' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/classes.txt]/selrole: Found selrole default 'object_r' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/classes.txt]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/classes.txt]/selrange: Found selrange default 's0' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/selrange: Found selrange default 's0' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/clientbucket]/seluser: Found seluser default 'system_u' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/clientbucket]/selrole: Found selrole default 'object_r' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/clientbucket]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/clientbucket]/selrange: Found selrange default 's0' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/graphs]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/graphs
Debug: /File[/var/lib/puppet/state/graphs]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/graphs
Debug: /File[/var/lib/puppet/state/graphs]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/graphs
Debug: /File[/var/lib/puppet/state/graphs]/selrange: Found selrange default 's0' for /var/lib/puppet/state/graphs
Debug: /File[/var/lib/puppet/facts.d]/seluser: Found seluser default 'system_u' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/selrole: Found selrole default 'object_r' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/selrange: Found selrange default 's0' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/state]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/lib]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/preview]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/ssl/certs]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/ssl/public_keys]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/certificate_requests]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/private_keys]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/private]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]: Autorequiring File[/var/lib/puppet/ssl/certs]
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]: Autorequiring File[/var/lib/puppet/ssl/private_keys]
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]: Autorequiring File[/var/lib/puppet/ssl/public_keys]
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]: Autorequiring File[/var/lib/puppet/ssl/certs]
Debug: /File[/var/lib/puppet/ssl/crl.pem]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/state/state.yaml]: Autorequiring File[/var/lib/puppet/state]
Debug: /File[/var/lib/puppet/client_yaml]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/client_data]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/classes.txt]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/state/resources.txt]: Autorequiring File[/var/lib/puppet/state]
Debug: /File[/var/lib/puppet/clientbucket]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]: Autorequiring File[/var/lib/puppet/state]
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]: Autorequiring File[/var/lib/puppet/state]
Debug: /File[/var/lib/puppet/state/graphs]: Autorequiring File[/var/lib/puppet/state]
Debug: /File[/var/lib/puppet/facts.d]: Autorequiring File[/var/lib/puppet]
Debug: Finishing transaction 29379640
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Runtime environment: puppet_version=3.8.7, ruby_version=2.0.0, run_mode=agent, default_encoding=UTF-8
Debug: Using settings: adding file resource 'confdir': 'File[/etc/puppet]{:path=>""/etc/puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'vardir': 'File[/var/lib/puppet]{:path=>""/var/lib/puppet"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'logdir': 'File[/var/log/puppet]{:path=>""/var/log/puppet"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'statedir': 'File[/var/lib/puppet/state]{:path=>""/var/lib/puppet/state"", :mode=>""1755"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'rundir': 'File[/var/run/puppet]{:path=>""/var/run/puppet"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'libdir': 'File[/var/lib/puppet/lib]{:path=>""/var/lib/puppet/lib"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'preview_outputdir': 'File[/var/lib/puppet/preview]{:path=>""/var/lib/puppet/preview"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'certdir': 'File[/var/lib/puppet/ssl/certs]{:path=>""/var/lib/puppet/ssl/certs"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'ssldir': 'File[/var/lib/puppet/ssl]{:path=>""/var/lib/puppet/ssl"", :mode=>""771"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'publickeydir': 'File[/var/lib/puppet/ssl/public_keys]{:path=>""/var/lib/puppet/ssl/public_keys"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'requestdir': 'File[/var/lib/puppet/ssl/certificate_requests]{:path=>""/var/lib/puppet/ssl/certificate_requests"", :mode=>""755"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'privatekeydir': 'File[/var/lib/puppet/ssl/private_keys]{:path=>""/var/lib/puppet/ssl/private_keys"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'privatedir': 'File[/var/lib/puppet/ssl/private]{:path=>""/var/lib/puppet/ssl/private"", :mode=>""750"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostcert': 'File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]{:path=>""/var/lib/puppet/ssl/certs/puppetpopagent.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostprivkey': 'File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]{:path=>""/var/lib/puppet/ssl/private_keys/puppetpopagent.pem"", :mode=>""640"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostpubkey': 'File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]{:path=>""/var/lib/puppet/ssl/public_keys/puppetpopagent.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'localcacert': 'File[/var/lib/puppet/ssl/certs/ca.pem]{:path=>""/var/lib/puppet/ssl/certs/ca.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'hostcrl': 'File[/var/lib/puppet/ssl/crl.pem]{:path=>""/var/lib/puppet/ssl/crl.pem"", :mode=>""644"", :owner=>""puppet"", :group=>""puppet"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'pluginfactdest': 'File[/var/lib/puppet/facts.d]{:path=>""/var/lib/puppet/facts.d"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: /File[/etc/puppet]/seluser: Found seluser default 'system_u' for /etc/puppet
Debug: /File[/etc/puppet]/selrole: Found selrole default 'object_r' for /etc/puppet
Debug: /File[/etc/puppet]/seltype: Found seltype default 'puppet_etc_t' for /etc/puppet
Debug: /File[/etc/puppet]/selrange: Found selrange default 's0' for /etc/puppet
Debug: /File[/var/lib/puppet]/seluser: Found seluser default 'system_u' for /var/lib/puppet
Debug: /File[/var/lib/puppet]/selrole: Found selrole default 'object_r' for /var/lib/puppet
Debug: /File[/var/lib/puppet]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet
Debug: /File[/var/lib/puppet]/selrange: Found selrange default 's0' for /var/lib/puppet
Debug: /File[/var/log/puppet]/seluser: Found seluser default 'system_u' for /var/log/puppet
Debug: /File[/var/log/puppet]/selrole: Found selrole default 'object_r' for /var/log/puppet
Debug: /File[/var/log/puppet]/seltype: Found seltype default 'puppet_log_t' for /var/log/puppet
Debug: /File[/var/log/puppet]/selrange: Found selrange default 's0' for /var/log/puppet
Debug: /File[/var/lib/puppet/state]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state
Debug: /File[/var/lib/puppet/state]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state
Debug: /File[/var/lib/puppet/state]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state
Debug: /File[/var/lib/puppet/state]/selrange: Found selrange default 's0' for /var/lib/puppet/state
Debug: /File[/var/run/puppet]/seluser: Found seluser default 'system_u' for /var/run/puppet
Debug: /File[/var/run/puppet]/selrole: Found selrole default 'object_r' for /var/run/puppet
Debug: /File[/var/run/puppet]/seltype: Found seltype default 'puppet_var_run_t' for /var/run/puppet
Debug: /File[/var/run/puppet]/selrange: Found selrange default 's0' for /var/run/puppet
Debug: /File[/var/lib/puppet/lib]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/selrange: Found selrange default 's0' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/preview]/seluser: Found seluser default 'system_u' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/preview]/selrole: Found selrole default 'object_r' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/preview]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/preview]/selrange: Found selrange default 's0' for /var/lib/puppet/preview
Debug: /File[/var/lib/puppet/ssl/certs]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl/certs]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl/certs]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl/certs]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certs
Debug: /File[/var/lib/puppet/ssl]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl
Debug: /File[/var/lib/puppet/ssl/public_keys]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/public_keys]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/public_keys]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/public_keys]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/public_keys
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/certificate_requests]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certificate_requests
Debug: /File[/var/lib/puppet/ssl/private_keys]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private_keys]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private_keys]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private_keys]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/private_keys
Debug: /File[/var/lib/puppet/ssl/private]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/private]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/private]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/private]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/private
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certs/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/private_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/public_keys/puppetpopagent.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/certs/ca.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/seluser: Found seluser default 'system_u' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/selrole: Found selrole default 'object_r' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/ssl/crl.pem]/selrange: Found selrange default 's0' for /var/lib/puppet/ssl/crl.pem
Debug: /File[/var/lib/puppet/facts.d]/seluser: Found seluser default 'system_u' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/selrole: Found selrole default 'object_r' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/selrange: Found selrange default 's0' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/state]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/lib]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/preview]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/ssl/certs]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl]: Autorequiring File[/var/lib/puppet]
Debug: /File[/var/lib/puppet/ssl/public_keys]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/certificate_requests]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/private_keys]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/private]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/ssl/certs/puppetpopagent.pem]: Autorequiring File[/var/lib/puppet/ssl/certs]
Debug: /File[/var/lib/puppet/ssl/private_keys/puppetpopagent.pem]: Autorequiring File[/var/lib/puppet/ssl/private_keys]
Debug: /File[/var/lib/puppet/ssl/public_keys/puppetpopagent.pem]: Autorequiring File[/var/lib/puppet/ssl/public_keys]
Debug: /File[/var/lib/puppet/ssl/certs/ca.pem]: Autorequiring File[/var/lib/puppet/ssl/certs]
Debug: /File[/var/lib/puppet/ssl/crl.pem]: Autorequiring File[/var/lib/puppet/ssl]
Debug: /File[/var/lib/puppet/facts.d]: Autorequiring File[/var/lib/puppet]
Debug: Finishing transaction 22614120
Debug: Using cached certificate for ca
Debug: Using cached certificate for puppetpopagent
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Using settings: adding file resource 'statefile': 'File[/var/lib/puppet/state/state.yaml]{:path=>""/var/lib/puppet/state/state.yaml"", :mode=>""660"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'clientyamldir': 'File[/var/lib/puppet/client_yaml]{:path=>""/var/lib/puppet/client_yaml"", :mode=>""750"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'client_datadir': 'File[/var/lib/puppet/client_data]{:path=>""/var/lib/puppet/client_data"", :mode=>""750"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'classfile': 'File[/var/lib/puppet/classes.txt]{:path=>""/var/lib/puppet/classes.txt"", :mode=>""640"", :owner=>""root"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'resourcefile': 'File[/var/lib/puppet/state/resources.txt]{:path=>""/var/lib/puppet/state/resources.txt"", :mode=>""640"", :owner=>""root"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'clientbucketdir': 'File[/var/lib/puppet/clientbucket]{:path=>""/var/lib/puppet/clientbucket"", :mode=>""750"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'lastrunfile': 'File[/var/lib/puppet/state/last_run_summary.yaml]{:path=>""/var/lib/puppet/state/last_run_summary.yaml"", :mode=>""644"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'lastrunreport': 'File[/var/lib/puppet/state/last_run_report.yaml]{:path=>""/var/lib/puppet/state/last_run_report.yaml"", :mode=>""640"", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: Using settings: adding file resource 'graphdir': 'File[/var/lib/puppet/state/graphs]{:path=>""/var/lib/puppet/state/graphs"", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'
Debug: /File[/var/lib/puppet/state/state.yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/state/state.yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/state/state.yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/state/state.yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/state/state.yaml
Debug: /File[/var/lib/puppet/client_yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/client_yaml
Debug: /File[/var/lib/puppet/client_data]/seluser: Found seluser default 'system_u' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/client_data]/selrole: Found selrole default 'object_r' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/client_data]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/client_data]/selrange: Found selrange default 's0' for /var/lib/puppet/client_data
Debug: /File[/var/lib/puppet/classes.txt]/seluser: Found seluser default 'system_u' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/classes.txt]/selrole: Found selrole default 'object_r' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/classes.txt]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/classes.txt]/selrange: Found selrange default 's0' for /var/lib/puppet/classes.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/state/resources.txt]/selrange: Found selrange default 's0' for /var/lib/puppet/state/resources.txt
Debug: /File[/var/lib/puppet/clientbucket]/seluser: Found seluser default 'system_u' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/clientbucket]/selrole: Found selrole default 'object_r' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/clientbucket]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/clientbucket]/selrange: Found selrange default 's0' for /var/lib/puppet/clientbucket
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_summary.yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/state/last_run_summary.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/last_run_report.yaml]/selrange: Found selrange default 's0' for /var/lib/puppet/state/last_run_report.yaml
Debug: /File[/var/lib/puppet/state/graphs]/seluser: Found seluser default 'system_u' for /var/lib/puppet/state/graphs
Debug: /File[/var/lib/puppet/state/graphs]/selrole: Found selrole default 'object_r' for /var/lib/puppet/state/graphs
Debug: /File[/var/lib/puppet/state/graphs]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/state/graphs
Debug: /File[/var/lib/puppet/state/graphs]/selrange: Found selrange default 's0' for /var/lib/puppet/state/graphs
Debug: Finishing transaction 27787520
Debug: Loaded state in 0.00 seconds
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Failed to load library 'msgpack' for feature 'msgpack'
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: node supports formats: pson b64_zlib_yaml yaml raw
Debug: Using cached certificate for ca
Debug: Using cached certificate for puppetpopagent
Debug: Creating new connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Using cached certificate_revocation_list for ca
Debug: Starting connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Caching connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Info: Retrieving pluginfacts
Debug: /File[/var/lib/puppet/facts.d]/seluser: Found seluser default 'system_u' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/selrole: Found selrole default 'object_r' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/facts.d
Debug: /File[/var/lib/puppet/facts.d]/selrange: Found selrange default 's0' for /var/lib/puppet/facts.d
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Failed to load library 'msgpack' for feature 'msgpack'
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: file_metadata supports formats: pson b64_zlib_yaml yaml raw
Debug: Using cached connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Caching connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Finishing transaction 28512820
Info: Retrieving plugin
Debug: /File[/var/lib/puppet/lib]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib]/selrange: Found selrange default 's0' for /var/lib/puppet/lib
Debug: /File[/var/lib/puppet/lib/puppet]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet
Debug: /File[/var/lib/puppet/lib/puppet]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet
Debug: /File[/var/lib/puppet/lib/puppet]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet
Debug: /File[/var/lib/puppet/lib/puppet]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet
Debug: /File[/var/lib/puppet/lib/facter]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter
Debug: /File[/var/lib/puppet/lib/facter]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter
Debug: /File[/var/lib/puppet/lib/facter]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter
Debug: /File[/var/lib/puppet/lib/facter]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter
Debug: /File[/var/lib/puppet/lib/puppet/provider]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider
Debug: /File[/var/lib/puppet/lib/puppet/provider]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider
Debug: /File[/var/lib/puppet/lib/puppet/provider]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider
Debug: /File[/var/lib/puppet/lib/puppet/provider]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider
Debug: /File[/var/lib/puppet/lib/puppet/parser]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser
Debug: /File[/var/lib/puppet/lib/puppet/parser]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser
Debug: /File[/var/lib/puppet/lib/puppet/parser]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser
Debug: /File[/var/lib/puppet/lib/puppet/parser]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser
Debug: /File[/var/lib/puppet/lib/puppet/functions]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/functions
Debug: /File[/var/lib/puppet/lib/puppet/functions]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/functions
Debug: /File[/var/lib/puppet/lib/puppet/functions]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/functions
Debug: /File[/var/lib/puppet/lib/puppet/functions]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/functions
Debug: /File[/var/lib/puppet/lib/puppet/type]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type
Debug: /File[/var/lib/puppet/lib/puppet/type]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type
Debug: /File[/var/lib/puppet/lib/puppet/type]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type
Debug: /File[/var/lib/puppet/lib/puppet/type]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type
Debug: /File[/var/lib/puppet/lib/puppet/util]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util
Debug: /File[/var/lib/puppet/lib/puppet/util]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util
Debug: /File[/var/lib/puppet/lib/puppet/util]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util
Debug: /File[/var/lib/puppet/lib/puppet/util]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util
Debug: /File[/var/lib/puppet/lib/puppet/property]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/property
Debug: /File[/var/lib/puppet/lib/puppet/property]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/property
Debug: /File[/var/lib/puppet/lib/puppet/property]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/property
Debug: /File[/var/lib/puppet/lib/puppet/property]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/property
Debug: /File[/var/lib/puppet/lib/puppet/parameter]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parameter
Debug: /File[/var/lib/puppet/lib/puppet/parameter]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parameter
Debug: /File[/var/lib/puppet/lib/puppet/parameter]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parameter
Debug: /File[/var/lib/puppet/lib/puppet/parameter]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parameter
Debug: /File[/var/lib/puppet/lib/facter/git_version.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/git_version.rb
Debug: /File[/var/lib/puppet/lib/facter/git_version.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/git_version.rb
Debug: /File[/var/lib/puppet/lib/facter/git_version.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/git_version.rb
Debug: /File[/var/lib/puppet/lib/facter/git_version.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/git_version.rb
Debug: /File[/var/lib/puppet/lib/facter/service_provider.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/service_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/service_provider.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/service_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/service_provider.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/service_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/service_provider.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/service_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/util]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/util
Debug: /File[/var/lib/puppet/lib/facter/util]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/util
Debug: /File[/var/lib/puppet/lib/facter/util]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/util
Debug: /File[/var/lib/puppet/lib/facter/util]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/util
Debug: /File[/var/lib/puppet/lib/facter/git_html_path.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/git_html_path.rb
Debug: /File[/var/lib/puppet/lib/facter/git_html_path.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/git_html_path.rb
Debug: /File[/var/lib/puppet/lib/facter/git_html_path.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/git_html_path.rb
Debug: /File[/var/lib/puppet/lib/facter/git_html_path.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/git_html_path.rb
Debug: /File[/var/lib/puppet/lib/facter/git_exec_path.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/git_exec_path.rb
Debug: /File[/var/lib/puppet/lib/facter/git_exec_path.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/git_exec_path.rb
Debug: /File[/var/lib/puppet/lib/facter/git_exec_path.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/git_exec_path.rb
Debug: /File[/var/lib/puppet/lib/facter/git_exec_path.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/git_exec_path.rb
Debug: /File[/var/lib/puppet/lib/facter/facter_dot_d.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/facter_dot_d.rb
Debug: /File[/var/lib/puppet/lib/facter/facter_dot_d.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/facter_dot_d.rb
Debug: /File[/var/lib/puppet/lib/facter/facter_dot_d.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/facter_dot_d.rb
Debug: /File[/var/lib/puppet/lib/facter/facter_dot_d.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/facter_dot_d.rb
Debug: /File[/var/lib/puppet/lib/facter/root_home.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/root_home.rb
Debug: /File[/var/lib/puppet/lib/facter/root_home.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/root_home.rb
Debug: /File[/var/lib/puppet/lib/facter/root_home.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/root_home.rb
Debug: /File[/var/lib/puppet/lib/facter/root_home.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/root_home.rb
Debug: /File[/var/lib/puppet/lib/facter/package_provider.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/package_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/package_provider.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/package_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/package_provider.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/package_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/package_provider.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/package_provider.rb
Debug: /File[/var/lib/puppet/lib/facter/pe_version.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/pe_version.rb
Debug: /File[/var/lib/puppet/lib/facter/pe_version.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/pe_version.rb
Debug: /File[/var/lib/puppet/lib/facter/pe_version.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/pe_version.rb
Debug: /File[/var/lib/puppet/lib/facter/pe_version.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/pe_version.rb
Debug: /File[/var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb
Debug: /File[/var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb
Debug: /File[/var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb
Debug: /File[/var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb
Debug: /File[/var/lib/puppet/lib/facter/puppet_vardir.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/puppet_vardir.rb
Debug: /File[/var/lib/puppet/lib/facter/puppet_vardir.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/puppet_vardir.rb
Debug: /File[/var/lib/puppet/lib/facter/puppet_vardir.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/puppet_vardir.rb
Debug: /File[/var/lib/puppet/lib/facter/puppet_vardir.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/puppet_vardir.rb
Debug: /File[/var/lib/puppet/lib/facter/eselect.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/eselect.rb
Debug: /File[/var/lib/puppet/lib/facter/eselect.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/eselect.rb
Debug: /File[/var/lib/puppet/lib/facter/eselect.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/eselect.rb
Debug: /File[/var/lib/puppet/lib/facter/eselect.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/eselect.rb
Debug: /File[/var/lib/puppet/lib/facter/portage.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/portage.rb
Debug: /File[/var/lib/puppet/lib/facter/portage.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/portage.rb
Debug: /File[/var/lib/puppet/lib/facter/portage.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/portage.rb
Debug: /File[/var/lib/puppet/lib/facter/portage.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/portage.rb
Debug: /File[/var/lib/puppet/lib/facter/gemhome.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/gemhome.rb
Debug: /File[/var/lib/puppet/lib/facter/gemhome.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/gemhome.rb
Debug: /File[/var/lib/puppet/lib/facter/gemhome.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/gemhome.rb
Debug: /File[/var/lib/puppet/lib/facter/gemhome.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/gemhome.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/file_line
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/file_line
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/file_line
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/file_line
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/git_config
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/git_config
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/git_config
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/git_config
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/ini_subsetting
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/ini_subsetting
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/ini_subsetting
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/ini_subsetting
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/webapp
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/webapp
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/webapp
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/webapp
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_use
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_use
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_use
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_use
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/a2mod
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/a2mod
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/a2mod
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/a2mod
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/ini_setting
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/ini_setting
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/ini_setting
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/ini_setting
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo
Debug: /File[/var/lib/puppet/lib/puppet/provider/package]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package
Debug: /File[/var/lib/puppet/lib/puppet/provider/package]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package
Debug: /File[/var/lib/puppet/lib/puppet/provider/package]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package
Debug: /File[/var/lib/puppet/lib/puppet/provider/package]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_keywords
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_keywords
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_keywords
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_keywords
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_env
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_env
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_env
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_env
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/layman
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/layman
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/layman
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/layman
Debug: /File[/var/lib/puppet/lib/puppet/provider/portagefile.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/portagefile.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/portagefile.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/portagefile.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/portagefile.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/portagefile.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/portagefile.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/portagefile.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_unmask
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_unmask
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_unmask
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_unmask
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/eselect
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/eselect
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/eselect
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/eselect
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_mask
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_mask
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_mask
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_mask
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions
Debug: /File[/var/lib/puppet/lib/puppet/functions/type_of.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/functions/type_of.rb
Debug: /File[/var/lib/puppet/lib/puppet/functions/type_of.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/functions/type_of.rb
Debug: /File[/var/lib/puppet/lib/puppet/functions/type_of.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/functions/type_of.rb
Debug: /File[/var/lib/puppet/lib/puppet/functions/type_of.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/functions/type_of.rb
Debug: /File[/var/lib/puppet/lib/puppet/functions/is_a.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/functions/is_a.rb
Debug: /File[/var/lib/puppet/lib/puppet/functions/is_a.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/functions/is_a.rb
Debug: /File[/var/lib/puppet/lib/puppet/functions/is_a.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/functions/is_a.rb
Debug: /File[/var/lib/puppet/lib/puppet/functions/is_a.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/functions/is_a.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/anchor.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/anchor.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/anchor.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/anchor.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/anchor.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/anchor.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/anchor.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/anchor.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/git_config.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/git_config.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/git_config.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/git_config.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/file_line.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/file_line.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/file_line.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/file_line.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/file_line.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/file_line.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/file_line.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/file_line.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/webapp.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/webapp.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/webapp.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/webapp.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_file.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/concat_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_file.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/concat_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_file.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/concat_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_file.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/concat_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_unmask.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/package_unmask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_unmask.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/package_unmask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_unmask.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/package_unmask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_unmask.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/package_unmask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_mask.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/package_mask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_mask.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/package_mask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_mask.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/package_mask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_mask.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/package_mask.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_use.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/package_use.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_use.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/package_use.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_use.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/package_use.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_use.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/package_use.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/vcsrepo.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/vcsrepo.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/vcsrepo.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/vcsrepo.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/vcsrepo.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_keywords.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/package_keywords.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_keywords.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/package_keywords.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_keywords.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/package_keywords.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_keywords.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/package_keywords.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/a2mod.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/a2mod.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/a2mod.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/a2mod.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_fragment.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/concat_fragment.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_fragment.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/concat_fragment.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_fragment.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/concat_fragment.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/concat_fragment.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/concat_fragment.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/layman.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/layman.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/layman.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/layman.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_setting.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/ini_setting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_setting.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/ini_setting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_setting.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/ini_setting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_setting.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/ini_setting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_subsetting.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/ini_subsetting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_subsetting.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/ini_subsetting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_subsetting.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/ini_subsetting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/ini_subsetting.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/ini_subsetting.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/eselect.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/eselect.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/eselect.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/eselect.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_env.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/type/package_env.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_env.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/type/package_env.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_env.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/type/package_env.rb
Debug: /File[/var/lib/puppet/lib/puppet/type/package_env.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/type/package_env.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/ini_file
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/ini_file
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/ini_file
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/ini_file
Debug: /File[/var/lib/puppet/lib/puppet/util/portage.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/portage.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/portage.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/portage.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/portage.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/portage.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/portage.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/portage.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/ini_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/ini_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/ini_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/ini_file.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/external_iterator.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/external_iterator.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/external_iterator.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/external_iterator.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/external_iterator.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/external_iterator.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/external_iterator.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/external_iterator.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/eselect.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/eselect.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/eselect.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/eselect.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/webapp.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/webapp.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/webapp.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/webapp.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/setting_value.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/setting_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/setting_value.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/setting_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/setting_value.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/setting_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/setting_value.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/setting_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_slot.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/property/portage_slot.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_slot.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/property/portage_slot.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_slot.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/property/portage_slot.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_slot.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/property/portage_slot.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_version.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/property/portage_version.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_version.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/property/portage_version.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_version.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/property/portage_version.rb
Debug: /File[/var/lib/puppet/lib/puppet/property/portage_version.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/property/portage_version.rb
Debug: /File[/var/lib/puppet/lib/puppet/parameter/portage_name.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parameter/portage_name.rb
Debug: /File[/var/lib/puppet/lib/puppet/parameter/portage_name.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parameter/portage_name.rb
Debug: /File[/var/lib/puppet/lib/puppet/parameter/portage_name.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parameter/portage_name.rb
Debug: /File[/var/lib/puppet/lib/puppet/parameter/portage_name.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parameter/portage_name.rb
Debug: /File[/var/lib/puppet/lib/facter/util/puppet_settings.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/util/puppet_settings.rb
Debug: /File[/var/lib/puppet/lib/facter/util/puppet_settings.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/util/puppet_settings.rb
Debug: /File[/var/lib/puppet/lib/facter/util/puppet_settings.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/util/puppet_settings.rb
Debug: /File[/var/lib/puppet/lib/facter/util/puppet_settings.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/util/puppet_settings.rb
Debug: /File[/var/lib/puppet/lib/facter/util/portage.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/facter/util/portage.rb
Debug: /File[/var/lib/puppet/lib/facter/util/portage.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/facter/util/portage.rb
Debug: /File[/var/lib/puppet/lib/facter/util/portage.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/facter/util/portage.rb
Debug: /File[/var/lib/puppet/lib/facter/util/portage.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/facter/util/portage.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line/ruby.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/file_line/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line/ruby.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/file_line/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line/ruby.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/file_line/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/file_line/ruby.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/file_line/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config/git_config.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/git_config/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config/git_config.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/git_config/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config/git_config.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/git_config/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/git_config/git_config.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/git_config/git_config.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/ini_subsetting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp/webapp.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/webapp/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp/webapp.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/webapp/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp/webapp.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/webapp/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/webapp/webapp.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/webapp/webapp.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use/parsed.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_use/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use/parsed.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_use/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use/parsed.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_use/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_use/parsed.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_use/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/a2mod/modfix.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/a2mod/a2mod.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/a2mod/redhat.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/a2mod/gentoo.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/ini_setting/ruby.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo/p4.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo/bzr.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo/svn.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo/hg.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo/dummy.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo/git.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/vcsrepo/cvs.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package/pe_gem.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package/pe_gem.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package/pe_gem.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package/pe_gem.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package/pe_gem.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package/pe_gem.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package/pe_gem.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package/pe_gem.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_keywords/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env/parsed.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_env/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env/parsed.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_env/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env/parsed.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_env/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_env/parsed.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_env/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman/layman.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/layman/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman/layman.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/layman/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman/layman.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/layman/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/layman/layman.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/layman/layman.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_unmask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect/eselect.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/eselect/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect/eselect.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/eselect/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect/eselect.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/eselect/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/eselect/eselect.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/eselect/eselect.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/provider/package_mask/parsed.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/defined_with_params.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/parseyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/ensure_packages.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/try_get_value.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dirname.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/dirname.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dirname.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/dirname.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dirname.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/dirname.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dirname.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/dirname.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_string.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_string.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_string.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_string.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/count.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/count.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/count.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/count.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/count.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/count.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/count.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/count.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_integer.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_integer.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_integer.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_integer.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_integer.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/any2array.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/any2array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/any2array.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/any2array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/any2array.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/any2array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/any2array.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/any2array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_values.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/delete_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_values.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/delete_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_values.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/delete_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_values.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/delete_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/load_module_metadata.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/camelcase.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/camelcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/camelcase.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/camelcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/camelcase.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/camelcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/camelcase.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/camelcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_slength.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/get_module_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/hash.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/hash.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/hash.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/hash.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/num2bool.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/num2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/num2bool.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/num2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/num2bool.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/num2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/num2bool.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/num2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/suffix.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/suffix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/suffix.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/suffix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/suffix.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/suffix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/suffix.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/suffix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/shuffle.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/shuffle.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/shuffle.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/shuffle.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/shuffle.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/shuffle.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/shuffle.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/shuffle.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv4_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_numeric.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/pw_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/capitalize.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/capitalize.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/capitalize.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/capitalize.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/capitalize.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/capitalize.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/capitalize.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/capitalize.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/size.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/size.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/size.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/size.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/size.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/size.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/size.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/size.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/str2saltedsha512.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rand_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/dos2unix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strip.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/strip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strip.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/strip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strip.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/strip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strip.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/strip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_float.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_float.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_float.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_float.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_float.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_float.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_float.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_float.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2str.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/bool2str.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2str.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/bool2str.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2str.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/bool2str.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2str.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/bool2str.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/sort.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/sort.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/sort.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/sort.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/sort.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/sort.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/sort.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/sort.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/pick.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/pick.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/pick.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/pick.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reject.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/reject.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reject.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/reject.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reject.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/reject.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reject.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/reject.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parsejson.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/parsejson.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parsejson.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/parsejson.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parsejson.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/parsejson.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/parsejson.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/parsejson.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/to_bytes.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/time.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/time.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/time.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/time.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/time.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/time.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/time.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/time.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/delete.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/delete.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/delete.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/delete.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/downcase.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/downcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/downcase.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/downcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/downcase.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/downcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/downcase.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/downcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_bool.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_bool.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_bool.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_bool.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_domain_name.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/loadyaml.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/member.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/member.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/member.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/member.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/member.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/member.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/member.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/member.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type3x.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/type3x.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type3x.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/type3x.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type3x.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/type3x.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type3x.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/type3x.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unique.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/unique.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unique.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/unique.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unique.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/unique.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unique.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/unique.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_hash.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_hash.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_hash.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_hash.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/fqdn_rotate.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/assert_private.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/assert_private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/assert_private.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/assert_private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/assert_private.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/assert_private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/assert_private.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/assert_private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/has_interface_with.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/keys.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/keys.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/keys.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/keys.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/keys.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/keys.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/keys.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/keys.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/deep_merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/difference.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/difference.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/difference.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/difference.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/difference.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/difference.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/difference.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/difference.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values_at.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/values_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values_at.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/values_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values_at.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/values_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/values_at.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/values_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_key.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/has_key.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_key.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/has_key.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_key.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/has_key.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_key.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/has_key.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/unix2dos.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/rstrip.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/rstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/rstrip.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/rstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/rstrip.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/rstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/rstrip.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/rstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/range.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/range.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/range.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/range.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/range.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/range.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/range.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/range.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/flatten.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/flatten.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/flatten.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/flatten.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/flatten.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/flatten.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/flatten.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/flatten.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/lstrip.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/lstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/lstrip.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/lstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/lstrip.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/lstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/lstrip.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/lstrip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_string.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_string.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_string.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_string.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_string.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/private.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/private.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/private.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/private.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/private.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_array.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_array.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_array.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_array.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2bool.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/str2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2bool.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/str2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2bool.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/str2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/str2bool.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/str2bool.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick_default.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/pick_default.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick_default.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/pick_default.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick_default.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/pick_default.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/pick_default.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/pick_default.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ceiling.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/ceiling.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ceiling.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/ceiling.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ceiling.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/ceiling.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ceiling.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/ceiling.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/base64.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/base64.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/base64.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/base64.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/base64.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/base64.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/base64.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/base64.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reverse.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/reverse.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reverse.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/reverse.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reverse.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/reverse.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/reverse.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/reverse.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/max.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/max.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/max.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/max.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/max.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/max.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/max.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/max.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/prefix.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/prefix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/prefix.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/prefix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/prefix.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/prefix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/prefix.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/prefix.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/join_keys_to_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/zip.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/zip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/zip.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/zip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/zip.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/zip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/zip.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/zip.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/empty.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/empty.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/empty.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/empty.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/empty.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/empty.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/empty.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/empty.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/squeeze.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/squeeze.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/squeeze.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/squeeze.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/squeeze.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/squeeze.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/squeeze.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/squeeze.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/type.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/type.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/type.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/type.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/type.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_augeas.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2num.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/bool2num.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2num.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/bool2num.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2num.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/bool2num.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/bool2num.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/bool2num.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getvar.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/getvar.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getvar.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/getvar.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getvar.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/getvar.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getvar.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/getvar.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/has_ip_network.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/swapcase.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/swapcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/swapcase.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/swapcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/swapcase.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/swapcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/swapcase.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/swapcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/concat.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/concat.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/concat.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/concat.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/concat.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/concat.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/concat.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/concat.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/uriescape.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/uriescape.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/uriescape.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/uriescape.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/uriescape.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/uriescape.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/uriescape.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/uriescape.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strftime.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/strftime.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strftime.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/strftime.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strftime.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/strftime.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/strftime.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/strftime.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/convert_base.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/convert_base.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/convert_base.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/convert_base.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/convert_base.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/convert_base.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/convert_base.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/convert_base.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/min.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/min.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/min.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/min.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/min.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/min.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/min.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/min.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/abs.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/abs.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/abs.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/abs.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/abs.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/abs.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/abs.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/abs.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/upcase.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/upcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/upcase.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/upcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/upcase.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/upcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/upcase.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/upcase.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/union.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/union.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/union.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/union.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/union.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/union.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/union.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/union.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chomp.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/chomp.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chomp.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/chomp.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chomp.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/chomp.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chomp.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/chomp.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_absolute_path.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chop.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/chop.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chop.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/chop.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chop.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/chop.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/chop.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/chop.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_mac_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_re.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_re.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_re.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_re.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_re.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_re.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_re.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_re.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getparam.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/getparam.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getparam.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/getparam.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getparam.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/getparam.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/getparam.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/getparam.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_array.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_array.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_array.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_array.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_array.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_ipv6_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/git_config_hash.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/merge.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/merge.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/merge.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/merge.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/merge.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/grep.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/grep.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/grep.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/grep.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/grep.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/grep.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/grep.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/grep.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/join.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/join.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/join.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/join.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/join.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/floor.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/floor.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/floor.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/floor.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/floor.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/floor.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/floor.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/floor.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/intersection.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/intersection.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/intersection.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/intersection.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/intersection.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/intersection.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/intersection.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/intersection.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/basename.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/basename.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/basename.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/basename.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/basename.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/basename.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/basename.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/basename.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/seeded_rand.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_at.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/delete_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_at.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/delete_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_at.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/delete_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_at.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/delete_at.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/ensure_resource.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/is_function_available.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/delete_undef_values.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_ip_address.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/validate_cmd.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb
Debug: /File[/var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/parser/functions/create_ini_settings.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file/section.rb]/seluser: Found seluser default 'system_u' for /var/lib/puppet/lib/puppet/util/ini_file/section.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file/section.rb]/selrole: Found selrole default 'object_r' for /var/lib/puppet/lib/puppet/util/ini_file/section.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file/section.rb]/seltype: Found seltype default 'puppet_var_lib_t' for /var/lib/puppet/lib/puppet/util/ini_file/section.rb
Debug: /File[/var/lib/puppet/lib/puppet/util/ini_file/section.rb]/selrange: Found selrange default 's0' for /var/lib/puppet/lib/puppet/util/ini_file/section.rb
Debug: Failed to load library 'msgpack' for feature 'msgpack'
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: file_metadata supports formats: pson b64_zlib_yaml yaml raw
Debug: Using cached connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Caching connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Finishing transaction 20915360
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Loading external facts from /var/lib/puppet/facts.d
Info: Loading facts
Debug: Loading facts from /var/lib/puppet/lib/facter/git_version.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/service_provider.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/git_html_path.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/git_exec_path.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/facter_dot_d.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/root_home.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/package_provider.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/pe_version.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/vcsrepo_svn_ver.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/puppet_vardir.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/eselect.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/portage.rb
Debug: Loading facts from /var/lib/puppet/lib/facter/gemhome.rb
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Executing '/bin/rpm --version'
Debug: Executing '/bin/rpm -ql rpm'
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Evicting cache entry for environment 'feature'
Debug: Caching environment 'feature' (ttl = 0 sec)
Debug: Executing '/bin/rpm --version'
Debug: Puppet::Type::Service::ProviderDaemontools: file /usr/bin/svc does not exist
Debug: Puppet::Type::Service::ProviderDebian: file /usr/sbin/update-rc.d does not exist
Debug: Puppet::Type::Service::ProviderGentoo: file /sbin/rc-update does not exist
Debug: Puppet::Type::Service::ProviderLaunchd: file /bin/launchctl does not exist
Debug: Puppet::Type::Service::ProviderOpenrc: file /bin/rc-status does not exist
Debug: Puppet::Type::Service::ProviderRunit: file /usr/bin/sv does not exist
Debug: Puppet::Type::Service::ProviderUpstart: 0 confines (of 2) were true
Debug: Puppet::Type::Package::ProviderPe_gem: file /opt/puppet/bin/gem does not exist
Debug: Puppet::Type::Package::ProviderAix: file /usr/bin/lslpp does not exist
Debug: Puppet::Type::Package::ProviderDpkg: file /usr/bin/dpkg does not exist
Debug: Puppet::Type::Package::ProviderApt: file /usr/bin/apt-get does not exist
Debug: Puppet::Type::Package::ProviderAptitude: file /usr/bin/aptitude does not exist
Debug: Puppet::Type::Package::ProviderAptrpm: file apt-get does not exist
Debug: Puppet::Type::Package::ProviderSun: file /usr/bin/pkginfo does not exist
Debug: Puppet::Type::Package::ProviderFink: file /sw/bin/fink does not exist
Debug: Puppet::Type::Package::ProviderOpenbsd: file pkg_info does not exist
Debug: Puppet::Type::Package::ProviderFreebsd: file /usr/sbin/pkg_info does not exist
Debug: Puppet::Type::Package::ProviderHpux: file /usr/sbin/swinstall does not exist
Debug: Puppet::Type::Package::ProviderNim: file /usr/sbin/nimclient does not exist
Debug: Puppet::Type::Package::ProviderOpkg: file opkg does not exist
Debug: Puppet::Type::Package::ProviderPacman: file /usr/bin/pacman does not exist
Debug: Puppet::Type::Package::ProviderPkg: file /usr/bin/pkg does not exist
Debug: Puppet::Type::Package::ProviderPkgin: file pkgin does not exist
Debug: Puppet::Type::Package::ProviderPortage: file /usr/bin/emerge does not exist
Debug: Puppet::Type::Package::ProviderPorts: file /usr/local/sbin/portupgrade does not exist
Debug: Puppet::Type::Package::ProviderPortupgrade: file /usr/local/sbin/portupgrade does not exist
Debug: Puppet::Type::Package::ProviderRug: file /usr/bin/rug does not exist
Debug: Puppet::Type::Package::ProviderSunfreeware: file pkg-get does not exist
Debug: Puppet::Type::Package::ProviderUp2date: file /usr/sbin/up2date-nox does not exist
Debug: Puppet::Type::Package::ProviderUrpmi: file urpmi does not exist
Debug: Puppet::Type::Package::ProviderZypper: file /usr/bin/zypper does not exist
Debug: Failed to load library 'msgpack' for feature 'msgpack'
Debug: Puppet::Network::Format[msgpack]: feature msgpack is missing
Debug: catalog supports formats: pson b64_zlib_yaml yaml dot raw
Debug: Using cached connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Caching connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Info: Caching catalog for puppetpopagent
Debug: Creating default schedules
Debug: Loaded state in 0.00 seconds
Info: Applying configuration version '1498118267'
Debug: Finishing transaction 38257640
Debug: Storing state
Debug: Stored state in 0.01 seconds
Notice: Finished catalog run in 0.01 seconds
Debug: Using cached connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Caching connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
Debug: Closing connection for https://puppetmasterpophealth.azure.athenahealth.com:8140
++++

Could YOu please guide me as soon as possible. It is blocking my automation. 

Regards. 
K.Keerthiga",Bug,PUP-7687,[],Puppet agent --test not applying any manifests. which i am trying to using environments. 
"root@master:~ # puppet apply --configprint modulepath
/etc/puppetlabs/code/environments/production/modules:/etc/puppetlabs/code/modules:/opt/puppetlabs/puppet/modules
root@master:~ # puppet apply config --configprint certname
master.puppetlabs.vm
root@master:~ # puppet apply --configprint certname
master.puppetlabs.vm

The above usage is not clear from the puppetserver help documentation.

{noformat}
root@master:~ # puppet apply --configprint modulepath
/etc/puppetlabs/code/environments/production/modules:/etc/puppetlabs/code/modules:/opt/puppetlabs/puppet/modules
root@master:~ # puppet apply config --configprint certname
master.puppetlabs.vm
root@master:~ # puppet apply --configprint certname
master.puppetlabs.vm
root@master:~ # puppet apply --help

puppet-apply(8) -- Apply Puppet manifests locally
========

SYNOPSIS
--------
Applies a standalone Puppet manifest to the local system.


USAGE
-----
puppet apply [-h|--help] [-V|--version] [-d|--debug] [-v|--verbose]
  [-e|--execute] [--detailed-exitcodes] [-L|--loadclasses]
  [-l|--logdest syslog|eventlog|<FILE>|console] [--noop]
  [--catalog <catalog>] [--write-catalog-summary] <file>


DESCRIPTION
-----------
This is the standalone puppet execution tool; use it to apply
individual manifests.

When provided with a modulepath, via command line or config file, puppet
apply can effectively mimic the catalog that would be served by puppet
master with access to the same modules, although there are some subtle
differences. When combined with scheduling and an automated system for
pushing manifests, this can be used to implement a serverless Puppet
site.

Most users should use 'puppet agent' and 'puppet master' for site-wide
manifests.


OPTIONS
-------
Note that any setting that's valid in the configuration
file is also a valid long argument. For example, 'tags' is a
valid setting, so you can specify '--tags <class>,<tag>'
as an argument.

See the configuration file documentation at
https://docs.puppetlabs.com/puppet/latest/reference/configuration.html for the
full list of acceptable parameters. A commented list of all
configuration options can also be generated by running puppet with
'--genconfig'.

* --debug:
  Enable full debugging.

* --detailed-exitcodes:
  Provide extra information about the run via exit codes. If enabled, 'puppet
  apply' will use the following exit codes:

  0: The run succeeded with no changes or failures; the system was already in
  the desired state.

  1: The run failed.

  2: The run succeeded, and some resources were changed.

  4: The run succeeded, and some resources failed.

  6: The run succeeded, and included both changes and failures.

* --help:
  Print this help message

* --loadclasses:
  Load any stored classes. 'puppet agent' caches configured classes
  (usually at /etc/puppetlabs/puppet/classes.txt), and setting this option causes
  all of those classes to be set in your puppet manifest.

* --logdest:
  Where to send log messages. Choose between 'syslog' (the POSIX syslog
  service), 'eventlog' (the Windows Event Log), 'console', or the path to a log
  file. Defaults to 'console'.

  A path ending with '.json' will receive structured output in JSON format. The
  log file will not have an ending ']' automatically written to it due to the
  appending nature of logging. It must be appended manually to make the content
  valid JSON.

* --noop:
  Use 'noop' mode where Puppet runs in a no-op or dry-run mode. This
  is useful for seeing what changes Puppet will make without actually
  executing the changes.

* --execute:
  Execute a specific piece of Puppet code

* --test:
  Enable the most common options used for testing. These are 'verbose',
  'detailed-exitcodes' and 'show_diff'.

* --verbose:
  Print extra information.

* --catalog:
  Apply a JSON catalog (such as one generated with 'puppet master --compile'). You can
  either specify a JSON file or pipe in JSON from standard input.

* --write-catalog-summary
  After compiling the catalog saves the resource list and classes list to the node
  in the state directory named classes.txt and resources.txt

EXAMPLE
-------
    $ puppet apply -l /tmp/manifest.log manifest.pp
    $ puppet apply --modulepath=/root/dev/modules -e ""include ntpd::server""
    $ puppet apply --catalog catalog.json


AUTHOR
------
Luke Kanies


COPYRIGHT
---------
Copyright (c) 2011 Puppet Labs, LLC Licensed under the Apache 2.0 License

root@master:~ #


{noformat}
",Bug,PUP-7686,"['beginner', 'the-goods']",puppet apply --help doesn't show configprint option
"Systems with complex, and overlapping, user lookups may double list a user's groups.

For example:

{noformat}
$ puppet resource user riehecky
{noformat}

{code:puppet}
user { 'riehecky':
  ensure           => 'present',
  comment          => 'Patrick Riehecky',
  gid              => '100',
  groups           => ['wheel', 'mock', 'staff', 'wheel', 'mock', 'staff'],
  home             => '/home/r/riehecky',
  shell            => '/bin/bash',
  uid              => '10000',
}
{code}",Bug,PUP-7685,['community'],puppet resource user may show double groups
"Ubuntu on Power 8

The following tests are failing they're all test issues as the fqdn and the agent.hostname are not the same and the test is expects them to be.

Test Case tests/reports/corrective_change_new_resource.rb
Test Case tests/reports/corrective_change_outside_puppet.rb
Test Case tests/reports/corrective_change_via_puppet.rb
Test Case tests/resource/file/ticket_6448_file_with_utf8_source.rb",Bug,PUP-7684,[],Puppet acceptance tests failures on Power 8 Ubuntu 16.04 and Rhel 7
Add acceptance test to validate that generated types take precedence over ruby types if present.,Task,PUP-7683,[],acceptance: add test ensuring that generated types take presedence over ruby types
"Add acceptance test to verify that when facter facts include characters that are sensitive to URL encoding (' ', '+', '*', '#', '%', '&'), the catalog is successfully compiled and applied.",Sub-task,PUP-7682,[],acceptance: add test ensuring URL special characters do not break catalog compile/apply
Add acceptance test to validate that the catalog sent by the puppet master is in the {{pson}} format if the catalog contains binary content.,Task,PUP-7681,[],acceptance: add test ensuring PSON catalog sent if it contains binary data
,Bug,PUP-7680,[],Create acceptance test for PUP-7671
"Its going to take a while to get the power machines for ubuntu up and running in CI. So we need to hand test Puppet, hiera, facter, and pxp-agent tests on Ubuntu ppc64 and file any issues found",Task,PUP-7679,[],"Hand test Puppet, hiera, facter, and pxp-agent tests on Ubuntu 16.04 and RedHat 7 Power 8 ppc64"
"The functions {{all}} and {{any}} are very useful to have as the alternative is to write a somewhat awkward reduce where lots of values are potentially skipped.

The {{all}} and {{any}} should follow the puppet iterative function convention of one or two keys being the index/key and value.",New Feature,PUP-7678,[],Add functions 'all' and 'any'
"We will need a mechanism to ship dark changes during the puppet 5 series that are targeted to go live / on by default in puppet 6

*In Scope*
* Create a puppet setting that can be used to determine whether a user wants to opt into possible future behavior of puppet (including breaking changes)
* Suggest name `--future-features` with boolean possible values: true, false (default to false)

*Notes*
* This flag doesn't have to be constrained to the puppet 5 => 6 transition. We could consider just retaining it to generally mean ""major features or changes anticipated for the next major version of puppet""
* Docs should note that code enabled with the `--future-features` flag is experimental and subject to change, especially based on user feedback
",New Feature,PUP-7677,[],Create a feature flag setting for puppet 6 features during puppet 5 lifetime
"In order to convert values from hiera backends to rich data values not directly representable in plain YAML/JSON, the {{lookup_options}} should be given a new key {{convert_to}} that accepts either a type name (for example {{""Sensitive""}}), or an array of type name and arguments to the type's {{new}} function.

This is of value as there is no way to represent certain data types directly in JSON, YAML, etc. and there is no way to have any logic post process a looked up value before it is assigned to a class parameter when using APL.

If a simple data type is used (for example {{Sensitive}}) it is expected that this type has a single argument constructor that accepts the looked up value and returns an instance of the specified data type. If the constructor is more complex and needs additional arguments, or where its single argument constructor is not appropriate for the use case, an array of typename + arguments is instead used. An example could be interpretation of a String in a particular format used to construct a time/date value.

The type entry in lookup_options is a String with a valid Puppet Type System specification of a data type, thereby also adding type matching - since a `new` will check that what is produced is compliant with any type constraints expressed in the type.

Example - Making a value Sensitive
{code:yaml}
mymodule::mykey: 42
lookup_options:
  mymodule::mykey:
    convert_to: ""Sensitive""
{code}

Example - turning a non Array value into an array:
{code:yaml}
mymodule::mykey: 42
lookup_options:
  mymodule::mykey:
    convert_to: 
      - ""Array""
      - true
{code}
",New Feature,PUP-7675,[],Add the ability to typecast a key using lookup_options
"A resource collector will always load the ruby resource, even if resources has been generated using {{puppet generate types}}.",Bug,PUP-7674,['resolved-issue-added'],Resource collectors fails to load generated resource types.
"On Solaris ZFS has a 'zoned' property. On Linux it's a noop, on FreeBSD it is called 'jailed'.  

Exemple :

{noformat}
$ bundle exec puppet resource zfs
Error: Could not run: Execution of '/sbin/zfs get -H -o value zoned SSD' returned 2: bad property list: invalid property 'zoned'
{noformat}

{{/sbin/zfs get -H -o value zoned SSD}} should be {{/sbin/zfs get -H -o value jailed SSD}} on FreeBSD",Bug,PUP-7672,[],The ZFS zoned property is not portable
"We have been using the following snippet to generate a number of resources dynamically in an each loop for a while now without problems. After the upgrade to 4.10.3 this morning (including a restart of the Puppetserver) we get this error on multiple nodes

{noformat}
Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Unknown resource type: 'Saltnetwork::Iptables::Service_chain::Icmp' at <location of Resource in snippet below>
{noformat}

The files are still in the

{code:puppet}
  each([ ""icmp""
       , ""ssh""
       , ""http""
       , ""http81""
       , ""https""
       , ""dhcp_client""
       , ""smtp""       
       , ""nrpe""
       ]) |$service_chain| {
    $service_chain_dashes = regsubst($service_chain, '_', '-', 'G')
    Resource[""saltnetwork::iptables::service_chain::${service_chain}""] { ""allow_${service_chain}"":
      rule_set_name => 'common'
    , rule_target  => { table => 'filter', chain => ""allow-${service_chain_dashes}"", target => 'ACCEPT' }
    }                          
  } 

{code}

For reference, the definition of the resource is in one of our module paths in saltnetwork/manifests/iptables/service_chain/icmp.pp


{code:puppet}
define saltnetwork::iptables::service_chain::icmp(
    SaltNetwork::IPTables::Rule_Set_Name $rule_set_name
  , SaltNetwork::IPTables::Rule_Target_Both $rule_target
  , Boolean $return = true
  ) {

  $chain_name = $rule_target['chain']

  $table = saltnetwork::iptables::table_for_target($rule_target)

  saltnetwork::iptables::custom_chain_both { ""${rule_set_name}_${table}_${chain_name}"":
      rule_set_name => $rule_set_name
    , table      => $table
    , chain_name => $chain_name
    , return     => $return
  }

  saltnetwork::iptables::rule_both { ""${rule_set_name}_${table}_${chain_name}_icmp"":
      rule_set_name => $rule_set_name
    , rule_order => 10
    , rule_matches => [ { match => 'iana_protocol', protocol => 'icmp' } ]
    , rule_target => $rule_target
    , rule_comment => ""ICMP""
  }

}

{code}

",Bug,PUP-7671,"['regression', 'resolved-issue-added']","Resource definition via Resource[""string""] { ""title"": ... } fails in Puppet 4.10.3"
"Almost all Pcore type classes are named using the convention: {{P<type name>Type}}. There are two exceptions, the {{PType}} and {{PHostClassType}}. They should be renamed to {{PTypeType}} and {{PClassType}} and the code in place to cater for the exceptions should be removed.",Improvement,PUP-7670,[],Rename PType and PHostClassType to follow naming convention
,Task,PUP-7669,[],Tag puppet 4.10.3 for agent 1.10.3 release
"The example used to create this failure is below. The service resource has an offset of 34, which is actually the start of the else keyword. It should be 45.

{code}
class firewall {
  if(true) {
  } else {
    service { 'service':
      ensure    => running
    }
  }
}
{code}",Bug,PUP-7668,[],ResourceExpression has incorrect offset when inside of an else block
"When adding a new node which has a FQDN set in /etc/hostname, the generated CSR on puppet agent doesn't include the FQDN, as long as no DNS search domain is set. This makes things weird, as a second CSR will be generated when network is set up properly and the DNS domain suddenly appears:

This might be due to facter not showing the FQDN correctly, but I'm unsure whether puppet agents derives the csr name from facter or not.

{noformat}
root@puppettest:~# cat /etc/hostname 
puppettest.mydomain.com

root@puppettest:~# facter hostname
puppettest
root@puppettest:~# facter fqdn    
puppettest

root@puppettest:~# puppet agent --server puppet.mydomain.com --waitforcert 10 -t --verbose
Info: Creating a new SSL key for puppettest
Info: Caching certificate for ca
Info: csr_attributes file loading from /etc/puppet/csr_attributes.yaml
Info: Creating a new SSL certificate request for puppettest
Info: Certificate Request fingerprint (SHA256): F5:09:15:AD:A1:2A:F2:85:9E:A1:65:C9:23:9F:A4:16:50:36:89:8A:06:6F:FC:45:4F:6D:00:E9:1D:BA:25:C0
Info: Caching certificate for ca
Notice: Did not receive certificate
{noformat}

As soon as I add ""{{domain mydomain.com}}"" to {{/etc/resolv.conf}}, {{facter fqdn}} shows {{""puppettest.mydomain.com""}}, and the puppet agent generates a new certificate on the next run.

I think it should be more consistent to take the FQDN from {{$(hostname)}}, if one is set there, instead of only {{$(hostname -s)}}, and adding one from {{/etc/resolv.conf}} if set. This applies both to {{facter fqdn}} and the agents method of deriving the certificate name.",Bug,PUP-7667,[],"puppet agent doesn't create certificate with FQDN if /etc/hostname contains FQDN, but search domain is not set"
,Task,PUP-7666,[],bump puppet version to 4.10.3
"This is related to PUP-7658, except that it applies to when the agent sends the catalog request in JSON, as we do not currently escape the fact values. So the {{&}} is interpreted as a query parameter delimiter instead of a fact value.

To repro. Create external facts with the following in either {{/etc/puppetlabs/facter/facts.d}} if running as root, or {{~/.facter/facts.d}}:

{code:yaml}
---
space: ""foo bar""
plus: ""foo+bar""
star: ""foo*bar""
hash: ""foo#bar""
percent: ""foo%bar""
ampersand: ""foo & bar""
{code}

Do an agent run, and it will fail with:

{noformat}
<- ""POST /puppet/v3/catalog/chara.corp.puppetlabs.net?environment=production HTTP/1.1\r\nAccept: application/json, application/x-msgpack, text/pson\r\nX-Puppet-Version: 5.0.0\r\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\r\nUser-Agent: Puppet/5.0.0 Ruby/2.4.1-p111 (x86_64-darwin15)\r\nHost: chara.corp.puppetlabs.net:8140\r\nContent-Length: 5599\r\nContent-Type: application/x-www-form-urlencoded\r\n\r\n""
<- ""environment=production&facts_format=application%2Fjson&facts=%7B%22name%22%3A%22XXX.corp.puppetlabs.net%22%2C%22values%22%3A%7B%22puppetversion%22%3A%225.0.0%22%2C%22architecture%22%3A%22x86_64%22%2C%22kernel%22%3A%22Darwin%22%2C%22space%22%3A%22foo%20bar%22%2C%22plus%22%3A%22foo%2Bbar%22%2C%22star%22%3A%22foo%2Abar%22%2C%22hash%22%3A%22foo%23bar%22%2C%22percent%22%3A%22foo%25bar%22%2C%22ampersand%22%3A%22foo%20&%20bar%22%2C...
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Could not intern from json: 743: unexpected token at '{""name"":""chara.corp.puppetlabs.net"",""values"":{""puppetversion"":""5.0.0"",""architecture"":""x86_64"",""kernel"":""Darwin"",""space"":""foo bar"",""plus"":""foo+bar"",""star"":""foo*bar"",""hash"":""foo#bar"",""percent"":""foo%bar"",""ampersand"":""foo '
{noformat}",Bug,PUP-7665,[],Puppet 5 fails when facter facts contain ampersands
"Somewhere in between 78e175e6 and 27fdad2 of puppet, puppet server tests have started failing.

Specifically, [https://jenkins-master-prod-1.delivery.puppetlabs.net/job/platform_puppetserver_integration-system_no-conditional_smoke-master/366/LAYOUT=redhat7-64ma-windows2008r2-64a,LDAP_TYPE=default,label=beaker/consoleFull], with output:
{code}10:26:01 p7145rmqxgo7fs9.delivery.puppetlabs.net (redhat7-64-1) 17:26:01$ curl --silent --cacert /etc/puppetlabs/puppet/ssl/certs/ca.pem --key /etc/puppetlabs/puppet/ssl/private_keys/p7145rmqxgo7fs9.delivery.puppetlabs.net.pem --cert /etc/puppetlabs/puppet/ssl/certs/p7145rmqxgo7fs9.delivery.puppetlabs.net.pem https://p7145rmqxgo7fs9.delivery.puppetlabs.net:8140/puppet/v3/catalog/p7145rmqxgo7fs9.delivery.puppetlabs.net?environment=production | python -m json.tool
10:26:01   {
10:26:02       ""issue_kind"": ""RUNTIME_ERROR"",
10:26:02       ""message"": ""Server Error: Function lookup() did not find a value for the name 'classes' on node p7145rmqxgo7fs9.delivery.puppetlabs.net""
10:26:02   }
10:26:02 
10:26:02 p7145rmqxgo7fs9.delivery.puppetlabs.net (redhat7-64-1) executed in 1.00 seconds
10:26:02 Minitest::Assertion: FAIL: Expected catalog to contain current_code_id 3aafbd686b0f884f4519de1ebd6fdac5d2454d14..
{code}
On repro, the actual stack trace from logs is [https://gist.github.com/MosesMendoza/4cdedf11fb92c137404a29b28d137a48].

*Update*
 This is the result of laying down a hiera 5 yaml file in puppet instead of the previous default hiera yaml file provided by the hiera project.

This was done in [https://github.com/puppetlabs/puppet/commit/7178bf1850c1addc40b5cc31a29aa4add09f34a9]. The puppet install.rb runs after the hiera install.rb during the puppet agent build process, so the hiera.yaml from hiera is overwritten by the hiera.yaml from puppet.

The new default does not specify the same hierarchy, so lookup now fails where it previously succeeded.

This is problematic because the original hiera.yaml file was never modified - which means package managers won't back it up given a new one (the hiera 5 yaml) on upgrade. If users were relying on the previous behavior their lookups will fail.",Bug,PUP-7664,[],"""Function lookup() did not find a value for the name 'classes' on node"""
"Setting the user resource's expiry to `absent` in SLES 11 results in the expiry for the user to be `1970-01-01` instead of `never`. This is different from what is seen in CentOS 6/7, and results in users that are not able to authenticate. 

{code}
# puppet resource user testuser ensure=present expiry=absent
Notice: /User[testuser]/ensure: created
user { 'testuser':
  ensure => 'present',
  expiry => '1970-01-01',
}
# puppet resource user testuser ensure=present expiry=absent
Notice: /User[testuser]/expiry: undefined 'expiry' from '1970-01-01'
user { 'testuser':
  ensure => 'present',
  expiry => '1970-01-01',
}
{code}
",Bug,PUP-7663,"['sles', 'triaged', 'type_and_provider', 'user']",User resource expiry incorrect on SLES 11
"There are a number of communications between an agent and master during an agent run - the agent sends a node request to obtain the server-specified environment, it sends requests for pluginfacts and plugin modules, it requests a catalog, and it sends a report. Somewhere in here we can probably remove at least one of these communications...

I wouldn't be surprised if there are additional communications that occur between the master and puppetdb due to historic indirector behavior that could also be corrected (ex confirming caching is configured correctly)

*In Scope*
* Investigate ways to optimize the number of and purpose of communications between agent and master, with an eye to reducing both number and payload
",Task,PUP-7662,[],SPIKE - investigate agent/master/puppetdb HTTP coms optimizations
"If you need to know about pre-docs, first read: https://confluence.puppetlabs.com/display/DOCS/Pre-docs%3A+How+to+create+and+share+them (Kari's demo video is also very helpful, linked on this same page.)

* What is the functional change?
* Why is this change happening?
* How does it affect users?
* What do users need to *do* because of this change?
* Which existing docs need to be updated or deleted because this new info makes it obsolete?
* Do you have a place in mind in the docs for this new info?
* Who is available for technical review for these docs after they are written?",Task,PUP-7661,[],Create Pre-Docs for PSON => JSON
"I would not expect these to be validated unless the resource is actually realized, since an unrealized resource could indicate that other related resources are missing.

{noformat}
branan@rycon:~/proj/pl/puppet$ bundle exec puppet apply foo.pp
Error: Could not find resource 'Package[aptitude]' in parameter 'require' at /home/branan/proj/pl/puppet/foo.pp:2 on node rycon
branan@rycon:~/proj/pl/puppet$ cat foo.pp
@package { 'apt':
  require => Package['aptitude']
}
{noformat}",Bug,PUP-7660,['resolved-issue-added'],Metaparameters are validated on unrealized resources
"Hi,

Overnight, puppet-agent was upgraded from 1.10.1-1xenial to 1.10.2-1xenial. This seemingly innocuous change resulted in the following error:
{code}
Jun 14 00:48:20 i-072fa113c6c3ba210 puppet-agent[6912]: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Could not intern from pson: expected value in object at '""#!/bin/bash\nPUPPET'!
{code}

(NB {{'#!/bin/bash\nPUPPET'}} is the start of our AWS EC2 user data, found in facter.)

Downgrading the package fixed the issue, nothing else seemed to work including restarting master and agents, and removing and generating new certificates.

If it matters, our puppet masters run 2.7.2-1puppetlabs1.",Bug,PUP-7659,[],Agent upgrade to 4.10.2 breaks runs
"Some of our Puppet users did upgrade to the newest Puppet agent version 4.10.2 and have failing Puppet runs when one of their custom Facts contain an ampersand character.

Facter itself does return the custom fact correctly.

Everything works with Puppet agent version 4.10.1

Steps to reproduce:
{code}
$ puppet --version
4.10.2
$ cat > /etc/facter/facts.d/foo.yaml
---
fact: ""foo & bar""
$ facter --version
3.6.5 (commit f1dd8bb97a2a5254093862bc0168a464e72f135a)
$ facter fact
foo & bar
{code}

Puppet agent output:
{code}
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Could not intern from pson: expected value in object at '""foo '!
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{code}


We suspect the bug could originate from this commit:

https://github.com/puppetlabs/puppet/commit/fb99479df8dcc07f19cc9c2bff6b5c79dbcc1f

which changed the way the Facter fact values where formated into pson.


Puppetserver log:

{code}
2017-06-14 12:32:44,356 ERROR [qtp1802912927-72] [puppetserver] Puppet Server Error: Could not intern from pson: expected value in object at '""foo '!
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/external/pson/pure/parser.rb:292:in `parse_object'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/external/pson/pure/parser.rb:225:in `parse_value'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/external/pson/pure/parser.rb:280:in `parse_object'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/external/pson/pure/parser.rb:92:in `parse'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/external/pson/common.rb:121:in `parse'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/formats.rb:89:in `intern'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/format_support.rb:12:in `convert_from'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:30:in `extract_facts_from_request'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:23:in `extract_facts_from_request'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:50:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:121:in `do_find'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:306:in `override'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `process'
org/jruby/RubyArray.java:1613:in `each'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:81:in `process'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:60:in `process'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'
/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:58:in `process'
file:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppetserver-lib/puppet/server/master.rb:42:in `handleRequest'
Puppet$$Server$$Master_1215734539.gen:13:in `handleRequest'
request_handler_core.clj:273:in `invoke'
jruby_request.clj:46:in `invoke'
jruby_request.clj:31:in `invoke'
request_handler_service.clj:34:in `handle_request'
request_handler.clj:3:in `invoke'
request_handler.clj:3:in `invoke'
core.clj:2515:in `invoke'
ring_middleware.clj:284:in `invoke'
core.clj:168:in `invoke'
core.clj:211:in `invoke'
core.clj:45:in `invoke'
core.clj:343:in `invoke'
core.clj:51:in `invoke'
ringutils.clj:83:in `invoke'
master_core.clj:428:in `invoke'
ring.clj:21:in `invoke'
ring.clj:12:in `invoke'
comidi.clj:249:in `invoke'
jetty9_core.clj:424:in `invoke'
normalized_uri_helpers.clj:80:in `invoke'
{code}",Bug,PUP-7658,[],Puppet 4.10.2 fails when Facter facts contains ampersand
"Hello,

Please take this report for the moment as a call for help debugging although it might end up becoming a bug report. The Puppet version over here is 4.9.4.

We're experiencing intermittent compilation failures in nodes making using of the following modules:

* https://github.com/openstack/puppet-openstacklib/tree/stable/newton
* https://github.com/openstack/puppet-nova/tree/stable/newton

The snippet to reproduce the issue is pretty simple:

{noformat}
  Package<| tag == 'nova-support-package'|>
  -> Nova_network<||>
{noformat}

and the error message as seen by the agent when requesting a catalog is the following:

{noformat}
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Virtual Query, Could not autoload puppet/type/nova_network: Could not autoload puppet/provider/nova_network/nova: no such file to load -- puppet/provider/openstack at somewhere/environments/fooenv/somemanifest.pp:171:6 on node foo.example.org
{noformat}

The Package resouce collector is in principle irrelevant, the point is to force the parser to ask for the type called Nova_network.

This error only happens when the master hasn't seen that type before. When we restart the puppetserver daemon the compilation failure only happens during the first run that a particular thread serves for that node, the rest succeed. This a bit annoying in production as the number of masters that could serve a given node is quite high and we recycle instances every 3000 requests.

The chain of calls is the following:

The [nova provider|https://github.com/openstack/puppet-nova/blob/stable/newton/lib/puppet/provider/nova_network/nova.rb] for the Nova_network type is loaded, which loads another file using this statement:

{noformat}
require File.join(File.dirname(__FILE__), '..','..','..', 'puppet/provider/nova')
{noformat}

That  path resolves to [this file|https://github.com/openstack/puppet-nova/blob/stable/newton/lib/puppet/provider/nova.rb] which requires [another class from the openstacklib module|https://github.com/openstack/puppet-openstacklib/blob/stable/newton/lib/puppet/provider/openstack.rb]:

{noformat}
require 'puppet/provider/openstack'
{noformat}

If I don't misread the error message that's the class that the master is unable to find:

{noformat}
Could not autoload puppet/provider/nova_network/nova: no such file to load -- puppet/provider/openstack
{noformat}

Are the aforementioned modules doing anything wrong? Could it be a misconfiguration of our masters? A bug in Puppet itself perhaps?

We've got as well the full server-side backtrace so please don't hesitate to ask for it if you think that it might be useful. Any request to do extra debugging from our side is also more than welcome.

Thanks!",Bug,PUP-7657,[],Providers requiring files in other modules might cause intermittent compilation failures
Execute manual test: Hiera 5 content in various locales,Task,PUP-7656,[],Execute manual test: Hiera 5 content in various locales
"On puppet/master

I have the following manifest:
{code}
file { ""C:\Users\moses\Desktop\file_utf8_title_€"" :
  ensure => file,
  mode => ""0644"",
  content => ""This is the file content.
"",
}

{code}

when I apply this on windows (as this is a windows path), I get the following:
{code}
C:\Users\moses\development\puppet(master)> be puppet apply C:\Users\moses\Desktop\foo_win.pp
Warning: Unrecognized escape sequence '\U' at C:/Users/moses/Desktop/foo_win.pp:1:50
Warning: Unrecognized escape sequence '\m' at C:/Users/moses/Desktop/foo_win.pp:1:50
Warning: Unrecognized escape sequence '\D' at C:/Users/moses/Desktop/foo_win.pp:1:50
Warning: Unrecognized escape sequence '\f' at C:/Users/moses/Desktop/foo_win.pp:1:50
Notice: Compiled catalog for win-ghb4gdkiluo.localdomain in environment production in 0.04 seconds
Notice: Applied catalog in 0.03 seconds
{code}

These warnings are invalid since its just a file path, not escape sequences..",Bug,PUP-7655,[],"""Warning: Unrecognized escape sequence"" with windows file paths"
"Hi,

I have tried the upgrade to ""Puppet5- nightly"" (only the puppet-agent package) on a healthy and updated puppetserver. Here is the upgrade:

{code:bash}
wget https://apt.puppetlabs.com/puppet5-nightly-release-trusty.deb
dpkg -i puppet5-nightly-release-trusty.deb
apt-get update

# I only upgrade puppet-agent.
#
# If I update puppetdb and puppetdb-termini too I have a puppetdb problem
# (see https://tickets.puppetlabs.com/browse/PDB-3550).
apt-get install puppet-agent
reboot
{code}

After the reboot, I try a puppet run:

{code:bash}
~# /opt/puppetlabs/bin/puppet agent --test
Warning: Setting trusted_server_facts is deprecated. 
   (at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:1159:in `issue_deprecation_warning')
Info: Using configured environment 'production'
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Loading facts
Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: undefined method `key_attributes' for nil:NilClass
Warning: Not using cache on failed catalog
Error: Could not retrieve catalog; skipping run
{code}

In attachment, I have put the content of {{/var/log/puppetlabs/puppetserver/puppetserver.log}} during the puppet run.

Regards.",Bug,PUP-7654,[],Upgrade to puppet5-nightly: undefined method `key_attributes' for nil:NilClass
"Appears to have been introduced in 6562d10a6652aa6a948c549bdf746579cced1111.

{code}
☂ : git co 6562d10a6652aa6a948c549bdf746579cced1111
Previous HEAD position was 43e2c93... Merge pull request #5498 from prometheanfire/enable_portage_options
HEAD is now at 6562d10... (PUP-7042) Mark strings in util
[0] root@ubuntu16:puppet ((no branch, bisect started on 1b04bec))
☂ : be puppet master --no-daemonize
File: /root/puppet/.bundle/ruby/2.3.0/gems/fast_gettext-1.1.0/lib/fast_gettext/vendor/empty.mo: Permission denied @ rb_sysopen - /root/puppet/.bundle/ruby/2.3.0/gems/fast_gettext-1.1.0/lib/fast_gettext/vendor/empty.mo (Errno::EACCES)
☂ : git co HEAD~
Previous HEAD position was 6562d10... (PUP-7042) Mark strings in util
HEAD is now at 43e2c93... Merge pull request #5498 from prometheanfire/enable_portage_options
[0] root@ubuntu16:puppet ((no branch, bisect started on 1b04bec))
☂ : be puppet master --no-daemonize
Warning: The WEBrick Puppet master server is deprecated and will be removed in a future release. Please use Puppet Server instead. See http://links.puppetlabs.com/deprecate-rack-webrick-servers for more information.
   (at /root/puppet/lib/puppet/application/master.rb:210:in `main')
{code}

",Bug,PUP-7653,[],`puppet master` broken on puppet/master
"The ""catalog_uuid_correlates_catalogs_with_reports"" test inspects the serialized content of the ""catalog_uuid"" field in the {{Puppet::Transaction::Report}} that the master stores.  The test expects the value for the ""catalog_uuid"" field to [not be quoted|https://github.com/puppetlabs/puppet/blob/3deda986fcbdf62fe9c3880d3a6c7b91b5122ed3/acceptance/tests/direct_puppet/catalog_uuid_correlates_catalogs_with_reports.rb#L19].  With MRI Ruby 2.3.2 and later (and with JRuby 9.1.9.0, which emulates Ruby language version 2.3.3), some string-based UUID values are serialized to yaml with single quotes around them.

On Ruby 2.3.1, for example, the following value is serialized without any surrounding quotes:

{noformat}
› ruby -ryaml -e ""puts '03080442-0449-43cb-8ec2-f26658f958ac'.to_yaml""
--- 03080442-0449-43cb-8ec2-f26658f958ac
{noformat}

On Ruby 2.3.2, however, the same command from above results in a value wrapped with single quotes:

{noformat}
› ruby -ryaml -e ""puts '03080442-0449-43cb-8ec2-f26658f958ac'.to_yaml""
--- '03080442-0449-43cb-8ec2-f26658f958ac'
{noformat}

Note that this only happens in Ruby 2.3.2+ with some values.  For example, the following is produced under Ruby 2.3.2 and later:

{noformat}
› ruby -ryaml -e ""puts 'caaf2053-7398-410f-8ede-407bbe934162'.to_yaml""
--- caaf2053-7398-410f-8ede-407bbe934162
{noformat}

While the difference in serialized output between the Ruby versions is odd, I'm not sure that it's technically a ""bug"" in that the source value for the {{catalog_uuid}} is a string and characters like ""-"" arguably could warrant quoting whenever they are serialized out to yaml.

For this ticket, I think we should just update the catalog_uuid_correlates_catalogs_with_reports.rb test to handle both the presence or absence of surrounding single quotes the same.  This should enable the test to pass consistently when run with a Puppet Server master running JRuby 9k under Ruby language version 2.3.2+.",Task,PUP-7652,[],Update catalog_uuid acceptance test for Ruby yaml serialization changes
"Devices should be able to handle the notify resource. For instance:

Given this manifest:
  node 'pe-201652-master' {
    include f5
  }

  node 'bigip' {
    notify {""TJK"": }

    f5_virtualserver { '/Common/puppet_vs':
	  ensure                     => 'present',
	  provider                   => 'standard',
	  description                => 'Hello World',
	  destination_address        => '10.20.30.40',
	  destination_mask           => '255.255.255.255',
	  http_profile               => '/Common/http',
	  service_port               => '443',
	  protocol                   => 'tcp',
	  source                     => '0.0.0.0/0',
	  source_address_translation => 'automap',
    }
  }

We don't see any notify output:
  [root@pe-201652-master manifests]# puppet device -v --user=root
  Info: starting applying configuration to bigip at https://54.244.180.9:443/
  Info: Using configured environment 'production'
  Info: Retrieving pluginfacts
  Info: Retrieving plugin
  Info: Caching catalog for bigip
  Info: Applying configuration version '1497281724'
  Notice: Applied catalog in 3.12 seconds

Can we add notify to the list of supported resources for devices?",New Feature,PUP-7651,[],The Notify Resource for Devices
"A load of a resource type will _sometimes_ create a {{Puppet::Pops::Loader::TypedName}} that starts with an uppercase letter. When this name is used in order to find a type generated with {{puppet generate types}}, it isn't found. Since it's not found, a load of the Ruby type is performed instead, which results in an ""Attempt to redefine entity"" error when that a successful load of the generated type has been performed earlier (with a {{TypedName}} that didn't start with an uppercase letter).",Bug,PUP-7650,[],"""Attempt to redefine entity"" caused by upper/lower case name confusion in Loader"
"{{ci:test:git}} won't correctly run the pre-suite against OSX 10.11 due to:

* locations of binaries - and the PATH setup (for an appropriate fix BKR-1139 needs to be released)
* some binary path installation issues as a result of SIP (System Integrity Protection)

The invocation under test is:

{noformat}
GEM_SOURCE=http://rubygems.delivery.puppetlabs.net/ TEST_TARGET=osx1011-64a PUPPET_FORK='Iristyle' bundle exec rake ci:test:git SHA=`git lastref` TEST=./tests/direct_puppet/supports_utf8.rb
{noformat}

This effort was taken on to repro PUP-6217",Improvement,PUP-7648,"['ci', 'osx', 'tech-debt']",Fix ci:test:git pre-suite on OSX 10.11
"In addition to rolling its own CA, the Puppet infrastructure should be able to use SCEP to request certificates from a pre-existing PKI infrastructure to easily support Enterprise PKI Policies.",New Feature,PUP-7647,[],All Puppet components should support SCEP
"h1.  The Problem

I'd like to set `environment_timeout = unlimited` for my production environment and any other long lived environments I may have.  

I'd like all of my feature branch environments to have a much lower environment_timeout so they do no consume memory long after I've stopped using them.  

Since environment.conf is in my control-repo I cannot change environment_timeout to a different value without eventually causing that value to become a merge conflict.  

h1.  Suggested Solution

I should be able to set environment_timeout ( and possibly other puppet.conf settings ) for an environment in a file outside of the environment.  

The environment sections in puppet.conf would have probably been fine if they hadn't been removed when directory environments were introduced.  

https://docs.puppet.com/puppet/3.5/config_file_main.html#environment-config-sections",Bug,PUP-7646,[],Environment_timeout should be configurable per environment but not from a file inside of the environment
"We do not currently commit any MO files to the Puppet repo: they are built in vanagon packaging and installed along with the Agent. If we want to support i18n in the Puppet gem, we need to make sure we compile these files during gem packaging as well. Alternatively, we need to revisit the decision to not commit these files.

*UPDATE* The easiest solution may be to use PO files instead of MO files when running from source or as a gem.

If translations are not going to be supported when using the Puppet gem, this ticket can be closed.",Task,PUP-7645,[],Ensure that translations are available in released puppet gems
"Given that pyton3 and pip3 are installed in the machine already I'm declaring the boto3 package as follows:
{code}
  package { 'boto3':
    ensure => present,
    provider => 'pip3',
  }
{code}
The issue is that when you run puppet for the first time you get:
{code}
{""level"":""debug"",""message"":""Executing '/bin/pip3 freeze'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:22:58.058603923+
00:00""}
{""level"":""debug"",""message"":""Executing '/bin/pip3 --version'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:22:58.7344189
24+00:00""}
{""level"":""debug"",""message"":""Executing '/bin/pip3 freeze'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:22:59.317146692+
00:00""}
{""level"":""debug"",""message"":""Executing '/bin/pip3 --version'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:22:59.9823109
65+00:00""}
{""level"":""debug"",""message"":""Executing: '/bin/pip install -q boto3'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:23:00.569312158+00:00""}
{code}
and when you run it the second time it works as expected:
{code}
{""level"":""debug"",""message"":""Executing '/bin/pip3 freeze'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:39:50.080139315+
00:00""}
{""level"":""debug"",""message"":""Executing '/bin/pip3 --version'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:39:50.7515434
28+00:00""}
{""level"":""debug"",""message"":""Executing '/bin/pip3 freeze'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:39:51.332423254+
00:00""}
{""level"":""debug"",""message"":""Executing '/bin/pip3 --version'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:39:51.9972545
96+00:00""}
{""level"":""debug"",""message"":""Executing: '/bin/pip3 install -q boto3'"",""source"":""Puppet"",""tags"":[""debug""],""file"":null,""line"":null,""version"":1,""@timestamp"":""2017-06-08T14:39:52.586167287+00:00""}
{code}
The above happens without making any change at all in the environment between puppet runs.

culprit has to be in https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet/provider/package/pip3.rb ￼ which basically imports https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet/provider/package/pip.rb

Also, a collaborator posted this answer:
	
Following the stack trace within the code, I would blame this: https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet/provider/package/pip.rb#L129 It should probably be pip_cmd. You certainly have enough to file an issue on the JIRA at this point though. – Matt Schuchard",Bug,PUP-7644,[],puppet installing pip rather than pip3 packages using the pip3 provider only on the first run
"Acceptance tests expecting catalog application notices to return array elements are now failing due to language changes that return arrays in bracketed notation.

Example error:
{code}
Expected /ip changed 'ip.if.1:1.1.1.1'.* to .'ip.if.1:1.1.1.1', 'ip.if.2:1.1.1.2'./ to match ""\e[mNotice: Compiled catalog for sviz1kae5v49d6z.delivery.puppetlabs.net in environment production in 0.04 seconds\e[0m\n\e[0;32mInfo: Applying configuration version '1496988604'\e[0m\n\e[mNotice: /Stage[main]/Main/Zone[tstzone]/ip: ip changed ip.if.1:1.1.1.1 to ['ip.if.1:1.1.1.1', 'ip.if.2:1.1.1.2']\e[0m\n\e[mNotice: Applied catalog in 0.17 seconds\e[0m\n"".
{code}

[Job link|https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/master/view/Suite/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/]",CI Blocker,PUP-7643,[],acceptance tests fail recieving bracket array values
"When an agent that deals with custom rich-data types (Objects) sends a report to the server, the server will not have a correct environment/loaders configured to instantiate the values that are contained in the report events. It currently does, which results in an error.

The desired behavior is to retain the hash that is the result of serializing such objects.
",Bug,PUP-7642,[],A Report containing rich-data should allow presence of unresolved custom types.
"I recently got stumped doing a training course trying to demonstrate moving global data to the environment layer and came across this behaviour - If this is intended behaviour then it really needs to be documented well because (for me) this was seems really confusing.

h1. Summary
Lookups will always prioritise data found in /etc/puppetlabs/puppet/data/ even if no global level lookup has been configured.

h2. Set up

Version 4.10.1

{code}
[root@devagent puppetlabs]# puppet -V
4.10.1
{code}

One hiera.yaml file at the environment level - no global configuration file.
{code}
[root@devagent puppetlabs]# find /etc/puppetlabs -name hiera.yaml
/etc/puppetlabs/code/environments/production/hiera.yaml

[root@devagent puppetlabs]# cat /etc/puppetlabs/code/environments/production/hiera.yaml
version: 5
hierarchy:
  - name: ""test""
    path: ""common.yaml""
    data_hash: yaml_data
    datadir: hieradata
{code}

h2. Steps

1) Populate the environment data

{code}
[root@devagent puppetlabs]# echo -n ""foo::bar: from the environment"" > /etc/puppetlabs/code/environments/production/hieradata/common.yaml
[root@devagent puppetlabs]# puppet lookup foo::bar
--- from the environment
...
{code}

2) ... so far so good ...  now if we leave some data in the global layer, which we've not configured anywhere, it's used by default....

{code}
[root@devagent puppetlabs]# echo -n ""foo::bar: WTF?"" > /etc/puppetlabs/puppet/data/common.yaml
[root@devagent puppetlabs]# puppet lookup foo::bar
--- WTF?
...
{code}

With explain turned on....

{code}
[root@devagent puppetlabs]# puppet lookup foo::bar --explain
Searching for ""lookup_options""
  Global Data Provider (hiera configuration version 5)
    Hierarchy entry ""Common""
      Path ""/etc/puppetlabs/puppet/data/common.yaml""
        Original path: ""common.yaml""
        No such key: ""lookup_options""
  Environment Data Provider (hiera configuration version 5)
    Using configuration ""/etc/puppetlabs/code/environments/production/hiera.yaml""
    Hierarchy entry ""test""
      Path ""/etc/puppetlabs/code/environments/production/hieradata/common.yaml""
        Original path: ""common.yaml""
        No such key: ""lookup_options""
  Module data provider for module ""foo"" not found
Searching for ""foo::bar""
  Global Data Provider (hiera configuration version 5)
    Hierarchy entry ""Common""
      Path ""/etc/puppetlabs/puppet/data/common.yaml""
        Original path: ""common.yaml""
        Found key: ""foo::bar"" value: ""WTF?""
{code}

So it seems the global level will always get looked up even when the user hasn't configured it and will use defaults - so if old / obsolete data is found in the global default datadir then it gets prioritised over whats configured and this, to me, is confusing behaviour.

",Bug,PUP-7641,[],Hiera 5 Global level is looked up even when not configured
"*Problem 1.*
The {{Puppet::Property::List}} class, super class of {{Puppet::Property::OrderedList}} implements the method {{#is_to_s}} but does not implement {{#should_to_s}}. This leads to inconsistent representation of the _current_ and _to_ values when change events are reported.

The _groups_ property of a {{User}} type can for instance present changes like:
{code}
Notice: /Stage[main]/Main/User[foobar]/groups: groups changed wheel,sshd to ['mail', 'sshd', 'wheel']
{code}

*Problem 2.*
Since the delimiter separated list is no longer quoted by default due to the changes in PUP-7616, consequently, a list with no entries is represented as an empty string. Adding the first group to a user looks like this:
{code}
Notice: /Stage[main]/Main/User[foobar]/groups: groups changed  to ['wheel']
{code}

The methods {{#is_to_s}} and {{#should_to_s}} should be implemented the same way and we need to make a decision on the representation.

*Alternative 1.*
The property is changed to rely on default behavior (i.e. the special {{#is_to_s}} is simply removed. The result will then be that both values are represented as bracketed arrays and that the current _delimiter_ property is rendered useless. The above changes would then instead look like:
{code}
groups changed ['sshd', 'wheel'] to ['mail', 'sshd', 'wheel']
groups changed [] to ['wheel']
{code}

*Alternative 2.*
A {{#should_to_s}} is added that is equal to {{#is_to_s}}. Both methods present a list of entries joined by the given delimiter. This list must then be quoted to avoid problem #2. The changes would then be presented as:
{code}
groups changed 'sshd,wheel' to 'mail,sshd,wheel'
groups changed '' to 'wheel'
{code}
While this alternative vouches for a more compact presentation, it is also problematic. {{List}} is abstract and used as the parent of by many properties. The presentation will look strange if one or several entries contain:
# the delimiter
# a single quote
# a complex object

The presentation is also different from how the property is presented by commands like {{puppet resource}}, which always uses the bracketed array.",Bug,PUP-7640,[],Property::List is inconsistent with respect to #is_to_s and #should_to_s
"`puppet config print certname` appears to read from the [main] section of puppet.conf only, and if certname is not set in that section it defaults to the FQDN of the system.

To test:
1. Spin up a blank box.
2. Create puppet.conf and set the certname to something other than the FQDN.
3. Install the agent, confirming that the certname has been set to something other than the FQDN.
4. Run `puppet config print certname` and compare to expected output.

Additionally:
1. Open puppet.conf, and if certname is set in [main] comment it out.
2. Add a unique certname value to the [agent] section and save and close the file.
3. Run 'puppet config print certname' and compare to expected output.
4. Run 'puppet config print --section=agent` and compare.
5. Repeat for any other sections, such as [master].",Bug,PUP-7638,[],"`puppet config print certname` only reads from [main], defaults to FQDN if no value is in [main]"
"In order to avoid having to build a puppet-agent package in the puppet component pipeline, we would like to switch to using {{ci:test:git}} in the integration step of the pipeline. This will clone puppet and run the tests on the test target standalone. We should still be able to run the same test subsets we usually run.",Task,PUP-7637,[],Switch to using ci:test:git for puppet component integration tests
"Switching to using {{ci:test:git}} to run some acceptance tests in the Puppet component pipeline entails that we will also be testing in an environment that is highly dependent on the OS under test, because {{ci:test:git}} does not install and run against an Agent package. 

We need to determine which OSes it makes the most sense to run these smoke tests on, taking into account the state of the existing pooler images (e.g. what Ruby version do they have?) and what that means in terms of the feedback it gives us. We then need to weigh how much work it would be to get {{ci:test:git}} working reliably on the platforms we currently use (for example, I believe it's fairly broken on redhat6 right now, which is one of the platforms we currently test in the puppet component pipeline) against what we might lose (or gain) by switching to an alternative OS that could give us the same kind of feedback.",Task,PUP-7636,[],Determine list of platforms for puppet component smoke testing with ci:test:git
"I'm trying to create a custom service provider to be distributed with a module. I don't want it to ever be selected as the default service provider, but it's *always* selected as the default over the debian provider. Here is a trivial test case for the service provider:

{code:java}
Puppet::Type.type(:service).provide :testdefaultservice, :parent => :init do
  def startcmd
    [ ""/bin/true"" ]
  end

  def stopcmd
    [ ""/bin/true"" ]
  end

  def restartcmd
    [ ""/bin/true"" ]
  end  

  def statuscmd
    [ ""/bin/true"" ]
  end
end
{code}

I get this warning from puppet agent:
{noformat}
Warning: Found multiple default providers for service: testdefaultservice, debian; using testdefaultservice
{noformat}

Note that my test case contains no ""defaultfor"" statements (unlike the debian service provider) and its parent is init, which is the same as the debian service provider, so it should be at the same level of specificity.

So, why is it being chosen as the default?


",Bug,PUP-7635,[],Custom service provider is always selected as default
"This will mean:
*  adding config print to puppet device. 
*  enabling the last_run_report for puppet device.",Improvement,PUP-7634,[],Puppet device - make it threadable
"In an organization that has security compliance issues there is the need to show that parameters set in a module are final.

This means that regular use of hiera data in a sensitive module can not be used because all of the parameters defined that way can be overridden in the environment and global layers.

The author of a module would however like to use hierarchical data and integration with hiera backends and construct the logic with APL. 

Since this is not possible, the current work around is to write custom functions that read data files in yaml, and/or call custom functions to get data from external sources. These do not work with APL. Alternatively the user is stuck with params.pp and defining the values in code.

The features we have proposed for partial ordering of layers etc. do not help as they all allow for overrides to be made outside of the control of the module.

We have a similar use case in MEEP where a completely private hierarchy is needed.

I can imagine that part of the solution is to support {{private}} defines and classes and to specify that those may not have their parameters bound in higher layers (i.e their bindings in hiera are private and final in the module). To make them configurable they would need to have public wrappers that define the API for the public (and variable) subset the module supports.
Such a solution seems more appealing than trying to come up with a mechanism for a private layer or by trying to work in specification of ""final"" declarations in keys in the hiera data.

More user research is needed to see if that is a workable solution. It seems reasonable to assume that it should not be possible to provide arguments to private defines and classes as they are indeed private and can only be instantiated by the module they are private too.

(In addition, work is needed to prevent overrides to take place using collections).",Story,PUP-7633,[],need to show that module config cannot be overridden
"Hi,

the FreeBSD package providers ""ports"" and ""portupgrade"" are outdated as they use ""pkg_info"" instead of ""pkg info"":

https://wiki.freebsd.org/pkgng

I would like to offer my support here but due to the lack of ruby knowledge I cannot do this myself.

My current workaround is to create /usr/sbin/pkg_info with the following content:


{code:shell}
#!/bin/sh
CMD=""$(echo ${@} | sed -e 's#Q#q#g' -e 's#O#o#g')""
/usr/sbin/pkg info ${CMD}
{code}

Helmut",Improvement,PUP-7632,"['freebsd', 'help_wanted', 'package', 'triaged', 'type_and_provider']",FreeBSD package providers are outdated
"Failure on puppet/master:

https://jenkins-master-prod-1.delivery.puppetlabs.net/job/platform_puppet_intn-van-sys_master/337/SLAVE_LABEL=beaker,TEST_TARGET=redhat7-64m-redhat6-64a,UNEEDED=UNEEDED/testReport/junit/(root)/tests_resource_package/yum_rb/

{quote}
Expected /Package\[guid\]\/ensure:\ change\ from\ purged\ to\ 1\.1\ failed/ to match ""redhat6-64-1: \e[1;31mError: Could not update: Execution of '/usr/bin/yum -d 0 -e 0 -y install guid-1.1' returned 1: Error: Nothing to do\e[0m\n\e[1;31mError: /Stage[main]/Main/Package[guid]/ensure: change from 'purged' to '1.1' failed: Could not update: Execution of '/usr/bin/yum -d 0 -e 0 -y install guid-1.1' returned 1: Error: Nothing to do\e[0m\n"".
{quote}

Difference appears to be quoted vs unquoted values.

",CI Blocker,PUP-7631,[],Acceptance failure on unquoted resource change values 
"It's possible to get a successful agent run report that on closer inspection include errors.

For instance, an error points to a failure with the Chocolatey provider. Because the provider failed out, it did not return a complete list of resources to manage, and the agent run completes successfully on this smaller catalog without raising an alarm.

There is no way for an administrator to notice this problem and correct it without drilling down into green agent reports to confirm whether an error has occurred or not. On large scale deployments this solution rapidly becomes unmanageable.

Agent runs need to return some condition when providers fail that highlights that this has occurred. There needs to be a scaleable way to monitor and report on this kind of failure.

Please add all errors and warnings for consideration as failed run status assignment criteria [here|https://docs.google.com/document/d/1PKLzYYPyPVt0pKS4Fc6r-1BbDAfK8eFOmTICcgT5gQ4/edit?usp=sharing].",Bug,PUP-7630,[],"""Successful"" puppet agent reports hide provider errors"
"h1. The Problem

When setting environment_timeout to unlimited there is an expectation that all code and hieradata be loaded into memory and not re-read from disk until the environment cache is flushed. 

If you change a puppet manifest on disk after it has been loaded into the puppet master the puppet master will not read that manifest.  

However, if you change a hiera data file on disk after it has been loaded by the puppet master it will still be re-read from disk and immediately affect catalog compilation.  

h1.  Suggested Solution 

These two things are not congruent.  Either all files in the $codedir should be cached until the environment cache is flush or none of the files should be cached.  

h1.  Performance Benefit

There is presumably a performance benefit to be had from loading hieradata once and then never having to recheck files on disk until the cache is flushed.  ",Bug,PUP-7629,[],Hieradata should be loaded and cached in accordance with the environment_timeout
"When promoting a Puppet agent to a compile master, that agent must be in the production environment (as per puppet.conf) or the promotion process will fail. The failure is caused by the puppetserver failing to load jrubies because the configured directory environment does not exist.

{code}
2017-06-05 11:38:05,412 INFO  [async-dispatch-2] [p.t.s.w.jetty9-service] Initializing web server(s).

2017-06-05 11:38:05,573 INFO  [async-dispatch-2] [p.t.s.s.status-service] Registering status callbackfunction for service 'broker-service', version 1.3.1
2017-06-05 11:38:05,582 INFO  [async-dispatch-2] [p.t.s.s.status-service] Registering status callbackfunction for service 'pe-puppet-profiler', version 2017.2.0.8
2017-06-05 11:38:05,584 INFO  [async-dispatch-2] [p.s.j.jruby-puppet-service] Initializing the JRuby service
2017-06-05 11:38:05,602 INFO  [async-dispatch-2] [p.s.j.jruby-pool-manager-service] Initializing the JRuby service
2017-06-05 11:38:05,629 INFO  [clojure-agent-send-pool-0] [p.s.j.i.jruby-internal] Creating JRubyInstance with id 1.
2017-06-05 11:38:17,492 WARN  [clojure-agent-send-pool-0] [puppetserver] Puppet Support for ruby version 1.9.3 is deprecated and will be removed in a future release. See https://docs.puppet.com/puppet/latest/system_requirements.html#ruby for a list of supported ruby versions.
   (at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:168:in `Puppet')
2017-06-05 11:38:17,547 INFO  [clojure-agent-send-pool-0] [puppetserver] Puppet Puppet settings initialized; run mode: master
2017-06-05 11:38:17,553 ERROR [clojure-agent-send-pool-0] [p.t.internal] shutdown-on-error triggered because of exception!
java.lang.IllegalStateException: There was a problem adding a JRubyInstance to the pool.
        at puppetlabs.services.jruby_pool_manager.impl.jruby_agents$eval40441$prime_pool_BANG___40446$fn__40450.invoke(jruby_agents.clj:65)
        at puppetlabs.services.jruby_pool_manager.impl.jruby_agents$eval40441$prime_pool_BANG___40446.invoke(jruby_agents.clj:46)
        at puppetlabs.services.jruby_pool_manager.impl.jruby_agents$eval40638$send_prime_pool_BANG___40643$fn__40644$fn__40645.invoke(jruby_agents.clj:186)
        at puppetlabs.trapperkeeper.internal$shutdown_on_error_STAR_.invokeStatic(internal.clj:393)
        at puppetlabs.trapperkeeper.internal$shutdown_on_error_STAR_.invoke(internal.clj:368)
        at puppetlabs.trapperkeeper.internal$shutdown_on_error_STAR_.invokeStatic(internal.clj:378)
        at puppetlabs.trapperkeeper.internal$shutdown_on_error_STAR_.invoke(internal.clj:368)
        at puppetlabs.trapperkeeper.internal$eval14185$shutdown_service__14190$fn$reify__14192$service_fnk__5261__auto___positional$reify__14197.shutdown_on_error(internal.clj:433)
        at puppetlabs.trapperkeeper.internal$eval14115$fn__14127$G__14107__14135.invoke(internal.clj:401)
        at puppetlabs.trapperkeeper.internal$eval14115$fn__14127$G__14106__14144.invoke(internal.clj:401)
        at clojure.core$partial$fn__4759.invoke(core.clj:2516)
        at clojure.core$partial$fn__4759.invoke(core.clj:2515)
        at puppetlabs.services.jruby_pool_manager.impl.jruby_agents$eval40416$send_agent__40421$fn__40422$agent_fn__40423.invoke(jruby_agents.clj:40)
        at clojure.core$binding_conveyor_fn$fn__4676.invoke(core.clj:1941)
        at clojure.lang.AFn.applyToHelper(AFn.java:154)
        at clojure.lang.RestFn.applyTo(RestFn.java:132)
        at clojure.lang.Agent$Action.doRun(Agent.java:114)
        at clojure.lang.Agent$Action.run(Agent.java:163)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:748)
Caused by: org.jruby.embed.InvokeFailedException: (EnvironmentNotFound) Could not find a directory environment named 'scaling_upgrade' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?
        at org.jruby.embed.internal.EmbedRubyObjectAdapterImpl.call(EmbedRubyObjectAdapterImpl.java:318)
        at org.jruby.embed.internal.EmbedRubyObjectAdapterImpl.callMethod(EmbedRubyObjectAdapterImpl.java:170)
        at org.jruby.embed.ScriptingContainer.callMethod(ScriptingContainer.java:1528)
        at com.puppetlabs.jruby_utils.jruby.ScriptingContainer.callMethodWithArgArray(ScriptingContainer.java:33)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)
        at clojure.lang.Reflector.invokeInstanceMethod(Reflector.java:28)
        at puppetlabs.services.jruby.jruby_puppet_core$eval41825$get_initialize_pool_instance_fn__41830$fn__41831$fn__41832.invoke(jruby_puppet_core.clj:133)
        at puppetlabs.services.jruby_pool_manager.impl.jruby_internal$eval40051$create_pool_instance_BANG___40056$fn__40057.invoke(jruby_internal.clj:131)
        at puppetlabs.services.jruby_pool_manager.impl.jruby_internal$eval40051$create_pool_instance_BANG___40056.invoke(jruby_internal.clj:109)
        at puppetlabs.services.jruby_pool_manager.impl.jruby_agents$eval40441$prime_pool_BANG___40446$fn__404
{code}

Why does this need to be a hard requirement? There doesn't even need to be anything in the folder, it just has to exist.",Bug,PUP-7628,[],Cannot run puppet commands or startup master when environment directory missing
"I was investigating why [~david.schmitt] and I were getting different results from `Puppet::FileSystem.symlink` on Windows. His VM was correctly reporting an error and mine was silently failing.

When run as a non-administrator user on my VM, `CreateSymbolicLinkW` would return non-zero (success for this function) when it should have failed. Going through the MSDN docs, I noticed that it returns a 1 byte `BOOLEAN` rather than the 4 byte `BOOL` that it is currently prototyped for with FFI (so I was getting a value with random data in the 3 upper bytes).

Changing the FFI prototype for the function over to returning an `int8` resolved the problem for me (see linked PR).",Bug,PUP-7627,"['resolved-issue-added', 'windows']",CreateSymbolicLinkW returns the wrong data type
"Hi together, 

it seems the problem described in https://projects.puppetlabs.com/issues/5405 , which sadly has been closed without any change to the sources, is still valid for 4.10.1. 

In short, ext/logcheck/puppet should be changed like: 
{noformat}
-^\w{3} [ :0-9]{11} [._[:alnum:]-]+ puppet-master\[[0-9]+\]: Compiled catalog for [._[:alnum:]-]+ in [.0-9]+ seconds$
+^\w{3} [ :0-9]{11} [._[:alnum:]-]+ puppet-master\[[0-9]+\]: Compiled catalog for [._[:alnum:]-]+ in environment [._[:alnum:]-]+ in [.[:digit:]]+ seconds$
{noformat}
Debian downstream is still patching the package accordingly. Sadly, this patch did not make it upstream (i.e. ""here""). 

Cheers, Oliver",Bug,PUP-7625,['resolved-issue-added'], puppet-master logcheck rule needs adjustment
"Log messages created and displayed by puppet are no longer displaying certain characters in the UTF-8 format. Common symbols such as '@' and '#' are displayed fine but any character not native to the english language seems to be replaced with a variation of '\u{4E07}'.
The characters are shown and stored correctly when set as such, and the problem seems to be unique to information generated by puppet itself and after further attention it seems as though this problem originates from the puppet language itself.
Please view the attached file for an example of a set of reports where this problem has occurred.",Bug,PUP-7624,['utf-8'],Log Messages no longer register certain characters in the UTF-8 format
"The error message is:

{noformat}
Error: Parameter 'require' is already set on Package[pip] by #<Puppet::Resource::Type:0x005570c96bc260> at /home/branan/.puppetlabs/etc/code/environments/production/modules/foo/manifests/init.pp:4; cannot redefine at /home/branan/.puppetlabs/etc/code/environments/production/site.pp:1 on node rycon.delivery.puppetlabs.net
{noformat}

This was discovered while Ops was trying to upgrade to a pre-release hoyt build.

See the attached tarball for a minimal reproduction. This is an environment that can be untarred into a code dir and verified with {{puppet apply --debug --noop $CODEDIR/environments/repro/site.pp}}. The error only occurs when the resource override is in place. If the overridden parameters are inlined into the resource declaration, it works as expected.

This was apparently introduced as part of PUP-7484, and is in general related to the PUP-25 work.

According to a bisect, the breaking commit is 38413cd78c61fe34d2ee343ef773a07b4786f65a",Bug,PUP-7623,[],Resource defaults and resource overrides can lead to incorrect parameter conflicts
"The {{puppet/acceptance/tests/modules/build/build_agent.rb}} test failed due to a pre-existing directory that conflicted with the test.

This may have been caused by the test environment not being properly reset prior to the run. However, this situation can be guarded against by using a temporary directory for the test rather than relying creating test artifacts in the {{$HOME}} directory on the SUT.

Error:
{code}
      Begin tests/modules/build/build_agent.rb
      
      puppet module build (agent)
      
      * generate
      
      sol10-1.delivery.puppetlabs.net (solaris10-SPARC-1) 01:24:34$ puppet module generate foo-bar --skip-interview
        Error: /bar already exists.
        Error: Try 'puppet help module generate' for usage
      
      sol10-1.delivery.puppetlabs.net (solaris10-SPARC-1) executed in 6.96 seconds
      Exited: 1
      Beaker::Host::CommandFailure: Host 'sol10-1.delivery.puppetlabs.net' exited with 1 running:
       puppet module generate foo-bar --skip-interview
      Last 10 lines of output were:
      	Error: /bar already exists.
      	Error: Try 'puppet help module generate' for usage
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/host.rb:373
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/dsl/helpers/host_helpers.rb:83
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/shared/host_manager.rb:127
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/dsl/patterns.rb:37
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/dsl/helpers/host_helpers.rb:63
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/tests/modules/build/build_agent.rb:9
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/tests/modules/build/build_agent.rb:3
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/tests/modules/build/build_agent.rb:3
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/test_case.rb:133
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/test_case.rb:133
      /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/test_case.rb:130
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/test_suite.rb:325
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/test_suite.rb:322
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/test_suite.rb:322
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/test_suite.rb:371
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/cli.rb:205
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/lib/beaker/cli.rb:131
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/gems/beaker-3.14.0/bin/beaker:9
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/bin/beaker:23
      /tmp/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris10-SPARCfa%7Bhypervisor=none%2Cvmhostname=sol10-1.delivery.puppetlabs.net%7D/puppet/acceptance/.bundle/gems/bin/beaker:23
      Begin teardown
      
      sol10-1.delivery.puppetlabs.net (solaris10-SPARC-1) 01:24:41$ rm -rf bar
      
      sol10-1.delivery.puppetlabs.net (solaris10-SPARC-1) executed in 0.05 seconds
      End teardown
{code}

[Job link|https://jenkins-master-prod-1.delivery.puppetlabs.net/view/puppet-agent/view/stable/view/Hardware/job/platform_puppet-agent_intn-van-sys_suite-hardware-puppet-stable/27/]",CI Blocker,PUP-7621,[],pmt acceptance test fails due to pre-existing directory
"The stdlib {{unique}} function can only process {{String}} and {{Array}} values and it is not possible to influence the comparison (it is always a Ruby == operation).

The {{unique}} function is really intrinsic to collections and iterators and it makes sense for it to be in Puppet instead of stdlib.

* For {{String}} and {{Array}} the function must be compatible with the stdlib version
* The function should handle all {{Iterables}}
* It should be possible to give the function a lambda that computes the value to do the equality/uniqueness check on.
* For {{Hash}} the result should be a hash with associations between the sets of keys that all have values that are computed to be equal (by the built in == or by a given lambda) and the set of those values.
",Improvement,PUP-7620,[],Add a `unique` function that works with all kinds of iterables
"By adding a function `convert_to` that takes a value and a type in the reverse order from the `new` function sequences of transformations becomes easier to read.

Instead of:
{code:puppet}
Hash(Array(""abc"").map |$i,$v| { [$i, $v]})
{code}
 
It is possible to write:
{code:puppet}
""abc"".convert_to(Array).map |$i,$v| { [$i, $v]}.convert_to(Hash)
{code}",Improvement,PUP-7619,[],Add a `convert_to` function that works like `new` but with type arg as second arg
"In Puppet 5 we will be switching from using PSON by default to JSON.  This requires that various interactions are validated to work as we expect them to.  Here are the rough notes put together but [~john.duarte] and myself based on a meeting we had with [~josh]

{code}
Agent     <-       Server      <-      Database
      node info             
      catalog               
      file meta data        
      
Agent     ->       Server       ->      Database        
      facts                 facts
      reports               catalog
                            reports
                            
------------------------------------
 v5                 v5                     v5
A: json                                                    (covered in CI)
B: fallback to pson catalog only (with binary data)        (needs beaker testing) (John) (PUP-7681)
C: --preferred serialization format=pson on Agent          (needs beaker testing) (John) (PUP-7729)
F: cached cat -> Always send json with escaped characters  (needs beaker testing) (John) (PUP-7730)
------------------------------------
 v3/4               v5                     v5
D: pson                                                    (covered in PE upgrade testing)
F: cached cat -> Always send pson with escaped characters  (manual) (Stan)
------------------------------------
v5                 v4                      v4
E: pson                                                    (expected downgrade to pson)  (Stan)
F: cached cat -> Always send json with escaped characters  (expected graceful failure) (manual) (Stan)
{code}",Task,PUP-7618,[],PSON -> JSON Testing
"If there happens to be any leftover files from older PE installations, it will cause the PE 2017.2.1 installation to fail because Puppet will end up pulling the wrong locale path:


{code:java}
2017-05-29 14:42:51,320 Running command: /opt/puppetlabs/puppet/bin/puppet infrastructure configure  --detailed-exitcodes --modulepath /opt/puppetlabs/server/data/enterprise/modules 
/opt/puppetlabs/puppet/lib/ruby/2.1.0/psych.rb:464:in `initialize': No such file or directory @ rb_sysopen - /opt/puppet/share/locale/config.yaml (Errno::ENOENT)
	from /opt/puppetlabs/puppet/lib/ruby/2.1.0/psych.rb:464:in `open'
	from /opt/puppetlabs/puppet/lib/ruby/2.1.0/psych.rb:464:in `load_file'
	from /opt/puppetlabs/puppet/lib/ruby/gems/2.1.0/gems/gettext-setup-0.20/lib/gettext-setup/gettext_setup.rb:21:in `initialize'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:80:in `singleton class'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:55:in `<module:Puppet>'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:49:in `<top (required)>'
	from /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'
	from /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'
	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:12:in `<top (required)>'
	from /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'
	from /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'
	from /opt/puppetlabs/puppet/bin/puppet:4:in `<main>'
* /opt/puppetlabs/puppet/bin/puppet infrastructure configure  --detailed-exitcodes --modulepath /opt/puppetlabs/server/data/enterprise/modules 
* returned: 1
{code}

This appears to be due to how Puppet searches for the locale directory in https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L56-L73.  https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L60 will set {{posix_system_locale_path}} to {{/opt/puppetlabs/puppet/share/locale}}, which is the correct path.  The problem is that https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L62 runs regardless of the Puppet master not being a Windows machine and sets {{win32_system_locale_path}} to {{/opt/puppet/share/locale/config.yaml}} (because that would be /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/../../../../../puppet/share/locale).

Since {{win32_system_locale_path}} is checked before {{posix_system_locale_path}} in the if/else block at https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L64-L73, the ""windows"" path will be used.  If the old directory still exists, this path gets passed to GettextSetup, which leads to the failure.

I'd think the fix would be to add logic to https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L68 to check if we are actually on a Windows system 

or

Move the {{posix_system_locale_path}} check above the {{win32_system_locale_path}} one in the if/else block.",Bug,PUP-7617,"['maintenance', 'triage']",Leftover /opt/puppet contents cause upgrades to fail on locale/config.yaml
"The method {{Puppet::Property#change_to_s}}, which is used when constructing the message of an event, is broken. It calls the methods {{#is_to_s}} and {{#should_to_s}} to convert values to their string form and then calls {{#format_value_for_display}} to convert that string again.

Sometimes this almost works since the default implementation of the method {{#is_to_s}} just returns it's argument untouched (the documentation states that it produces a ""pretty printing string"", but it doesn't) so that two wrongs ends up as one right. The default for {{#should_to_s}} will however always convert its argument using default ruby string conversion (it converts to an array and joins with space).

This should be fixed so that the {{#change_to_s}} just calls {{#is_to_s}} and {{#should_to_s}} and the default implementation them then calls {{#format_value_for_display}}.",Bug,PUP-7616,['resolved-issue-added'],Fix broken implementation of Property#change_to_s method
"when invoking 
{code}
$ puppet facts (and various utils)
Warning: vosp_wls has an invalid and unparsable metadata.json file. The parse error: 399: unexpected token at '],
  ""data_provider"": null
}
'
Warning: wls_helpers has an invalid and unparsable metadata.json file. The parse error: 399: unexpected token at '{""name"":""puppetlabs-lvm"",""version_requirement"":"">= 0.7.0""}
  ],
  ""data_provider"": null
}
'
Warning: vosp_wls has an invalid and unparsable metadata.json file. The parse error: 399: unexpected token at '],
  ""data_provider"": null
}
'
Warning: wls_helpers has an invalid and unparsable metadata.json file. The parse error: 399: unexpected token at '{""name"":""puppetlabs-lvm"",""version_requirement"":"">= 0.7.0""}
  ],
  ""data_provider"": null
}
'
{code}
These appear to be bleed from what I would expect in puppet module list can or should these be quashed in other utilities.",Improvement,PUP-7615,[],puppet command leaks module command issues.
"$puppet --help
generates the following list 
Usage: puppet <subcommand> [options] <action> [options]

Available subcommands:
    
  agent             The puppet agent daemon
  apply             Apply Puppet manifests locally
  ca                Local Puppet Certificate Authority management.
  catalog           Compile, save, view, and convert catalogs.
  cert              Manage certificates and requests
  certificate       Provide access to the CA for certificate management.
  certificate_request  Manage certificate requests.
  certificate_revocation_list  Manage the list of revoked certificates.
  config            Interact with Puppet's settings.
  describe          Display help about resource types
  device            Manage remote network devices
  doc               Generate Puppet references
  enterprise        Commands to facilitate support of Puppet Enterprise.
  epp               Interact directly with the EPP template parser/renderer.
  facts             Retrieve and store facts.
  file              Retrieve and store files in a filebucket
  filebucket        Store and retrieve files in a filebucket
  generate          Generates Puppet code from Ruby definitions.
  help              Display Puppet help.
  inspect           Send an inspection report
  key               Create, save, and remove certificate keys.
  license           
  lookup            Data in modules lookup function
  man               Display Puppet manual pages.
  master            The puppet master daemon
  module            Creates, installs and searches for modules on the Puppet Forge.
  node              View and manage node definitions.
  parser            Interact directly with the parser.
  plugin            Interact with the Puppet plugin system.
  report            Create, display, and submit reports.
  resource          The resource abstraction layer shell
  resource_type     View classes, defined resource types, and nodes from all manifests.
  status            View puppet server status.
  type              

See 'puppet help <subcommand> <action>' for help on a specific subcommand action.
See 'puppet help <subcommand>' for help on a specific subcommand.
Puppet v4.8.1


Job
access
app
db
infrapuppet 
query

All do not appear in the list as expected behaviour.",Bug,PUP-7614,[],"'puppet help' does not provide entries for job, access or app "
"Fedora < 24 are now end-of-life.  Fedora has used dnf as the default package manager since Fedora 22 (and it's been an option since Fedora 18).

Every new Fedora release requires a commit to add the new version as a default for that version; but it is now an entrenched default and is the established successor to yum.  People who want other behavior can still override the default if they wish.

I'll submit a PR.",Improvement,PUP-7613,[],DNF should be default package provider for Fedora
"With the fix of PUP-7594, it is now possible to use hashes with integer keys in Hiera. Those keys can however not be navigated using a dotted key with integer numbers in it. I.e.
{code:yaml}
ports:
  80:
    test: test
{code}
cannot be navigated using the key 'ports.80'. This is because integers in dotted keys are presumed to be positional indexes in arrays, not keys in hashes.

It should be possible to navigate a hash containing integer keys. A hash containing strings that represent integers should also be possible to navigate, but then, the integer in the dotted key must be quoted. E.g.
{code:yaml}
ports:
  ""80"":
    test: test
{code}
should not be found by key {{ports.80}}. Instead, {{ports.'80'}} must be used.
",Bug,PUP-7612,['resolved-issue-added'],It is impossible to navigate an integer keyed Hiera hash using dotted keys
"There are a few different issues with how {{warn_once}} is implemented that prevent deprecation warnings from being silenced.

# There are typos, e.g. {{deprecatation}}
# We use both symbols and strings:
{noformat}
Puppet.warn_once('deprecation', 'AST::ResourceParam', _('Use of Puppet::Parser::AST::ResourceParam is deprecated and not fully functional'))
Puppet.warn_once(:deprecation, ""metadata.json#data_provider-#{module_name}"",
{noformat}
# The {{warn_once}} logic doesn't account for string vs symbol, which probably wasn't a problem before we removed the symbol string monkey_patch:
{code:ruby}
    return if Puppet[:disable_warnings].include?(kind)
{code}
# The {{disable_warnings}} setting only accepts plural {{deprecations}}, but all of the {{warn_once}} call sites use singular {{deprecation}}, so the {{include?}} check never matches
# There is another {{warnonce}} method defined in {{Puppet::Util::Warnings}}.

But the main issue is that you can't turn deprecations off:

{code:puppet}
notify { '1':
  message => strftime(""%s"")
}
notify { '2':
  message => strftime(""%s"")
}
{code}

{noformat}
$ bundle exec puppet apply warnings.pp --disable_warnings deprecations
/Users/josh/work/puppet/.bundle/ruby/2.4.0/gems/CFPropertyList-2.2.8/lib/cfpropertylist/rbCFTypes.rb:24: warning: constant ::Fixnum is deprecated
Warning: The argument signature (String format, [String timezone]) is deprecated for #strfime. See #strftime documentation and Timespan type for more info
   (file & line not available)
Notice: Compiled catalog for chara.corp.puppetlabs.net in environment production in 0.02 seconds
Notice: 1496267306
Notice: /Stage[main]/Main/Notify[1]/message: defined 'message' as '1496267306'
Notice: 1496267306
Notice: /Stage[main]/Main/Notify[2]/message: defined 'message' as '1496267306'
Notice: 1496267306
{noformat}


",Bug,PUP-7611,['resolved-issue-added'],Can't turn off deprecation warnings
Make the configurable error for {{@class}} and {{@@class}} added in PUP-1606 always be a hard error in Puppet 6.0.0.,Bug,PUP-7609,[],Make  @class and @@class always be a hard error
"The {{lookup}} function with a unique merge doesn't seem to deduplicate when there is only one layer of Hiera that the key appears in.

For example, when I run this:
{noformat}
puppet lookup people::tags --merge unique
---
- syseng
- syseng-identity_dev
- identity
- identity-dev
- identity
- identity-identity_dev
{noformat}

If I add the key with {{identity}} to another layer I get
{noformat}
---
- identity
- syseng
- syseng-identity_dev
- identity-dev
- identity-identity_dev
{noformat}",Bug,PUP-7608,['resolved-issue-added'],Lookup unique merge doesn't deduplicate with a single layer
"The PuppetDB terminus breaks *all the time* due to changes in Puppet. Most of these are fairly small issues, but they take a significant amount of time to diagnose and fix. We need to just admit to ourselves that the terminus is fundamentally part of puppet and put the code where belongs. 

An alternate acceptable solution would be to define a solid data-based api for the terminus to use. But that seems like a ton of unnecessary extra work, as we already have a reasonable API on the network side and are going to be working on formalizing that in the near future. ",Improvement,PUP-7606,[],Pull the PuppetDB terminus into Puppet
"When calling catalog.resource(type, title) with the string ""main"" as the title parameter, it doesn't return a resource in the catalog with that title. It appears that title is getting passed through resource.munge_type_name(), which had a special case for :main that doesn't kick in now we're using the stringified data from to_hash. 

This is triggered by PUP commit 7bbe36774; this returns title as a string in to_data_hash, where it used to be a symbol somtimes. The PDB terminus in turns calls catalog_resource with this, which then returns nil.",Bug,PUP-7605,[],"catalog.resource() doesn't accept ""main"" as a title parameter"
"The AIX provider for the {{group}} resource type produces a String instead of a Numeric value for the {{gid}} attribute. 

This was found when working with PUP-7155.",Bug,PUP-7604,"['aix', 'group', 'triaged', 'type_and_provider']",The AIX 'group' provider should not quote 'gid' (it is supposed to be numeric)
"The `StringConverter`, when converting strings to their '%p' format, will currently use double quotes in many cases where it is unnecessary. In essence, the only time that double qoutes are needed when producing a string, is when the string contains control characters (codepoint < 0x20) or non-ascii characters (codepoint > 0x7f). In all other cases, it's desirable to use single quotes since the representation gets more compact and is more efficient to parse.",Bug,PUP-7603,[],StringConverter should be more diligent about using single quotes 
"If the catalog contains binary content, then the master won't be able to serialize it to json, generating an HTTP 500 error. To make it easy to migrate to Puppet 5, the master should detect when there is an encoding error when serializing the catalog, and downgrade to {{pson}}. It should also emit the correct mime-type.

The agent should still be able to cache the catalog (as PSON), and later load the catalog and apply, e.g. {{puppet agent -t --use_cached_catalog}}.

This issue is blocking puppetdb tests because they verify binary file content transfer from agent to server to puppetdb.",Bug,PUP-7602,[],"If the catalog contains binary content, the server should downgrade to pson"
"This blurb from the LDAP Node Terminus documentation says it all:

{quote}
OK: We're very sorry about this, but documentation for how variables work with LDAP has been basically lost to time. The document we inherited from the wiki was very unclear about all this, and we can't budget the time to set up a test environment and confirm it. We don't even know if anyone is using this terminus anymore, to be honest.
{quote}

The docs practically beg users to switch to use hiera instead. We believe very few users are using this terminus, and we should deprecate it to avoid new users coming across it and feeling our pain.",Task,PUP-7601,[],Remove built-in LDAP Node Terminus
"This blurb from the LDAP Node Terminus documentation says it all:

{quote}
OK: We’re very sorry about this, but documentation for how variables work with LDAP has been basically lost to time. The document we inherited from the wiki was very unclear about all this, and we can’t budget the time to set up a test environment and confirm it. We don’t even know if anyone is using this terminus anymore, to be honest.
{quote}

The docs practically beg users to switch to use hiera instead. We believe very few users are using this terminus, and we should deprecate it to avoid new users coming across it and feeling our pain.",Task,PUP-7600,[],Deprecate built-in LDAP Node Terminus
The current ssh authorized keys tests assume that the login user on the SUT is root.  This works fine in most cases but fails on the Cisco Nexus because the user is 'beaker' not root.  The best solution to resolving this is to have the test detected who is logged in and assume that is the user.  The environment variable LOGNAME should be able to be used.,Task,PUP-7599,[],Acceptance: Fix authorized keys acceptance tests
"A pull request was issued and refused for this same problem back in 2.6.

https://github.com/puppetlabs/puppet/pull/829

I just spent an hour trying to figure out why my mysql database was being uninstalled.  Turns out I Percona 5.7 requires percona-xtrabackup-24 which conflicts with percona-xtrabackup.  So my manifest would install the database, then the next run it would install percona-xtrabackup which would gladly remove percona-xtrabackup-24 and package percona-xtradb-cluster-server-5.7 which required  percona-xtrabackup-24.  This, had it happened in production would have been incredibly destructive.  ",Bug,PUP-7598,"['apt', 'debian', 'linux', 'package', 'triaged', 'type_and_provider', 'ubuntu']",Apt provider silently uninstalls conflicting packages
This supports PA-1139 by adding the actual config file to the {{puppet}} repo.,Improvement,PUP-7597,[],Add hiera5 default config file to puppet
"As part of MODULES-4976 I was investigating the use of the following code snippet:
{code}
  if Puppet::Util::Platform.windows?
    config.output_stream = $stdout
    config.error_stream = $stderr
    config.formatters.each { |f| f.instance_variable_set(:@output, $stdout) }
  end
{code}

I noticed that this still exists in Puppet at;
https://github.com/puppetlabs/puppet/blob/master/spec/spec_helper.rb#L87-L96

This code was originally to get around an issue with the win32_console gem back in the Ruby 1.x days.

https://github.com/puppetlabs/puppet/commit/4ffc02d22093f0b76046a51eee603932a9b14f62
and
https://github.com/puppetlabs/puppet/commit/0babce626adb2e59bf212e4272b9e088a7b559a7

As Puppet 3 is now end of life, Ruby 2.x no longer uses the win32_console gem, this code is no longer required to run specs on Windows correctly.

This ticket is track removing this from the the spec_helper
",Task,PUP-7596,[],Remove redundant Rspec settings from spec_helper.rb
"As we leverage pcore typesets for network devices, it becomes imperative that we are able to map device version to a typeset version.

Example
vendor os A 6.3.1 -> typeset v1.0.0
vendor os A 6.2.1 -> typeset v1.1.0
vendor os A 7.0.0 -> typeset v2.0.0

This work will most likely reside in the `puppet device` world, and will require some facts to do the mapping.

This ticket will most likely be a discussion point, with follow on tickets for spike/work.",New Feature,PUP-7595,[],pcore : add ability to load multiple versions of the same typeset
"Puppet 4.9+ currently converts hiera hash elements into strings unconditiionally. YAML.load_file() will deserialize say an Integer to a ruby Fixnum, but the function symkeys_to_string converts every key to a string, regardless of whether it is a symbol.

Here is a simple example:
{code}
$ports = lookup(""ports"")

$ports.each |$port, $options | {
	$port_type = type(Integer.new($port), 'generalized')
	notify { ""${port} = ${port_type}"":}
}
{code}
common.yaml:
{code}
ports:
  80:
    test: test
  443:
    test: test
{code}
And the output:
{code}
Notice: 80 = String
Notice: /Stage[main]/Main/Notify[80 = String]/message: defined 'message' as '80 = String'
Notice: 443 = String
Notice: /Stage[main]/Main/Notify[443 = String]/message: defined 'message' as '443 = String'
Notice: Applied catalog in 0.02 seconds
{code}

This is also a regression in functionality from Puppet <4.8. PR uploaded to https://github.com/puppetlabs/puppet/pull/5912",Bug,PUP-7594,"['regression', 'resolved-issue-added']",Hiera hash keys are being converted to strings recursively
"We have been seeing the following failure on AIX for over two weeks now:

{code}
failed to modify UTF-8 user comment in UTF-8 environment.
Expected /changed 'Aۿ' to 'ᚠ𠜎'/ to match ""\e[mNotice: Compiled catalog for pe-aix-61-spec.delivery.puppetlabs.net in environment production in 0.03 seconds\e[0m\n\e[0;32mInfo: Applying configuration version '1495597093'\e[0m\n\e[mNotice: /Stage[main]/Main/User[foo1347]/comment: comment changed 'AÛ¿' to 'á\u009A ð \u009C\u008E'\e[0m\n\e[mNotice: Applied catalog in 0.43 seconds\e[0m\n"".
{code}

Last passing SHA of puppet through these tests was a207e6ec2ba1d662510de3b438a21476643a45e0.

[~josh] and [~ethan] believe this might be related to work that has been going on around Etc.",Bug,PUP-7592,[],utf8_user_comments test fails on AIX
"Update the acceptance tests in puppet to allow SERVER_VERSION to be set to ""latest"" so we can pull latest puppetserver from nightlies and test against that.",Task,PUP-7591,[],Update puppet component tests to allow SERVER_VERSION=latest
"On master, a basic manifest triggers a warning for virtualizable classes, which I think is incorrect:

test.pp:

{noformat}
class a { }
class { 'a': }
{noformat}

{noformat}
$ be puppet parser validate test.pp
Warning: Classes are not virtualizable at test.pp:2:1
{noformat}

Prior to PUP-1606 being merged into master, this didn't occur. This warning does not appear to occur on the stable branch with PUP-1606, only on master with PUP-1606, so may only affect Puppet 5.",Bug,PUP-7590,[],"""Classes are not virtualizable"" warning with resource-type non-virtual class declaration"
"When a user provides values to attributes of a resource where the provider doesn't support the required features, there is a debug message raised and the action is unsuccessful.

Because the action fails, this should be something that is visible to a user.  As such, I'm proposing that the log level of the below be raised to {{error}}:

https://github.com/puppetlabs/puppet/blob/6c5b7043896977e51587df815bd8c9dbb071ace3/lib/puppet/type.rb#L771

To replicate this behaviour, use the below (I ran it on a CentOS 6 VM):

{code}
puppet apply -e 'group { ""myspecialgroup"": members => ['chad'], ensure => present, provider => groupadd }' --noop --debug
{code}

This results in the following log:
{noformat}
Debug: Caching environment 'production' (ttl = 0 sec)
Notice: Compiled catalog for centos6a.pdx.puppet.vm in environment production in 0.09 seconds
Debug: /Group[myspecialgroup]: Provider groupadd does not support features manages_members; not managing attribute members
Debug: Creating default schedules
Debug: Loaded state in 0.02 seconds
Debug: Loaded state in 0.04 seconds
Debug: Loaded transaction store file in 0.00 seconds
Info: Applying configuration version '1495533119'
Notice: /Stage[main]/Main/Group[myspecialgroup]/ensure: current_value absent, should be present (noop)
Debug: /Group[myspecialgroup]: The container Class[Main] will propagate my refresh event
Notice: Class[Main]: Would have triggered 'refresh' from 1 events
Debug: Class[Main]: The container Stage[main] will propagate my refresh event
Notice: Stage[main]: Would have triggered 'refresh' from 1 events
Debug: Finishing transaction 39288460
Debug: Storing state
Debug: Stored state in 0.03 seconds
Notice: Applied catalog in 0.08 seconds
{noformat}

As the target state is never reached, puppet should notify the user that there has been a failure in an error message.

This ticket is based on observations in PUP-7139.",Improvement,PUP-7588,[],Types should error when provider is missing a feature for an attribute
